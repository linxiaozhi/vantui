/*! For license information please see 5861_53fb70072102071c295c.js.LICENSE.txt */
(self.webpackJsonp=self.webpackJsonp||[]).push([[5861],{"98840":function(R,C,I){"use strict";I.d(C,{"a":function(){return createCommonjsModule},"b":function(){return O},"c":function(){return F},"g":function(){return getDefaultExportFromCjs}});var w=I(99361),x=I(1858),_=I.n(x),O=void 0!==_()?_():"undefined"!=typeof window?window:void 0!==I.g?I.g:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(R){return R&&R.__esModule&&Object.prototype.hasOwnProperty.call(R,"default")?R.default:R}function createCommonjsModule(R,C,I){return R(I={"path":C,"exports":{},"require":function require(R,C){return function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},I.exports),I.exports}var F=createCommonjsModule((function(R){!function(){var C={}.hasOwnProperty;function r(){for(var R=[],I=0;I<arguments.length;I++){var x=arguments[I];if(x){var _=(0,w.Z)(x);if("string"===_||"number"===_)R.push(x);else if(Array.isArray(x)){if(x.length){var O=r.apply(null,x);O&&R.push(O)}}else if("object"===_)if(x.toString===Object.prototype.toString)for(var F in x)C.call(x,F)&&x[F]&&R.push(F);else R.push(x.toString())}}return R.join(" ")}R.exports?(r.default=r,R.exports=r):window.classNames=r}()}))},"53160":function(R,C,I){"use strict";function throttle(R,C,I){void 0===C&&(C=250);var w,x=0;return function(){for(var _=[],O=0;O<arguments.length;O++)_[O]=arguments[O];var F=I||this,P=Date.now();P-x>C?(R.apply(this,_),x=P):(clearTimeout(w),w=setTimeout((function(){x=P,R.apply(F,_)}),C))}}function debounce(R,C,I){var w;return void 0===C&&(C=250),function(){for(var x=[],_=0;_<arguments.length;_++)x[_]=arguments[_];var O=I||this;clearTimeout(w),w=setTimeout((function(){R.apply(O,x)}),C)}}I.d(C,{"d":function(){return debounce},"t":function(){return throttle}})},"35861":function(R,C,I){"use strict";I.r(C),I.d(C,{"taro_video_control":function(){return gt},"taro_video_core":function(){return mt},"taro_video_danmu":function(){return yt}});var w=I(99361),x=I(13505),_=I.n(x),O=I(96286),F=I.n(O),P=I(22583),M=I.n(P),N=I(57961),B=I.n(N),U=I(86227),G=I.n(U),j=I(71488),K=I.n(j),H=I(47834),V=I.n(H),W=I(40192),Y=I.n(W),z=I(6087),X=I.n(z),q=I(10262),Z=I.n(q),Q=I(15891),J=I.n(Q),$=I(2921),ee=I.n($),te=I(25431),re=I.n(te),ie=I(21463),ne=I.n(ie),ae=I(40453),se=I.n(ae),oe=I(85337),le=I.n(oe),ue=I(14903),ce=I.n(ue),de=I(26736),he=I.n(de),fe=I(45932),ge=I.n(fe),ve=I(9353),pe=I.n(ve),me=I(35034),ye=I.n(me),Ee=I(99879),Te=I.n(Ee),be=I(18635),Se=I.n(be),Ae=I(84191),Le=I.n(Ae),De=I(9521),Re=I.n(De),ke=I(83188),Ce=I.n(ke),Ie=I(91092),we=I.n(Ie),xe=I(5490),_e=I.n(xe),Oe=I(48621),Fe=I.n(Oe),Pe=I(81080),Me=I.n(Pe),Ne=I(91375),Be=I.n(Ne),Ue=I(82985),Ge=I.n(Ue),je=I(93963),Ke=I.n(je),He=I(81552),Ve=I.n(He),We=I(13662),Ye=I.n(We),ze=I(52015),Xe=I.n(ze),qe=I(29413),Ze=I.n(qe),Qe=I(3676),Je=I.n(Qe),$e=I(35451),et=I.n($e),tt=I(52271),rt=I.n(tt),it=I(49599),nt=I.n(it),at=I(39805),st=I.n(at),ot=I(47109),lt=I(98840),ut=I(53160),__generator=function(R,C){var I,w,x,O,P={"label":0,"sent":function sent(){if(1&x[0])throw x[1];return x[1]},"trys":[],"ops":[]};return O={"next":o(0),"throw":o(1),"return":o(2)},"function"==typeof _()&&(O[F()]=function(){return this}),O;function o(R){return function(C){return l([R,C])}}function l(_){if(I)throw new TypeError("Generator is already executing.");for(;P;)try{if(I=1,w&&(x=2&_[0]?w.return:_[0]?w.throw||((x=w.return)&&x.call(w),0):w.next)&&!(x=x.call(w,_[1])).done)return x;switch(w=0,x&&(_=[2&_[0],x.value]),_[0]){case 0:case 1:x=_;break;case 4:return P.label++,{"value":_[1],"done":!1};case 5:P.label++,w=_[1],_=[0];continue;case 7:_=P.ops.pop(),P.trys.pop();continue;default:if(!(x=P.trys,(x=x.length>0&&x[x.length-1])||6!==_[0]&&2!==_[0])){P=0;continue}if(3===_[0]&&(!x||_[1]>x[0]&&_[1]<x[3])){P.label=_[1];break}if(6===_[0]&&P.label<x[1]){P.label=x[1],x=_;break}if(x&&P.label<x[2]){P.label=x[2],P.ops.push(_);break}x[2]&&P.ops.pop(),P.trys.pop();continue}_=C.call(R,P)}catch(R){_=[6,R],w=0}finally{I=x=0}if(5&_[0])throw _[1];return{"value":_[0]?_[1]:void 0,"done":!0}}},__spreadArray=function(R,C){for(var I=0,w=C.length,x=R.length;I<w;I++,x++)R[x]=C[I];return R},ct=function formatTime(R){if(!R)return"";var C=Math.round(R%60),I=Math.round((R-C)/60);return(I<10?"0"+I:I)+":"+(C<10?"0"+C:C)},dt=function normalizeNumber(R){return Math.max(-1,Math.min(R,1))},ht="default",ft=function(){for(var R,C=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],I=["webkitEnterFullscreen","webkitExitFullscreen","webkitCurrentFullScreenElement","webkitSupportsFullscreen","fullscreenchange","fullscreenerror"],w=0,x=C.length,_={};w<x;w++)if((R=C[w])&&R[1]in document){for(w=0;w<R.length;w++)_[C[0][w]]=R[w];return _}if(!_[C[0][0]])for(ht="iOS",w=0;w<I.length;w++)_[C[0][w]]=I[w];return _}(),__awaiter$2=function(R,C,I,w){function a(R){return R instanceof I?R:new I((function(C){C(R)}))}return new(I||(I=M()))((function(I,x){function s(R){try{l(w.next(R))}catch(R){x(R)}}function o(R){try{l(w.throw(R))}catch(R){x(R)}}function l(R){R.done?I(R.value):a(R.value).then(s,o)}l((w=w.apply(R,C||[])).next())}))},gt=function(){function e(R){var C=this;(0,ot.r)(this,R),this.visible=!1,this.isDraggingProgressBall=!1,this.percentage=0,this.progressDimensions={"left":0,"width":0},this.calcPercentage=function(R){var I=R-C.progressDimensions.left;return I=Math.max(I,0),(I=Math.min(I,C.progressDimensions.width))/C.progressDimensions.width},this.onDragProgressBallStart=function(){C.isDraggingProgressBall=!0,C.hideControlsTimer&&clearTimeout(C.hideControlsTimer)},this.onClickProgress=function(R){R.stopPropagation();var I=C.calcPercentage(R.pageX);C.seekFunc(I*C.duration),C.toggleVisibility(!0)}}return e.prototype.onDocumentTouchMove=function(R){if(this.isDraggingProgressBall){var C=R.touches[0].pageX;this.percentage=this.calcPercentage(C),this.setProgressBall(this.percentage),this.setCurrentTime(this.percentage*this.duration)}},e.prototype.onDocumentTouchEnd=function(){this.isDraggingProgressBall&&(this.isDraggingProgressBall=!1,this.seekFunc(this.percentage*this.duration),this.toggleVisibility(!0))},e.prototype.setProgressBall=function(R){return __awaiter$2(this,void 0,void 0,(function(){return __generator(this,(function(C){return this.progressBallRef&&(this.progressBallRef.style.left=100*R+"%"),[2]}))}))},e.prototype.toggleVisibility=function(R){return __awaiter$2(this,void 0,void 0,(function(){var C,I=this;return __generator(this,(function(w){return(C=void 0===R?!this.visible:R)?(this.hideControlsTimer&&clearTimeout(this.hideControlsTimer),this.isPlaying&&(this.hideControlsTimer=setTimeout((function(){I.toggleVisibility(!1)}),2e3)),this.el.style.visibility="visible"):this.el.style.visibility="hidden",this.visible=!!C,[2]}))}))},e.prototype.getIsDraggingProgressBall=function(){return __awaiter$2(this,void 0,void 0,(function(){return __generator(this,(function(R){return[2,this.isDraggingProgressBall]}))}))},e.prototype.setCurrentTime=function(R){return __awaiter$2(this,void 0,void 0,(function(){return __generator(this,(function(C){return this.currentTimeRef.innerHTML=ct(R),[2]}))}))},e.prototype.render=function(){var R,C=this,I=this,w=I.controls,x=I.currentTime,_=I.duration,O=I.isPlaying,F=I.pauseFunc,P=I.playFunc,M=I.showPlayBtn,N=I.showProgress,B=ct(_);return R=M?O?(0,ot.h)("div",{"class":"taro-video-control-button taro-video-control-button-pause","onClick":F}):(0,ot.h)("div",{"class":"taro-video-control-button taro-video-control-button-play","onClick":P}):null,(0,ot.h)(ot.H,{"class":"taro-video-bar taro-video-bar-full"},w&&(0,ot.h)("div",{"class":"taro-video-controls"},R,N&&(0,ot.h)("div",{"class":"taro-video-current-time","ref":function ref(R){return C.currentTimeRef=R}},ct(x)),N&&(0,ot.h)("div",{"class":"taro-video-progress-container","onClick":this.onClickProgress},(0,ot.h)("div",{"class":"taro-video-progress","ref":function ref(R){if(R){var I=R.getBoundingClientRect();C.progressDimensions.left=I.left,C.progressDimensions.width=I.width}}},(0,ot.h)("div",{"class":"taro-video-progress-buffered","style":{"width":"100%"}}),(0,ot.h)("div",{"class":"taro-video-ball","ref":function ref(R){return C.progressBallRef=R},"onTouchStart":this.onDragProgressBallStart,"style":{"left":(B?this.currentTime/_*100:0)+"%"}},(0,ot.h)("div",{"class":"taro-video-inner"})))),N&&(0,ot.h)("div",{"class":"taro-video-duration"},B)),(0,ot.h)("slot",null))},B()(e.prototype,"el",{"get":function get(){return(0,ot.g)(this)},"enumerable":!1,"configurable":!0}),e}(),vt=(0,lt.a)((function(R,C){"undefined"!=typeof window&&function t(C,I){R.exports=I()}(lt.b,(function(){return function(R){var C={};function r(I){if(C[I])return C[I].exports;var w=C[I]={"i":I,"l":!1,"exports":{}};return R[I].call(w.exports,w,w.exports,r),w.l=!0,w.exports}return r.m=R,r.c=C,r.d=function(R,C,I){r.o(R,C)||B()(R,C,{"enumerable":!0,"get":I})},r.r=function(R){void 0!==_()&&G()&&B()(R,G(),{"value":"Module"}),B()(R,"__esModule",{"value":!0})},r.t=function(R,C){if(1&C&&(R=r(R)),8&C)return R;if(4&C&&"object"===(0,w.Z)(R)&&R&&R.__esModule)return R;var I=Object.create(null);if(r.r(I),B()(I,"default",{"enumerable":!0,"value":R}),2&C&&"string"!=typeof R)for(var x in R)r.d(I,x,function(C){return R[C]}.bind(null,x));return I},r.n=function(R){var C=R&&R.__esModule?function t(){return R.default}:function t(){return R};return r.d(C,"a",C),C},r.o=function(R,C){return Object.prototype.hasOwnProperty.call(R,C)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function node_modulesEventemitter3IndexJs(R,C,I){var w=Object.prototype.hasOwnProperty,x="~";function n(){}function s(R,C,I){this.fn=R,this.context=C,this.once=I||!1}function o(R,C,I,w,_){if("function"!=typeof I)throw new TypeError("The listener must be a function");var O=new s(I,w||R,_),F=x?x+C:C;return R._events[F]?R._events[F].fn?R._events[F]=[R._events[F],O]:R._events[F].push(O):(R._events[F]=O,R._eventsCount++),R}function l(R,C){0==--R._eventsCount?R._events=new n:delete R._events[C]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(x=!1)),u.prototype.eventNames=function e(){var R,C,I=[];if(0===this._eventsCount)return I;for(C in R=this._events)w.call(R,C)&&I.push(x?K()(C).call(C,1):C);return V()?Y()(I).call(I,V()(R)):I},u.prototype.listeners=function e(R){var C=x?x+R:R,I=this._events[C];if(!I)return[];if(I.fn)return[I.fn];for(var w=0,_=I.length,O=new Array(_);w<_;w++)O[w]=I[w].fn;return O},u.prototype.listenerCount=function e(R){var C=x?x+R:R,I=this._events[C];return I?I.fn?1:I.length:0},u.prototype.emit=function e(R,C,I,w,_,O){var F=x?x+R:R;if(!this._events[F])return!1;var P,M,N=this._events[F],B=arguments.length;if(N.fn){switch(N.once&&this.removeListener(R,N.fn,void 0,!0),B){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,C),!0;case 3:return N.fn.call(N.context,C,I),!0;case 4:return N.fn.call(N.context,C,I,w),!0;case 5:return N.fn.call(N.context,C,I,w,_),!0;case 6:return N.fn.call(N.context,C,I,w,_,O),!0}for(M=1,P=new Array(B-1);M<B;M++)P[M-1]=arguments[M];N.fn.apply(N.context,P)}else{var U,G=N.length;for(M=0;M<G;M++)switch(N[M].once&&this.removeListener(R,N[M].fn,void 0,!0),B){case 1:N[M].fn.call(N[M].context);break;case 2:N[M].fn.call(N[M].context,C);break;case 3:N[M].fn.call(N[M].context,C,I);break;case 4:N[M].fn.call(N[M].context,C,I,w);break;default:if(!P)for(U=1,P=new Array(B-1);U<B;U++)P[U-1]=arguments[U];N[M].fn.apply(N[M].context,P)}}return!0},u.prototype.on=function e(R,C,I){return o(this,R,C,I,!1)},u.prototype.once=function e(R,C,I){return o(this,R,C,I,!0)},u.prototype.removeListener=function e(R,C,I,w){var _=x?x+R:R;if(!this._events[_])return this;if(!C)return l(this,_),this;var O=this._events[_];if(O.fn)O.fn!==C||w&&!O.once||I&&O.context!==I||l(this,_);else{for(var F=0,P=[],M=O.length;F<M;F++)(O[F].fn!==C||w&&!O[F].once||I&&O[F].context!==I)&&P.push(O[F]);P.length?this._events[_]=1===P.length?P[0]:P:l(this,_)}return this},u.prototype.removeAllListeners=function e(R){var C;return R?(C=x?x+R:R,this._events[C]&&l(this,C)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=x,u.EventEmitter=u,R.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function node_modulesUrlToolkitSrcUrlToolkitJs(R,C,I){!function(C){var I=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,w=/^([^\/?#]*)([^]*)$/,x=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,O={"buildAbsoluteURL":function buildAbsoluteURL(R,C,I){if(I=I||{},R=X()(R).call(R),!(C=X()(C).call(C))){if(!I.alwaysNormalize)return R;var x=O.parseURL(R);if(!x)throw new Error("Error trying to parse base URL.");return x.path=O.normalizePath(x.path),O.buildURLFromParts(x)}var _=O.parseURL(C);if(!_)throw new Error("Error trying to parse relative URL.");if(_.scheme)return I.alwaysNormalize?(_.path=O.normalizePath(_.path),O.buildURLFromParts(_)):C;var F=O.parseURL(R);if(!F)throw new Error("Error trying to parse base URL.");if(!F.netLoc&&F.path&&"/"!==F.path[0]){var P=w.exec(F.path);F.netLoc=P[1],F.path=P[2]}F.netLoc&&!F.path&&(F.path="/");var M={"scheme":F.scheme,"netLoc":_.netLoc,"path":null,"params":_.params,"query":_.query,"fragment":_.fragment};if(!_.netLoc&&(M.netLoc=F.netLoc,"/"!==_.path[0]))if(_.path){var N=F.path,B=N.substring(0,Z()(N).call(N,"/")+1)+_.path;M.path=O.normalizePath(B)}else M.path=F.path,_.params||(M.params=F.params,_.query||(M.query=F.query));return null===M.path&&(M.path=I.alwaysNormalize?O.normalizePath(_.path):_.path),O.buildURLFromParts(M)},"parseURL":function parseURL(R){var C=I.exec(R);return C?{"scheme":C[1]||"","netLoc":C[2]||"","path":C[3]||"","params":C[4]||"","query":C[5]||"","fragment":C[6]||""}:null},"normalizePath":function normalizePath(R){var C,I;for(R=J()(C=R.split("")).call(C).join("").replace(x,"");R.length!==(R=R.replace(_,"")).length;);return J()(I=R.split("")).call(I).join("")},"buildURLFromParts":function buildURLFromParts(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}};R.exports=O}()},"./node_modules/webworkify-webpack/index.js":function node_modulesWebworkifyWebpackIndexJs(R,C,I){function i(R){var C={};function r(I){if(C[I])return C[I].exports;var w=C[I]={"i":I,"l":!1,"exports":{}};return R[I].call(w.exports,w,w.exports,r),w.l=!0,w.exports}r.m=R,r.c=C,r.i=function(R){return R},r.d=function(R,C,I){r.o(R,C)||B()(R,C,{"configurable":!1,"enumerable":!0,"get":I})},r.r=function(R){B()(R,"__esModule",{"value":!0})},r.n=function(R){var C=R&&R.__esModule?function t(){return R.default}:function t(){return R};return r.d(C,"a",C),C},r.o=function(R,C){return Object.prototype.hasOwnProperty.call(R,C)},r.p="/",r.oe=function(R){throw console.error(R),R};var I=r(r.s=ENTRY_MODULE);return I.default||I}var w="[\\.|\\-|\\+|\\w|/|@]+",x="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+w+").*?\\)";function s(R){return(R+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(R){return!isNaN(1*R)}function l(R,C,_){var O={};O[_]=[];var F=C.toString(),P=F.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!P)return O;for(var M,N=P[1],B=new RegExp("(\\\\n|\\W)"+s(N)+x,"g");M=B.exec(F);)"dll-reference"!==M[3]&&O[_].push(M[3]);for(B=new RegExp("\\("+s(N)+'\\("(dll-reference\\s('+w+'))"\\)\\)'+x,"g");M=B.exec(F);)R[M[2]]||(O[_].push(M[1]),R[M[2]]=I(M[1]).m),O[M[2]]=O[M[2]]||[],O[M[2]].push(M[4]);for(var U=ee()(O),G=0;G<U.length;G++)for(var j=0;j<O[U[G]].length;j++)o(O[U[G]][j])&&(O[U[G]][j]=1*O[U[G]][j]);return O}function u(R){var C=ee()(R);return re()(C).call(C,(function(C,I){return C||R[I].length>0}),!1)}function f(R,C){for(var I={"main":[C]},w={"main":[]},x={"main":{}};u(I);)for(var _=ee()(I),O=0;O<_.length;O++){var F=_[O],P=I[F].pop();if(x[F]=x[F]||{},!x[F][P]&&R[F][P]){x[F][P]=!0,w[F]=w[F]||[],w[F].push(P);for(var M=l(R,R[F][P],F),N=ee()(M),B=0;B<N.length;B++){var U;I[N[B]]=I[N[B]]||[],I[N[B]]=Y()(U=I[N[B]]).call(U,M[N[B]])}}}return w}R.exports=function(R,C){var w,x,_;C=C||{};var O={"main":I.m},F=C.all?{"main":ee()(O.main)}:f(O,R),P="";ne()(w=se()(x=ee()(F)).call(x,(function(R){return"main"!==R}))).call(w,(function(R){for(var C,I=0;F[R][I];)I++;F[R].push(I),O[R][I]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",P=P+"var "+R+" = ("+i.toString().replace("ENTRY_MODULE",le()(I))+")({"+ce()(C=F[R]).call(C,(function(C){return le()(C)+": "+O[R][C].toString()})).join(",")+"});\n"})),P=P+"new (("+i.toString().replace("ENTRY_MODULE",le()(R))+")({"+ce()(_=F.main).call(_,(function(R){return le()(R)+": "+O.main[R].toString()})).join(",")+"}))(self);";var M=new window.Blob([P],{"type":"text/javascript"});if(C.bare)return M;var N=(he()||window.webkitURL||window.mozURL||window.msURL).createObjectURL(M),B=new window.Worker(N);return B.objectURL=N,B}},"./src/config.ts":function srcConfigTs(R,C,I){I.r(C),I.d(C,"hlsDefaultConfig",(function(){return X})),I.d(C,"mergeConfig",(function(){return D})),I.d(C,"enableStreamingMode",(function(){return k}));var w=I("./src/controller/abr-controller.ts"),x=I("./src/controller/audio-stream-controller.ts"),_=I("./src/controller/audio-track-controller.ts"),O=I("./src/controller/subtitle-stream-controller.ts"),F=I("./src/controller/subtitle-track-controller.ts"),P=I("./src/controller/buffer-controller.ts"),M=I("./src/controller/timeline-controller.ts"),N=I("./src/controller/cap-level-controller.ts"),U=I("./src/controller/fps-controller.ts"),G=I("./src/controller/eme-controller.ts"),j=I("./src/controller/cmcd-controller.ts"),K=I("./src/utils/xhr-loader.ts"),H=I("./src/utils/fetch-loader.ts"),W=I("./src/utils/cues.ts"),Y=I("./src/utils/mediakeys-helper.ts"),z=I("./src/utils/logger.ts");function E(){return E=ge()||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(R[w]=I[w])}return R},E.apply(this,arguments)}function T(R,C){var I=ee()(R);if(V()){var w=V()(R);C&&(w=se()(w).call(w,(function(C){return pe()(R,C).enumerable}))),I.push.apply(I,w)}return I}function b(R){for(var C=1;C<arguments.length;C++){var I,w=null!=arguments[C]?arguments[C]:{};if(C%2)ne()(I=T(Object(w),!0)).call(I,(function(C){S(R,C,w[C])}));else if(ye())Te()(R,ye()(w));else{var x;ne()(x=T(Object(w))).call(x,(function(C){B()(R,C,pe()(w,C))}))}}return R}function S(R,C,I){return C in R?B()(R,C,{"value":I,"enumerable":!0,"configurable":!0,"writable":!0}):R[C]=I,R}var X=b(b({"autoStartLoad":!0,"startPosition":-1,"defaultAudioCodec":void 0,"debug":!1,"capLevelOnFPSDrop":!1,"capLevelToPlayerSize":!1,"initialLiveManifestSize":1,"maxBufferLength":30,"backBufferLength":1/0,"maxBufferSize":6e7,"maxBufferHole":.1,"highBufferWatchdogPeriod":2,"nudgeOffset":.1,"nudgeMaxRetry":3,"maxFragLookUpTolerance":.25,"liveSyncDurationCount":3,"liveMaxLatencyDurationCount":1/0,"liveSyncDuration":void 0,"liveMaxLatencyDuration":void 0,"maxLiveSyncPlaybackRate":1,"liveDurationInfinity":!1,"liveBackBufferLength":null,"maxMaxBufferLength":600,"enableWorker":!0,"enableSoftwareAES":!0,"manifestLoadingTimeOut":1e4,"manifestLoadingMaxRetry":1,"manifestLoadingRetryDelay":1e3,"manifestLoadingMaxRetryTimeout":64e3,"startLevel":void 0,"levelLoadingTimeOut":1e4,"levelLoadingMaxRetry":4,"levelLoadingRetryDelay":1e3,"levelLoadingMaxRetryTimeout":64e3,"fragLoadingTimeOut":2e4,"fragLoadingMaxRetry":6,"fragLoadingRetryDelay":1e3,"fragLoadingMaxRetryTimeout":64e3,"startFragPrefetch":!1,"fpsDroppedMonitoringPeriod":5e3,"fpsDroppedMonitoringThreshold":.2,"appendErrorMaxRetry":3,"loader":K.default,"fLoader":void 0,"pLoader":void 0,"xhrSetup":void 0,"licenseXhrSetup":void 0,"licenseResponseCallback":void 0,"abrController":w.default,"bufferController":P.default,"capLevelController":N.default,"fpsController":U.default,"stretchShortVideoTrack":!1,"maxAudioFramesDrift":1,"forceKeyFrameOnDiscontinuity":!0,"abrEwmaFastLive":3,"abrEwmaSlowLive":9,"abrEwmaFastVoD":3,"abrEwmaSlowVoD":9,"abrEwmaDefaultEstimate":5e5,"abrBandWidthFactor":.95,"abrBandWidthUpFactor":.7,"abrMaxWithRealBitrate":!1,"maxStarvationDelay":4,"maxLoadingDelay":4,"minAutoBitrate":0,"emeEnabled":!1,"widevineLicenseUrl":void 0,"drmSystemOptions":{},"requestMediaKeySystemAccessFunc":Y.requestMediaKeySystemAccess,"testBandwidth":!0,"progressive":!1,"lowLatencyMode":!0,"cmcd":void 0},function L(){return{"cueHandler":W.default,"enableCEA708Captions":!0,"enableWebVTT":!0,"enableIMSC1":!0,"captionsTextTrack1Label":"English","captionsTextTrack1LanguageCode":"en","captionsTextTrack2Label":"Spanish","captionsTextTrack2LanguageCode":"es","captionsTextTrack3Label":"Unknown CC","captionsTextTrack3LanguageCode":"","captionsTextTrack4Label":"Unknown CC","captionsTextTrack4LanguageCode":"","renderTextTracksNatively":!0}}()),{},{"subtitleStreamController":O.SubtitleStreamController,"subtitleTrackController":F.default,"timelineController":M.TimelineController,"audioStreamController":x.default,"audioTrackController":_.default,"emeController":G.default,"cmcdController":j.default});function D(R,C){if((C.liveSyncDurationCount||C.liveMaxLatencyDurationCount)&&(C.liveSyncDuration||C.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==C.liveMaxLatencyDurationCount&&(void 0===C.liveSyncDurationCount||C.liveMaxLatencyDurationCount<=C.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==C.liveMaxLatencyDuration&&(void 0===C.liveSyncDuration||C.liveMaxLatencyDuration<=C.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return E({},R,C)}function k(R){var C=R.loader;C!==H.default&&C!==K.default?(z.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),R.progressive=!1):Object(H.fetchSupported)()&&(R.loader=H.default,R.progressive=!0,R.enableSoftwareAES=!0,z.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function srcControllerAbrControllerTs(R,C,I){I.r(C);var w=I("./src/polyfills/number.ts"),x=I("./src/utils/ewma-bandwidth-estimator.ts"),_=I("./src/events.ts"),O=I("./src/utils/buffer-helper.ts"),F=I("./src/errors.ts"),P=I("./src/types/loader.ts"),M=I("./src/utils/logger.ts");function f(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var N=function(){function e(R){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=R;var C=R.config;this.bwEstimator=new x.default(C.abrEwmaSlowVoD,C.abrEwmaFastVoD,C.abrEwmaDefaultEstimate),this.registerListeners()}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(_.Events.FRAG_LOADING,this.onFragLoading,this),R.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(_.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(_.Events.ERROR,this.onError,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(_.Events.FRAG_LOADING,this.onFragLoading,this),R.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(_.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(_.Events.ERROR,this.onError,this)},R.destroy=function e(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},R.onFragLoading=function e(R,C){var I,w=C.frag;w.type===P.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=w,this.partCurrent=null!=(I=C.part)?I:null,this.timer=self.setInterval(this.onCheck,100)))},R.onLevelLoaded=function e(R,C){var I=this.hls.config;C.details.live?this.bwEstimator.update(I.abrEwmaSlowLive,I.abrEwmaFastLive):this.bwEstimator.update(I.abrEwmaSlowVoD,I.abrEwmaFastVoD)},R._abandonRulesCheck=function e(){var R=this.fragCurrent,C=this.partCurrent,I=this.hls,x=I.autoLevelEnabled,F=I.config,P=I.media;if(R&&P){var N=C?C.stats:R.stats,B=C?C.duration:R.duration;if(N.aborted)return M.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(x&&!P.paused&&P.playbackRate&&P.readyState){var U=performance.now()-N.loading.start,G=Math.abs(P.playbackRate);if(!(U<=500*B/G)){var j=I.levels,K=I.minAutoLevel,H=j[R.level],V=N.total||Math.max(N.loaded,Math.round(B*H.maxBitrate/8)),W=Math.max(1,N.bwEstimate?N.bwEstimate/8:1e3*N.loaded/U),Y=(V-N.loaded)/W,z=P.currentTime,X=(O.BufferHelper.bufferInfo(P,z,F.maxBufferHole).end-z)/G;if(!(X>=2*B/G||Y<=X)){var q,Z=Number.POSITIVE_INFINITY;for(q=R.level-1;q>K;q--){if((Z=B*j[q].maxBitrate/(6.4*W))<X)break}if(!(Z>=Y)){var Q=this.bwEstimator.getEstimate();M.logger.warn("Fragment "+R.sn+(C?" part "+C.index:"")+" of level "+R.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+q+"\n      Current BW estimate: "+(Object(w.isFiniteNumber)(Q)?(Q/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+Y.toFixed(3)+" s\n      Estimated load time for the next fragment: "+Z.toFixed(3)+" s\n      Time to underbuffer: "+X.toFixed(3)+" s"),I.nextLoadLevel=q,this.bwEstimator.sample(U,N.loaded),this.clearTimer(),R.loader&&(this.fragCurrent=this.partCurrent=null,R.loader.abort()),I.trigger(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,{"frag":R,"part":C,"stats":N})}}}}}},R.onFragLoaded=function e(R,C){var I=C.frag,x=C.part;if(I.type===P.PlaylistLevelType.MAIN&&Object(w.isFiniteNumber)(I.sn)){var O=x?x.stats:I.stats,F=x?x.duration:I.duration;if(this.clearTimer(),this.lastLoadedFragLevel=I.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var M=this.hls.levels[I.level],N=(M.loaded?M.loaded.bytes:0)+O.loaded,B=(M.loaded?M.loaded.duration:0)+F;M.loaded={"bytes":N,"duration":B},M.realBitrate=Math.round(8*N/B)}if(I.bitrateTest){var U={"stats":O,"frag":I,"part":x,"id":I.type};this.onFragBuffered(_.Events.FRAG_BUFFERED,U),I.bitrateTest=!1}}},R.onFragBuffered=function e(R,C){var I=C.frag,w=C.part,x=w?w.stats:I.stats;if(!x.aborted&&I.type===P.PlaylistLevelType.MAIN&&"initSegment"!==I.sn){var _=x.parsing.end-x.loading.start;this.bwEstimator.sample(_,x.loaded),x.bwEstimate=this.bwEstimator.getEstimate(),I.bitrateTest?this.bitrateTestDelay=_/1e3:this.bitrateTestDelay=0}},R.onError=function e(R,C){switch(C.details){case F.ErrorDetails.FRAG_LOAD_ERROR:case F.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},R.clearTimer=function e(){self.clearInterval(this.timer),this.timer=void 0},R.getNextABRAutoLevel=function e(){var R=this.fragCurrent,C=this.partCurrent,I=this.hls,w=I.maxAutoLevel,x=I.config,_=I.minAutoLevel,F=I.media,P=C?C.duration:R?R.duration:0,N=F?F.currentTime:0,B=F&&0!==F.playbackRate?Math.abs(F.playbackRate):1,U=this.bwEstimator?this.bwEstimator.getEstimate():x.abrEwmaDefaultEstimate,G=(O.BufferHelper.bufferInfo(F,N,x.maxBufferHole).end-N)/B,j=this.findBestLevel(U,_,w,G,x.abrBandWidthFactor,x.abrBandWidthUpFactor);if(j>=0)return j;M.logger.trace((G?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var K=P?Math.min(P,x.maxStarvationDelay):x.maxStarvationDelay,H=x.abrBandWidthFactor,V=x.abrBandWidthUpFactor;if(!G){var W=this.bitrateTestDelay;if(W)K=(P?Math.min(P,x.maxLoadingDelay):x.maxLoadingDelay)-W,M.logger.trace("bitrate test took "+Math.round(1e3*W)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*K)+" ms"),H=V=1}return j=this.findBestLevel(U,_,w,G+K,H,V),Math.max(j,0)},R.findBestLevel=function e(R,C,I,w,x,_){for(var O,F=this.fragCurrent,P=this.partCurrent,N=this.lastLoadedFragLevel,B=this.hls.levels,U=B[N],G=!(null==U||null===(O=U.details)||void 0===O||!O.live),j=null==U?void 0:U.codecSet,K=P?P.duration:F?F.duration:0,H=I;H>=C;H--){var V=B[H];if(V&&(!j||V.codecSet===j)){var W=V.details,Y=(P?null==W?void 0:W.partTarget:null==W?void 0:W.averagetargetduration)||K,z=void 0;z=H<=N?x*R:_*R;var X=B[H].maxBitrate,q=X*Y/z;if(M.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+H+"/"+Math.round(z)+"/"+X+"/"+Y+"/"+w+"/"+q),z>X&&(!q||G&&!this.bitrateTestDelay||q<w))return H}}return-1},function c(R,C,I){return C&&f(R.prototype,C),I&&f(R,I),R}(e,[{"key":"nextAutoLevel","get":function e(){var R=this._nextAutoLevel,C=this.bwEstimator;if(!(-1===R||C&&C.canEstimate()))return R;var I=this.getNextABRAutoLevel();return-1!==R&&(I=Math.min(R,I)),I},"set":function e(R){this._nextAutoLevel=R}}]),e}();C.default=N},"./src/controller/audio-stream-controller.ts":function srcControllerAudioStreamControllerTs(R,C,I){I.r(C);var w=I("./src/polyfills/number.ts"),x=I("./src/controller/base-stream-controller.ts"),_=I("./src/events.ts"),O=I("./src/utils/buffer-helper.ts"),F=I("./src/controller/fragment-tracker.ts"),P=I("./src/types/level.ts"),M=I("./src/types/loader.ts"),N=I("./src/loader/fragment.ts"),B=I("./src/demux/chunk-cache.ts"),U=I("./src/demux/transmuxer-interface.ts"),G=I("./src/types/transmuxer.ts"),j=I("./src/controller/fragment-finders.ts"),K=I("./src/utils/discontinuities.ts"),H=I("./src/errors.ts"),V=I("./src/utils/logger.ts");function y(){return y=ge()||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(R[w]=I[w])}return R},y.apply(this,arguments)}function T(R,C){return T=Se()||function e(R,C){return R.__proto__=C,R},T(R,C)}var W=function(R){function t(C,I){var w;return(w=R.call(this,C,I,"[audio-stream-controller]")||this).videoBuffer=null,w.videoTrackCC=-1,w.waitingVideoCC=-1,w.audioSwitch=!1,w.trackId=-1,w.waitingData=null,w.mainDetails=null,w.bufferFlushed=!1,w._registerListeners(),w}!function E(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,T(R,C)}(t,R);var C=t.prototype;return C.onHandlerDestroying=function e(){this._unregisterListeners(),this.mainDetails=null},C._registerListeners=function e(){var R=this.hls;R.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(_.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),R.on(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.on(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.on(_.Events.ERROR,this.onError,this),R.on(_.Events.BUFFER_RESET,this.onBufferReset,this),R.on(_.Events.BUFFER_CREATED,this.onBufferCreated,this),R.on(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.on(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.on(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(_.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),R.off(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.off(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.off(_.Events.ERROR,this.onError,this),R.off(_.Events.BUFFER_RESET,this.onBufferReset,this),R.off(_.Events.BUFFER_CREATED,this.onBufferCreated,this),R.off(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.off(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.off(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C.onInitPtsFound=function e(R,C){var I=C.frag,w=C.id,_=C.initPTS;if("main"===w){var O=I.cc;this.initPTS[I.cc]=_,this.log("InitPTS for cc: "+O+" found from main: "+_),this.videoTrackCC=O,this.state===x.State.WAITING_INIT_PTS&&this.tick()}},C.startLoad=function e(R){if(!this.levels)return this.startPosition=R,void(this.state=x.State.STOPPED);var C=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,C>0&&-1===R?(this.log("Override startPosition with lastCurrentTime @"+C.toFixed(3)),this.state=x.State.IDLE):(this.loadedmetadata=!1,this.state=x.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=R,this.tick()},C.doTick=function t(){switch(this.state){case x.State.IDLE:this.doTickIdle();break;case x.State.WAITING_TRACK:var C,I=this.levels,w=this.trackId,_=null==I||null===(C=I[w])||void 0===C?void 0:C.details;if(_){if(this.waitForCdnTuneIn(_))break;this.state=x.State.WAITING_INIT_PTS}break;case x.State.FRAG_LOADING_WAITING_RETRY:var F,P=performance.now(),M=this.retryDate;(!M||P>=M||null!==(F=this.media)&&void 0!==F&&F.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=x.State.IDLE);break;case x.State.WAITING_INIT_PTS:var N=this.waitingData;if(N){var B=N.frag,U=N.part,G=N.cache,K=N.complete;if(void 0!==this.initPTS[B.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=x.State.FRAG_LOADING;var H={"frag":B,"part":U,"payload":G.flush(),"networkDetails":null};this._handleFragmentLoadProgress(H),K&&R.prototype._handleFragmentLoadComplete.call(this,H)}else if(this.videoTrackCC!==this.waitingVideoCC)V.logger.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),Y=O.BufferHelper.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole);Object(j.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,B)<0&&(V.logger.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=x.State.IDLE}this.onTickEnd()},C.clearWaitingFragment=function e(){var R=this.waitingData;R&&(this.fragmentTracker.removeFragment(R.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=x.State.IDLE)},C.onTickEnd=function e(){var R=this.media;if(R&&R.readyState){var C=(this.mediaBuffer?this.mediaBuffer:R).buffered;!this.loadedmetadata&&C.length&&(this.loadedmetadata=!0),this.lastCurrentTime=R.currentTime}},C.doTickIdle=function e(){var R,C,I=this.hls,w=this.levels,O=this.media,F=this.trackId,P=I.config;if(w&&w[F]&&(O||!this.startFragRequested&&P.startFragPrefetch)){var B=w[F].details;if(!B||B.live&&this.levelLastLoaded!==F||this.waitForCdnTuneIn(B))this.state=x.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,N.ElementaryStreamTypes.AUDIO,M.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,M.PlaylistLevelType.AUDIO);if(null!==U){var G=U.len,j=this.getMaxBufferLength(),K=this.audioSwitch;if(!(G>=j)||K){if(!K&&this._streamEnded(U,B))return I.trigger(_.Events.BUFFER_EOS,{"type":"audio"}),void(this.state=x.State.ENDED);var H=B.fragments[0].start,V=U.end;if(K){var W=this.getLoadPosition();V=W,B.PTSKnown&&W<H&&(U.end>H||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),O.currentTime=H+.05)}var Y=this.getNextFragment(V,B);Y?"identity"!==(null===(R=Y.decryptdata)||void 0===R?void 0:R.keyFormat)||null!==(C=Y.decryptdata)&&void 0!==C&&C.key?this.loadFragment(Y,B,V):this.loadKey(Y,B):this.bufferFlushed=!0}}}}},C.getMaxBufferLength=function t(){var C=R.prototype.getMaxBufferLength.call(this),I=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,M.PlaylistLevelType.MAIN);return null===I?C:Math.max(C,I.len)},C.onMediaDetaching=function t(){this.videoBuffer=null,R.prototype.onMediaDetaching.call(this)},C.onAudioTracksUpdated=function e(R,C){var I=C.audioTracks;this.resetTransmuxer(),this.levels=ce()(I).call(I,(function(R){return new P.Level(R)}))},C.onAudioTrackSwitching=function e(R,C){var I=!!C.url;this.trackId=C.id;var w=this.fragCurrent;null!=w&&w.loader&&w.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),I?this.setInterval(100):this.resetTransmuxer(),I?(this.audioSwitch=!0,this.state=x.State.IDLE):this.state=x.State.STOPPED,this.tick()},C.onManifestLoading=function e(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},C.onLevelLoaded=function e(R,C){this.mainDetails=C.details},C.onAudioTrackLoaded=function e(R,C){var I,w=this.levels,_=C.details,O=C.id;if(w){this.log("Track "+O+" loaded ["+_.startSN+","+_.endSN+"],duration:"+_.totalduration);var F=w[O],P=0;if(_.live||null!==(I=F.details)&&void 0!==I&&I.live){var M=this.mainDetails;if(_.fragments[0]||(_.deltaUpdateFailed=!0),_.deltaUpdateFailed||!M)return;!F.details&&_.hasProgramDateTime&&M.hasProgramDateTime?(Object(K.alignMediaPlaylistByPDT)(_,M),P=_.fragments[0].start):P=this.alignPlaylists(_,F.details)}F.details=_,this.levelLastLoaded=O,this.startFragRequested||!this.mainDetails&&_.live||this.setStartPosition(F.details,P),this.state!==x.State.WAITING_TRACK||this.waitForCdnTuneIn(_)||(this.state=x.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+O)},C._handleFragmentLoadProgress=function e(R){var C,I=R.frag,w=R.part,_=R.payload,O=this.config,F=this.trackId,P=this.levels;if(P){var N=P[F];console.assert(N,"Audio track is defined on fragment load progress");var j=N.details;console.assert(j,"Audio track details are defined on fragment load progress");var K=O.defaultAudioCodec||N.audioCodec||"mp4a.40.2",H=this.transmuxer;H||(H=this.transmuxer=new U.default(this.hls,M.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var W=this.initPTS[I.cc],Y=null===(C=I.initSegment)||void 0===C?void 0:C.data;if(void 0!==W){var z=w?w.index:-1,X=-1!==z,q=new G.ChunkMetadata(I.level,I.sn,I.stats.chunkCount,_.byteLength,z,X);H.push(_,Y,K,"",I,w,j.totalduration,!1,q,W)}else{V.logger.log("Unknown video PTS for cc "+I.cc+", waiting for video PTS before demuxing audio frag "+I.sn+" of ["+j.startSN+" ,"+j.endSN+"],track "+F),(this.waitingData=this.waitingData||{"frag":I,"part":w,"cache":new B.default,"complete":!1}).cache.push(new Uint8Array(_)),this.waitingVideoCC=this.videoTrackCC,this.state=x.State.WAITING_INIT_PTS}}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered")},C._handleFragmentLoadComplete=function t(C){this.waitingData?this.waitingData.complete=!0:R.prototype._handleFragmentLoadComplete.call(this,C)},C.onBufferReset=function e(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},C.onBufferCreated=function e(R,C){var I=C.tracks.audio;I&&(this.mediaBuffer=I.buffer),C.tracks.video&&(this.videoBuffer=C.tracks.video.buffer)},C.onFragBuffered=function e(R,C){var I=C.frag,w=C.part;I.type===M.PlaylistLevelType.AUDIO&&(this.fragContextChanged(I)?this.warn("Fragment "+I.sn+(w?" p: "+w.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==I.sn&&(this.fragPrevious=I,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(_.Events.AUDIO_TRACK_SWITCHED,{"id":this.trackId}))),this.fragBufferedComplete(I,w)))},C.onError=function t(C,I){switch(I.details){case H.ErrorDetails.FRAG_LOAD_ERROR:case H.ErrorDetails.FRAG_LOAD_TIMEOUT:case H.ErrorDetails.KEY_LOAD_ERROR:case H.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.AUDIO,I);break;case H.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case H.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==x.State.ERROR&&this.state!==x.State.STOPPED&&(this.state=I.fatal?x.State.ERROR:x.State.IDLE,this.warn(I.details+" while loading frag, switching to "+this.state+" state"));break;case H.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===I.parent&&(this.state===x.State.PARSING||this.state===x.State.PARSED)){var w=!0,_=this.getFwdBufferInfo(this.mediaBuffer,M.PlaylistLevelType.AUDIO);_&&_.len>.5&&(w=!this.reduceMaxBufferLength(_.len)),w&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,R.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},C.onBufferFlushed=function e(R,C){C.type===N.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},C._handleTransmuxComplete=function e(R){var C,I="audio",w=this.hls,O=R.remuxResult,F=R.chunkMeta,P=this.getCurrentContext(F);if(!P)return this.warn("The loading context changed while buffering fragment "+F.sn+" of level "+F.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(F.level);var M=P.frag,B=P.part,U=O.audio,G=O.text,j=O.id3,K=O.initSegment;if(!this.fragContextChanged(M)){if(this.state=x.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),null!=K&&K.tracks&&(this._bufferInitSegment(K.tracks,M,F),w.trigger(_.Events.FRAG_PARSING_INIT_SEGMENT,{"frag":M,"id":I,"tracks":K.tracks})),U){var H=U.startPTS,V=U.endPTS,W=U.startDTS,Y=U.endDTS;B&&(B.elementaryStreams[N.ElementaryStreamTypes.AUDIO]={"startPTS":H,"endPTS":V,"startDTS":W,"endDTS":Y}),M.setElementaryStreamInfo(N.ElementaryStreamTypes.AUDIO,H,V,W,Y),this.bufferFragmentData(U,M,B,F)}if(null!=j&&null!==(C=j.samples)&&void 0!==C&&C.length){var z=y({"frag":M,"id":I},j);w.trigger(_.Events.FRAG_PARSING_METADATA,z)}if(G){var X=y({"frag":M,"id":I},G);w.trigger(_.Events.FRAG_PARSING_USERDATA,X)}}},C._bufferInitSegment=function e(R,C,I){if(this.state===x.State.PARSING){R.video&&delete R.video;var w=R.audio;if(w){w.levelCodec=w.codec,w.id="audio",this.log("Init audio buffer, container:"+w.container+", codecs[parsed]=["+w.codec+"]"),this.hls.trigger(_.Events.BUFFER_CODECS,R);var O=w.initSegment;if(null!=O&&O.byteLength){var F={"type":"audio","frag":C,"part":null,"chunkMeta":I,"parent":C.type,"data":O};this.hls.trigger(_.Events.BUFFER_APPENDING,F)}this.tick()}}},C.loadFragment=function t(C,I,_){var O=this.fragmentTracker.getState(C);this.fragCurrent=C,(this.audioSwitch||O===F.FragmentState.NOT_LOADED||O===F.FragmentState.PARTIAL)&&("initSegment"===C.sn?this._loadInitSegment(C):I.live&&!Object(w.isFiniteNumber)(this.initPTS[C.cc])?(this.log("Waiting for video PTS in continuity counter "+C.cc+" of live stream before loading audio fragment "+C.sn+" of level "+this.trackId),this.state=x.State.WAITING_INIT_PTS):(this.startFragRequested=!0,R.prototype.loadFragment.call(this,C,I,_)))},C.completeAudioSwitch=function t(){var C=this.hls,I=this.media,w=this.trackId;I&&(this.log("Switching audio track : flushing all audio"),R.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,C.trigger(_.Events.AUDIO_TRACK_SWITCHED,{"id":w})},t}(x.default);C.default=W},"./src/controller/audio-track-controller.ts":function srcControllerAudioTrackControllerTs(R,C,I){I.r(C);var w=I("./src/events.ts"),x=I("./src/errors.ts"),_=I("./src/controller/base-playlist-controller.ts"),O=I("./src/types/loader.ts");function o(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function f(R,C){return f=Se()||function e(R,C){return R.__proto__=C,R},f(R,C)}var F=function(R){function t(C){var I;return(I=R.call(this,C,"[audio-track-controller]")||this).tracks=[],I.groupId=null,I.tracksInGroup=[],I.trackId=-1,I.trackName="",I.selectDefaultTrack=!0,I.registerListeners(),I}!function u(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,f(R,C)}(t,R);var C=t.prototype;return C.registerListeners=function e(){var R=this.hls;R.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.on(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.on(w.Events.ERROR,this.onError,this)},C.unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(w.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.off(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),R.off(w.Events.ERROR,this.onError,this)},C.destroy=function t(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,R.prototype.destroy.call(this)},C.onManifestLoading=function e(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},C.onManifestParsed=function e(R,C){this.tracks=C.audioTracks||[]},C.onAudioTrackLoaded=function e(R,C){var I=C.id,w=C.details,x=this.tracksInGroup[I];if(x){var _=x.details;x.details=C.details,this.log("audioTrack "+I+" loaded ["+w.startSN+"-"+w.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,C,_))}else this.warn("Invalid audio track id "+I)},C.onLevelLoading=function e(R,C){this.switchLevel(C.level)},C.onLevelSwitching=function e(R,C){this.switchLevel(C.level)},C.switchLevel=function e(R){var C=this.hls.levels[R];if(null!=C&&C.audioGroupIds){var I=C.audioGroupIds[C.urlId];if(this.groupId!==I){var x;this.groupId=I;var _=se()(x=this.tracks).call(x,(function(R){return!I||R.groupId===I}));this.selectDefaultTrack&&!Le()(_).call(_,(function(R){return R.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=_;var O={"audioTracks":_};this.log("Updating audio tracks, "+_.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(w.Events.AUDIO_TRACKS_UPDATED,O),this.selectInitialTrack()}}},C.onError=function t(C,I){R.prototype.onError.call(this,C,I),!I.fatal&&I.context&&I.context.type===O.PlaylistContextType.AUDIO_TRACK&&I.context.id===this.trackId&&I.context.groupId===this.groupId&&this.retryLoadingOrFail(I)},C.setAudioTrack=function e(R){var C=this.tracksInGroup;if(R<0||R>=C.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var I=C[this.trackId];this.log("Now switching to audio-track index "+R);var x=C[R],_=x.id,O=x.groupId,F=void 0===O?"":O,P=x.name,M=x.type,N=x.url;if(this.trackId=R,this.trackName=P,this.selectDefaultTrack=!1,this.hls.trigger(w.Events.AUDIO_TRACK_SWITCHING,{"id":_,"groupId":F,"name":P,"type":M,"url":N}),!x.details||x.details.live){var B=this.switchParams(x.url,null==I?void 0:I.details);this.loadPlaylist(B)}}},C.selectInitialTrack=function e(){var R=this.tracksInGroup;console.assert(R.length,"Initial audio track should be selected when tracks are known");var C=this.trackName,I=this.findTrackId(C)||this.findTrackId();-1!==I?this.setAudioTrack(I):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,"fatal":!0}))},C.findTrackId=function e(R){for(var C=this.tracksInGroup,I=0;I<C.length;I++){var w=C[I];if((!this.selectDefaultTrack||w.default)&&(!R||R===w.name))return w.id}return-1},C.loadPlaylist=function e(R){var C=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(C)){var I=C.id,x=C.groupId,_=C.url;if(R)try{_=R.addDirectives(_)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("loading audio-track playlist for id: "+I),this.clearTimer(),this.hls.trigger(w.Events.AUDIO_TRACK_LOADING,{"url":_,"id":I,"groupId":x,"deliveryDirectives":R||null})}},function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}(t,[{"key":"audioTracks","get":function e(){return this.tracksInGroup}},{"key":"audioTrack","get":function e(){return this.trackId},"set":function e(R){this.selectDefaultTrack=!1,this.setAudioTrack(R)}}]),t}(_.default);C.default=F},"./src/controller/base-playlist-controller.ts":function srcControllerBasePlaylistControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return P}));var w=I("./src/polyfills/number.ts"),x=I("./src/types/level.ts"),_=I("./src/controller/level-helper.ts"),O=I("./src/utils/logger.ts"),F=I("./src/errors.ts"),P=function(){function e(R,C){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=O.logger.log.bind(O.logger,C+":"),this.warn=O.logger.warn.bind(O.logger,C+":"),this.hls=R}var R=e.prototype;return R.destroy=function e(){this.clearTimer(),this.hls=this.log=this.warn=null},R.onError=function e(R,C){C.fatal&&C.type===F.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},R.clearTimer=function e(){clearTimeout(this.timer),this.timer=-1},R.startLoad=function e(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},R.stopLoad=function e(){this.canLoad=!1,this.clearTimer()},R.switchParams=function e(R,C){var I=null==C?void 0:C.renditionReports;if(I)for(var _=0;_<I.length;_++){var O=I[_],F=""+O.URI;if(F===R.substr(-F.length)){var P=Re()(O["LAST-MSN"]),M=Re()(O["LAST-PART"]);if(C&&this.hls.config.lowLatencyMode){var N=Math.min(C.age-C.partTarget,C.targetduration);void 0!==M&&N>C.partTarget&&(M+=1)}if(Object(w.isFiniteNumber)(P))return new x.HlsUrlParameters(P,Object(w.isFiniteNumber)(M)?M:void 0,x.HlsSkip.No)}}},R.loadPlaylist=function e(R){},R.shouldLoadTrack=function e(R){return this.canLoad&&R&&!!R.url&&(!R.details||R.details.live)},R.playlistLoaded=function e(R,C,I){var w=this,x=C.details,O=C.stats,F=O.loading.end?Math.max(0,self.performance.now()-O.loading.end):0;if(x.advancedDateTime=Date.now()-F,x.live||null!=I&&I.live){if(x.reloaded(I),I&&this.log("live playlist "+R+" "+(x.advanced?"REFRESHED "+x.lastPartSn+"-"+x.lastPartIndex:"MISSED")),I&&x.fragments.length>0&&Object(_.mergeDetails)(I,x),!this.canLoad||!x.live)return;var P,M=void 0,N=void 0;if(x.canBlockReload&&x.endSN&&x.advanced){var B=this.hls.config.lowLatencyMode,U=x.lastPartSn,G=x.endSN,j=x.lastPartIndex,K=U===G;-1!==j?(M=K?G+1:U,N=K?B?0:j:j+1):M=G+1;var H=x.age,V=H+x.ageHeader,W=Math.min(V-x.partTarget,1.5*x.targetduration);if(W>0){if(I&&W>I.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+I.tuneInGoal+" to: "+W+" with playlist age: "+x.age),W=0;else{var Y=Math.floor(W/x.targetduration);if(M+=Y,void 0!==N)N+=Math.round(W%x.targetduration/x.partTarget);this.log("CDN Tune-in age: "+x.ageHeader+"s last advanced "+H.toFixed(2)+"s goal: "+W+" skip sn "+Y+" to part "+N)}x.tuneInGoal=W}if(P=this.getDeliveryDirectives(x,C.deliveryDirectives,M,N),B||!K)return void this.loadPlaylist(P)}else P=this.getDeliveryDirectives(x,C.deliveryDirectives,M,N);var z=Object(_.computeReloadInterval)(x,O);void 0!==M&&x.canBlockReload&&(z-=x.partTarget||1),this.log("reload live playlist "+R+" in "+Math.round(z)+" ms"),this.timer=self.setTimeout((function(){return w.loadPlaylist(P)}),z)}else this.clearTimer()},R.getDeliveryDirectives=function e(R,C,I,w){var _=Object(x.getSkipValue)(R,I);return null!=C&&C.skip&&R.deltaUpdateFailed&&(I=C.msn,w=C.part,_=x.HlsSkip.No),new x.HlsUrlParameters(I,w,_)},R.retryLoadingOrFail=function e(R){var C,I,w=this,x=this.hls.config,_=this.retryCount<x.levelLoadingMaxRetry;if(_)if(this.retryCount++,Ce()(C=R.details).call(C,"LoadTimeOut")>-1&&null!==(I=R.context)&&void 0!==I&&I.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+R.details+'"'),this.loadPlaylist();else{var O=Math.min(Math.pow(2,this.retryCount)*x.levelLoadingRetryDelay,x.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return w.loadPlaylist()}),O),this.warn("retry playlist loading #"+this.retryCount+" in "+O+' ms after "'+R.details+'"')}else this.warn('cannot recover from error "'+R.details+'"'),this.clearTimer(),R.fatal=!0;return _},e}()},"./src/controller/base-stream-controller.ts":function srcControllerBaseStreamControllerTs(R,C,I){I.r(C),I.d(C,"State",(function(){return q})),I.d(C,"default",(function(){return Z}));var w=I("./src/polyfills/number.ts"),x=I("./src/task-loop.ts"),_=I("./src/controller/fragment-tracker.ts"),O=I("./src/utils/buffer-helper.ts"),F=I("./src/utils/logger.ts"),P=I("./src/events.ts"),N=I("./src/errors.ts"),U=I("./src/types/transmuxer.ts"),G=I("./src/utils/mp4-tools.ts"),j=I("./src/utils/discontinuities.ts"),K=I("./src/controller/fragment-finders.ts"),H=I("./src/controller/level-helper.ts"),V=I("./src/loader/fragment-loader.ts"),W=I("./src/crypt/decrypter.ts"),z=I("./src/utils/time-ranges.ts"),X=I("./src/types/loader.ts");function E(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function A(R,C){return A=Se()||function e(R,C){return R.__proto__=C,R},A(R,C)}var q={"STOPPED":"STOPPED","IDLE":"IDLE","KEY_LOADING":"KEY_LOADING","FRAG_LOADING":"FRAG_LOADING","FRAG_LOADING_WAITING_RETRY":"FRAG_LOADING_WAITING_RETRY","WAITING_TRACK":"WAITING_TRACK","PARSING":"PARSING","PARSED":"PARSED","BACKTRACKING":"BACKTRACKING","ENDED":"ENDED","ERROR":"ERROR","WAITING_INIT_PTS":"WAITING_INIT_PTS","WAITING_LEVEL":"WAITING_LEVEL"},Z=function(R){function t(C,I,w){var x;return(x=R.call(this)||this).hls=void 0,x.fragPrevious=null,x.fragCurrent=null,x.fragmentTracker=void 0,x.transmuxer=null,x._state=q.STOPPED,x.media=void 0,x.mediaBuffer=void 0,x.config=void 0,x.bitrateTest=!1,x.lastCurrentTime=0,x.nextLoadPosition=0,x.startPosition=0,x.loadedmetadata=!1,x.fragLoadError=0,x.retryDate=0,x.levels=null,x.fragmentLoader=void 0,x.levelLastLoaded=null,x.startFragRequested=!1,x.decrypter=void 0,x.initPTS=[],x.onvseeking=null,x.onvended=null,x.logPrefix="",x.log=void 0,x.warn=void 0,x.logPrefix=w,x.log=F.logger.log.bind(F.logger,w+":"),x.warn=F.logger.warn.bind(F.logger,w+":"),x.hls=C,x.fragmentLoader=new V.default(C.config),x.fragmentTracker=I,x.config=C.config,x.decrypter=new W.default(C,C.config),C.on(P.Events.KEY_LOADED,x.onKeyLoaded,function b(R){if(void 0===R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}(x)),x}!function S(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,A(R,C)}(t,R);var C=t.prototype;return C.doTick=function e(){this.onTickEnd()},C.onTickEnd=function e(){},C.startLoad=function e(R){},C.stopLoad=function e(){this.fragmentLoader.abort();var R=this.fragCurrent;R&&this.fragmentTracker.removeFragment(R),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=q.STOPPED},C._streamEnded=function e(R,C){var I=this.fragCurrent,w=this.fragmentTracker;if(!C.live&&I&&I.sn>=C.endSN&&!R.nextStart){var x=C.partList;if(null!=x&&x.length){var F=x[x.length-1];return O.BufferHelper.isBuffered(this.media,F.start+F.duration/2)}var P=w.getState(I);return P===_.FragmentState.PARTIAL||P===_.FragmentState.OK}return!1},C.onMediaAttached=function e(R,C){var I=this.media=this.mediaBuffer=C.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===q.STOPPED&&this.startLoad(w.startPosition)},C.onMediaDetaching=function e(){var R=this.media;null!=R&&R.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),R&&(R.removeEventListener("seeking",this.onvseeking),R.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},C.onMediaSeeking=function e(){var R=this.config,C=this.fragCurrent,I=this.media,x=this.mediaBuffer,_=this.state,F=I?I.currentTime:0,P=O.BufferHelper.bufferInfo(x||I,F,R.maxBufferHole);if(this.log("media seeking to "+(Object(w.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+_),_===q.ENDED)this.resetLoadingState();else if(C&&!P.len){var M=R.maxFragLookUpTolerance,N=C.start-M,B=F>C.start+C.duration+M;(F<N||B)&&(B&&C.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),C.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=F),this.loadedmetadata||P.len||(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},C.onMediaEnded=function e(){this.startPosition=this.lastCurrentTime=0},C.onKeyLoaded=function e(R,C){if(this.state===q.KEY_LOADING&&C.frag===this.fragCurrent&&this.levels){this.state=q.IDLE;var I=this.levels[C.frag.level].details;I&&this.loadFragment(C.frag,I,C.frag.start)}},C.onHandlerDestroying=function t(){this.stopLoad(),R.prototype.onHandlerDestroying.call(this)},C.onHandlerDestroyed=function t(){this.state=q.STOPPED,this.hls.off(P.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,R.prototype.onHandlerDestroyed.call(this)},C.loadKey=function e(R,C){this.log("Loading key for "+R.sn+" of ["+C.startSN+"-"+C.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+R.level),this.state=q.KEY_LOADING,this.fragCurrent=R,this.hls.trigger(P.Events.KEY_LOADING,{"frag":R})},C.loadFragment=function e(R,C,I){this._loadFragForPlayback(R,C,I)},C._loadFragForPlayback=function e(R,C,I){var w=this;this._doFragLoad(R,C,I,(function e(C){if(w.fragContextChanged(R))return w.warn("Fragment "+R.sn+(C.part?" p: "+C.part.index:"")+" of level "+R.level+" was dropped during download."),void w.fragmentTracker.removeFragment(R);R.stats.chunkCount++,w._handleFragmentLoadProgress(C)})).then((function(C){if(C){w.fragLoadError=0;var I=w.state;if(!w.fragContextChanged(R))return"payload"in C&&(w.log("Loaded fragment "+R.sn+" of level "+R.level),w.hls.trigger(P.Events.FRAG_LOADED,C),w.state===q.BACKTRACKING)?(w.fragmentTracker.backtrack(R,C),void w.resetFragmentLoading(R)):void w._handleFragmentLoadComplete(C);(I===q.FRAG_LOADING||I===q.BACKTRACKING||!w.fragCurrent&&I===q.PARSING)&&(w.fragmentTracker.removeFragment(R),w.state=q.IDLE)}})).catch((function(C){w.warn(C),w.resetFragmentLoading(R)}))},C.flushMainBuffer=function e(R,C,I){if(void 0===I&&(I=null),R-C){var w={"startOffset":R,"endOffset":C,"type":I};this.fragLoadError=0,this.hls.trigger(P.Events.BUFFER_FLUSHING,w)}},C._loadInitSegment=function e(R){var C=this;this._doFragLoad(R).then((function(I){if(!I||C.fragContextChanged(R)||!C.levels)throw new Error("init load aborted");return I})).then((function(I){var w=C.hls,x=I.payload,_=R.decryptdata;if(x&&x.byteLength>0&&_&&_.key&&_.iv&&"AES-128"===_.method){var O=self.performance.now();return C.decrypter.webCryptoDecrypt(new Uint8Array(x),_.key.buffer,_.iv.buffer).then((function(C){var x=self.performance.now();return w.trigger(P.Events.FRAG_DECRYPTED,{"frag":R,"payload":C,"stats":{"tstart":O,"tdecrypt":x}}),I.payload=C,I}))}return I})).then((function(I){var w=C.fragCurrent,x=C.hls,_=C.levels;if(!_)throw new Error("init load aborted, missing levels");var O=_[R.level].details;console.assert(O,"Level details are defined when init segment is loaded");var F=R.stats;C.state=q.IDLE,C.fragLoadError=0,R.data=new Uint8Array(I.payload),F.parsing.start=F.buffering.start=self.performance.now(),F.parsing.end=F.buffering.end=self.performance.now(),I.frag===w&&x.trigger(P.Events.FRAG_BUFFERED,{"stats":F,"frag":w,"part":null,"id":R.type}),C.tick()})).catch((function(I){C.warn(I),C.resetFragmentLoading(R)}))},C.fragContextChanged=function e(R){var C=this.fragCurrent;return!R||!C||R.level!==C.level||R.sn!==C.sn||R.urlId!==C.urlId},C.fragBufferedComplete=function e(R,C){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+R.type+" sn: "+R.sn+(C?" part: "+C.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+R.level+" "+z.default.toString(O.BufferHelper.getBuffered(I))),this.state=q.IDLE,this.tick()},C._handleFragmentLoadComplete=function e(R){var C=this.transmuxer;if(C){var I=R.frag,w=R.part,x=R.partsLoaded,_=!x||0===x.length||Le()(x).call(x,(function(R){return!R})),O=new U.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,w?w.index:-1,!_);C.flush(O)}},C._handleFragmentLoadProgress=function e(R){},C._doFragLoad=function e(R,C,I,x){var _=this;if(void 0===I&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(R.start,I||0),this.config.lowLatencyMode&&C){var O=C.partList;if(O&&x){I>R.end&&C.fragmentHint&&(R=C.fragmentHint);var F=this.getNextPart(O,R,I);if(F>-1){var N=O[F];return this.log("Loading part sn: "+R.sn+" p: "+N.index+" cc: "+R.cc+" of playlist ["+C.startSN+"-"+C.endSN+"] parts [0-"+F+"-"+(O.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+R.level+", target: "+we()(I.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=q.FRAG_LOADING,this.hls.trigger(P.Events.FRAG_LOADING,{"frag":R,"part":O[F],"targetBufferTime":I}),this.doFragPartsLoad(R,O,F,x).catch((function(R){return _.handleFragLoadError(R)}))}if(!R.url||this.loadedEndOfParts(O,I))return M().resolve(null)}}return this.log("Loading fragment "+R.sn+" cc: "+R.cc+" "+(C?"of ["+C.startSN+"-"+C.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+R.level+", target: "+we()(I.toFixed(3))),Object(w.isFiniteNumber)(R.sn)&&!this.bitrateTest&&(this.nextLoadPosition=R.start+R.duration),this.state=q.FRAG_LOADING,this.hls.trigger(P.Events.FRAG_LOADING,{"frag":R,"targetBufferTime":I}),this.fragmentLoader.load(R,x).catch((function(R){return _.handleFragLoadError(R)}))},C.doFragPartsLoad=function e(R,C,I,w){var x=this;return new(M())((function(_,O){var F=[];!function i(I){var M=C[I];x.fragmentLoader.loadPart(R,M,w).then((function(w){F[M.index]=w;var O=w.part;x.hls.trigger(P.Events.FRAG_LOADED,w);var N=C[I+1];if(!N||N.fragment!==R)return _({"frag":R,"part":O,"partsLoaded":F});i(I+1)})).catch(O)}(I)}))},C.handleFragLoadError=function e(R){var C=R.data;return C&&C.details===N.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(C.frag,C.part):this.hls.trigger(P.Events.ERROR,C),null},C._handleTransmuxerFlush=function e(R){var C=this.getCurrentContext(R);if(C&&this.state===q.PARSING){var I=C.frag,w=C.part,x=C.level,_=self.performance.now();I.stats.parsing.end=_,w&&(w.stats.parsing.end=_),this.updateLevelTiming(I,w,x,R.partial)}else this.fragCurrent||(this.state=q.IDLE)},C.getCurrentContext=function e(R){var C=this.levels,I=R.level,w=R.sn,x=R.part;if(!C||!C[I])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+I+". The current chunk will not be buffered."),null;var _=C[I],O=x>-1?Object(H.getPartWith)(_,w,x):null,F=O?O.fragment:Object(H.getFragmentWithSN)(_,w,this.fragCurrent);return F?{"frag":F,"part":O,"level":_}:null},C.bufferFragmentData=function e(R,C,I,w){if(R&&this.state===q.PARSING){var x=R.data1,_=R.data2,O=x;if(x&&_&&(O=Object(G.appendUint8Array)(x,_)),O&&O.length){var F={"type":R.type,"frag":C,"part":I,"chunkMeta":w,"parent":C.type,"data":O};this.hls.trigger(P.Events.BUFFER_APPENDING,F),R.dropped&&R.independent&&!I&&this.flushBufferGap(C)}}},C.flushBufferGap=function e(R){var C=this.media;if(C)if(O.BufferHelper.isBuffered(C,C.currentTime)){var I=C.currentTime,w=O.BufferHelper.bufferInfo(C,I,0),x=R.duration,_=Math.min(2*this.config.maxFragLookUpTolerance,.25*x),F=Math.max(Math.min(R.start-_,w.end-_),I+_);R.start-F>_&&this.flushMainBuffer(F,R.start)}else this.flushMainBuffer(0,R.start)},C.getFwdBufferInfo=function e(R,C){var I=this.config,x=this.getLoadPosition();if(!Object(w.isFiniteNumber)(x))return null;var _=O.BufferHelper.bufferInfo(R,x,I.maxBufferHole);if(0===_.len&&void 0!==_.nextStart){var F=this.fragmentTracker.getBufferedFrag(x,C);if(F&&_.nextStart<F.end)return O.BufferHelper.bufferInfo(R,x,Math.max(_.nextStart,I.maxBufferHole))}return _},C.getMaxBufferLength=function e(R){var C,I=this.config;return C=R?Math.max(8*I.maxBufferSize/R,I.maxBufferLength):I.maxBufferLength,Math.min(C,I.maxMaxBufferLength)},C.reduceMaxBufferLength=function e(R){var C=this.config,I=R||C.maxBufferLength;return C.maxMaxBufferLength>=I&&(C.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+C.maxMaxBufferLength+"s"),!0)},C.getNextFragment=function e(R,C){var I,w,x=C.fragments,_=x.length;if(!_)return null;var O,F=this.config,P=x[0].start;if(C.live){var M=F.initialLiveManifestSize;if(_<M)return this.warn("Not enough fragments to start playback (have: "+_+", need: "+M+")"),null;C.PTSKnown||this.startFragRequested||-1!==this.startPosition||(O=this.getInitialLiveFragment(C,x),this.startPosition=O?this.hls.liveSyncPosition||O.start:R)}else R<=P&&(O=x[0]);if(!O){var N=F.lowLatencyMode?C.partEnd:C.fragmentEnd;O=this.getFragmentAtPosition(R,N,C)}return null===(I=O)||void 0===I||!I.initSegment||null!==(w=O)&&void 0!==w&&w.initSegment.data||this.bitrateTest||(O=O.initSegment),O},C.getNextPart=function e(R,C,I){for(var w=-1,x=!1,_=!0,O=0,F=R.length;O<F;O++){var P=R[O];if(_=_&&!P.independent,w>-1&&I<P.start)break;var M=P.loaded;!M&&(x||P.independent||_)&&P.fragment===C&&(w=O),x=M}return w},C.loadedEndOfParts=function e(R,C){var I=R[R.length-1];return I&&C>I.start&&I.loaded},C.getInitialLiveFragment=function e(R,C){var I=this.fragPrevious,w=null;if(I){if(R.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),w=Object(K.findFragmentByPDT)(C,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var x=I.sn+1;if(x>=R.startSN&&x<=R.endSN){var _=C[x-R.startSN];I.cc===_.cc&&(w=_,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(K.findFragWithCC)(C,I.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn)}}else{var O=this.hls.liveSyncPosition;null!==O&&(w=this.getFragmentAtPosition(O,this.bitrateTest?R.fragmentEnd:R.edge,R))}return w},C.getFragmentAtPosition=function e(R,C,I){var w,x=this.config,O=this.fragPrevious,F=I.fragments,P=I.endSN,M=I.fragmentHint,N=x.maxFragLookUpTolerance,B=!!(x.lowLatencyMode&&I.partList&&M);if(B&&M&&!this.bitrateTest&&(F=Y()(F).call(F,M),P=M.sn),R<C){var U=R>C-N?0:N;w=Object(K.findFragmentByPTS)(O,F,R,U)}else w=F[F.length-1];if(w){var G=w.sn-I.startSN,j=O&&w.level===O.level,H=F[G+1];if(this.fragmentTracker.getState(w)===_.FragmentState.BACKTRACKED){w=null;for(var V=G;F[V]&&this.fragmentTracker.getState(F[V])===_.FragmentState.BACKTRACKED;)w=O?F[V--]:F[--V];w||(w=H)}else O&&w.sn===O.sn&&!B&&j&&(w.sn<P&&this.fragmentTracker.getState(H)!==_.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+H.sn),w=H):w=null)}return w},C.synchronizeToLiveEdge=function e(R){var C=this.config,I=this.media;if(I){var w=this.hls.liveSyncPosition,x=I.currentTime,_=R.fragments[0].start,O=R.edge,F=x>=_-C.maxFragLookUpTolerance&&x<=O;if(null!==w&&I.duration>w&&(x<w||!F)){var P=void 0!==C.liveMaxLatencyDuration?C.liveMaxLatencyDuration:C.liveMaxLatencyDurationCount*R.targetduration;(!F&&I.readyState<4||x<O-P)&&(this.loadedmetadata||(this.nextLoadPosition=w),I.readyState&&(this.warn("Playback: "+x.toFixed(3)+" is located too far from the end of live sliding playlist: "+O+", reset currentTime to : "+w.toFixed(3)),I.currentTime=w))}}},C.alignPlaylists=function e(R,C){var I=this.levels,x=this.levelLastLoaded,_=this.fragPrevious,O=null!==x?I[x]:null,F=R.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var P=R.fragments[0].start,M=!C,N=R.alignedSliding&&Object(w.isFiniteNumber)(P);if(M||!N&&!P){Object(j.alignStream)(_,O,R);var B=R.fragments[0].start;return this.log("Live playlist sliding: "+B.toFixed(2)+" start-sn: "+(C?C.startSN:"na")+"->"+R.startSN+" prev-sn: "+(_?_.sn:"na")+" fragments: "+F),B}return P},C.waitForCdnTuneIn=function e(R){return R.live&&R.canBlockReload&&R.tuneInGoal>Math.max(R.partHoldBack,3*R.partTarget)},C.setStartPosition=function e(R,C){var I=this.startPosition;if(I<C&&(I=-1),-1===I||-1===this.lastCurrentTime){var x=R.startTimeOffset;Object(w.isFiniteNumber)(x)?(I=C+x,x<0&&(I+=R.totalduration),I=Math.min(Math.max(C,I),C+R.totalduration),this.log("Start time offset "+x+" found in playlist, adjust startPosition to "+I),this.startPosition=I):R.live?I=this.hls.liveSyncPosition||C:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},C.getLoadPosition=function e(){var R=this.media,C=0;return this.loadedmetadata&&R?C=R.currentTime:this.nextLoadPosition&&(C=this.nextLoadPosition),C},C.handleFragLoadAborted=function e(R,C){this.transmuxer&&"initSegment"!==R.sn&&R.stats.aborted&&(this.warn("Fragment "+R.sn+(C?" part"+C.index:"")+" of level "+R.level+" was aborted"),this.resetFragmentLoading(R))},C.resetFragmentLoading=function e(R){this.fragCurrent&&this.fragContextChanged(R)||(this.state=q.IDLE)},C.onFragmentOrKeyLoadError=function e(R,C){if(!C.fatal){var I=C.frag;if(I&&I.type===R){var w=this.fragCurrent;console.assert(w&&I.sn===w.sn&&I.level===w.level&&I.urlId===w.urlId,"Frag load error must match current frag to retry");var x=this.config;if(this.fragLoadError+1<=x.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var _=Math.min(Math.pow(2,this.fragLoadError)*x.fragLoadingRetryDelay,x.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+R+" "+I.level+" failed to load, retrying in "+_+"ms"),this.retryDate=self.performance.now()+_,this.fragLoadError++,this.state=q.FRAG_LOADING_WAITING_RETRY}else C.levelRetry?(R===X.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=q.IDLE):(F.logger.error(C.details+" reaches max retry, redispatch as fatal ..."),C.fatal=!0,this.hls.stopLoad(),this.state=q.ERROR)}}},C.afterBufferFlushed=function e(R,C,I){if(R){var w=O.BufferHelper.getBuffered(R);this.fragmentTracker.detectEvictedFragments(C,w,I),this.state===q.ENDED&&this.resetLoadingState()}},C.resetLoadingState=function e(){this.fragCurrent=null,this.fragPrevious=null,this.state=q.IDLE},C.resetLiveStartWhenNotLoaded=function e(R){if(!this.loadedmetadata){this.startFragRequested=!1;var C=this.levels?this.levels[R].details:null;if(null!=C&&C.live)return this.startPosition=-1,this.setStartPosition(C,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},C.updateLevelTiming=function e(R,C,I,w){var x,_=this,O=I.details;console.assert(!!O,"level.details must be defined");var F=re()(x=ee()(R.elementaryStreams)).call(x,(function(C,x){var F=R.elementaryStreams[x];if(F){var M=F.endPTS-F.startPTS;if(M<=0)return _.warn("Could not parse fragment "+R.sn+" "+x+" duration reliably ("+M+") resetting transmuxer to fallback to playlist timing"),_.resetTransmuxer(),C||!1;var N=w?0:Object(H.updateFragPTSDTS)(O,R,F.startPTS,F.endPTS,F.startDTS,F.endDTS);return _.hls.trigger(P.Events.LEVEL_PTS_UPDATED,{"details":O,"level":I,"drift":N,"type":x,"frag":R,"start":F.startPTS,"end":F.endPTS}),!0}return C}),!1);F?(this.state=q.PARSED,this.hls.trigger(P.Events.FRAG_PARSED,{"frag":R,"part":C})):this.resetLoadingState()},C.resetTransmuxer=function e(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function T(R,C,I){return C&&E(R.prototype,C),I&&E(R,I),R}(t,[{"key":"state","get":function e(){return this._state},"set":function e(R){var C=this._state;C!==R&&(this._state=R,this.log(C+"->"+R))}}]),t}(x.default)},"./src/controller/buffer-controller.ts":function srcControllerBufferControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return j}));var w=I("./src/polyfills/number.ts"),x=I("./src/events.ts"),_=I("./src/utils/logger.ts"),O=I("./src/errors.ts"),F=I("./src/utils/buffer-helper.ts"),P=I("./src/utils/mediasource-helper.ts"),N=I("./src/loader/fragment.ts"),B=I("./src/controller/buffer-operation-queue.ts"),U=Object(P.getMediaSource)(),G=/([ha]vc.)(?:\.[^.,]+)+/,j=function(){function e(R){var C=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var R=C.hls,I=C.media,w=C.mediaSource;_.logger.log("[buffer-controller]: Media source opened"),I&&(C.updateMediaElementDuration(),R.trigger(x.Events.MEDIA_ATTACHED,{"media":I})),w&&w.removeEventListener("sourceopen",C._onMediaSourceOpen),C.checkPendingTracks()},this._onMediaSourceClose=function(){_.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){_.logger.log("[buffer-controller]: Media source ended")},this.hls=R,this._initSourceBuffer(),this.registerListeners()}var R=e.prototype;return R.hasSourceTypes=function e(){return this.getSourceBufferTypes().length>0||ee()(this.pendingTracks).length>0},R.destroy=function e(){this.unregisterListeners(),this.details=null},R.registerListeners=function e(){var R=this.hls;R.on(x.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(x.Events.BUFFER_RESET,this.onBufferReset,this),R.on(x.Events.BUFFER_APPENDING,this.onBufferAppending,this),R.on(x.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.on(x.Events.BUFFER_EOS,this.onBufferEos,this),R.on(x.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),R.on(x.Events.LEVEL_UPDATED,this.onLevelUpdated,this),R.on(x.Events.FRAG_PARSED,this.onFragParsed,this),R.on(x.Events.FRAG_CHANGED,this.onFragChanged,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(x.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(x.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(x.Events.BUFFER_RESET,this.onBufferReset,this),R.off(x.Events.BUFFER_APPENDING,this.onBufferAppending,this),R.off(x.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.off(x.Events.BUFFER_EOS,this.onBufferEos,this),R.off(x.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),R.off(x.Events.LEVEL_UPDATED,this.onLevelUpdated,this),R.off(x.Events.FRAG_PARSED,this.onFragParsed,this),R.off(x.Events.FRAG_CHANGED,this.onFragChanged,this)},R._initSourceBuffer=function e(){this.sourceBuffer={},this.operationQueue=new B.default(this.sourceBuffer),this.listeners={"audio":[],"video":[],"audiovideo":[]}},R.onManifestParsed=function e(R,C){var I=2;(C.audio&&!C.video||!C.altAudio)&&(I=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=I,this.details=null,_.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},R.onMediaAttaching=function e(R,C){var I=this.media=C.media;if(I&&U){var w=this.mediaSource=new U;w.addEventListener("sourceopen",this._onMediaSourceOpen),w.addEventListener("sourceended",this._onMediaSourceEnded),w.addEventListener("sourceclose",this._onMediaSourceClose),I.src=he().createObjectURL(w),this._objectUrl=I.src}},R.onMediaDetaching=function e(){var R=this.media,C=this.mediaSource,I=this._objectUrl;if(C){if(_.logger.log("[buffer-controller]: media source detaching"),"open"===C.readyState)try{C.endOfStream()}catch(e){_.logger.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),C.removeEventListener("sourceopen",this._onMediaSourceOpen),C.removeEventListener("sourceended",this._onMediaSourceEnded),C.removeEventListener("sourceclose",this._onMediaSourceClose),R&&(I&&he().revokeObjectURL(I),R.src===I?(R.removeAttribute("src"),R.load()):_.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(x.Events.MEDIA_DETACHED,void 0)},R.onBufferReset=function e(){var R,C=this;ne()(R=this.getSourceBufferTypes()).call(R,(function(R){var I=C.sourceBuffer[R];try{I&&(C.removeBufferListeners(R),C.mediaSource&&C.mediaSource.removeSourceBuffer(I),C.sourceBuffer[R]=void 0)}catch(C){_.logger.warn("[buffer-controller]: Failed to reset the "+R+" buffer",C)}})),this._initSourceBuffer()},R.onBufferCodecs=function e(R,C){var I,w=this,x=this.getSourceBufferTypes().length;ne()(I=ee()(C)).call(I,(function(R){if(x){var I=w.tracks[R];if(I&&"function"==typeof I.buffer.changeType){var _=C[R],O=_.codec,F=_.levelCodec,P=_.container;if((I.levelCodec||I.codec).replace(G,"$1")!==(F||O).replace(G,"$1")){var M=P+";codecs="+(F||O);w.appendChangeType(R,M)}}}else w.pendingTracks[R]=C[R]})),x||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},R.appendChangeType=function e(R,C){var I=this,w=this.operationQueue,x={"execute":function e(){var x=I.sourceBuffer[R];x&&(_.logger.log("[buffer-controller]: changing "+R+" sourceBuffer type to "+C),x.changeType(C)),w.shiftAndExecuteNext(R)},"onStart":function e(){},"onComplete":function e(){},"onError":function e(C){_.logger.warn("[buffer-controller]: Failed to change "+R+" SourceBuffer type",C)}};w.append(x,R)},R.onBufferAppending=function e(R,C){var I=this,w=this.hls,P=this.operationQueue,M=this.tracks,N=C.data,B=C.type,U=C.frag,G=C.part,j=C.chunkMeta,K=j.buffering[B],H=self.performance.now();K.start=H;var V=U.stats.buffering,W=G?G.stats.buffering:null;0===V.start&&(V.start=H),W&&0===W.start&&(W.start=H);var Y=M.audio,z="audio"===B&&1===j.id&&"audio/mpeg"===(null==Y?void 0:Y.container),X={"execute":function e(){if(K.executeStart=self.performance.now(),z){var R=I.sourceBuffer[B];if(R){var C=U.start-R.timestampOffset;Math.abs(C)>=.1&&(_.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+U.start+" (delta: "+C+") sn: "+U.sn+")"),R.timestampOffset=U.start)}}I.appendExecutor(N,B)},"onStart":function e(){},"onComplete":function e(){var R=self.performance.now();K.executeEnd=K.end=R,0===V.first&&(V.first=R),W&&0===W.first&&(W.first=R);var C=I.sourceBuffer,w={};for(var _ in C)w[_]=F.BufferHelper.getBuffered(C[_]);I.appendError=0,I.hls.trigger(x.Events.BUFFER_APPENDED,{"type":B,"frag":U,"part":G,"chunkMeta":j,"parent":U.type,"timeRanges":w})},"onError":function e(R){_.logger.error("[buffer-controller]: Error encountered while trying to append to the "+B+" SourceBuffer",R);var C={"type":O.ErrorTypes.MEDIA_ERROR,"parent":U.type,"details":O.ErrorDetails.BUFFER_APPEND_ERROR,"err":R,"fatal":!1};R.code===DOMException.QUOTA_EXCEEDED_ERR?C.details=O.ErrorDetails.BUFFER_FULL_ERROR:(I.appendError++,C.details=O.ErrorDetails.BUFFER_APPEND_ERROR,I.appendError>w.config.appendErrorMaxRetry&&(_.logger.error("[buffer-controller]: Failed "+w.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),C.fatal=!0)),w.trigger(x.Events.ERROR,C)}};P.append(X,B)},R.onBufferFlushing=function e(R,C){var I,w=this,O=this.operationQueue,F=function e(R){return{"execute":w.removeExecutor.bind(w,R,C.startOffset,C.endOffset),"onStart":function e(){},"onComplete":function e(){w.hls.trigger(x.Events.BUFFER_FLUSHED,{"type":R})},"onError":function e(C){_.logger.warn("[buffer-controller]: Failed to remove from "+R+" SourceBuffer",C)}}};C.type?O.append(F(C.type),C.type):ne()(I=this.getSourceBufferTypes()).call(I,(function(R){O.append(F(R),R)}))},R.onFragParsed=function e(R,C){var I=this,w=C.frag,O=C.part,F=[],P=O?O.elementaryStreams:w.elementaryStreams;P[N.ElementaryStreamTypes.AUDIOVIDEO]?F.push("audiovideo"):(P[N.ElementaryStreamTypes.AUDIO]&&F.push("audio"),P[N.ElementaryStreamTypes.VIDEO]&&F.push("video"));0===F.length&&_.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+w.type+" level: "+w.level+" sn: "+w.sn),this.blockBuffers((function e(){var R=self.performance.now();w.stats.buffering.end=R,O&&(O.stats.buffering.end=R);var C=O?O.stats:w.stats;I.hls.trigger(x.Events.FRAG_BUFFERED,{"frag":w,"part":O,"stats":C,"id":w.type})}),F)},R.onFragChanged=function e(R,C){this.flushBackBuffer()},R.onBufferEos=function e(R,C){var I,w=this,x=re()(I=this.getSourceBufferTypes()).call(I,(function(R,I){var x=w.sourceBuffer[I];return C.type&&C.type!==I||x&&!x.ended&&(x.ended=!0,_.logger.log("[buffer-controller]: "+I+" sourceBuffer now EOS")),R&&!(x&&!x.ended)}),!0);x&&this.blockBuffers((function(){var R=w.mediaSource;R&&"open"===R.readyState&&R.endOfStream()}))},R.onLevelUpdated=function e(R,C){var I=C.details;I.fragments.length&&(this.details=I,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},R.flushBackBuffer=function e(){var R=this.hls,C=this.details,I=this.media,_=this.sourceBuffer;if(I&&null!==C){var O=this.getSourceBufferTypes();if(O.length){var P=C.live&&null!==R.config.liveBackBufferLength?R.config.liveBackBufferLength:R.config.backBufferLength;if(Object(w.isFiniteNumber)(P)&&!(P<0)){var M=I.currentTime,N=C.levelTargetDuration,B=Math.max(P,N),U=Math.floor(M/N)*N-B;ne()(O).call(O,(function(I){var w=_[I];if(w){var O=F.BufferHelper.getBuffered(w);O.length>0&&U>O.start(0)&&(R.trigger(x.Events.BACK_BUFFER_REACHED,{"bufferEnd":U}),C.live&&R.trigger(x.Events.LIVE_BACK_BUFFER_REACHED,{"bufferEnd":U}),R.trigger(x.Events.BUFFER_FLUSHING,{"startOffset":0,"endOffset":U,"type":I}))}}))}}}},R.updateMediaElementDuration=function e(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var R=this.details,C=this.hls,I=this.media,x=this.mediaSource,O=R.fragments[0].start+R.totalduration,F=I.duration,P=Object(w.isFiniteNumber)(x.duration)?x.duration:0;R.live&&C.config.liveDurationInfinity?(_.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),x.duration=1/0,this.updateSeekableRange(R)):(O>P&&O>F||!Object(w.isFiniteNumber)(F))&&(_.logger.log("[buffer-controller]: Updating Media Source duration to "+O.toFixed(3)),x.duration=O)}},R.updateSeekableRange=function e(R){var C=this.mediaSource,I=R.fragments;if(I.length&&R.live&&null!=C&&C.setLiveSeekableRange){var w=Math.max(0,I[0].start),x=Math.max(w,w+R.totalduration);C.setLiveSeekableRange(w,x)}},R.checkPendingTracks=function e(){var R=this.bufferCodecEventsExpected,C=this.operationQueue,I=this.pendingTracks,w=ee()(I).length;if(w&&!R||2===w){this.createSourceBuffers(I),this.pendingTracks={};var _=this.getSourceBufferTypes();if(0===_.length)return void this.hls.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"reason":"could not create source buffer for media codec(s)"});ne()(_).call(_,(function(R){C.executeNext(R)}))}},R.createSourceBuffers=function e(R){var C=this.sourceBuffer,I=this.mediaSource;if(!I)throw Error("createSourceBuffers called when mediaSource was null");var w=0;for(var F in R)if(!C[F]){var P=R[F];if(!P)throw Error("source buffer exists for track "+F+", however track does not");var M=P.levelCodec||P.codec,N=P.container+";codecs="+M;_.logger.log("[buffer-controller]: creating sourceBuffer("+N+")");try{var B=C[F]=I.addSourceBuffer(N),U=F;this.addBufferListener(U,"updatestart",this._onSBUpdateStart),this.addBufferListener(U,"updateend",this._onSBUpdateEnd),this.addBufferListener(U,"error",this._onSBUpdateError),this.tracks[F]={"buffer":B,"codec":M,"container":P.container,"levelCodec":P.levelCodec,"id":P.id},w++}catch(e){_.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.BUFFER_ADD_CODEC_ERROR,"fatal":!1,"error":e,"mimeType":N})}}w&&this.hls.trigger(x.Events.BUFFER_CREATED,{"tracks":this.tracks})},R._onSBUpdateStart=function e(R){this.operationQueue.current(R).onStart()},R._onSBUpdateEnd=function e(R){var C=this.operationQueue;C.current(R).onComplete(),C.shiftAndExecuteNext(R)},R._onSBUpdateError=function e(R,C){_.logger.error("[buffer-controller]: "+R+" SourceBuffer error",C),this.hls.trigger(x.Events.ERROR,{"type":O.ErrorTypes.MEDIA_ERROR,"details":O.ErrorDetails.BUFFER_APPENDING_ERROR,"fatal":!1});var I=this.operationQueue.current(R);I&&I.onError(C)},R.removeExecutor=function e(R,C,I){var x=this.media,O=this.mediaSource,F=this.operationQueue,P=this.sourceBuffer[R];if(!x||!O||!P)return _.logger.warn("[buffer-controller]: Attempting to remove from the "+R+" SourceBuffer, but it does not exist"),void F.shiftAndExecuteNext(R);var M=Object(w.isFiniteNumber)(x.duration)?x.duration:1/0,N=Object(w.isFiniteNumber)(O.duration)?O.duration:1/0,B=Math.max(0,C),U=Math.min(I,M,N);U>B?(_.logger.log("[buffer-controller]: Removing ["+B+","+U+"] from the "+R+" SourceBuffer"),console.assert(!P.updating,R+" sourceBuffer must not be updating"),P.remove(B,U)):F.shiftAndExecuteNext(R)},R.appendExecutor=function e(R,C){var I=this.operationQueue,w=this.sourceBuffer[C];if(!w)return _.logger.warn("[buffer-controller]: Attempting to append to the "+C+" SourceBuffer, but it does not exist"),void I.shiftAndExecuteNext(C);w.ended=!1,console.assert(!w.updating,C+" sourceBuffer must not be updating"),w.appendBuffer(R)},R.blockBuffers=function e(R,C){var I=this;if(void 0===C&&(C=this.getSourceBufferTypes()),C.length){var w=this.operationQueue,x=ce()(C).call(C,(function(R){return w.appendBlocker(R)}));M().all(x).then((function(){R(),ne()(C).call(C,(function(R){var C=I.sourceBuffer[R];C&&C.updating||w.shiftAndExecuteNext(R)}))}))}else _.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist")},R.getSourceBufferTypes=function e(){return ee()(this.sourceBuffer)},R.addBufferListener=function e(R,C,I){var w=this.sourceBuffer[R];if(w){var x=I.bind(this,R);this.listeners[R].push({"event":C,"listener":x}),w.addEventListener(C,x)}},R.removeBufferListeners=function e(R){var C,I=this.sourceBuffer[R];I&&ne()(C=this.listeners[R]).call(C,(function(R){I.removeEventListener(R.event,R.listener)}))},e}()},"./src/controller/buffer-operation-queue.ts":function srcControllerBufferOperationQueueTs(R,C,I){I.r(C),I.d(C,"default",(function(){return x}));var w=I("./src/utils/logger.ts"),x=function(){function e(R){this.buffers=void 0,this.queues={"video":[],"audio":[],"audiovideo":[]},this.buffers=R}var R=e.prototype;return R.append=function e(R,C){var I=this.queues[C];I.push(R),1===I.length&&this.buffers[C]&&this.executeNext(C)},R.insertAbort=function e(R,C){this.queues[C].unshift(R),this.executeNext(C)},R.appendBlocker=function e(R){var C,I=new(M())((function(R){C=R})),w={"execute":C,"onStart":function e(){},"onComplete":function e(){},"onError":function e(){}};return this.append(w,R),I},R.executeNext=function e(R){var C=this.buffers,I=this.queues,x=C[R],_=I[R];if(_.length){var O=_[0];try{O.execute()}catch(e){w.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),O.onError(e),x&&x.updating||(_.shift(),this.executeNext(R))}}},R.shiftAndExecuteNext=function e(R){this.queues[R].shift(),this.executeNext(R)},R.current=function e(R){return this.queues[R][0]},e}()},"./src/controller/cap-level-controller.ts":function srcControllerCapLevelControllerTs(R,C,I){I.r(C);var w=I("./src/events.ts");function a(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var x=function(){function e(R){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=R,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=e.prototype;return R.setStreamController=function e(R){this.streamController=R},R.destroy=function e(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function e(){var R=this.hls;R.on(w.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),R.on(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(w.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function e(){var R=this.hls;R.off(w.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),R.off(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(w.Events.BUFFER_CODECS,this.onBufferCodecs,this),R.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function t(R,C){e.isLevelAllowed(C.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(C.droppedLevel)},R.onMediaAttaching=function e(R,C){this.media=C.media instanceof HTMLVideoElement?C.media:null},R.onManifestParsed=function e(R,C){var I=this.hls;this.restrictedLevels=[],this.firstLevel=C.firstLevel,I.config.capLevelToPlayerSize&&C.video&&this.startCapping()},R.onBufferCodecs=function e(R,C){this.hls.config.capLevelToPlayerSize&&C.video&&this.startCapping()},R.onMediaDetaching=function e(){this.stopCapping()},R.detectPlayerSize=function e(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var R=this.hls.levels;if(R.length){var C=this.hls;C.autoLevelCapping=this.getMaxLevel(R.length-1),C.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=C.autoLevelCapping}}},R.getMaxLevel=function t(R){var C=this,I=this.hls.levels;if(!I.length)return-1;var w=se()(I).call(I,(function(I,w){return e.isLevelAllowed(w,C.restrictedLevels)&&w<=R}));return this.clientRect=null,e.getMaxLevelByMediaSize(w,this.mediaWidth,this.mediaHeight)},R.startCapping=function e(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function e(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function e(){if(this.clientRect)return this.clientRect;var R=this.media,C={"width":0,"height":0};if(R){var I=R.getBoundingClientRect();C.width=I.width,C.height=I.height,C.width||C.height||(C.width=I.right-I.left||R.width||0,C.height=I.bottom-I.top||R.height||0)}return this.clientRect=C,C},e.isLevelAllowed=function e(R,C){return void 0===C&&(C=[]),-1===Ce()(C).call(C,R)},e.getMaxLevelByMediaSize=function e(R,C,I){if(!R||!R.length)return-1;for(var w=function e(R,C){return!C||(R.width!==C.width||R.height!==C.height)},x=R.length-1,_=0;_<R.length;_+=1){var O=R[_];if((O.width>=C||O.height>=I)&&w(O,R[_+1])){x=_;break}}return x},function n(R,C,I){return C&&a(R.prototype,C),I&&a(R,I),R}(e,[{"key":"mediaWidth","get":function t(){return this.getDimensions().width*e.contentScaleFactor}},{"key":"mediaHeight","get":function t(){return this.getDimensions().height*e.contentScaleFactor}}],[{"key":"contentScaleFactor","get":function e(){var R=1;try{R=self.devicePixelRatio}catch(e){}return R}}]),e}();C.default=x},"./src/controller/cmcd-controller.ts":function srcControllerCmcdControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return M}));var x=I("./src/events.ts"),O=I("./src/types/cmcd.ts"),F=I("./src/utils/buffer-helper.ts"),P=I("./src/utils/logger.ts");function o(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}function u(R,C){var I=void 0!==_()&&_e()(R)||R["@@iterator"];if(I)return(I=I.call(R)).next.bind(I);if(Array.isArray(R)||(I=function f(R,C){var I;if(!R)return;if("string"==typeof R)return c(R,C);var w=K()(I=Object.prototype.toString.call(R)).call(I,8,-1);"Object"===w&&R.constructor&&(w=R.constructor.name);if("Map"===w||"Set"===w)return Fe()(R);if("Arguments"===w||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w))return c(R,C)}(R))||C&&R&&"number"==typeof R.length){I&&(R=I);var w=0;return function(){return w>=R.length?{"done":!0}:{"done":!1,"value":R[w++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(R,C){(null==C||C>R.length)&&(C=R.length);for(var I=0,w=new Array(C);I<C;I++)w[I]=R[I];return w}function d(){return d=ge()||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(R[w]=I[w])}return R},d.apply(this,arguments)}var M=function(){function e(R){var C=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){C.initialized&&(C.starved=!0),C.buffering=!0},this.onPlaying=function(){C.initialized||(C.initialized=!0),C.buffering=!1},this.applyPlaylistData=function(R){try{C.apply(R,{"ot":O.CMCDObjectType.MANIFEST,"su":!C.initialized})}catch(R){P.logger.warn("Could not generate manifest CMCD data.",R)}},this.applyFragmentData=function(R){try{var I=R.frag,w=C.hls.levels[I.level],x=C.getObjectType(I),_={"d":1e3*I.duration,"ot":x};x!==O.CMCDObjectType.VIDEO&&x!==O.CMCDObjectType.AUDIO&&x!=O.CMCDObjectType.MUXED||(_.br=w.bitrate/1e3,_.tb=C.getTopBandwidth(x)/1e3,_.bl=C.getBufferLength(x)),C.apply(R,_)}catch(R){P.logger.warn("Could not generate segment CMCD data.",R)}},this.hls=R;var I=this.config=R.config,w=I.cmcd;null!=w&&(I.pLoader=this.createPlaylistLoader(),I.fLoader=this.createFragmentLoader(),this.sid=w.sessionId||e.uuid(),this.cid=w.contentId,this.useHeaders=!0===w.useHeaders,this.registerListeners())}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(x.Events.MEDIA_DETACHED,this.onMediaDetached,this),R.on(x.Events.BUFFER_CREATED,this.onBufferCreated,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(x.Events.MEDIA_DETACHED,this.onMediaDetached,this),R.off(x.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},R.destroy=function e(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},R.onMediaAttached=function e(R,C){this.media=C.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},R.onMediaDetached=function e(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},R.onBufferCreated=function e(R,C){var I,w;this.audioBuffer=null===(I=C.tracks.audio)||void 0===I?void 0:I.buffer,this.videoBuffer=null===(w=C.tracks.video)||void 0===w?void 0:w.buffer},R.createData=function e(){var R;return{"v":O.CMCDVersion,"sf":O.CMCDStreamingFormat.HLS,"sid":this.sid,"cid":this.cid,"pr":null===(R=this.media)||void 0===R?void 0:R.playbackRate,"mtp":this.hls.bandwidthEstimate/1e3}},R.apply=function t(R,C){void 0===C&&(C={}),d(C,this.createData());var I=C.ot===O.CMCDObjectType.INIT||C.ot===O.CMCDObjectType.VIDEO||C.ot===O.CMCDObjectType.MUXED;if(this.starved&&I&&(C.bs=!0,C.su=!0,this.starved=!1),null==C.su&&(C.su=this.buffering),this.useHeaders){var w=e.toHeaders(C);if(!ee()(w).length)return;R.headers||(R.headers={}),d(R.headers,w)}else{var x=e.toQuery(C);if(!x)return;R.url=e.appendQueryToUri(R.url,x)}},R.getObjectType=function e(R){var C=R.type;return"subtitle"===C?O.CMCDObjectType.TIMED_TEXT:"initSegment"===R.sn?O.CMCDObjectType.INIT:"audio"===C?O.CMCDObjectType.AUDIO:"main"===C?this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED:void 0},R.getTopBandwidth=function e(R){var C,I=0,w=this.hls;if(R===O.CMCDObjectType.AUDIO)C=w.audioTracks;else{var x,_=w.maxAutoLevel,F=_>-1?_+1:w.levels.length;C=K()(x=w.levels).call(x,0,F)}for(var P,M=u(C);!(P=M()).done;){var N=P.value;N.bitrate>I&&(I=N.bitrate)}return I>0?I:NaN},R.getBufferLength=function e(R){var C=this.hls.media,I=R===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return I&&C?1e3*F.BufferHelper.bufferInfo(I,C.currentTime,this.config.maxBufferHole).len:NaN},R.createPlaylistLoader=function e(){var R=this.config.pLoader,C=this.applyPlaylistData,I=R||this.config.loader;return function(){function e(R){this.loader=void 0,this.loader=new I(R)}var R=e.prototype;return R.destroy=function e(){this.loader.destroy()},R.abort=function e(){this.loader.abort()},R.load=function e(R,I,w){C(R),this.loader.load(R,I,w)},l(e,[{"key":"stats","get":function e(){return this.loader.stats}},{"key":"context","get":function e(){return this.loader.context}}]),e}()},R.createFragmentLoader=function e(){var R=this.config.fLoader,C=this.applyFragmentData,I=R||this.config.loader;return function(){function e(R){this.loader=void 0,this.loader=new I(R)}var R=e.prototype;return R.destroy=function e(){this.loader.destroy()},R.abort=function e(){this.loader.abort()},R.load=function e(R,I,w){C(R),this.loader.load(R,I,w)},l(e,[{"key":"stats","get":function e(){return this.loader.stats}},{"key":"context","get":function e(){return this.loader.context}}]),e}()},e.uuid=function e(){var R=he().createObjectURL(new Blob),e=R.toString();return he().revokeObjectURL(R),e.substr(Z()(e).call(e,"/")+1)},e.serialize=function e(R){for(var C,I,x=[],_=function e(R){return!Me()(R)&&null!=R&&""!==R&&!1!==R},O=function e(R){return Math.round(R)},F=function e(R){return 100*O(R/100)},P={"br":O,"d":O,"bl":F,"dl":F,"mtp":F,"nor":function e(R){return encodeURIComponent(R)},"rtp":F,"tb":O},M=u(Be()(C=ee()(R||{})).call(C));!(I=M()).done;){var N=I.value,B=R[N];if(_(B)&&!("v"===N&&1===B||"pr"==N&&1===B)){var U=P[N];U&&(B=U(B));var G=(0,w.Z)(B),j=void 0;j="ot"===N||"sf"===N||"st"===N?N+"="+B:"boolean"===G?N:"number"===G?N+"="+B:N+"="+le()(B),x.push(j)}}return x.join(",")},e.toHeaders=function t(R){for(var C={},I=["Object","Request","Session","Status"],w=[{},{},{},{}],x={"br":0,"d":0,"ot":0,"tb":0,"bl":1,"dl":1,"mtp":1,"nor":1,"nrr":1,"su":1,"cid":2,"pr":2,"sf":2,"sid":2,"st":2,"v":2,"bs":3,"rtp":3},_=0,O=ee()(R);_<O.length;_++){var F=O[_];w[null!=x[F]?x[F]:1][F]=R[F]}for(var P=0;P<w.length;P++){var M=e.serialize(w[P]);M&&(C["CMCD-"+I[P]]=M)}return C},e.toQuery=function t(R){return"CMCD="+encodeURIComponent(e.serialize(R))},e.appendQueryToUri=function e(R,C){return C?""+R+(Ge()(R).call(R,"?")?"&":"?")+C:R},e}()},"./src/controller/eme-controller.ts":function srcControllerEmeControllerTs(R,C,I){I.r(C);var w=I("./src/events.ts"),x=I("./src/errors.ts"),_=I("./src/utils/logger.ts"),O=I("./src/utils/mediakeys-helper.ts");function o(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var F=function e(R,C,I,w){if(R===O.KeySystems.WIDEVINE)return function e(R,C,I){var w={"audioCapabilities":[],"videoCapabilities":[]};return ne()(R).call(R,(function(R){w.audioCapabilities.push({"contentType":'audio/mp4; codecs="'+R+'"',"robustness":I.audioRobustness||""})})),ne()(C).call(C,(function(R){w.videoCapabilities.push({"contentType":'video/mp4; codecs="'+R+'"',"robustness":I.videoRobustness||""})})),[w]}(C,I,w);throw new Error("Unknown key-system: "+R)},P=function(){function e(R){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=R,this._config=R.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var R=e.prototype;return R.destroy=function e(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},R._registerListeners=function e(){this.hls.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this)},R._unregisterListeners=function e(){this.hls.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this)},R.getLicenseServerUrl=function e(R){switch(R){case O.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+R+'"')},R._attemptKeySystemAccess=function e(R,C,I){var w=this,x=F(R,C,I,this._drmSystemOptions);_.logger.log("Requesting encrypted media key-system access");var O=this.requestMediaKeySystemAccess(R,x);this.mediaKeysPromise=O.then((function(C){return w._onMediaKeySystemAccessObtained(R,C)})),O.catch((function(C){_.logger.error('Failed to obtain key-system "'+R+'" access:',C)}))},R._onMediaKeySystemAccessObtained=function e(R,C){var I=this;_.logger.log('Access for key-system "'+R+'" obtained');var w={"mediaKeysSessionInitialized":!1,"mediaKeySystemAccess":C,"mediaKeySystemDomain":R};this._mediaKeysList.push(w);var x=M().resolve().then((function(){return C.createMediaKeys()})).then((function(C){return w.mediaKeys=C,_.logger.log('Media-keys created for key-system "'+R+'"'),I._onMediaKeysCreated(),C}));return x.catch((function(R){_.logger.error("Failed to create media-keys:",R)})),x},R._onMediaKeysCreated=function e(){var R,C=this;ne()(R=this._mediaKeysList).call(R,(function(R){R.mediaKeysSession||(R.mediaKeysSession=R.mediaKeys.createSession(),C._onNewMediaKeySession(R.mediaKeysSession))}))},R._onNewMediaKeySession=function e(R){var C=this;_.logger.log("New key-system session "+R.sessionId),R.addEventListener("message",(function(I){C._onKeySessionMessage(R,I.message)}),!1)},R._onKeySessionMessage=function e(R,C){_.logger.log("Got EME message event, creating license request"),this._requestLicense(C,(function(C){_.logger.log("Received license data (length: "+(C?C.byteLength:C)+"), updating key-session"),R.update(C)}))},R.onMediaEncrypted=function e(R){var C=this;if(_.logger.log('Media is encrypted using "'+R.initDataType+'" init data type'),!this.mediaKeysPromise)return _.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_NO_KEYS,"fatal":!0});var I=function e(I){C._media&&(C._attemptSetMediaKeys(I),C._generateRequestWithPreferredKeySession(R.initDataType,R.initData))};this.mediaKeysPromise.then(I).catch(I)},R._attemptSetMediaKeys=function e(R){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var C=this._mediaKeysList[0];if(!C||!C.mediaKeys)return _.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_NO_KEYS,"fatal":!0});_.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(C.mediaKeys),this._hasSetMediaKeys=!0}},R._generateRequestWithPreferredKeySession=function e(R,C){var I=this,O=this._mediaKeysList[0];if(!O)return _.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_NO_ACCESS,"fatal":!0});if(O.mediaKeysSessionInitialized)_.logger.warn("Key-Session already initialized but requested again");else{var F=O.mediaKeysSession;if(!F)return _.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_NO_SESSION,"fatal":!0});if(!C)return _.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,"fatal":!0});_.logger.log('Generating key-session request for "'+R+'" init data type'),O.mediaKeysSessionInitialized=!0,F.generateRequest(R,C).then((function(){_.logger.debug("Key-session generation succeeded")})).catch((function(R){_.logger.error("Error generating key-session request:",R),I.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_NO_SESSION,"fatal":!1})}))}},R._createLicenseXhr=function e(R,C,I){var w=new XMLHttpRequest;w.responseType="arraybuffer",w.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,w,R,C,I);var x=this._licenseXhrSetup;if(x)try{x.call(this.hls,w,R),x=void 0}catch(e){_.logger.error(e)}try{w.readyState||w.open("POST",R,!0),x&&x.call(this.hls,w,R)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return w},R._onLicenseRequestReadyStageChange=function e(R,C,I,O){if(4===R.readyState)if(200===R.status){this._requestLicenseFailureCount=0,_.logger.log("License request succeeded");var F=R.response,P=this._licenseResponseCallback;if(P)try{F=P.call(this.hls,R,C)}catch(e){_.logger.error(e)}O(F)}else{if(_.logger.error("License Request XHR failed ("+C+"). Status: "+R.status+" ("+R.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,"fatal":!0});var M=3-this._requestLicenseFailureCount+1;_.logger.warn("Retrying license request, "+M+" attempts left"),this._requestLicense(I,O)}},R._generateLicenseRequestChallenge=function e(R,C){if(R.mediaKeySystemDomain===O.KeySystems.WIDEVINE)return C;throw new Error("unsupported key-system: "+R.mediaKeySystemDomain)},R._requestLicense=function e(R,C){_.logger.log("Requesting content license for key-system");var I=this._mediaKeysList[0];if(!I)return _.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_NO_ACCESS,"fatal":!0});try{var O=this.getLicenseServerUrl(I.mediaKeySystemDomain),F=this._createLicenseXhr(O,R,C);_.logger.log("Sending license request to URL: "+O);var P=this._generateLicenseRequestChallenge(I,R);F.send(P)}catch(e){_.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.KEY_SYSTEM_ERROR,"details":x.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,"fatal":!0})}},R.onMediaAttached=function e(R,C){if(this._emeEnabled){var I=C.media;this._media=I,I.addEventListener("encrypted",this._onMediaEncrypted)}},R.onMediaDetached=function e(){var R=this._media,C=this._mediaKeysList;R&&(R.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],M().all(ce()(C).call(C,(function(R){if(R.mediaKeysSession)return R.mediaKeysSession.close().catch((function(){}))}))).then((function(){return R.setMediaKeys(null)})).catch((function(){})))},R.onManifestParsed=function e(R,C){var I,w,x,_;if(this._emeEnabled){var F=se()(I=ce()(w=C.levels).call(w,(function(R){return R.audioCodec}))).call(I,(function(R){return!!R})),P=se()(x=ce()(_=C.levels).call(_,(function(R){return R.videoCodec}))).call(x,(function(R){return!!R}));this._attemptKeySystemAccess(O.KeySystems.WIDEVINE,F,P)}},function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}(e,[{"key":"requestMediaKeySystemAccess","get":function e(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}();C.default=P},"./src/controller/fps-controller.ts":function srcControllerFpsControllerTs(R,C,I){I.r(C);var w=I("./src/events.ts"),x=I("./src/utils/logger.ts"),_=function(){function e(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var R=e.prototype;return R.setStreamController=function e(R){this.streamController=R},R.registerListeners=function e(){this.hls.on(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function e(){this.hls.off(w.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function e(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function e(R,C){var I=this.hls.config;if(I.capLevelOnFPSDrop){var w=C.media instanceof self.HTMLVideoElement?C.media:null;this.media=w,w&&"function"==typeof w.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),I.fpsDroppedMonitoringPeriod)}},R.checkFPS=function e(R,C,I){var _=performance.now();if(C){if(this.lastTime){var O=_-this.lastTime,F=I-this.lastDroppedFrames,P=C-this.lastDecodedFrames,M=1e3*F/O,N=this.hls;if(N.trigger(w.Events.FPS_DROP,{"currentDropped":F,"currentDecoded":P,"totalDroppedFrames":I}),M>0&&F>N.config.fpsDroppedMonitoringThreshold*P){var B=N.currentLevel;x.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+B),B>0&&(-1===N.autoLevelCapping||N.autoLevelCapping>=B)&&(B-=1,N.trigger(w.Events.FPS_DROP_LEVEL_CAPPING,{"level":B,"droppedLevel":N.currentLevel}),N.autoLevelCapping=B,this.streamController.nextLevelSwitch())}}this.lastTime=_,this.lastDroppedFrames=I,this.lastDecodedFrames=C}},R.checkFPSInterval=function e(){var R=this.media;if(R)if(this.isVideoPlaybackQualityAvailable){var C=R.getVideoPlaybackQuality();this.checkFPS(R,C.totalVideoFrames,C.droppedVideoFrames)}else this.checkFPS(R,R.webkitDecodedFrameCount,R.webkitDroppedFrameCount)},e}();C.default=_},"./src/controller/fragment-finders.ts":function srcControllerFragmentFindersTs(R,C,I){I.r(C),I.d(C,"findFragmentByPDT",(function(){return n})),I.d(C,"findFragmentByPTS",(function(){return s})),I.d(C,"fragmentWithinToleranceTest",(function(){return o})),I.d(C,"pdtWithinToleranceTest",(function(){return l})),I.d(C,"findFragWithCC",(function(){return u}));var w=I("./src/polyfills/number.ts"),x=I("./src/utils/binary-search.ts");function n(R,C,I){if(null===C||!Array.isArray(R)||!R.length||!Object(w.isFiniteNumber)(C))return null;if(C<(R[0].programDateTime||0))return null;if(C>=(R[R.length-1].endProgramDateTime||0))return null;I=I||0;for(var x=0;x<R.length;++x){var _=R[x];if(l(C,I,_))return _}return null}function s(R,C,I,w){void 0===I&&(I=0),void 0===w&&(w=0);var _=null;if(R?_=C[R.sn-C[0].sn+1]||null:0===I&&0===C[0].start&&(_=C[0]),_&&0===o(I,w,_))return _;var O=x.default.search(C,o.bind(null,I,w));return O||_}function o(R,C,I){void 0===R&&(R=0),void 0===C&&(C=0);var w=Math.min(C,I.duration+(I.deltaPTS?I.deltaPTS:0));return I.start+I.duration-w<=R?1:I.start-w>R&&I.start?-1:0}function l(R,C,I){var w=1e3*Math.min(C,I.duration+(I.deltaPTS?I.deltaPTS:0));return(I.endProgramDateTime||0)-w>R}function u(R,C){return x.default.search(R,(function(R){return R.cc<C?1:R.cc>C?-1:0}))}},"./src/controller/fragment-tracker.ts":function srcControllerFragmentTrackerTs(R,C,I){I.r(C),I.d(C,"FragmentState",(function(){return w})),I.d(C,"FragmentTracker",(function(){return O}));var w,x=I("./src/events.ts"),_=I("./src/types/loader.ts");!function(R){R.NOT_LOADED="NOT_LOADED",R.BACKTRACKED="BACKTRACKED",R.APPENDING="APPENDING",R.PARTIAL="PARTIAL",R.OK="OK"}(w||(w={}));var O=function(){function e(R){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=R,this._registerListeners()}var R=e.prototype;return R._registerListeners=function e(){var R=this.hls;R.on(x.Events.BUFFER_APPENDED,this.onBufferAppended,this),R.on(x.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.on(x.Events.FRAG_LOADED,this.onFragLoaded,this)},R._unregisterListeners=function e(){var R=this.hls;R.off(x.Events.BUFFER_APPENDED,this.onBufferAppended,this),R.off(x.Events.FRAG_BUFFERED,this.onFragBuffered,this),R.off(x.Events.FRAG_LOADED,this.onFragLoaded,this)},R.destroy=function e(){this._unregisterListeners(),this.fragments=this.timeRanges=null},R.getAppendedFrag=function e(R,C){if(C===_.PlaylistLevelType.MAIN){var I=this.activeFragment,w=this.activeParts;if(!I)return null;if(w)for(var x=w.length;x--;){var O=w[x],F=O?O.end:I.appendedPTS;if(O.start<=R&&void 0!==F&&R<=F)return x>9&&(this.activeParts=K()(w).call(w,x-9)),O}else if(I.start<=R&&void 0!==I.appendedPTS&&R<=I.appendedPTS)return I}return this.getBufferedFrag(R,C)},R.getBufferedFrag=function e(R,C){for(var I=this.fragments,w=ee()(I),x=w.length;x--;){var _=I[w[x]];if((null==_?void 0:_.body.type)===C&&_.buffered){var O=_.body;if(O.start<=R&&R<=O.end)return O}}return null},R.detectEvictedFragments=function e(R,C,I){var w,x=this;ne()(w=ee()(this.fragments)).call(w,(function(w){var _,O=x.fragments[w];if(O)if(O.buffered){var F=O.range[R];F&&Le()(_=F.time).call(_,(function(R){var I=!x.isTimeBuffered(R.startPTS,R.endPTS,C);return I&&x.removeFragment(O.body),I}))}else O.body.type===I&&x.removeFragment(O.body)}))},R.detectPartialFragments=function e(R){var C,I=this,w=this.timeRanges,x=R.frag,_=R.part;if(w&&"initSegment"!==x.sn){var O=l(x),F=this.fragments[O];F&&(ne()(C=ee()(w)).call(C,(function(R){var C=x.elementaryStreams[R];if(C){var O=w[R],P=null!==_||!0===C.partial;F.range[R]=I.getBufferedTimes(x,_,P,O)}})),F.backtrack=F.loaded=null,ee()(F.range).length?F.buffered=!0:this.removeFragment(F.body))}},R.fragBuffered=function e(R){var C=l(R),I=this.fragments[C];I&&(I.backtrack=I.loaded=null,I.buffered=!0)},R.getBufferedTimes=function e(R,C,I,w){for(var x={"time":[],"partial":I},_=C?C.start:R.start,O=C?C.end:R.end,F=R.minEndPTS||O,P=R.maxStartPTS||_,M=0;M<w.length;M++){var N=w.start(M)-this.bufferPadding,B=w.end(M)+this.bufferPadding;if(P>=N&&F<=B){x.time.push({"startPTS":Math.max(_,w.start(M)),"endPTS":Math.min(O,w.end(M))});break}if(_<B&&O>N)x.partial=!0,x.time.push({"startPTS":Math.max(_,w.start(M)),"endPTS":Math.min(O,w.end(M))});else if(O<=N)break}return x},R.getPartialFragment=function e(R){var C,I,w,x,_=null,O=0,F=this.bufferPadding,P=this.fragments;return ne()(C=ee()(P)).call(C,(function(C){var M=P[C];M&&o(M)&&(w=M.body.start-F,x=M.body.end+F,R>=w&&R<=x&&(I=Math.min(R-w,x-R),O<=I&&(_=M.body,O=I)))})),_},R.getState=function e(R){var C=l(R),I=this.fragments[C];return I?I.buffered?o(I)?w.PARTIAL:w.OK:I.backtrack?w.BACKTRACKED:w.APPENDING:w.NOT_LOADED},R.backtrack=function e(R,C){var I=l(R),w=this.fragments[I];if(!w||w.backtrack)return null;var e=w.backtrack=C||w.loaded;return w.loaded=null,e},R.getBacktrackData=function e(R){var C=l(R),I=this.fragments[C];if(I){var w,x=I.backtrack;if(null!=x&&null!==(w=x.payload)&&void 0!==w&&w.byteLength)return x;this.removeFragment(R)}return null},R.isTimeBuffered=function e(R,C,I){for(var w,x,_=0;_<I.length;_++){if(w=I.start(_)-this.bufferPadding,x=I.end(_)+this.bufferPadding,R>=w&&C<=x)return!0;if(C<=w)return!1}return!1},R.onFragLoaded=function e(R,C){var I=C.frag,w=C.part;if("initSegment"!==I.sn&&!I.bitrateTest&&!w){var x=l(I);this.fragments[x]={"body":I,"loaded":C,"backtrack":null,"buffered":!1,"range":Object.create(null)}}},R.onBufferAppended=function e(R,C){var I,w=this,x=C.frag,O=C.part,F=C.timeRanges;if(x.type===_.PlaylistLevelType.MAIN)if(this.activeFragment=x,O){var P=this.activeParts;P||(this.activeParts=P=[]),P.push(O)}else this.activeParts=null;this.timeRanges=F,ne()(I=ee()(F)).call(I,(function(R){var C=F[R];if(w.detectEvictedFragments(R,C),!O)for(var I=0;I<C.length;I++)x.appendedPTS=Math.max(C.end(I),x.appendedPTS||0)}))},R.onFragBuffered=function e(R,C){this.detectPartialFragments(C)},R.hasFragment=function e(R){var C=l(R);return!!this.fragments[C]},R.removeFragmentsInRange=function e(R,C,I){var w,x=this;ne()(w=ee()(this.fragments)).call(w,(function(w){var _=x.fragments[w];if(_&&_.buffered){var O=_.body;O.type===I&&O.start<C&&O.end>R&&x.removeFragment(O)}}))},R.removeFragment=function e(R){var C=l(R);R.stats.loaded=0,R.clearElementaryStreamInfo(),delete this.fragments[C]},R.removeAllFragments=function e(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function o(R){var C,I;return R.buffered&&((null===(C=R.range.video)||void 0===C?void 0:C.partial)||(null===(I=R.range.audio)||void 0===I?void 0:I.partial))}function l(R){return R.type+"_"+R.level+"_"+R.urlId+"_"+R.sn}},"./src/controller/gap-controller.ts":function srcControllerGapControllerTs(R,C,I){I.r(C),I.d(C,"STALL_MINIMUM_DURATION_MS",(function(){return F})),I.d(C,"MAX_START_GAP_JUMP",(function(){return P})),I.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return M})),I.d(C,"SKIP_BUFFER_RANGE_START",(function(){return N})),I.d(C,"default",(function(){return B}));var w=I("./src/utils/buffer-helper.ts"),x=I("./src/errors.ts"),_=I("./src/events.ts"),O=I("./src/utils/logger.ts"),F=250,P=2,M=.1,N=.05,B=function(){function e(R,C,I,w){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=R,this.media=C,this.fragmentTracker=I,this.hls=w}var R=e.prototype;return R.destroy=function e(){this.hls=this.fragmentTracker=this.media=null},R.poll=function e(R){var C=this.config,I=this.media,x=this.stalled,_=I.currentTime,M=I.seeking,N=this.seeking&&!M,B=!this.seeking&&M;if(this.seeking=M,_===R){if((B||N)&&(this.stalled=null),!I.paused&&!I.ended&&0!==I.playbackRate&&w.BufferHelper.getBuffered(I).length){var U=w.BufferHelper.bufferInfo(I,_,0),G=U.len>0,j=U.nextStart||0;if(G||j){if(M){var K=U.len>P,H=!j||j-_>P&&!this.fragmentTracker.getPartialFragment(_);if(K||H)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var V,W=Math.max(j,U.start||0)-_,Y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,z=(null==Y||null===(V=Y.details)||void 0===V?void 0:V.live)?2*Y.details.targetduration:P;if(W>0&&W<=z)return void this._trySkipBufferHole(null)}var X=self.performance.now();if(null!==x){var q=X-x;!M&&q>=F&&this._reportStall(U.len);var Z=w.BufferHelper.bufferInfo(I,_,C.maxBufferHole);this._tryFixBufferStall(Z,q)}else this.stalled=X}}}else if(this.moved=!0,null!==x){if(this.stallReported){var Q=self.performance.now()-x;O.logger.warn("playback not stuck anymore @"+_+", after "+Math.round(Q)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},R._tryFixBufferStall=function e(R,C){var I=this.config,w=this.fragmentTracker,x=this.media.currentTime,_=w.getPartialFragment(x);if(_&&this._trySkipBufferHole(_))return;R.len>I.maxBufferHole&&C>1e3*I.highBufferWatchdogPeriod&&(O.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},R._reportStall=function e(R){var C=this.hls,I=this.media;this.stallReported||(this.stallReported=!0,O.logger.warn("Playback stalling at @"+I.currentTime+" due to low buffer (buffer="+R+")"),C.trigger(_.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.BUFFER_STALLED_ERROR,"fatal":!1,"buffer":R}))},R._trySkipBufferHole=function e(R){for(var C=this.config,I=this.hls,F=this.media,P=F.currentTime,B=0,U=w.BufferHelper.getBuffered(F),G=0;G<U.length;G++){var j=U.start(G);if(P+C.maxBufferHole>=B&&P<j){var K=Math.max(j+N,F.currentTime+M);return O.logger.warn("skipping hole, adjusting currentTime from "+P+" to "+K),this.moved=!0,this.stalled=null,F.currentTime=K,R&&I.trigger(_.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.BUFFER_SEEK_OVER_HOLE,"fatal":!1,"reason":"fragment loaded with buffer holes, seeking from "+P+" to "+K,"frag":R}),K}B=U.end(G)}return 0},R._tryNudgeBuffer=function e(){var R=this.config,C=this.hls,I=this.media,w=I.currentTime,F=(this.nudgeRetry||0)+1;if(this.nudgeRetry=F,F<R.nudgeMaxRetry){var P=w+F*R.nudgeOffset;O.logger.warn("Nudging 'currentTime' from "+w+" to "+P),I.currentTime=P,C.trigger(_.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.BUFFER_NUDGE_ON_STALL,"fatal":!1})}else O.logger.error("Playhead still not moving while enough data buffered @"+w+" after "+R.nudgeMaxRetry+" nudges"),C.trigger(_.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.BUFFER_STALLED_ERROR,"fatal":!0})},e}()},"./src/controller/id3-track-controller.ts":function srcControllerId3TrackControllerTs(R,C,I){I.r(C);var w=I("./src/events.ts"),x=I("./src/utils/texttrack-utils.ts"),_=I("./src/demux/id3.ts"),O=function(){function e(R){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=R,this._registerListeners()}var R=e.prototype;return R.destroy=function e(){this._unregisterListeners()},R._registerListeners=function e(){var R=this.hls;R.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(w.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),R.on(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R._unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(w.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),R.off(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R.onMediaAttached=function e(R,C){this.media=C.media},R.onMediaDetaching=function e(){this.id3Track&&(Object(x.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},R.getID3Track=function e(R){if(this.media){for(var C=0;C<R.length;C++){var I=R[C];if("metadata"===I.kind&&"id3"===I.label)return Object(x.sendAddTrackEvent)(I,this.media),I}return this.media.addTextTrack("metadata","id3")}},R.onFragParsingMetadata=function e(R,C){if(this.media){var I=C.frag,w=C.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var x=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,O=0;O<w.length;O++){var F=_.getID3Frames(w[O].data);if(F){var P=w[O].pts,M=O<w.length-1?w[O+1].pts:I.end;M-P<=0&&(M=P+.25);for(var N=0;N<F.length;N++){var B=F[N];if(!_.isTimeStampFrame(B)){var U=new x(P,M,"");U.value=B,this.id3Track.addCue(U)}}}}}},R.onBufferFlushing=function e(R,C){var I=C.startOffset,w=C.endOffset,_=C.type;if(!_||"audio"===_){var O=this.id3Track;O&&Object(x.removeCuesInRange)(O,I,w)}},e}();C.default=O},"./src/controller/latency-controller.ts":function srcControllerLatencyControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return O}));var w=I("./src/errors.ts"),x=I("./src/events.ts"),_=I("./src/utils/logger.ts");function s(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var O=function(){function e(R){var C=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return C.timeupdate()},this.hls=R,this.config=R.config,this.registerListeners()}var R=e.prototype;return R.destroy=function e(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},R.registerListeners=function e(){this.hls.on(x.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(x.Events.ERROR,this.onError,this)},R.unregisterListeners=function e(){this.hls.off(x.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(x.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(x.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(x.Events.ERROR,this.onError)},R.onMediaAttached=function e(R,C){this.media=C.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},R.onMediaDetaching=function e(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},R.onManifestLoading=function e(){this.levelDetails=null,this._latency=null,this.stallCount=0},R.onLevelUpdated=function e(R,C){var I=C.details;this.levelDetails=I,I.advanced&&this.timeupdate(),!I.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},R.onError=function e(R,C){C.details===w.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,_.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},R.timeupdate=function e(){var R=this.media,C=this.levelDetails;if(R&&C){this.currentTime=R.currentTime;var I=this.computeLatency();if(null!==I){this._latency=I;var w=this.config,x=w.lowLatencyMode,_=w.maxLiveSyncPlaybackRate;if(x&&1!==_){var O=this.targetLatency;if(null!==O){var F=I-O,P=F<Math.min(this.maxLatency,O+C.targetduration);if(C.live&&P&&F>.05&&this.forwardBufferLength>1){var M=Math.min(2,Math.max(1,_)),N=Math.round(2/(1+Math.exp(-.75*F-this.edgeStalled))*20)/20;R.playbackRate=Math.min(M,Math.max(1,N))}else 1!==R.playbackRate&&0!==R.playbackRate&&(R.playbackRate=1)}}}}},R.estimateLiveEdge=function e(){var R=this.levelDetails;return null===R?null:R.edge+R.age},R.computeLatency=function e(){var R=this.estimateLiveEdge();return null===R?null:R-this.currentTime},function o(R,C,I){return C&&s(R.prototype,C),I&&s(R,I),R}(e,[{"key":"latency","get":function e(){return this._latency||0}},{"key":"maxLatency","get":function e(){var R=this.config,C=this.levelDetails;return void 0!==R.liveMaxLatencyDuration?R.liveMaxLatencyDuration:C?R.liveMaxLatencyDurationCount*C.targetduration:0}},{"key":"targetLatency","get":function e(){var R=this.levelDetails;if(null===R)return null;var C=R.holdBack,I=R.partHoldBack,w=R.targetduration,x=this.config,_=x.liveSyncDuration,O=x.liveSyncDurationCount,F=x.lowLatencyMode,P=this.hls.userConfig,M=F&&I||C;(P.liveSyncDuration||P.liveSyncDurationCount||0===M)&&(M=void 0!==_?_:O*w);var N=w;return M+Math.min(1*this.stallCount,N)}},{"key":"liveSyncPosition","get":function e(){var R=this.estimateLiveEdge(),C=this.targetLatency,I=this.levelDetails;if(null===R||null===C||null===I)return null;var w=I.edge,x=R-C-this.edgeStalled,_=w-I.totalduration,O=w-(this.config.lowLatencyMode&&I.partTarget||I.targetduration);return Math.min(Math.max(_,x),O)}},{"key":"drift","get":function e(){var R=this.levelDetails;return null===R?1:R.drift}},{"key":"edgeStalled","get":function e(){var R=this.levelDetails;if(null===R)return 0;var C=3*(this.config.lowLatencyMode&&R.partTarget||R.targetduration);return Math.max(R.age-C,0)}},{"key":"forwardBufferLength","get":function e(){var R=this.media,C=this.levelDetails;if(!R||!C)return 0;var I=R.buffered.length;return I?R.buffered.end(I-1):C.edge-this.currentTime}}]),e}()},"./src/controller/level-controller.ts":function srcControllerLevelControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return U}));var w=I("./src/types/level.ts"),x=I("./src/events.ts"),_=I("./src/errors.ts"),O=I("./src/utils/codecs.ts"),F=I("./src/controller/level-helper.ts"),P=I("./src/controller/base-playlist-controller.ts"),M=I("./src/types/loader.ts");function f(){return f=ge()||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(R[w]=I[w])}return R},f.apply(this,arguments)}function c(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function v(R,C){return v=Se()||function e(R,C){return R.__proto__=C,R},v(R,C)}var N=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),U=function(R){function t(C){var I;return(I=R.call(this,C,"[level-controller]")||this)._levels=[],I._firstLevel=-1,I._startLevel=void 0,I.currentLevelIndex=-1,I.manualLevelIndex=-1,I.onParsedComplete=void 0,I._registerListeners(),I}!function h(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,v(R,C)}(t,R);var C=t.prototype;return C._registerListeners=function e(){var R=this.hls;R.on(x.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.on(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(x.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.on(x.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(x.Events.ERROR,this.onError,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(x.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.off(x.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(x.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.off(x.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(x.Events.ERROR,this.onError,this)},C.destroy=function t(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,R.prototype.destroy.call(this)},C.startLoad=function t(){var C=this._levels;ne()(C).call(C,(function(R){R.loadError=0})),R.prototype.startLoad.call(this)},C.onManifestLoaded=function e(R,C){var I,P,M,B,U=[],G=[],j=[],K={},H=!1,V=!1,W=!1;(ne()(I=C.levels).call(I,(function(R){var C,I=R.attrs;H=H||!(!R.width||!R.height),V=V||!!R.videoCodec,W=W||!!R.audioCodec,N&&R.audioCodec&&-1!==Ce()(C=R.audioCodec).call(C,"mp4a.40.34")&&(R.audioCodec=void 0);var x=R.bitrate+"-"+R.attrs.RESOLUTION+"-"+R.attrs.CODECS;(M=K[x])?M.url.push(R.url):(M=new w.Level(R),K[x]=M,U.push(M)),I&&(I.AUDIO&&Object(F.addGroupId)(M,"audio",I.AUDIO),I.SUBTITLES&&Object(F.addGroupId)(M,"text",I.SUBTITLES))})),(H||V)&&W&&(U=se()(U).call(U,(function(R){var C=R.videoCodec,I=R.width,w=R.height;return!!C||!(!I||!w)}))),U=se()(U).call(U,(function(R){var C=R.audioCodec,I=R.videoCodec;return(!C||Object(O.isCodecSupportedInMp4)(C,"audio"))&&(!I||Object(O.isCodecSupportedInMp4)(I,"video"))})),C.audioTracks)&&(G=se()(B=C.audioTracks).call(B,(function(R){return!R.audioCodec||Object(O.isCodecSupportedInMp4)(R.audioCodec,"audio")})),Object(F.assignTrackIdsByGroup)(G));if(C.subtitles&&(j=C.subtitles,Object(F.assignTrackIdsByGroup)(j)),U.length>0){P=U[0].bitrate,Be()(U).call(U,(function(R,C){return R.bitrate-C.bitrate})),this._levels=U;for(var Y=0;Y<U.length;Y++)if(U[Y].bitrate===P){this._firstLevel=Y,this.log("manifest loaded, "+U.length+" level(s) found, first bitrate: "+P);break}var z=W&&!V,X={"levels":U,"audioTracks":G,"subtitleTracks":j,"firstLevel":this._firstLevel,"stats":C.stats,"audio":W,"video":V,"altAudio":!z&&Le()(G).call(G,(function(R){return!!R.url}))};this.hls.trigger(x.Events.MANIFEST_PARSED,X),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(x.Events.ERROR,{"type":_.ErrorTypes.MEDIA_ERROR,"details":_.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"url":C.url,"reason":"no level with compatible codecs found in manifest"})},C.onError=function t(C,I){if(R.prototype.onError.call(this,C,I),!I.fatal){var w=I.context,x=this._levels[this.currentLevelIndex];if(w&&(w.type===M.PlaylistContextType.AUDIO_TRACK&&x.audioGroupIds&&w.groupId===x.audioGroupIds[x.urlId]||w.type===M.PlaylistContextType.SUBTITLE_TRACK&&x.textGroupIds&&w.groupId===x.textGroupIds[x.urlId]))this.redundantFailover(this.currentLevelIndex);else{var O,F=!1,P=!0;switch(I.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:if(I.frag){var N=this._levels[I.frag.level];N?(N.fragmentError++,N.fragmentError>this.hls.config.fragLoadingMaxRetry&&(O=I.frag.level)):O=I.frag.level}break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:w&&(w.deliveryDirectives&&(P=!1),O=w.level),F=!0;break;case _.ErrorDetails.REMUX_ALLOC_ERROR:O=I.level,F=!0}void 0!==O&&this.recoverLevel(I,O,F,P)}}},C.recoverLevel=function e(R,C,I,w){var x=R.details,_=this._levels[C];if(_.loadError++,I){if(!this.retryLoadingOrFail(R))return void(this.currentLevelIndex=-1);R.levelRetry=!0}if(w){var O=_.url.length;if(O>1&&_.loadError<O)R.levelRetry=!0,this.redundantFailover(C);else if(-1===this.manualLevelIndex){var F=0===C?this._levels.length-1:C-1;this.currentLevelIndex!==F&&0===this._levels[F].loadError&&(this.warn(x+": switch to "+F),R.levelRetry=!0,this.hls.nextAutoLevel=F)}}},C.redundantFailover=function e(R){var C=this._levels[R],I=C.url.length;if(I>1){var w,x=(C.urlId+1)%I;this.warn("Switching to redundant URL-id "+x),ne()(w=this._levels).call(w,(function(R){R.urlId=x})),this.level=R}},C.onFragLoaded=function e(R,C){var I=C.frag;if(void 0!==I&&I.type===M.PlaylistLevelType.MAIN){var w=this._levels[I.level];void 0!==w&&(w.fragmentError=0,w.loadError=0)}},C.onLevelLoaded=function e(R,C){var I,w,x=C.level,_=C.details,O=this._levels[x];if(!O)return this.warn("Invalid level index "+x),void(null!==(w=C.deliveryDirectives)&&void 0!==w&&w.skip&&(_.deltaUpdateFailed=!0));x===this.currentLevelIndex?(0===O.fragmentError&&(O.loadError=0,this.retryCount=0),this.playlistLoaded(x,C,O.details)):null!==(I=C.deliveryDirectives)&&void 0!==I&&I.skip&&(_.deltaUpdateFailed=!0)},C.onAudioTrackSwitched=function e(R,C){var I=this.hls.levels[this.currentLevelIndex];if(I&&I.audioGroupIds){for(var w=-1,x=this.hls.audioTracks[C.id].groupId,_=0;_<I.audioGroupIds.length;_++)if(I.audioGroupIds[_]===x){w=_;break}w!==I.urlId&&(I.urlId=w,this.startLoad())}},C.loadPlaylist=function e(R){var C=this.currentLevelIndex,I=this._levels[C];if(this.canLoad&&I&&I.url.length>0){var w=I.urlId,_=I.url[w];if(R)try{_=R.addDirectives(_)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Attempt loading level index "+C+(R?" at sn "+R.msn+" part "+R.part:"")+" with URL-id "+w+" "+_),this.clearTimer(),this.hls.trigger(x.Events.LEVEL_LOADING,{"url":_,"level":C,"id":w,"deliveryDirectives":R||null})}},C.removeLevel=function e(R,C){var I,w,_=function e(R,I){return I!==C},O=ce()(I=se()(w=this._levels).call(w,(function(I,w){if(w!==R)return!0;if(I.url.length>1&&void 0!==C){var x,O,F;if(I.url=se()(x=I.url).call(x,_),I.audioGroupIds)I.audioGroupIds=se()(O=I.audioGroupIds).call(O,_);if(I.textGroupIds)I.textGroupIds=se()(F=I.textGroupIds).call(F,_);return I.urlId=0,!0}return!1}))).call(I,(function(R,C){var I,w=R.details;null!=w&&w.fragments&&ne()(I=w.fragments).call(I,(function(R){R.level=C}));return R}));this._levels=O,this.hls.trigger(x.Events.LEVELS_UPDATED,{"levels":O})},function d(R,C,I){return C&&c(R.prototype,C),I&&c(R,I),R}(t,[{"key":"levels","get":function e(){return 0===this._levels.length?null:this._levels}},{"key":"level","get":function e(){return this.currentLevelIndex},"set":function e(R){var C,I=this._levels;if(0!==I.length&&(this.currentLevelIndex!==R||null===(C=I[R])||void 0===C||!C.details)){if(R<0||R>=I.length){var w=R<0;if(this.hls.trigger(x.Events.ERROR,{"type":_.ErrorTypes.OTHER_ERROR,"details":_.ErrorDetails.LEVEL_SWITCH_ERROR,"level":R,"fatal":w,"reason":"invalid level idx"}),w)return;R=Math.min(R,I.length-1)}this.clearTimer();var O=this.currentLevelIndex,F=I[O],P=I[R];this.log("switching to level "+R+" from "+O),this.currentLevelIndex=R;var M=f({},P,{"level":R,"maxBitrate":P.maxBitrate,"uri":P.uri,"urlId":P.urlId});delete M._urlId,this.hls.trigger(x.Events.LEVEL_SWITCHING,M);var N=P.details;if(!N||N.live){var B=this.switchParams(P.uri,null==F?void 0:F.details);this.loadPlaylist(B)}}}},{"key":"manualLevel","get":function e(){return this.manualLevelIndex},"set":function e(R){this.manualLevelIndex=R,void 0===this._startLevel&&(this._startLevel=R),-1!==R&&(this.level=R)}},{"key":"firstLevel","get":function e(){return this._firstLevel},"set":function e(R){this._firstLevel=R}},{"key":"startLevel","get":function e(){if(void 0===this._startLevel){var R=this.hls.config.startLevel;return void 0!==R?R:this._firstLevel}return this._startLevel},"set":function e(R){this._startLevel=R}},{"key":"nextLoadLevel","get":function e(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},"set":function e(R){this.level=R,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=R)}}]),t}(P.default)},"./src/controller/level-helper.ts":function srcControllerLevelHelperTs(R,C,I){I.r(C),I.d(C,"addGroupId",(function(){return n})),I.d(C,"assignTrackIdsByGroup",(function(){return s})),I.d(C,"updatePTS",(function(){return o})),I.d(C,"updateFragPTSDTS",(function(){return u})),I.d(C,"mergeDetails",(function(){return f})),I.d(C,"mapPartIntersection",(function(){return c})),I.d(C,"mapFragmentIntersection",(function(){return d})),I.d(C,"adjustSliding",(function(){return h})),I.d(C,"addSliding",(function(){return v})),I.d(C,"computeReloadInterval",(function(){return g})),I.d(C,"getFragmentWithSN",(function(){return p})),I.d(C,"getPartWith",(function(){return m}));var w=I("./src/polyfills/number.ts"),x=I("./src/utils/logger.ts");function n(R,C,I){switch(C){case"audio":R.audioGroupIds||(R.audioGroupIds=[]),R.audioGroupIds.push(I);break;case"text":R.textGroupIds||(R.textGroupIds=[]),R.textGroupIds.push(I)}}function s(R){var C={};ne()(R).call(R,(function(R){var I=R.groupId||"";R.id=C[I]=C[I]||0,C[I]++}))}function o(R,C,I){l(R[C],R[I])}function l(R,C){var I=C.startPTS;if(Object(w.isFiniteNumber)(I)){var x,_=0;C.sn>R.sn?(_=I-R.start,x=R):(_=R.start-I,x=C),x.duration!==_&&(x.duration=_)}else if(C.sn>R.sn){R.cc===C.cc&&R.minEndPTS?C.start=R.start+(R.minEndPTS-R.start):C.start=R.start+R.duration}else C.start=Math.max(R.start-C.duration,0)}function u(R,C,I,_,O,F){_-I<=0&&(x.logger.warn("Fragment should have a positive duration",C),_=I+C.duration,F=O+C.duration);var P=I,M=_,N=C.startPTS,B=C.endPTS;if(Object(w.isFiniteNumber)(N)){var U=Math.abs(N-I);Object(w.isFiniteNumber)(C.deltaPTS)?C.deltaPTS=Math.max(U,C.deltaPTS):C.deltaPTS=U,P=Math.max(I,N),I=Math.min(I,N),O=Math.min(O,C.startDTS),M=Math.min(_,B),_=Math.max(_,B),F=Math.max(F,C.endDTS)}C.duration=_-I;var G=I-C.start;C.appendedPTS=_,C.start=C.startPTS=I,C.maxStartPTS=P,C.startDTS=O,C.endPTS=_,C.minEndPTS=M,C.endDTS=F;var j,K=C.sn;if(!R||K<R.startSN||K>R.endSN)return 0;var H=K-R.startSN,V=R.fragments;for(V[H]=C,j=H;j>0;j--)l(V[j],V[j-1]);for(j=H;j<V.length-1;j++)l(V[j],V[j+1]);return R.fragmentHint&&l(V[V.length-1],R.fragmentHint),R.PTSKnown=R.alignedSliding=!0,G}function f(R,C){for(var I=null,_=R.fragments,O=_.length-1;O>=0;O--){var F=_[O].initSegment;if(F){I=F;break}}R.fragmentHint&&delete R.fragmentHint.endPTS;var P,M,N=0;if(d(R,C,(function(R,x){R.relurl&&(N=R.cc-x.cc),Object(w.isFiniteNumber)(R.startPTS)&&Object(w.isFiniteNumber)(R.endPTS)&&(x.start=x.startPTS=R.startPTS,x.startDTS=R.startDTS,x.appendedPTS=R.appendedPTS,x.maxStartPTS=R.maxStartPTS,x.endPTS=R.endPTS,x.endDTS=R.endDTS,x.minEndPTS=R.minEndPTS,x.duration=R.endPTS-R.startPTS,x.duration&&(P=x),C.PTSKnown=C.alignedSliding=!0),x.elementaryStreams=R.elementaryStreams,x.loader=R.loader,x.stats=R.stats,x.urlId=R.urlId,R.initSegment&&(x.initSegment=R.initSegment,I=R.initSegment)})),I){var B,U=C.fragmentHint?Y()(B=C.fragments).call(B,C.fragmentHint):C.fragments;ne()(U).call(U,(function(R){var C;R.initSegment&&R.initSegment.relurl!==(null===(C=I)||void 0===C?void 0:C.relurl)||(R.initSegment=I)}))}if(C.skippedSegments&&(C.deltaUpdateFailed=Le()(M=C.fragments).call(M,(function(R){return!R})),C.deltaUpdateFailed)){x.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var G=C.skippedSegments;G--;)C.fragments.shift();C.startSN=C.fragments[0].sn,C.startCC=C.fragments[0].cc}var j=C.fragments;if(N){x.logger.warn("discontinuity sliding from playlist, take drift into account");for(var K=0;K<j.length;K++)j[K].cc+=N}C.skippedSegments&&(C.startCC=C.fragments[0].cc),c(R.partList,C.partList,(function(R,C){C.elementaryStreams=R.elementaryStreams,C.stats=R.stats})),P?u(C,P,P.startPTS,P.endPTS,P.startDTS,P.endDTS):h(R,C),j.length&&(C.totalduration=C.edge-j[0].start),C.driftStartTime=R.driftStartTime,C.driftStart=R.driftStart;var H=C.advancedDateTime;if(C.advanced&&H){var V=C.edge;C.driftStart||(C.driftStartTime=H,C.driftStart=V),C.driftEndTime=H,C.driftEnd=V}else C.driftEndTime=R.driftEndTime,C.driftEnd=R.driftEnd,C.advancedDateTime=R.advancedDateTime}function c(R,C,I){if(R&&C)for(var w=0,x=0,_=R.length;x<=_;x++){var O=R[x],F=C[x+w];O&&F&&O.index===F.index&&O.fragment.sn===F.fragment.sn?I(O,F):w--}}function d(R,C,I){for(var w,x,_=C.skippedSegments,O=Math.max(R.startSN,C.startSN)-C.startSN,F=(R.fragmentHint?1:0)+(_?C.endSN:Math.min(R.endSN,C.endSN))-C.startSN,P=C.startSN-R.startSN,M=C.fragmentHint?Y()(w=C.fragments).call(w,C.fragmentHint):C.fragments,N=R.fragmentHint?Y()(x=R.fragments).call(x,R.fragmentHint):R.fragments,B=O;B<=F;B++){var U=N[P+B],G=M[B];_&&!G&&B<_&&(G=C.fragments[B]=U),U&&G&&I(U,G)}}function h(R,C){var I=C.startSN+C.skippedSegments-R.startSN,w=R.fragments;I<0||I>=w.length||v(C,w[I].start)}function v(R,C){if(C){for(var I=R.fragments,w=R.skippedSegments;w<I.length;w++)I[w].start+=C;R.fragmentHint&&(R.fragmentHint.start+=C)}}function g(R,C){var I,w=1e3*R.levelTargetDuration,x=w/2,_=R.age,O=_>0&&_<3*w,F=C.loading.end-C.loading.start,P=R.availabilityDelay;if(!1===R.updated)if(O){var M=333*R.misses;I=Math.max(Math.min(x,2*F),M),R.availabilityDelay=(R.availabilityDelay||0)+I}else I=x;else O?(P=Math.min(P||w/2,_),R.availabilityDelay=P,I=P+w-_):I=w-F;return Math.round(I)}function p(R,C,I){if(!R||!R.details)return null;var w=R.details,x=w.fragments[C-w.startSN];return x||((x=w.fragmentHint)&&x.sn===C?x:C<w.startSN&&I&&I.sn===C?I:null)}function m(R,C,I){if(!R||!R.details)return null;var w=R.details.partList;if(w)for(var x=w.length;x--;){var _=w[x];if(_.index===I&&_.fragment.sn===C)return _}return null}},"./src/controller/stream-controller.ts":function srcControllerStreamControllerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return V}));var w=I("./src/polyfills/number.ts"),x=I("./src/controller/base-stream-controller.ts"),_=I("./src/is-supported.ts"),O=I("./src/events.ts"),F=I("./src/utils/buffer-helper.ts"),P=I("./src/controller/fragment-tracker.ts"),M=I("./src/types/loader.ts"),N=I("./src/loader/fragment.ts"),U=I("./src/demux/transmuxer-interface.ts"),G=I("./src/types/transmuxer.ts"),j=I("./src/controller/gap-controller.ts"),K=I("./src/errors.ts"),H=I("./src/utils/logger.ts");function p(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function E(R,C){return E=Se()||function e(R,C){return R.__proto__=C,R},E(R,C)}var V=function(R){function t(C,I){var w;return(w=R.call(this,C,I,"[stream-controller]")||this).audioCodecSwap=!1,w.gapController=null,w.level=-1,w._forceStartLoad=!1,w.altAudio=!1,w.audioOnly=!1,w.fragPlaying=null,w.onvplaying=null,w.onvseeked=null,w.fragLastKbps=0,w.stalled=!1,w.couldBacktrack=!1,w.audioCodecSwitch=!1,w.videoBuffer=null,w._registerListeners(),w}!function y(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,E(R,C)}(t,R);var C=t.prototype;return C._registerListeners=function e(){var R=this.hls;R.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),R.on(O.Events.ERROR,this.onError,this),R.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),R.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.on(O.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),R.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),R.off(O.Events.ERROR,this.onError,this),R.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),R.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),R.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),R.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),R.off(O.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),R.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},C.onHandlerDestroying=function e(){this._unregisterListeners(),this.onMediaDetaching()},C.startLoad=function e(R){if(this.levels){var C=this.lastCurrentTime,I=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var w=I.startLevel;-1===w&&(I.config.testBandwidth?(w=0,this.bitrateTest=!0):w=I.nextAutoLevel),this.level=I.nextLoadLevel=w,this.loadedmetadata=!1}C>0&&-1===R&&(this.log("Override startPosition with lastCurrentTime @"+C.toFixed(3)),R=C),this.state=x.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=R,this.tick()}else this._forceStartLoad=!0,this.state=x.State.STOPPED},C.stopLoad=function t(){this._forceStartLoad=!1,R.prototype.stopLoad.call(this)},C.doTick=function e(){switch(this.state){case x.State.IDLE:this.doTickIdle();break;case x.State.WAITING_LEVEL:var R,C=this.levels,I=this.level,w=null==C||null===(R=C[I])||void 0===R?void 0:R.details;if(w&&(!w.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(w))break;this.state=x.State.IDLE;break}break;case x.State.FRAG_LOADING_WAITING_RETRY:var _,O=self.performance.now(),F=this.retryDate;(!F||O>=F||null!==(_=this.media)&&void 0!==_&&_.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=x.State.IDLE)}this.onTickEnd()},C.onTickEnd=function t(){R.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},C.doTickIdle=function e(){var R,C,I=this.hls,w=this.levelLastLoaded,_=this.levels,F=this.media,B=I.config,U=I.nextLoadLevel;if(null!==w&&(F||!this.startFragRequested&&B.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&_&&_[U]){var G=_[U];this.level=I.nextLoadLevel=U;var j=G.details;if(!j||this.state===x.State.WAITING_LEVEL||j.live&&this.levelLastLoaded!==U)this.state=x.State.WAITING_LEVEL;else{var K=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:F,M.PlaylistLevelType.MAIN);if(null!==K)if(!(K.len>=this.getMaxBufferLength(G.maxBitrate))){if(this._streamEnded(K,j)){var H={};return this.altAudio&&(H.type="video"),this.hls.trigger(O.Events.BUFFER_EOS,H),void(this.state=x.State.ENDED)}var V=K.end,W=this.getNextFragment(V,j);if(this.couldBacktrack&&!this.fragPrevious&&W&&"initSegment"!==W.sn){var Y=W.sn-j.startSN;Y>1&&(W=j.fragments[Y-1],this.fragmentTracker.removeFragment(W))}if(W&&this.fragmentTracker.getState(W)===P.FragmentState.OK&&this.nextLoadPosition>V){var z=this.audioOnly&&!this.altAudio?N.ElementaryStreamTypes.AUDIO:N.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(F,z,M.PlaylistLevelType.MAIN),W=this.getNextFragment(this.nextLoadPosition,j)}W&&(!W.initSegment||W.initSegment.data||this.bitrateTest||(W=W.initSegment),"identity"!==(null===(R=W.decryptdata)||void 0===R?void 0:R.keyFormat)||null!==(C=W.decryptdata)&&void 0!==C&&C.key?this.loadFragment(W,j,V):this.loadKey(W,j))}}}},C.loadFragment=function t(C,I,w){var x,_=this.fragmentTracker.getState(C);if(this.fragCurrent=C,_===P.FragmentState.BACKTRACKED){var O=this.fragmentTracker.getBacktrackData(C);if(O)return this._handleFragmentLoadProgress(O),void this._handleFragmentLoadComplete(O);_=P.FragmentState.NOT_LOADED}_===P.FragmentState.NOT_LOADED||_===P.FragmentState.PARTIAL?"initSegment"===C.sn?this._loadInitSegment(C):this.bitrateTest?(C.bitrateTest=!0,this.log("Fragment "+C.sn+" of level "+C.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(C)):(this.startFragRequested=!0,R.prototype.loadFragment.call(this,C,I,w)):_===P.FragmentState.APPENDING?this.reduceMaxBufferLength(C.duration)&&this.fragmentTracker.removeFragment(C):0===(null===(x=this.media)||void 0===x?void 0:x.buffered.length)&&this.fragmentTracker.removeAllFragments()},C.getAppendedFrag=function e(R){var C=this.fragmentTracker.getAppendedFrag(R,M.PlaylistLevelType.MAIN);return C&&"fragment"in C?C.fragment:C},C.getBufferedFrag=function e(R){return this.fragmentTracker.getBufferedFrag(R,M.PlaylistLevelType.MAIN)},C.followingBufferedFrag=function e(R){return R?this.getBufferedFrag(R.end+.5):null},C.immediateLevelSwitch=function e(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},C.nextLevelSwitch=function e(){var R=this.levels,C=this.media;if(null!=C&&C.readyState){var I,w=this.getAppendedFrag(C.currentTime);if(w&&w.start>1&&this.flushMainBuffer(0,w.start-1),!C.paused&&R){var x=R[this.hls.nextLoadLevel],_=this.fragLastKbps;I=_&&this.fragCurrent?this.fragCurrent.duration*x.maxBitrate/(1e3*_)+1:0}else I=0;var O=this.getBufferedFrag(C.currentTime+I);if(O){var F=this.followingBufferedFrag(O);if(F){this.abortCurrentFrag();var P=F.maxStartPTS?F.maxStartPTS:F.start,M=F.duration,N=Math.max(O.end,P+Math.min(Math.max(M-this.config.maxFragLookUpTolerance,.5*M),.75*M));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},C.abortCurrentFrag=function e(){var R=this.fragCurrent;this.fragCurrent=null,null!=R&&R.loader&&R.loader.abort(),this.state===x.State.KEY_LOADING&&(this.state=x.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},C.flushMainBuffer=function t(C,I){R.prototype.flushMainBuffer.call(this,C,I,this.altAudio?"video":null)},C.onMediaAttached=function t(C,I){R.prototype.onMediaAttached.call(this,C,I);var w=I.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),w.addEventListener("playing",this.onvplaying),w.addEventListener("seeked",this.onvseeked),this.gapController=new j.default(this.config,w,this.fragmentTracker,this.hls)},C.onMediaDetaching=function t(){var C=this.media;C&&(C.removeEventListener("playing",this.onvplaying),C.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),R.prototype.onMediaDetaching.call(this)},C.onMediaPlaying=function e(){this.tick()},C.onMediaSeeked=function e(){var R=this.media,C=R?R.currentTime:null;Object(w.isFiniteNumber)(C)&&this.log("Media seeked to "+C.toFixed(3)),this.tick()},C.onManifestLoading=function e(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(O.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},C.onManifestParsed=function e(R,C){var I,w,x=!1,O=!1;ne()(I=C.levels).call(I,(function(R){(w=R.audioCodec)&&(-1!==Ce()(w).call(w,"mp4a.40.2")&&(x=!0),-1!==Ce()(w).call(w,"mp4a.40.5")&&(O=!0))})),this.audioCodecSwitch=x&&O&&!Object(_.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=C.levels,this.startFragRequested=!1},C.onLevelLoading=function e(R,C){var I=this.levels;if(I&&this.state===x.State.IDLE){var w=I[C.level];(!w.details||w.details.live&&this.levelLastLoaded!==C.level||this.waitForCdnTuneIn(w.details))&&(this.state=x.State.WAITING_LEVEL)}},C.onLevelLoaded=function e(R,C){var I,w=this.levels,_=C.level,F=C.details,P=F.totalduration;if(w){this.log("Level "+_+" loaded ["+F.startSN+","+F.endSN+"], cc ["+F.startCC+", "+F.endCC+"] duration:"+P);var M=this.fragCurrent;!M||this.state!==x.State.FRAG_LOADING&&this.state!==x.State.FRAG_LOADING_WAITING_RETRY||M.level!==C.level&&M.loader&&(this.state=x.State.IDLE,M.loader.abort());var N=w[_],B=0;if(F.live||null!==(I=N.details)&&void 0!==I&&I.live){if(F.fragments[0]||(F.deltaUpdateFailed=!0),F.deltaUpdateFailed)return;B=this.alignPlaylists(F,N.details)}if(N.details=F,this.levelLastLoaded=_,this.hls.trigger(O.Events.LEVEL_UPDATED,{"details":F,"level":_}),this.state===x.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(F))return;this.state=x.State.IDLE}this.startFragRequested?F.live&&this.synchronizeToLiveEdge(F):this.setStartPosition(F,B),this.tick()}else this.warn("Levels were reset while loading level "+_)},C._handleFragmentLoadProgress=function e(R){var C,I=R.frag,w=R.part,x=R.payload,_=this.levels;if(_){var O=_[I.level],F=O.details;if(F){var P=O.videoCodec,N=F.PTSKnown||!F.live,B=null===(C=I.initSegment)||void 0===C?void 0:C.data,j=this._getAudioCodec(O),K=this.transmuxer=this.transmuxer||new U.default(this.hls,M.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),H=w?w.index:-1,V=-1!==H,W=new G.ChunkMetadata(I.level,I.sn,I.stats.chunkCount,x.byteLength,H,V),Y=this.initPTS[I.cc];K.push(x,B,j,P,I,w,F.totalduration,N,W,Y)}else this.warn("Dropping fragment "+I.sn+" of level "+I.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered")},C.onAudioTrackSwitching=function e(R,C){var I=this.altAudio,w=!!C.url,x=C.id;if(!w){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var _=this.fragCurrent;null!=_&&_.loader&&(this.log("Switching to main audio track, cancel main fragment load"),_.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var F=this.hls;I&&F.trigger(O.Events.BUFFER_FLUSHING,{"startOffset":0,"endOffset":Number.POSITIVE_INFINITY,"type":"audio"}),F.trigger(O.Events.AUDIO_TRACK_SWITCHED,{"id":x})}},C.onAudioTrackSwitched=function e(R,C){var I=C.id,w=!!this.hls.audioTracks[I].url;if(w){var x=this.videoBuffer;x&&this.mediaBuffer!==x&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=x)}this.altAudio=w,this.tick()},C.onBufferCreated=function e(R,C){var I,w,x=C.tracks,_=!1;for(var O in x){var F=x[O];if("main"===F.id){if(w=O,I=F,"video"===O){var P=x[O];P&&(this.videoBuffer=P.buffer)}}else _=!0}_&&I?(this.log("Alternate track found, use "+w+".buffered to schedule main fragment loading"),this.mediaBuffer=I.buffer):this.mediaBuffer=this.media},C.onFragBuffered=function e(R,C){var I=C.frag,w=C.part;if(!I||I.type===M.PlaylistLevelType.MAIN){if(this.fragContextChanged(I))return this.warn("Fragment "+I.sn+(w?" p: "+w.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===x.State.PARSED&&(this.state=x.State.IDLE));var _=w?w.stats:I.stats;this.fragLastKbps=Math.round(8*_.total/(_.buffering.end-_.loading.first)),"initSegment"!==I.sn&&(this.fragPrevious=I),this.fragBufferedComplete(I,w)}},C.onError=function e(R,C){switch(C.details){case K.ErrorDetails.FRAG_LOAD_ERROR:case K.ErrorDetails.FRAG_LOAD_TIMEOUT:case K.ErrorDetails.KEY_LOAD_ERROR:case K.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(M.PlaylistLevelType.MAIN,C);break;case K.ErrorDetails.LEVEL_LOAD_ERROR:case K.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==x.State.ERROR&&(C.fatal?(this.warn(""+C.details),this.state=x.State.ERROR):C.levelRetry||this.state!==x.State.WAITING_LEVEL||(this.state=x.State.IDLE));break;case K.ErrorDetails.BUFFER_FULL_ERROR:if("main"===C.parent&&(this.state===x.State.PARSING||this.state===x.State.PARSED)){var I=!0,w=this.getFwdBufferInfo(this.media,M.PlaylistLevelType.MAIN);w&&w.len>.5&&(I=!this.reduceMaxBufferLength(w.len)),I&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},C.checkBuffer=function e(){var R=this.media,C=this.gapController;if(R&&C&&R.readyState){var I=F.BufferHelper.getBuffered(R);!this.loadedmetadata&&I.length?(this.loadedmetadata=!0,this.seekToStartPos()):C.poll(this.lastCurrentTime),this.lastCurrentTime=R.currentTime}},C.onFragLoadEmergencyAborted=function e(){this.state=x.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},C.onBufferFlushed=function e(R,C){var I=C.type;if(I!==N.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var w=(I===N.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(w,I,M.PlaylistLevelType.MAIN)}},C.onLevelsUpdated=function e(R,C){this.levels=C.levels},C.swapAudioCodec=function e(){this.audioCodecSwap=!this.audioCodecSwap},C.seekToStartPos=function e(){var R=this.media,C=R.currentTime,I=this.startPosition;if(I>=0&&C<I){if(R.seeking)return void H.logger.log("could not seek to "+I+", already seeking at "+C);var w=F.BufferHelper.getBuffered(R),x=(w.length?w.start(0):0)-I;x>0&&(x<this.config.maxBufferHole||x<this.config.maxFragLookUpTolerance)&&(H.logger.log("adjusting start position by "+x+" to match buffer start"),I+=x,this.startPosition=I),this.log("seek to target start position "+I+" from current time "+C),R.currentTime=I}},C._getAudioCodec=function e(R){var C=this.config.defaultAudioCodec||R.audioCodec;return this.audioCodecSwap&&C&&(this.log("Swapping audio codec"),C=-1!==Ce()(C).call(C,"mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),C},C._loadBitrateTestFrag=function e(R){var C=this;this._doFragLoad(R).then((function(I){var w=C.hls;if(I&&!w.nextLoadLevel&&!C.fragContextChanged(R)){C.fragLoadError=0,C.state=x.State.IDLE,C.startFragRequested=!1,C.bitrateTest=!1;var _=R.stats;_.parsing.start=_.parsing.end=_.buffering.start=_.buffering.end=self.performance.now(),w.trigger(O.Events.FRAG_LOADED,I)}}))},C._handleTransmuxComplete=function e(R){var C,I="main",_=this.hls,F=R.remuxResult,P=R.chunkMeta,M=this.getCurrentContext(P);if(!M)return this.warn("The loading context changed while buffering fragment "+P.sn+" of level "+P.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(P.level);var B=M.frag,U=M.part,G=M.level,j=F.video,K=F.text,H=F.id3,V=F.initSegment,W=this.altAudio?void 0:F.audio;if(!this.fragContextChanged(B)){if(this.state=x.State.PARSING,V){V.tracks&&(this._bufferInitSegment(G,V.tracks,B,P),_.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{"frag":B,"id":I,"tracks":V.tracks}));var Y=V.initPTS,z=V.timescale;Object(w.isFiniteNumber)(Y)&&(this.initPTS[B.cc]=Y,_.trigger(O.Events.INIT_PTS_FOUND,{"frag":B,"id":I,"initPTS":Y,"timescale":z}))}if(j&&!1!==F.independent){if(G.details){var X=j.startPTS,q=j.endPTS,Z=j.startDTS,Q=j.endDTS;if(U)U.elementaryStreams[j.type]={"startPTS":X,"endPTS":q,"startDTS":Z,"endDTS":Q};else if(j.firstKeyFrame&&j.independent&&(this.couldBacktrack=!0),j.dropped&&j.independent){if(this.getLoadPosition()+this.config.maxBufferHole<X)return void this.backtrack(B);B.setElementaryStreamInfo(j.type,B.start,q,B.start,Q,!0)}B.setElementaryStreamInfo(j.type,X,q,Z,Q),this.bufferFragmentData(j,B,U,P)}}else if(!1===F.independent)return void this.backtrack(B);if(W){var J=W.startPTS,$=W.endPTS,ee=W.startDTS,te=W.endDTS;U&&(U.elementaryStreams[N.ElementaryStreamTypes.AUDIO]={"startPTS":J,"endPTS":$,"startDTS":ee,"endDTS":te}),B.setElementaryStreamInfo(N.ElementaryStreamTypes.AUDIO,J,$,ee,te),this.bufferFragmentData(W,B,U,P)}if(null!=H&&null!==(C=H.samples)&&void 0!==C&&C.length){var re={"frag":B,"id":I,"samples":H.samples};_.trigger(O.Events.FRAG_PARSING_METADATA,re)}if(K){var ie={"frag":B,"id":I,"samples":K.samples};_.trigger(O.Events.FRAG_PARSING_USERDATA,ie)}}},C._bufferInitSegment=function e(R,C,I,w){var _,F=this;if(this.state===x.State.PARSING){this.audioOnly=!!C.audio&&!C.video,this.altAudio&&!this.audioOnly&&delete C.audio;var P=C.audio,M=C.video,N=C.audiovideo;if(P){var B=R.audioCodec,U=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(B&&(B=-1!==Ce()(B).call(B,"mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==P.metadata.channelCount&&-1===Ce()(U).call(U,"firefox")&&(B="mp4a.40.5")),-1!==Ce()(U).call(U,"android")&&"audio/mpeg"!==P.container&&(B="mp4a.40.2",this.log("Android: force audio codec to "+B)),R.audioCodec&&R.audioCodec!==B&&this.log('Swapping manifest audio codec "'+R.audioCodec+'" for "'+B+'"'),P.levelCodec=B,P.id="main",this.log("Init audio buffer, container:"+P.container+", codecs[selected/level/parsed]=["+(B||"")+"/"+(R.audioCodec||"")+"/"+P.codec+"]")}M&&(M.levelCodec=R.videoCodec,M.id="main",this.log("Init video buffer, container:"+M.container+", codecs[level/parsed]=["+(R.videoCodec||"")+"/"+M.codec+"]")),N&&this.log("Init audiovideo buffer, container:"+N.container+", codecs[level/parsed]=["+(R.attrs.CODECS||"")+"/"+N.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,C),ne()(_=ee()(C)).call(_,(function(R){var x=C[R].initSegment;null!=x&&x.byteLength&&F.hls.trigger(O.Events.BUFFER_APPENDING,{"type":R,"data":x,"frag":I,"part":null,"chunkMeta":w,"parent":I.type})})),this.tick()}},C.backtrack=function e(R){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(R);var C=this.fragmentTracker.backtrack(R);this.fragPrevious=null,this.nextLoadPosition=R.start,C?this.resetFragmentLoading(R):this.state=x.State.BACKTRACKING},C.checkFragmentChanged=function e(){var R=this.media,C=null;if(R&&R.readyState>1&&!1===R.seeking){var I=R.currentTime;if(F.BufferHelper.isBuffered(R,I)?C=this.getAppendedFrag(I):F.BufferHelper.isBuffered(R,I+.1)&&(C=this.getAppendedFrag(I+.1)),C){var w=this.fragPlaying,x=C.level;w&&C.sn===w.sn&&w.level===x&&C.urlId===w.urlId||(this.hls.trigger(O.Events.FRAG_CHANGED,{"frag":C}),w&&w.level===x||this.hls.trigger(O.Events.LEVEL_SWITCHED,{"level":x}),this.fragPlaying=C)}}},function m(R,C,I){return C&&p(R.prototype,C),I&&p(R,I),R}(t,[{"key":"nextLevel","get":function e(){var R=this.nextBufferedFrag;return R?R.level:-1}},{"key":"currentLevel","get":function e(){var R=this.media;if(R){var C=this.getAppendedFrag(R.currentTime);if(C)return C.level}return-1}},{"key":"nextBufferedFrag","get":function e(){var R=this.media;if(R){var C=this.getAppendedFrag(R.currentTime);return this.followingBufferedFrag(C)}return null}},{"key":"forceStartLoad","get":function e(){return this._forceStartLoad}}]),t}(x.default)},"./src/controller/subtitle-stream-controller.ts":function srcControllerSubtitleStreamControllerTs(R,C,I){I.r(C),I.d(C,"SubtitleStreamController",(function(){return G}));var w=I("./src/events.ts"),x=I("./src/utils/buffer-helper.ts"),_=I("./src/controller/fragment-finders.ts"),O=I("./src/utils/discontinuities.ts"),F=I("./src/controller/level-helper.ts"),P=I("./src/controller/fragment-tracker.ts"),M=I("./src/controller/base-stream-controller.ts"),N=I("./src/types/loader.ts"),U=I("./src/types/level.ts");function d(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function g(R,C){return g=Se()||function e(R,C){return R.__proto__=C,R},g(R,C)}var G=function(R){function t(C,I){var w;return(w=R.call(this,C,I,"[subtitle-stream-controller]")||this).levels=[],w.currentTrackId=-1,w.tracksBuffered=[],w.mainDetails=null,w._registerListeners(),w}!function v(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,g(R,C)}(t,R);var C=t.prototype;return C.onHandlerDestroying=function e(){this._unregisterListeners(),this.mainDetails=null},C._registerListeners=function e(){var R=this.hls;R.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.on(w.Events.ERROR,this.onError,this),R.on(w.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.on(w.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),R.on(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.on(w.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),R.on(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},C._unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),R.off(w.Events.ERROR,this.onError,this),R.off(w.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.off(w.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),R.off(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.off(w.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),R.off(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},C.startLoad=function e(){this.stopLoad(),this.state=M.State.IDLE,this.setInterval(500),this.tick()},C.onManifestLoading=function e(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},C.onLevelLoaded=function e(R,C){this.mainDetails=C.details},C.onSubtitleFragProcessed=function e(R,C){var I=C.frag,w=C.success;if(this.fragPrevious=I,this.state=M.State.IDLE,w){var x=this.tracksBuffered[this.currentTrackId];if(x){for(var _,O=I.start,F=0;F<x.length;F++)if(O>=x[F].start&&O<=x[F].end){_=x[F];break}var P=I.start+I.duration;_?_.end=P:(_={"start":O,"end":P},x.push(_)),this.fragmentTracker.fragBuffered(I)}}},C.onBufferFlushing=function e(R,C){var I=C.startOffset,w=C.endOffset;if(0===I&&w!==Number.POSITIVE_INFINITY){var x,_=this.currentTrackId,O=this.levels;if(!O.length||!O[_]||!O[_].details)return;var F=w-O[_].details.targetduration;if(F<=0)return;C.endOffsetSubtitles=Math.max(0,F),ne()(x=this.tracksBuffered).call(x,(function(R){for(var C=0;C<R.length;)if(R[C].end<=F)R.shift();else{if(!(R[C].start<F))break;R[C].start=F,C++}})),this.fragmentTracker.removeFragmentsInRange(I,F,N.PlaylistLevelType.SUBTITLE)}},C.onError=function e(R,C){var I,w=C.frag;w&&w.type===N.PlaylistLevelType.SUBTITLE&&(null!==(I=this.fragCurrent)&&void 0!==I&&I.loader&&this.fragCurrent.loader.abort(),this.state=M.State.IDLE)},C.onSubtitleTracksUpdated=function e(R,C){var I,w=this,x=C.subtitleTracks;this.tracksBuffered=[],this.levels=ce()(x).call(x,(function(R){return new U.Level(R)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,ne()(I=this.levels).call(I,(function(R){w.tracksBuffered[R.id]=[]})),this.mediaBuffer=null},C.onSubtitleTrackSwitch=function e(R,C){if(this.currentTrackId=C.id,this.levels.length&&-1!==this.currentTrackId){var I=this.levels[this.currentTrackId];null!=I&&I.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,I&&this.setInterval(500)}else this.clearInterval()},C.onSubtitleTrackLoaded=function e(R,C){var I,w=C.details,x=C.id,P=this.currentTrackId,N=this.levels;if(N.length){var B=N[P];if(!(x>=N.length||x!==P)&&B){if(this.mediaBuffer=this.mediaBufferTimeRanges,w.live||null!==(I=B.details)&&void 0!==I&&I.live){var U=this.mainDetails;if(w.deltaUpdateFailed||!U)return;var G=U.fragments[0];if(B.details)0===this.alignPlaylists(w,B.details)&&G&&Object(F.addSliding)(w,G.start);else w.hasProgramDateTime&&U.hasProgramDateTime?Object(O.alignMediaPlaylistByPDT)(w,U):G&&Object(F.addSliding)(w,G.start)}if(B.details=w,this.levelLastLoaded=x,this.tick(),w.live&&!this.fragCurrent&&this.media&&this.state===M.State.IDLE)Object(_.findFragmentByPTS)(null,w.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),B.details=void 0)}}},C._handleFragmentLoadComplete=function e(R){var C=R.frag,I=R.payload,x=C.decryptdata,_=this.hls;if(!this.fragContextChanged(C)&&I&&I.byteLength>0&&x&&x.key&&x.iv&&"AES-128"===x.method){var O=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(I),x.key.buffer,x.iv.buffer).then((function(R){var I=performance.now();_.trigger(w.Events.FRAG_DECRYPTED,{"frag":C,"payload":R,"stats":{"tstart":O,"tdecrypt":I}})}))}},C.doTick=function e(){if(this.media){if(this.state===M.State.IDLE){var R,C=this.currentTrackId,I=this.levels;if(!I.length||!I[C]||!I[C].details)return;var w=I[C].details,O=w.targetduration,F=this.config,N=this.media,B=x.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,N.currentTime-O,F.maxBufferHole),U=B.end;if(B.len>this.getMaxBufferLength()+O)return;console.assert(w,"Subtitle track details are defined on idle subtitle stream controller tick");var G,j=w.fragments,K=j.length,H=w.edge,V=this.fragPrevious;if(U<H){var W=F.maxFragLookUpTolerance;!(G=Object(_.findFragmentByPTS)(V,j,U,W))&&V&&V.start<j[0].start&&(G=j[0])}else G=j[K-1];null!==(R=G)&&void 0!==R&&R.encrypted?this.loadKey(G,w):G&&this.fragmentTracker.getState(G)===P.FragmentState.NOT_LOADED&&this.loadFragment(G,w,U)}}else this.state=M.State.IDLE},C.loadFragment=function t(C,I,w){this.fragCurrent=C,R.prototype.loadFragment.call(this,C,I,w)},function h(R,C,I){return C&&d(R.prototype,C),I&&d(R,I),R}(t,[{"key":"mediaBufferTimeRanges","get":function e(){return this.tracksBuffered[this.currentTrackId]||[]}}]),t}(M.default)},"./src/controller/subtitle-track-controller.ts":function srcControllerSubtitleTrackControllerTs(R,C,I){I.r(C);var w=I("./src/events.ts"),x=I("./src/utils/texttrack-utils.ts"),_=I("./src/controller/base-playlist-controller.ts"),O=I("./src/types/loader.ts");function o(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function f(R,C){return f=Se()||function e(R,C){return R.__proto__=C,R},f(R,C)}var F=function(R){function t(C){var I;return(I=R.call(this,C,"[subtitle-track-controller]")||this).media=null,I.tracks=[],I.groupId=null,I.tracksInGroup=[],I.trackId=-1,I.selectDefaultTrack=!0,I.queuedDefaultTrack=-1,I.trackChangeListener=function(){return I.onTextTracksChanged()},I.asyncPollTrackChange=function(){return I.pollTrackChange(0)},I.useTextTrackPolling=!1,I.subtitlePollingInterval=-1,I.subtitleDisplay=!0,I.registerListeners(),I}!function u(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,f(R,C)}(t,R);var C=t.prototype;return C.destroy=function t(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,R.prototype.destroy.call(this)},C.registerListeners=function e(){var R=this.hls;R.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.on(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.on(w.Events.ERROR,this.onError,this)},C.unregisterListeners=function e(){var R=this.hls;R.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),R.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),R.off(w.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),R.off(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),R.off(w.Events.ERROR,this.onError,this)},C.onMediaAttached=function e(R,C){this.media=C.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},C.pollTrackChange=function e(R){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,R)},C.onMediaDetaching=function e(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var R=d(this.media.textTracks);ne()(R).call(R,(function(R){Object(x.clearCurrentCues)(R)})),this.subtitleTrack=-1,this.media=null}},C.onManifestLoading=function e(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},C.onManifestParsed=function e(R,C){this.tracks=C.subtitleTracks},C.onSubtitleTrackLoaded=function e(R,C){var I=C.id,w=C.details,x=this.trackId,_=this.tracksInGroup[x];if(_){var O=_.details;_.details=C.details,this.log("subtitle track "+I+" loaded ["+w.startSN+"-"+w.endSN+"]"),I===this.trackId&&(this.retryCount=0,this.playlistLoaded(I,C,O))}else this.warn("Invalid subtitle track id "+I)},C.onLevelLoading=function e(R,C){this.switchLevel(C.level)},C.onLevelSwitching=function e(R,C){this.switchLevel(C.level)},C.switchLevel=function e(R){var C=this.hls.levels[R];if(null!=C&&C.textGroupIds){var I=C.textGroupIds[C.urlId];if(this.groupId!==I){var x,_=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,O=se()(x=this.tracks).call(x,(function(R){return!I||R.groupId===I}));this.tracksInGroup=O;var F=this.findTrackId(null==_?void 0:_.name)||this.findTrackId();this.groupId=I;var P={"subtitleTracks":O};this.log("Updating subtitle tracks, "+O.length+' track(s) found in "'+I+'" group-id'),this.hls.trigger(w.Events.SUBTITLE_TRACKS_UPDATED,P),-1!==F&&this.setSubtitleTrack(F,_)}}},C.findTrackId=function e(R){for(var C=this.tracksInGroup,I=0;I<C.length;I++){var w=C[I];if((!this.selectDefaultTrack||w.default)&&(!R||R===w.name))return w.id}return-1},C.onError=function t(C,I){R.prototype.onError.call(this,C,I),!I.fatal&&I.context&&I.context.type===O.PlaylistContextType.SUBTITLE_TRACK&&I.context.id===this.trackId&&I.context.groupId===this.groupId&&this.retryLoadingOrFail(I)},C.loadPlaylist=function e(R){var C=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(C)){var I=C.id,x=C.groupId,_=C.url;if(R)try{_=R.addDirectives(_)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+I),this.hls.trigger(w.Events.SUBTITLE_TRACK_LOADING,{"url":_,"id":I,"groupId":x,"deliveryDirectives":R||null})}},C.toggleTrackModes=function e(R){var C=this,I=this.media,w=this.subtitleDisplay,x=this.trackId;if(I){var _=d(I.textTracks),O=se()(_).call(_,(function(R){return R.groupId===C.groupId}));if(-1===R){var F;ne()(F=K()([]).call(_)).call(F,(function(R){R.mode="disabled"}))}else{var P=O[x];P&&(P.mode="disabled")}var M=O[R];M&&(M.mode=w?"showing":"hidden")}},C.setSubtitleTrack=function e(R,C){var I,x=this.tracksInGroup;if(this.media){if(this.trackId!==R&&this.toggleTrackModes(R),!(this.trackId===R&&(-1===R||null!==(I=x[R])&&void 0!==I&&I.details)||R<-1||R>=x.length)){this.clearTimer();var _=x[R];if(this.log("Switching to subtitle track "+R),this.trackId=R,_){var O=_.id,F=_.groupId,P=void 0===F?"":F,M=_.name,N=_.type,B=_.url;this.hls.trigger(w.Events.SUBTITLE_TRACK_SWITCH,{"id":O,"groupId":P,"name":M,"type":N,"url":B});var U=this.switchParams(_.url,null==C?void 0:C.details);this.loadPlaylist(U)}else this.hls.trigger(w.Events.SUBTITLE_TRACK_SWITCH,{"id":R})}}else this.queuedDefaultTrack=R},C.onTextTracksChanged=function e(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var R=-1,C=d(this.media.textTracks),I=0;I<C.length;I++)if("hidden"===C[I].mode)R=I;else if("showing"===C[I].mode){R=I;break}this.subtitleTrack!==R&&(this.subtitleTrack=R)}},function l(R,C,I){return C&&o(R.prototype,C),I&&o(R,I),R}(t,[{"key":"subtitleTracks","get":function e(){return this.tracksInGroup}},{"key":"subtitleTrack","get":function e(){return this.trackId},"set":function e(R){this.selectDefaultTrack=!1;var C=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(R,C)}}]),t}(_.default);function d(R){for(var C=[],I=0;I<R.length;I++){var w=R[I];"subtitles"===w.kind&&w.label&&C.push(R[I])}return C}C.default=F},"./src/controller/timeline-controller.ts":function srcControllerTimelineControllerTs(R,C,I){I.r(C),I.d(C,"TimelineController",(function(){return U}));var w=I("./src/polyfills/number.ts"),x=I("./src/events.ts"),_=I("./src/utils/cea-608-parser.ts"),O=I("./src/utils/output-filter.ts"),F=I("./src/utils/webvtt-parser.ts"),P=I("./src/utils/texttrack-utils.ts"),M=I("./src/utils/imsc1-ttml-parser.ts"),N=I("./src/types/loader.ts"),B=I("./src/utils/logger.ts"),U=function(){function e(R){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!1}},this.captionsProperties=void 0,this.hls=R,this.config=R.config,this.Cues=R.config.cueHandler,this.captionsProperties={"textTrack1":{"label":this.config.captionsTextTrack1Label,"languageCode":this.config.captionsTextTrack1LanguageCode},"textTrack2":{"label":this.config.captionsTextTrack2Label,"languageCode":this.config.captionsTextTrack2LanguageCode},"textTrack3":{"label":this.config.captionsTextTrack3Label,"languageCode":this.config.captionsTextTrack3LanguageCode},"textTrack4":{"label":this.config.captionsTextTrack4Label,"languageCode":this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var C=new O.default(this,"textTrack1"),I=new O.default(this,"textTrack2"),w=new O.default(this,"textTrack3"),F=new O.default(this,"textTrack4");this.cea608Parser1=new _.default(1,C,I),this.cea608Parser2=new _.default(3,w,F)}R.on(x.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.on(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(x.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.on(x.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.on(x.Events.FRAG_LOADING,this.onFragLoading,this),R.on(x.Events.FRAG_LOADED,this.onFragLoaded,this),R.on(x.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),R.on(x.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),R.on(x.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.on(x.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),R.on(x.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var R=e.prototype;return R.destroy=function e(){var R=this.hls;R.off(x.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(x.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(x.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.off(x.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.off(x.Events.FRAG_LOADING,this.onFragLoading,this),R.off(x.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(x.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),R.off(x.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),R.off(x.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.off(x.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),R.off(x.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},R.addCues=function e(R,C,I,w,_){for(var O=!1,F=_.length;F--;){var P=_[F],M=v(P[0],P[1],C,I);if(M>=0&&(P[0]=Math.min(P[0],C),P[1]=Math.max(P[1],I),O=!0,M/(I-C)>.5))return}if(O||_.push([C,I]),this.config.renderTextTracksNatively){var N=this.captionsTracks[R];this.Cues.newCue(N,C,I,w)}else{var B=this.Cues.newCue(null,C,I,w);this.hls.trigger(x.Events.CUES_PARSED,{"type":"captions","cues":B,"track":R})}},R.onInitPtsFound=function e(R,C){var I=this,w=C.frag,_=C.id,O=C.initPTS,F=C.timescale,P=this.unparsedVttFrags;"main"===_&&(this.initPTS[w.cc]=O,this.timescale[w.cc]=F),P.length&&(this.unparsedVttFrags=[],ne()(P).call(P,(function(R){I.onFragLoaded(x.Events.FRAG_LOADED,R)})))},R.getExistingTrack=function e(R){var C=this.media;if(C)for(var I=0;I<C.textTracks.length;I++){var w=C.textTracks[I];if(w[R])return w}return null},R.createCaptionsTrack=function e(R){this.config.renderTextTracksNatively?this.createNativeTrack(R):this.createNonNativeTrack(R)},R.createNativeTrack=function e(R){if(!this.captionsTracks[R]){var C=this.captionsProperties,I=this.captionsTracks,w=this.media,x=C[R],_=x.label,O=x.languageCode,F=this.getExistingTrack(R);if(F)I[R]=F,Object(P.clearCurrentCues)(I[R]),Object(P.sendAddTrackEvent)(I[R],w);else{var M=this.createTextTrack("captions",_,O);M&&(M[R]=!0,I[R]=M)}}},R.createNonNativeTrack=function e(R){if(!this.nonNativeCaptionsTracks[R]){var C=this.captionsProperties[R];if(C){var I={"_id":R,"label":C.label,"kind":"captions","default":!!C.media&&!!C.media.default,"closedCaptions":C.media};this.nonNativeCaptionsTracks[R]=I,this.hls.trigger(x.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":[I]})}}},R.createTextTrack=function e(R,C,I){var w=this.media;if(w)return w.addTextTrack(R,C,I)},R.onMediaAttaching=function e(R,C){this.media=C.media,this._cleanTracks()},R.onMediaDetaching=function e(){var R,C=this.captionsTracks;ne()(R=ee()(C)).call(R,(function(R){Object(P.clearCurrentCues)(C[R]),delete C[R]})),this.nonNativeCaptionsTracks={}},R.onManifestLoading=function e(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},R._cleanTracks=function e(){var R=this.media;if(R){var C=R.textTracks;if(C)for(var I=0;I<C.length;I++)Object(P.clearCurrentCues)(C[I])}},R.onSubtitleTracksUpdated=function e(R,C){var I=this;this.textTracks=[];var w=C.subtitleTracks||[],_=Le()(w).call(w,(function(R){return R.textCodec===M.IMSC1_CODEC}));if(this.config.enableWebVTT||_&&this.config.enableIMSC1){var O=this.tracks&&w&&this.tracks.length===w.length;if(this.tracks=w||[],this.config.renderTextTracksNatively){var F,N=this.media?this.media.textTracks:[];ne()(F=this.tracks).call(F,(function(R,C){var w;if(C<N.length){for(var x=null,_=0;_<N.length;_++)if(h(N[_],R)){x=N[_];break}x&&(w=x)}w?Object(P.clearCurrentCues)(w):(w=I.createTextTrack("subtitles",R.name,R.lang))&&(w.mode="disabled"),w&&(w.groupId=R.groupId,I.textTracks.push(w))}))}else if(!O&&this.tracks&&this.tracks.length){var B,U=ce()(B=this.tracks).call(B,(function(R){return{"label":R.name,"kind":R.type.toLowerCase(),"default":R.default,"subtitleTrack":R}}));this.hls.trigger(x.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":U})}}},R.onManifestLoaded=function e(R,C){var I,w=this;this.config.enableCEA708Captions&&C.captions&&ne()(I=C.captions).call(I,(function(R){var C=/(?:CC|SERVICE)([1-4])/.exec(R.instreamId);if(C){var I="textTrack"+C[1],x=w.captionsProperties[I];x&&(x.label=R.name,R.lang&&(x.languageCode=R.lang),x.media=R)}}))},R.onFragLoading=function e(R,C){var I=this.cea608Parser1,w=this.cea608Parser2,x=this.lastSn,_=this.lastPartIndex;if(this.enabled&&I&&w&&C.frag.type===N.PlaylistLevelType.MAIN){var O,F,P=C.frag.sn,M=null!=(O=null==C||null===(F=C.part)||void 0===F?void 0:F.index)?O:-1;P===x+1||P===x&&M===_+1||(I.reset(),w.reset()),this.lastSn=P,this.lastPartIndex=M}},R.onFragLoaded=function e(R,C){var I=C.frag,_=C.payload,O=this.initPTS,F=this.unparsedVttFrags;if(I.type===N.PlaylistLevelType.SUBTITLE)if(_.byteLength){if(!Object(w.isFiniteNumber)(O[I.cc]))return F.push(C),void(O.length&&this.hls.trigger(x.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":I,"error":new Error("Missing initial subtitle PTS")}));var P=I.decryptdata,B="stats"in C;if(null==P||null==P.key||"AES-128"!==P.method||B){var U=this.tracks[I.level],G=this.vttCCs;G[I.cc]||(G[I.cc]={"start":I.start,"prevCC":this.prevCC,"new":!0},this.prevCC=I.cc),U&&U.textCodec===M.IMSC1_CODEC?this._parseIMSC1(I,_):this._parseVTTs(I,_,G)}}else this.hls.trigger(x.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":I,"error":new Error("Empty subtitle payload")})},R._parseIMSC1=function e(R,C){var I=this,w=this.hls;Object(M.parseIMSC1)(C,this.initPTS[R.cc],this.timescale[R.cc],(function(C){I._appendCues(C,R.level),w.trigger(x.Events.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":R})}),(function(C){B.logger.log("Failed to parse IMSC1: "+C),w.trigger(x.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":R,"error":C})}))},R._parseVTTs=function e(R,C,I){var w=this,_=this.hls;Object(F.parseWebVTT)(C,this.initPTS[R.cc],this.timescale[R.cc],I,R.cc,R.start,(function(C){w._appendCues(C,R.level),_.trigger(x.Events.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":R})}),(function(I){w._fallbackToIMSC1(R,C),B.logger.log("Failed to parse VTT cue: "+I),_.trigger(x.Events.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":R,"error":I})}))},R._fallbackToIMSC1=function e(R,C){var I=this,w=this.tracks[R.level];w.textCodec||Object(M.parseIMSC1)(C,this.initPTS[R.cc],this.timescale[R.cc],(function(){w.textCodec=M.IMSC1_CODEC,I._parseIMSC1(R,C)}),(function(){w.textCodec="wvtt"}))},R._appendCues=function e(R,C){var I=this.hls;if(this.config.renderTextTracksNatively){var w=this.textTracks[C];if("disabled"===w.mode)return;ne()(R).call(R,(function(R){return Object(P.addCueToTrack)(w,R)}))}else{var _=this.tracks[C].default?"default":"subtitles"+C;I.trigger(x.Events.CUES_PARSED,{"type":"subtitles","cues":R,"track":_})}},R.onFragDecrypted=function e(R,C){var I=C.frag;if(I.type===N.PlaylistLevelType.SUBTITLE){if(!Object(w.isFiniteNumber)(this.initPTS[I.cc]))return void this.unparsedVttFrags.push(C);this.onFragLoaded(x.Events.FRAG_LOADED,C)}},R.onSubtitleTracksCleared=function e(){this.tracks=[],this.captionsTracks={}},R.onFragParsingUserdata=function e(R,C){var I=this.cea608Parser1,w=this.cea608Parser2;if(this.enabled&&I&&w)for(var x=0;x<C.samples.length;x++){var _=C.samples[x].bytes;if(_){var O=this.extractCea608Data(_);I.addData(C.samples[x].pts,O[0]),w.addData(C.samples[x].pts,O[1])}}},R.onBufferFlushing=function e(R,C){var I=C.startOffset,w=C.endOffset,x=C.endOffsetSubtitles,_=C.type,O=this.media;if(O&&!(O.currentTime<w)){if(!_||"video"===_){var F,M=this.captionsTracks;ne()(F=ee()(M)).call(F,(function(R){return Object(P.removeCuesInRange)(M[R],I,w)}))}if(this.config.renderTextTracksNatively&&0===I&&void 0!==x){var N,B=this.textTracks;ne()(N=ee()(B)).call(N,(function(R){return Object(P.removeCuesInRange)(B[R],I,x)}))}}},R.extractCea608Data=function e(R){for(var C=31&R[0],I=2,w=[[],[]],x=0;x<C;x++){var _=R[I++],O=127&R[I++],F=127&R[I++],P=3&_;0===O&&0===F||0!=(4&_)&&(0!==P&&1!==P||(w[P].push(O),w[P].push(F)))}return w},e}();function h(R,C){return R&&R.label===C.name&&!(R.textTrack1||R.textTrack2)}function v(R,C,I,w){return Math.min(C,w)-Math.max(R,I)}},"./src/crypt/aes-crypto.ts":function srcCryptAesCryptoTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w}));var w=function(){function e(R,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=C}return e.prototype.decrypt=function e(R,C){return this.subtle.decrypt({"name":"AES-CBC","iv":this.aesIV},C,R)},e}()},"./src/crypt/aes-decryptor.ts":function srcCryptAesDecryptorTs(R,C,I){I.r(C),I.d(C,"removePadding",(function(){return a})),I.d(C,"default",(function(){return x}));var w=I("./src/utils/typed-array.ts");function a(R){var C=R.byteLength,I=C&&new DataView(R.buffer).getUint8(C-1);return I?Object(w.sliceUint8)(R,0,C-I):R}var x=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=e.prototype;return R.uint8ArrayToUint32Array_=function e(R){for(var C=new DataView(R),I=new Uint32Array(4),w=0;w<4;w++)I[w]=C.getUint32(4*w);return I},R.initTable=function e(){var R=this.sBox,C=this.invSBox,I=this.subMix,w=I[0],x=I[1],_=I[2],O=I[3],F=this.invSubMix,P=F[0],M=F[1],N=F[2],B=F[3],U=new Uint32Array(256),G=0,j=0,K=0;for(K=0;K<256;K++)U[K]=K<128?K<<1:K<<1^283;for(K=0;K<256;K++){var H=j^j<<1^j<<2^j<<3^j<<4;H=H>>>8^255&H^99,R[G]=H,C[H]=G;var V=U[G],W=U[V],Y=U[W],z=257*U[H]^16843008*H;w[G]=z<<24|z>>>8,x[G]=z<<16|z>>>16,_[G]=z<<8|z>>>24,O[G]=z,z=16843009*Y^65537*W^257*V^16843008*G,P[H]=z<<24|z>>>8,M[H]=z<<16|z>>>16,N[H]=z<<8|z>>>24,B[H]=z,G?(G=V^U[U[U[Y^V]]],j^=U[U[j]]):G=j=1}},R.expandKey=function e(R){for(var C=this.uint8ArrayToUint32Array_(R),I=!0,w=0;w<C.length&&I;)I=C[w]===this.key[w],w++;if(!I){this.key=C;var x=this.keySize=C.length;if(4!==x&&6!==x&&8!==x)throw new Error("Invalid aes key size="+x);var _,O,F,P,M=this.ksRows=4*(x+6+1),N=this.keySchedule=new Uint32Array(M),B=this.invKeySchedule=new Uint32Array(M),U=this.sBox,G=this.rcon,j=this.invSubMix,K=j[0],H=j[1],V=j[2],W=j[3];for(_=0;_<M;_++)_<x?F=N[_]=C[_]:(P=F,_%x==0?(P=U[(P=P<<8|P>>>24)>>>24]<<24|U[P>>>16&255]<<16|U[P>>>8&255]<<8|U[255&P],P^=G[_/x|0]<<24):x>6&&_%x==4&&(P=U[P>>>24]<<24|U[P>>>16&255]<<16|U[P>>>8&255]<<8|U[255&P]),N[_]=F=(N[_-x]^P)>>>0);for(O=0;O<M;O++)_=M-O,P=3&O?N[_]:N[_-4],B[O]=O<4||_<=4?P:K[U[P>>>24]]^H[U[P>>>16&255]]^V[U[P>>>8&255]]^W[U[255&P]],B[O]=B[O]>>>0}},R.networkToHostOrderSwap=function e(R){return R<<24|(65280&R)<<8|(16711680&R)>>8|R>>>24},R.decrypt=function e(R,C,I){for(var w,x,_,O,F,P,M,N,B,U,G,j,K,H,V=this.keySize+6,W=this.invKeySchedule,Y=this.invSBox,z=this.invSubMix,X=z[0],q=z[1],Z=z[2],Q=z[3],J=this.uint8ArrayToUint32Array_(I),$=J[0],ee=J[1],te=J[2],re=J[3],ie=new Int32Array(R),ne=new Int32Array(ie.length),ae=this.networkToHostOrderSwap;C<ie.length;){for(B=ae(ie[C]),U=ae(ie[C+1]),G=ae(ie[C+2]),j=ae(ie[C+3]),F=B^W[0],P=j^W[1],M=G^W[2],N=U^W[3],K=4,H=1;H<V;H++)w=X[F>>>24]^q[P>>16&255]^Z[M>>8&255]^Q[255&N]^W[K],x=X[P>>>24]^q[M>>16&255]^Z[N>>8&255]^Q[255&F]^W[K+1],_=X[M>>>24]^q[N>>16&255]^Z[F>>8&255]^Q[255&P]^W[K+2],O=X[N>>>24]^q[F>>16&255]^Z[P>>8&255]^Q[255&M]^W[K+3],F=w,P=x,M=_,N=O,K+=4;w=Y[F>>>24]<<24^Y[P>>16&255]<<16^Y[M>>8&255]<<8^Y[255&N]^W[K],x=Y[P>>>24]<<24^Y[M>>16&255]<<16^Y[N>>8&255]<<8^Y[255&F]^W[K+1],_=Y[M>>>24]<<24^Y[N>>16&255]<<16^Y[F>>8&255]<<8^Y[255&P]^W[K+2],O=Y[N>>>24]<<24^Y[F>>16&255]<<16^Y[P>>8&255]<<8^Y[255&M]^W[K+3],ne[C]=ae(w^$),ne[C+1]=ae(O^ee),ne[C+2]=ae(_^te),ne[C+3]=ae(x^re),$=B,ee=U,te=G,re=j,C+=4}return ne.buffer},e}()},"./src/crypt/decrypter.ts":function srcCryptDecrypterTs(R,C,I){I.r(C),I.d(C,"default",(function(){return N}));var w=I("./src/crypt/aes-crypto.ts"),x=I("./src/crypt/fast-aes-key.ts"),_=I("./src/crypt/aes-decryptor.ts"),O=I("./src/utils/logger.ts"),F=I("./src/utils/mp4-tools.ts"),P=I("./src/utils/typed-array.ts"),N=function(){function e(R,C,I){var w=(void 0===I?{}:I).removePKCS7Padding,x=void 0===w||w;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=R,this.config=C,this.removePKCS7Padding=x,x)try{var _=self.crypto;_&&(this.subtle=_.subtle||_.webkitSubtle)}catch(R){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var R=e.prototype;return R.destroy=function e(){this.observer=null},R.isSync=function e(){return this.config.enableSoftwareAES},R.flush=function e(){var R=this.currentResult;if(R){var C=new Uint8Array(R);return this.reset(),this.removePKCS7Padding?Object(_.removePadding)(C):C}this.reset()},R.reset=function e(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},R.decrypt=function e(R,C,I,w){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(R),C,I);var x=this.flush();x&&w(x.buffer)}else this.webCryptoDecrypt(new Uint8Array(R),C,I).then(w)},R.softwareDecrypt=function e(R,C,I){var w=this.currentIV,x=this.currentResult,O=this.remainderData;this.logOnce("JS AES decrypt"),O&&(R=Object(F.appendUint8Array)(O,R),this.remainderData=null);var M=this.getValidChunk(R);if(!M.length)return null;w&&(I=w);var N=this.softwareDecrypter;N||(N=this.softwareDecrypter=new _.default),N.expandKey(C);var B=x;return this.currentResult=N.decrypt(M.buffer,0,I),this.currentIV=Object(P.sliceUint8)(M,-16).buffer,B||null},R.webCryptoDecrypt=function e(R,C,I){var _=this,O=this.subtle;return this.key===C&&this.fastAesKey||(this.key=C,this.fastAesKey=new x.default(O,C)),this.fastAesKey.expandKey().then((function(C){return O?new w.default(O,I).decrypt(R.buffer,C):M().reject(new Error("web crypto not initialized"))})).catch((function(w){return _.onWebCryptoError(w,R,C,I)}))},R.onWebCryptoError=function e(R,C,I,w){return O.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",R),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(C,I,w)},R.getValidChunk=function e(R){var C=R,I=R.length-R.length%16;return I!==R.length&&(C=Object(P.sliceUint8)(R,0,I),this.remainderData=Object(P.sliceUint8)(R,I)),C},R.logOnce=function e(R){this.logEnabled&&(O.logger.log("[decrypter.ts]: "+R),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":function srcCryptFastAesKeyTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w}));var w=function(){function e(R,C){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=C}return e.prototype.expandKey=function e(){return this.subtle.importKey("raw",this.key,{"name":"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function srcDemuxAacdemuxerTs(R,C,I){I.r(C);var w=I("./src/demux/base-audio-demuxer.ts"),x=I("./src/demux/adts.ts"),_=I("./src/utils/logger.ts"),O=I("./src/demux/id3.ts");function l(R,C){return l=Se()||function e(R,C){return R.__proto__=C,R},l(R,C)}var F=function(R){function t(C,I){var w;return(w=R.call(this)||this).observer=void 0,w.config=void 0,w.observer=C,w.config=I,w}!function o(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,l(R,C)}(t,R);var C=t.prototype;return C.resetInitSegment=function t(C,I,w){R.prototype.resetInitSegment.call(this,C,I,w),this._audioTrack={"container":"audio/adts","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"isAAC":!0,"samples":[],"manifestCodec":C,"duration":w,"inputTimeScale":9e4,"dropped":0}},t.probe=function e(R){if(!R)return!1;for(var C=(O.getID3Data(R,0)||[]).length,I=R.length;C<I;C++)if(x.probe(R,C))return _.logger.log("ADTS sync word found !"),!0;return!1},C.canParse=function e(R,C){return x.canParse(R,C)},C.appendFrame=function e(R,C,I){x.initTrackConfig(R,this.observer,C,I,R.manifestCodec);var w=x.appendFrame(R,C,I,this.initPTS,this.frameIndex);if(w&&0===w.missing)return w},t}(w.default);F.minProbeByteLength=9,C.default=F},"./src/demux/adts.ts":function srcDemuxAdtsTs(R,C,I){I.r(C),I.d(C,"getAudioConfig",(function(){return s})),I.d(C,"isHeaderPattern",(function(){return o})),I.d(C,"getHeaderLength",(function(){return l})),I.d(C,"getFullFrameLength",(function(){return u})),I.d(C,"canGetFrameLength",(function(){return f})),I.d(C,"isHeader",(function(){return c})),I.d(C,"canParse",(function(){return d})),I.d(C,"probe",(function(){return h})),I.d(C,"initTrackConfig",(function(){return v})),I.d(C,"getFrameDuration",(function(){return g})),I.d(C,"parseFrameHeader",(function(){return p})),I.d(C,"appendFrame",(function(){return m}));var w=I("./src/utils/logger.ts"),x=I("./src/errors.ts"),_=I("./src/events.ts");function s(R,C,I,O){var F,P,M,N,B=navigator.userAgent.toLowerCase(),U=O,G=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];F=1+((192&C[I+2])>>>6);var j=(60&C[I+2])>>>2;if(!(j>G.length-1))return M=(1&C[I+2])<<2,M|=(192&C[I+3])>>>6,w.logger.log("manifest codec:"+O+", ADTS type:"+F+", samplingIndex:"+j),/firefox/i.test(B)?j>=6?(F=5,N=new Array(4),P=j-3):(F=2,N=new Array(2),P=j):-1!==Ce()(B).call(B,"android")?(F=2,N=new Array(2),P=j):(F=5,N=new Array(4),O&&(-1!==Ce()(O).call(O,"mp4a.40.29")||-1!==Ce()(O).call(O,"mp4a.40.5"))||!O&&j>=6?P=j-3:((O&&-1!==Ce()(O).call(O,"mp4a.40.2")&&(j>=6&&1===M||/vivaldi/i.test(B))||!O&&1===M)&&(F=2,N=new Array(2)),P=j)),N[0]=F<<3,N[0]|=(14&j)>>1,N[1]|=(1&j)<<7,N[1]|=M<<3,5===F&&(N[1]|=(14&P)>>1,N[2]=(1&P)<<7,N[2]|=8,N[3]=0),{"config":N,"samplerate":G[j],"channelCount":M,"codec":"mp4a.40."+F,"manifestCodec":U};R.trigger(_.Events.ERROR,{"type":x.ErrorTypes.MEDIA_ERROR,"details":x.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!0,"reason":"invalid ADTS sampling index:"+j})}function o(R,C){return 255===R[C]&&240==(246&R[C+1])}function l(R,C){return 1&R[C+1]?7:9}function u(R,C){return(3&R[C+3])<<11|R[C+4]<<3|(224&R[C+5])>>>5}function f(R,C){return C+5<R.length}function c(R,C){return C+1<R.length&&o(R,C)}function d(R,C){return f(R,C)&&o(R,C)&&u(R,C)<=R.length-C}function h(R,C){if(c(R,C)){var I=l(R,C);if(C+I>=R.length)return!1;var w=u(R,C);if(w<=I)return!1;var x=C+w;return x===R.length||c(R,x)}return!1}function v(R,C,I,x,_){if(!R.samplerate){var O=s(C,I,x,_);if(!O)return;R.config=O.config,R.samplerate=O.samplerate,R.channelCount=O.channelCount,R.codec=O.codec,R.manifestCodec=O.manifestCodec,w.logger.log("parsed codec:"+R.codec+", rate:"+O.samplerate+", channels:"+O.channelCount)}}function g(R){return 9216e4/R}function p(R,C,I,w,x){var _=l(R,C),O=u(R,C);if((O-=_)>0)return{"headerLength":_,"frameLength":O,"stamp":I+w*x}}function m(R,C,I,w,x){var _=p(C,I,w,x,g(R.samplerate));if(_){var O,F=_.frameLength,P=_.headerLength,M=_.stamp,N=P+F,B=Math.max(0,I+N-C.length);B?(O=new Uint8Array(N-P)).set(C.subarray(I+P,C.length),0):O=C.subarray(I+P,I+N);var U={"unit":O,"pts":M};return B||R.samples.push(U),{"sample":U,"length":N,"missing":B}}}},"./src/demux/base-audio-demuxer.ts":function srcDemuxBaseAudioDemuxerTs(R,C,I){I.r(C),I.d(C,"initPTSFn",(function(){return N}));var w=I("./src/polyfills/number.ts"),x=I("./src/demux/id3.ts"),_=I("./src/demux/dummy-demuxed-track.ts"),O=I("./src/utils/mp4-tools.ts"),F=I("./src/utils/typed-array.ts"),P=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var R=e.prototype;return R.resetInitSegment=function e(R,C,I){this._id3Track={"type":"id3","id":3,"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0}},R.resetTimeStamp=function e(){},R.resetContiguity=function e(){},R.canParse=function e(R,C){return!1},R.appendFrame=function e(R,C,I){},R.demux=function e(R,C){this.cachedData&&(R=Object(O.appendUint8Array)(this.cachedData,R),this.cachedData=null);var I,w,P=x.getID3Data(R,0),M=P?P.length:0,B=this._audioTrack,U=this._id3Track,G=P?x.getTimeStamp(P):void 0,j=R.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=N(G,C)),P&&P.length>0&&U.samples.push({"pts":this.initPTS,"dts":this.initPTS,"data":P}),w=this.initPTS;M<j;){if(this.canParse(R,M)){var K=this.appendFrame(B,R,M);K?(this.frameIndex++,w=K.sample.pts,I=M+=K.length):M=j}else x.canParse(R,M)?(P=x.getID3Data(R,M),U.samples.push({"pts":w,"dts":w,"data":P}),I=M+=P.length):M++;if(M===j&&I!==j){var H=Object(F.sliceUint8)(R,I);this.cachedData?this.cachedData=Object(O.appendUint8Array)(this.cachedData,H):this.cachedData=H}}return{"audioTrack":B,"avcTrack":Object(_.dummyTrack)(),"id3Track":U,"textTrack":Object(_.dummyTrack)()}},R.demuxSampleAes=function e(R,C,I){return M().reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},R.flush=function e(R){var C=this.cachedData;return C&&(this.cachedData=null,this.demux(C,0)),this.frameIndex=0,{"audioTrack":this._audioTrack,"avcTrack":Object(_.dummyTrack)(),"id3Track":this._id3Track,"textTrack":Object(_.dummyTrack)()}},R.destroy=function e(){},e}(),N=function e(R,C){return Object(w.isFiniteNumber)(R)?90*R:9e4*C};C.default=P},"./src/demux/chunk-cache.ts":function srcDemuxChunkCacheTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w}));var w=function(){function e(){this.chunks=[],this.dataLength=0}var R=e.prototype;return R.push=function e(R){this.chunks.push(R),this.dataLength+=R.length},R.flush=function e(){var R,C=this.chunks,I=this.dataLength;return C.length?(R=1===C.length?C[0]:function a(R,C){for(var I=new Uint8Array(C),w=0,x=0;x<R.length;x++){var _=R[x];I.set(_,w),w+=_.length}return I}(C,I),this.reset(),R):new Uint8Array(0)},R.reset=function e(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":function srcDemuxDummyDemuxedTrackTs(R,C,I){function i(){return{"type":"","id":-1,"pid":-1,"inputTimeScale":9e4,"sequenceNumber":-1,"samples":[],"dropped":0}}I.r(C),I.d(C,"dummyTrack",(function(){return i}))},"./src/demux/exp-golomb.ts":function srcDemuxExpGolombTs(R,C,I){I.r(C);var w=I("./src/utils/logger.ts"),x=function(){function e(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var R=e.prototype;return R.loadWord=function e(){var R=this.data,C=this.bytesAvailable,I=R.byteLength-C,w=new Uint8Array(4),x=Math.min(4,C);if(0===x)throw new Error("no bytes available");w.set(R.subarray(I,I+x)),this.word=new DataView(w.buffer).getUint32(0),this.bitsAvailable=8*x,this.bytesAvailable-=x},R.skipBits=function e(R){var C;this.bitsAvailable>R?(this.word<<=R,this.bitsAvailable-=R):(R-=this.bitsAvailable,R-=(C=R>>3)>>3,this.bytesAvailable-=C,this.loadWord(),this.word<<=R,this.bitsAvailable-=R)},R.readBits=function e(R){var C=Math.min(this.bitsAvailable,R),I=this.word>>>32-C;return R>32&&w.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=C,this.bitsAvailable>0?this.word<<=C:this.bytesAvailable>0&&this.loadWord(),(C=R-C)>0&&this.bitsAvailable?I<<C|this.readBits(C):I},R.skipLZ=function e(){var R;for(R=0;R<this.bitsAvailable;++R)if(0!=(this.word&2147483648>>>R))return this.word<<=R,this.bitsAvailable-=R,R;return this.loadWord(),R+this.skipLZ()},R.skipUEG=function e(){this.skipBits(1+this.skipLZ())},R.skipEG=function e(){this.skipBits(1+this.skipLZ())},R.readUEG=function e(){var R=this.skipLZ();return this.readBits(R+1)-1},R.readEG=function e(){var R=this.readUEG();return 1&R?1+R>>>1:-1*(R>>>1)},R.readBoolean=function e(){return 1===this.readBits(1)},R.readUByte=function e(){return this.readBits(8)},R.readUShort=function e(){return this.readBits(16)},R.readUInt=function e(){return this.readBits(32)},R.skipScalingList=function e(R){for(var C=8,I=8,w=0;w<R;w++)0!==I&&(I=(C+this.readEG()+256)%256),C=0===I?C:I},R.readSPS=function e(){var R,C,I,w=0,x=0,_=0,O=0,F=this.readUByte.bind(this),P=this.readBits.bind(this),M=this.readUEG.bind(this),N=this.readBoolean.bind(this),B=this.skipBits.bind(this),U=this.skipEG.bind(this),G=this.skipUEG.bind(this),j=this.skipScalingList.bind(this);F();var K=F();if(P(5),B(3),F(),G(),100===K||110===K||122===K||244===K||44===K||83===K||86===K||118===K||128===K){var H=M();if(3===H&&B(1),G(),G(),B(1),N())for(C=3!==H?8:12,I=0;I<C;I++)N()&&j(I<6?16:64)}G();var V=M();if(0===V)M();else if(1===V)for(B(1),U(),U(),R=M(),I=0;I<R;I++)U();G(),B(1);var W=M(),Y=M(),z=P(1);0===z&&B(1),B(1),N()&&(w=M(),x=M(),_=M(),O=M());var X=[1,1];if(N()&&N())switch(F()){case 1:X=[1,1];break;case 2:X=[12,11];break;case 3:X=[10,11];break;case 4:X=[16,11];break;case 5:X=[40,33];break;case 6:X=[24,11];break;case 7:X=[20,11];break;case 8:X=[32,11];break;case 9:X=[80,33];break;case 10:X=[18,11];break;case 11:X=[15,11];break;case 12:X=[64,33];break;case 13:X=[160,99];break;case 14:X=[4,3];break;case 15:X=[3,2];break;case 16:X=[2,1];break;case 255:X=[F()<<8|F(),F()<<8|F()]}return{"width":Math.ceil(16*(W+1)-2*w-2*x),"height":(2-z)*(Y+1)*16-(z?2:4)*(_+O),"pixelRatio":X}},R.readSliceType=function e(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();C.default=x},"./src/demux/id3.ts":function srcDemuxId3Ts(R,C,I){I.r(C),I.d(C,"isHeader",(function(){return x})),I.d(C,"isFooter",(function(){return _})),I.d(C,"getID3Data",(function(){return O})),I.d(C,"canParse",(function(){return P})),I.d(C,"getTimeStamp",(function(){return M})),I.d(C,"isTimeStampFrame",(function(){return N})),I.d(C,"getID3Frames",(function(){return U})),I.d(C,"decodeFrame",(function(){return G})),I.d(C,"utf8ArrayToStr",(function(){return W})),I.d(C,"testables",(function(){return Y}));var w,x=function e(R,C){return C+10<=R.length&&73===R[C]&&68===R[C+1]&&51===R[C+2]&&R[C+3]<255&&R[C+4]<255&&R[C+6]<128&&R[C+7]<128&&R[C+8]<128&&R[C+9]<128},_=function e(R,C){return C+10<=R.length&&51===R[C]&&68===R[C+1]&&73===R[C+2]&&R[C+3]<255&&R[C+4]<255&&R[C+6]<128&&R[C+7]<128&&R[C+8]<128&&R[C+9]<128},O=function e(R,C){for(var I=C,w=0;x(R,C);){w+=10,w+=F(R,C+6),_(R,C+10)&&(w+=10),C+=w}if(w>0)return R.subarray(I,I+w)},F=function e(R,C){var I=0;return I=(127&R[C])<<21,I|=(127&R[C+1])<<14,I|=(127&R[C+2])<<7,I|=127&R[C+3]},P=function e(R,C){return x(R,C)&&F(R,C+6)+10<=R.length-C},M=function e(R){for(var C=U(R),I=0;I<C.length;I++){var w=C[I];if(N(w))return V(w)}},N=function e(R){return R&&"PRIV"===R.key&&"com.apple.streaming.transportStreamTimestamp"===R.info},B=function e(R){var C=String.fromCharCode(R[0],R[1],R[2],R[3]),I=F(R,4);return{"type":C,"size":I,"data":R.subarray(10,10+I)}},U=function e(R){for(var C=0,I=[];x(R,C);){for(var w=F(R,C+6),O=(C+=10)+w;C+8<O;){var P=B(R.subarray(C)),M=G(P);M&&I.push(M),C+=P.size+10}_(R,C)&&(C+=10)}return I},G=function e(R){return"PRIV"===R.type?j(R):"W"===R.type[0]?H(R):K(R)},j=function e(R){if(!(R.size<2)){var C=W(R.data,!0),I=new Uint8Array(R.data.subarray(C.length+1));return{"key":R.type,"info":C,"data":I.buffer}}},K=function e(R){if(!(R.size<2)){if("TXXX"===R.type){var C=1,I=W(R.data.subarray(C),!0);C+=I.length+1;var w=W(R.data.subarray(C));return{"key":R.type,"info":I,"data":w}}var x=W(R.data.subarray(1));return{"key":R.type,"data":x}}},H=function e(R){if("WXXX"===R.type){if(R.size<2)return;var C=1,I=W(R.data.subarray(C),!0);C+=I.length+1;var w=W(R.data.subarray(C));return{"key":R.type,"info":I,"data":w}}var x=W(R.data);return{"key":R.type,"data":x}},V=function e(R){if(8===R.data.byteLength){var C=new Uint8Array(R.data),I=1&C[3],w=(C[4]<<23)+(C[5]<<15)+(C[6]<<7)+C[7];return w/=45,I&&(w+=47721858.84),Math.round(w)}},W=function e(R,C){void 0===C&&(C=!1);var I=function T(){w||void 0===self.TextDecoder||(w=new self.TextDecoder("utf-8"));return w}();if(I){var x=I.decode(R);if(C){var _=Ce()(x).call(x,"\0");return-1!==_?x.substring(0,_):x}return x.replace(/\0/g,"")}for(var O,F,P,M=R.length,N="",B=0;B<M;){if(0===(O=R[B++])&&C)return N;if(0!==O&&3!==O)switch(O>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:N+=String.fromCharCode(O);break;case 12:case 13:F=R[B++],N+=String.fromCharCode((31&O)<<6|63&F);break;case 14:F=R[B++],P=R[B++],N+=String.fromCharCode((15&O)<<12|(63&F)<<6|(63&P)<<0)}}return N},Y={"decodeTextFrame":K}},"./src/demux/mp3demuxer.ts":function srcDemuxMp3demuxerTs(R,C,I){I.r(C);var w=I("./src/demux/base-audio-demuxer.ts"),x=I("./src/demux/id3.ts"),_=I("./src/utils/logger.ts"),O=I("./src/demux/mpegaudio.ts");function l(R,C){return l=Se()||function e(R,C){return R.__proto__=C,R},l(R,C)}var F=function(R){function t(){return R.apply(this,arguments)||this}!function o(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,l(R,C)}(t,R);var C=t.prototype;return C.resetInitSegment=function t(C,I,w){R.prototype.resetInitSegment.call(this,C,I,w),this._audioTrack={"container":"audio/mpeg","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"isAAC":!1,"samples":[],"manifestCodec":C,"duration":w,"inputTimeScale":9e4,"dropped":0}},t.probe=function e(R){if(!R)return!1;for(var C=(x.getID3Data(R,0)||[]).length,I=R.length;C<I;C++)if(O.probe(R,C))return _.logger.log("MPEG Audio sync word found !"),!0;return!1},C.canParse=function e(R,C){return O.canParse(R,C)},C.appendFrame=function e(R,C,I){if(null!==this.initPTS)return O.appendFrame(R,C,I,this.initPTS,this.frameIndex)},t}(w.default);F.minProbeByteLength=4,C.default=F},"./src/demux/mp4demuxer.ts":function srcDemuxMp4demuxerTs(R,C,I){I.r(C);var w=I("./src/utils/mp4-tools.ts"),x=I("./src/demux/dummy-demuxed-track.ts"),_=function(){function e(R,C){this.remainderData=null,this.config=void 0,this.config=C}var R=e.prototype;return R.resetTimeStamp=function e(){},R.resetInitSegment=function e(){},R.resetContiguity=function e(){},e.probe=function e(R){return Object(w.findBox)({"data":R,"start":0,"end":Math.min(R.length,16384)},["moof"]).length>0},R.demux=function e(R){var C=R,I=Object(x.dummyTrack)();if(this.config.progressive){this.remainderData&&(C=Object(w.appendUint8Array)(this.remainderData,R));var _=Object(w.segmentValidRange)(C);this.remainderData=_.remainder,I.samples=_.valid||new Uint8Array}else I.samples=C;return{"audioTrack":Object(x.dummyTrack)(),"avcTrack":I,"id3Track":Object(x.dummyTrack)(),"textTrack":Object(x.dummyTrack)()}},R.flush=function e(){var R=Object(x.dummyTrack)();return R.samples=this.remainderData||new Uint8Array,this.remainderData=null,{"audioTrack":Object(x.dummyTrack)(),"avcTrack":R,"id3Track":Object(x.dummyTrack)(),"textTrack":Object(x.dummyTrack)()}},R.demuxSampleAes=function e(R,C,I){return M().reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},R.destroy=function e(){},e}();_.minProbeByteLength=1024,C.default=_},"./src/demux/mpegaudio.ts":function srcDemuxMpegaudioTs(R,C,I){I.r(C),I.d(C,"appendFrame",(function(){return l})),I.d(C,"parseHeader",(function(){return u})),I.d(C,"isHeaderPattern",(function(){return f})),I.d(C,"isHeader",(function(){return c})),I.d(C,"canParse",(function(){return d})),I.d(C,"probe",(function(){return h}));var w=null,x=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],_=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],O=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],F=[0,1,1,4];function l(R,C,I,w,x){if(!(I+24>C.length)){var _=u(C,I);if(_&&I+_.frameLength<=C.length){var O=w+x*(9e4*_.samplesPerFrame/_.sampleRate),F={"unit":C.subarray(I,I+_.frameLength),"pts":O,"dts":O};return R.config=[],R.channelCount=_.channelCount,R.samplerate=_.sampleRate,R.samples.push(F),{"sample":F,"length":_.frameLength,"missing":0}}}}function u(R,C){var I=R[C+1]>>3&3,P=R[C+1]>>1&3,M=R[C+2]>>4&15,N=R[C+2]>>2&3;if(1!==I&&0!==M&&15!==M&&3!==N){var B=R[C+2]>>1&1,U=R[C+3]>>6,G=1e3*x[14*(3===I?3-P:3===P?3:4)+M-1],j=_[3*(3===I?0:2===I?1:2)+N],K=3===U?1:2,H=O[I][P],V=F[P],W=8*H*V,Y=Math.floor(H*G/j+B)*V;if(null===w){var z=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);w=z?Re()(z[1]):0}return!!w&&w<=87&&2===P&&G>=224e3&&0===U&&(R[C+3]=128|R[C+3]),{"sampleRate":j,"channelCount":K,"frameLength":Y,"samplesPerFrame":W}}}function f(R,C){return 255===R[C]&&224==(224&R[C+1])&&0!=(6&R[C+1])}function c(R,C){return C+1<R.length&&f(R,C)}function d(R,C){return f(R,C)&&4<=R.length-C}function h(R,C){if(C+1<R.length&&f(R,C)){var I=u(R,C),w=4;null!=I&&I.frameLength&&(w=I.frameLength);var x=C+w;return x===R.length||c(R,x)}return!1}},"./src/demux/sample-aes.ts":function srcDemuxSampleAesTs(R,C,I){I.r(C);var w=I("./src/crypt/decrypter.ts"),x=I("./src/demux/tsdemuxer.ts"),_=function(){function e(R,C,I){this.keyData=void 0,this.decrypter=void 0,this.keyData=I,this.decrypter=new w.default(R,C,{"removePKCS7Padding":!1})}var R=e.prototype;return R.decryptBuffer=function e(R,C){this.decrypter.decrypt(R,this.keyData.key.buffer,this.keyData.iv.buffer,C)},R.decryptAacSample=function e(R,C,I,w){var x,_=R[C].unit,O=_.subarray(16,_.length-_.length%16),F=K()(x=O.buffer).call(x,O.byteOffset,O.byteOffset+O.length),P=this;this.decryptBuffer(F,(function(x){var O=new Uint8Array(x);_.set(O,16),w||P.decryptAacSamples(R,C+1,I)}))},R.decryptAacSamples=function e(R,C,I){for(;;C++){if(C>=R.length)return void I();if(!(R[C].unit.length<32)){var w=this.decrypter.isSync();if(this.decryptAacSample(R,C,I,w),!w)return}}},R.getAvcEncryptedData=function e(R){for(var C=16*Math.floor((R.length-48)/160)+16,I=new Int8Array(C),w=0,x=32;x<R.length-16;x+=160,w+=16)I.set(R.subarray(x,x+16),w);return I},R.getAvcDecryptedUnit=function e(R,C){for(var I=new Uint8Array(C),w=0,x=32;x<R.length-16;x+=160,w+=16)R.set(I.subarray(w,w+16),x);return R},R.decryptAvcSample=function e(R,C,I,w,_,O){var F=Object(x.discardEPB)(_.data),P=this.getAvcEncryptedData(F),M=this;this.decryptBuffer(P.buffer,(function(x){_.data=M.getAvcDecryptedUnit(F,x),O||M.decryptAvcSamples(R,C,I+1,w)}))},R.decryptAvcSamples=function e(R,C,I,w){if(R instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;C++,I=0){if(C>=R.length)return void w();for(var x=R[C].units;!(I>=x.length);I++){var _=x[I];if(!(_.data.length<=48||1!==_.type&&5!==_.type)){var O=this.decrypter.isSync();if(this.decryptAvcSample(R,C,I,w,_,O),!O)return}}}},e}();C.default=_},"./src/demux/transmuxer-interface.ts":function srcDemuxTransmuxerInterfaceTs(R,C,I){I.r(C),I.d(C,"default",(function(){return B}));var w=I("./node_modules/webworkify-webpack/index.js"),x=I("./src/events.ts"),_=I("./src/demux/transmuxer.ts"),O=I("./src/utils/logger.ts"),F=I("./src/errors.ts"),P=I("./src/utils/mediasource-helper.ts"),M=I("./node_modules/eventemitter3/index.js"),N=Object(P.getMediaSource)()||{"isTypeSupported":function e(){return!1}},B=function(){function e(R,C,I,P){var B=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=R,this.id=C,this.onTransmuxComplete=I,this.onFlush=P;var U=R.config,G=function t(C,I){(I=I||{}).frag=B.frag,I.id=B.id,R.trigger(C,I)};this.observer=new M.EventEmitter,this.observer.on(x.Events.FRAG_DECRYPTED,G),this.observer.on(x.Events.ERROR,G);var j={"mp4":N.isTypeSupported("video/mp4"),"mpeg":N.isTypeSupported("audio/mpeg"),"mp3":N.isTypeSupported('audio/mp4; codecs="mp3"')},K=navigator.vendor;if(U.enableWorker&&"undefined"!=typeof Worker){var H;O.logger.log("demuxing in webworker");try{H=this.worker=w("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),H.addEventListener("message",this.onwmsg),H.onerror=function(C){R.trigger(x.Events.ERROR,{"type":F.ErrorTypes.OTHER_ERROR,"details":F.ErrorDetails.INTERNAL_EXCEPTION,"fatal":!0,"event":"demuxerWorker","error":new Error(C.message+"  ("+C.filename+":"+C.lineno+")")})},H.postMessage({"cmd":"init","typeSupported":j,"vendor":K,"id":C,"config":le()(U)})}catch(R){O.logger.warn("Error in worker:",R),O.logger.error("Error while initializing DemuxerWorker, fallback to inline"),H&&he().revokeObjectURL(H.objectURL),this.transmuxer=new _.default(this.observer,j,U,K,C),this.worker=null}}else this.transmuxer=new _.default(this.observer,j,U,K,C)}var R=e.prototype;return R.destroy=function e(){var R=this.worker;if(R)R.removeEventListener("message",this.onwmsg),R.terminate(),this.worker=null;else{var C=this.transmuxer;C&&(C.destroy(),this.transmuxer=null)}var I=this.observer;I&&I.removeAllListeners(),this.observer=null},R.push=function e(R,C,I,w,x,F,P,M,N,B){var U,G,j=this;N.transmuxing.start=self.performance.now();var K=this.transmuxer,H=this.worker,V=F?F.start:x.start,W=x.decryptdata,Y=this.frag,z=!(Y&&x.cc===Y.cc),X=!(Y&&N.level===Y.level),q=Y?N.sn-Y.sn:-1,Z=this.part?N.part-this.part.index:1,Q=!X&&(1===q||0===q&&1===Z),J=self.performance.now();(X||q||0===x.stats.parsing.start)&&(x.stats.parsing.start=J),!F||!Z&&Q||(F.stats.parsing.start=J);var $=!(Y&&(null===(U=x.initSegment)||void 0===U?void 0:U.url)===(null===(G=Y.initSegment)||void 0===G?void 0:G.url)),ee=new _.TransmuxState(z,Q,M,X,V,$);if(!Q||z||$){O.logger.log("[transmuxer-interface, "+x.type+"]: Starting new transmux session for sn: "+N.sn+" p: "+N.part+" level: "+N.level+" id: "+N.id+"\n        discontinuity: "+z+"\n        trackSwitch: "+X+"\n        contiguous: "+Q+"\n        accurateTimeOffset: "+M+"\n        timeOffset: "+V+"\n        initSegmentChange: "+$);var te=new _.TransmuxConfig(I,w,C,P,B);this.configureTransmuxer(te)}if(this.frag=x,this.part=F,H)H.postMessage({"cmd":"demux","data":R,"decryptdata":W,"chunkMeta":N,"state":ee},R instanceof ArrayBuffer?[R]:[]);else if(K){var re=K.push(R,W,N,ee);Object(_.isPromise)(re)?re.then((function(R){j.handleTransmuxComplete(R)})):this.handleTransmuxComplete(re)}},R.flush=function e(R){var C=this;R.transmuxing.start=self.performance.now();var I=this.transmuxer,w=this.worker;if(w)w.postMessage({"cmd":"flush","chunkMeta":R});else if(I){var x=I.flush(R);Object(_.isPromise)(x)?x.then((function(I){C.handleFlushResult(I,R)})):this.handleFlushResult(x,R)}},R.handleFlushResult=function e(R,C){var I=this;ne()(R).call(R,(function(R){I.handleTransmuxComplete(R)})),this.onFlush(C)},R.onWorkerMessage=function e(R){var C=R.data,I=this.hls;switch(C.event){case"init":he().revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(C.data);break;case"flush":this.onFlush(C.data);break;default:C.data=C.data||{},C.data.frag=this.frag,C.data.id=this.id,I.trigger(C.event,C.data)}},R.configureTransmuxer=function e(R){var C=this.worker,I=this.transmuxer;C?C.postMessage({"cmd":"configure","config":R}):I&&I.configure(R)},R.handleTransmuxComplete=function e(R){R.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(R)},e}()},"./src/demux/transmuxer-worker.ts":function srcDemuxTransmuxerWorkerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return o}));var w=I("./src/demux/transmuxer.ts"),x=I("./src/events.ts"),_=I("./src/utils/logger.ts"),O=I("./node_modules/eventemitter3/index.js");function o(R){var C=new O.EventEmitter,I=function t(C,I){R.postMessage({"event":C,"data":I})};C.on(x.Events.FRAG_DECRYPTED,I),C.on(x.Events.ERROR,I),R.addEventListener("message",(function(x){var O=x.data;switch(O.cmd){case"init":var F=JSON.parse(O.config);R.transmuxer=new w.default(C,O.typeSupported,F,O.vendor,O.id),Object(_.enableLogs)(F.debug),I("init",null);break;case"configure":R.transmuxer.configure(O.config);break;case"demux":var P=R.transmuxer.push(O.data,O.decryptdata,O.chunkMeta,O.state);Object(w.isPromise)(P)?P.then((function(C){l(R,C)})):l(R,P);break;case"flush":var M=O.chunkMeta,N=R.transmuxer.flush(M);Object(w.isPromise)(N)?N.then((function(C){f(R,C,M)})):f(R,N,M)}}))}function l(R,C){if(!function c(R){return!(R.audio||R.video||R.text||R.id3||R.initSegment)}(C.remuxResult)){var I=[],w=C.remuxResult,x=w.audio,_=w.video;x&&u(I,x),_&&u(I,_),R.postMessage({"event":"transmuxComplete","data":C},I)}}function u(R,C){C.data1&&R.push(C.data1.buffer),C.data2&&R.push(C.data2.buffer)}function f(R,C,I){ne()(C).call(C,(function(C){l(R,C)})),R.postMessage({"event":"flush","data":I})}},"./src/demux/transmuxer.ts":function srcDemuxTransmuxerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return W})),I.d(C,"isPromise",(function(){return b})),I.d(C,"TransmuxConfig",(function(){return z})),I.d(C,"TransmuxState",(function(){return X}));var w,x=I("./src/events.ts"),_=I("./src/errors.ts"),O=I("./src/crypt/decrypter.ts"),F=I("./src/demux/aacdemuxer.ts"),P=I("./src/demux/mp4demuxer.ts"),M=I("./src/demux/tsdemuxer.ts"),N=I("./src/demux/mp3demuxer.ts"),B=I("./src/remux/mp4-remuxer.ts"),U=I("./src/remux/passthrough-remuxer.ts"),G=I("./src/demux/chunk-cache.ts"),j=I("./src/utils/mp4-tools.ts"),K=I("./src/utils/logger.ts");try{w=self.performance.now.bind(self.performance)}catch(R){K.logger.debug("Unable to use Performance API on this environment"),w=self.Date.now}var H=[{"demux":M.default,"remux":B.default},{"demux":P.default,"remux":U.default},{"demux":F.default,"remux":B.default},{"demux":N.default,"remux":B.default}],V=1024;ne()(H).call(H,(function(R){var C=R.demux;V=Math.max(V,C.minProbeByteLength)}));var W=function(){function e(R,C,I,w,x){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new G.default,this.observer=R,this.typeSupported=C,this.config=I,this.vendor=w,this.id=x}var R=e.prototype;return R.configure=function e(R){this.transmuxConfig=R,this.decrypter&&this.decrypter.reset()},R.push=function e(R,C,I,x){var _=this,O=I.transmuxing;O.executeStart=w();var F=new Uint8Array(R),P=this.cache,M=this.config,N=this.currentTransmuxState,B=this.transmuxConfig;x&&(this.currentTransmuxState=x);var U=function E(R,C){var I=null;R.byteLength>0&&null!=C&&null!=C.key&&null!==C.iv&&null!=C.method&&(I=C);return I}(F,C);if(U&&"AES-128"===U.method){var G=this.getDecrypter();if(!M.enableSoftwareAES)return this.decryptionPromise=G.webCryptoDecrypt(F,U.key.buffer,U.iv.buffer).then((function(R){var C=_.push(R,null,I);return _.decryptionPromise=null,C})),this.decryptionPromise;var K=G.softwareDecrypt(F,U.key.buffer,U.iv.buffer);if(!K)return O.executeEnd=w(),Y(I);F=new Uint8Array(K)}var H=x||N,V=H.contiguous,W=H.discontinuity,z=H.trackSwitch,X=H.accurateTimeOffset,q=H.timeOffset,Z=H.initSegmentChange,Q=B.audioCodec,J=B.videoCodec,$=B.defaultInitPts,ee=B.duration,te=B.initSegmentData;if((W||z||Z)&&this.resetInitSegment(te,Q,J,ee),(W||Z)&&this.resetInitialTimestamp($),V||this.resetContiguity(),this.needsProbing(F,W,z)){if(P.dataLength){var re=P.flush();F=Object(j.appendUint8Array)(re,F)}this.configureTransmuxer(F,B)}var ie=this.transmux(F,U,q,X,I),ne=this.currentTransmuxState;return ne.contiguous=!0,ne.discontinuity=!1,ne.trackSwitch=!1,O.executeEnd=w(),ie},R.flush=function e(R){var C=this,I=R.transmuxing;I.executeStart=w();var O=this.decrypter,F=this.cache,P=this.currentTransmuxState,M=this.decryptionPromise;if(M)return M.then((function(){return C.flush(R)}));var N=[],B=P.timeOffset;if(O){var U=O.flush();U&&N.push(this.push(U,null,R))}var G=F.dataLength;F.reset();var j=this.demuxer,K=this.remuxer;if(!j||!K)return G>=V&&this.observer.emit(x.Events.ERROR,x.Events.ERROR,{"type":_.ErrorTypes.MEDIA_ERROR,"details":_.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!0,"reason":"no demux matching with content found"}),I.executeEnd=w(),[Y(R)];var H=j.flush(B);return b(H)?H.then((function(I){return C.flushRemux(N,I,R),N})):(this.flushRemux(N,H,R),N)},R.flushRemux=function e(R,C,I){var x=C.audioTrack,_=C.avcTrack,O=C.id3Track,F=C.textTrack,P=this.currentTransmuxState,M=P.accurateTimeOffset,N=P.timeOffset;K.logger.log("[transmuxer.ts]: Flushed fragment "+I.sn+(I.part>-1?" p: "+I.part:"")+" of level "+I.level);var B=this.remuxer.remux(x,_,O,F,N,M,!0,this.id);R.push({"remuxResult":B,"chunkMeta":I}),I.transmuxing.executeEnd=w()},R.resetInitialTimestamp=function e(R){var C=this.demuxer,I=this.remuxer;C&&I&&(C.resetTimeStamp(R),I.resetTimeStamp(R))},R.resetContiguity=function e(){var R=this.demuxer,C=this.remuxer;R&&C&&(R.resetContiguity(),C.resetNextTimestamp())},R.resetInitSegment=function e(R,C,I,w){var x=this.demuxer,_=this.remuxer;x&&_&&(x.resetInitSegment(C,I,w),_.resetInitSegment(R,C,I))},R.destroy=function e(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},R.transmux=function e(R,C,I,w,x){return C&&"SAMPLE-AES"===C.method?this.transmuxSampleAes(R,C,I,w,x):this.transmuxUnencrypted(R,I,w,x)},R.transmuxUnencrypted=function e(R,C,I,w){var x=this.demuxer.demux(R,C,!1,!this.config.progressive),_=x.audioTrack,O=x.avcTrack,F=x.id3Track,P=x.textTrack;return{"remuxResult":this.remuxer.remux(_,O,F,P,C,I,!1,this.id),"chunkMeta":w}},R.transmuxSampleAes=function e(R,C,I,w,x){var _=this;return this.demuxer.demuxSampleAes(R,C,I).then((function(R){return{"remuxResult":_.remuxer.remux(R.audioTrack,R.avcTrack,R.id3Track,R.textTrack,I,w,!1,_.id),"chunkMeta":x}}))},R.configureTransmuxer=function e(R,C){for(var I,w=this.config,x=this.observer,_=this.typeSupported,O=this.vendor,F=C.audioCodec,M=C.defaultInitPts,N=C.duration,B=C.initSegmentData,G=C.videoCodec,j=0,V=H.length;j<V;j++)if(H[j].demux.probe(R)){I=H[j];break}I||(K.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),I={"demux":P.default,"remux":U.default});var W=this.demuxer,Y=this.remuxer,z=I.remux,X=I.demux;Y&&Y instanceof z||(this.remuxer=new z(x,w,_,O)),W&&W instanceof X||(this.demuxer=new X(x,w,_),this.probe=X.probe),this.resetInitSegment(B,F,G,N),this.resetInitialTimestamp(M)},R.needsProbing=function e(R,C,I){return!this.demuxer||!this.remuxer||C||I},R.getDecrypter=function e(){var R=this.decrypter;return R||(R=this.decrypter=new O.default(this.observer,this.config)),R},e}();var Y=function e(R){return{"remuxResult":{},"chunkMeta":R}};function b(R){return"then"in R&&R.then instanceof Function}var z=function e(R,C,I,w,x){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=R,this.videoCodec=C,this.initSegmentData=I,this.duration=w,this.defaultInitPts=x},X=function e(R,C,I,w,x,_){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=R,this.contiguous=C,this.accurateTimeOffset=I,this.trackSwitch=w,this.timeOffset=x,this.initSegmentChange=_}},"./src/demux/tsdemuxer.ts":function srcDemuxTsdemuxerTs(R,C,I){I.r(C),I.d(C,"discardEPB",(function(){return T}));var w=I("./src/demux/adts.ts"),x=I("./src/demux/mpegaudio.ts"),_=I("./src/demux/exp-golomb.ts"),O=I("./src/demux/id3.ts"),F=I("./src/demux/sample-aes.ts"),P=I("./src/events.ts"),N=I("./src/utils/mp4-tools.ts"),B=I("./src/utils/logger.ts"),U=I("./src/errors.ts"),G={"video":1,"audio":2,"id3":3,"text":4},j=function(){function e(R,C,I){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=R,this.config=C,this.typeSupported=I}e.probe=function t(R){var C=e.syncOffset(R);return!(C<0)&&(C&&B.logger.warn("MPEG2-TS detected but first sync word found @ offset "+C+", junk ahead ?"),!0)},e.syncOffset=function e(R){for(var C=Math.min(1e3,R.length-564),I=0;I<C;){if(71===R[I]&&71===R[I+188]&&71===R[I+376])return I;I++}return-1},e.createTrack=function e(R,C){return{"container":"video"===R||"audio"===R?"video/mp2t":void 0,"type":R,"id":G[R],"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0,"duration":"audio"===R?C:void 0}};var R=e.prototype;return R.resetInitSegment=function t(R,C,I){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",I),this._audioTrack=e.createTrack("audio",I),this._id3Track=e.createTrack("id3",I),this._txtTrack=e.createTrack("text",I),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=R,this.videoCodec=C,this._duration=I},R.resetTimeStamp=function e(){},R.resetContiguity=function e(){var R=this._audioTrack,C=this._avcTrack,I=this._id3Track;R&&(R.pesData=null),C&&(C.pesData=null),I&&(I.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},R.demux=function t(R,C,I,w){var x;void 0===I&&(I=!1),void 0===w&&(w=!1),I||(this.sampleAes=null);var _=this._avcTrack,O=this._audioTrack,F=this._id3Track,M=_.pid,G=_.pesData,j=O.pid,K=F.pid,H=O.pesData,V=F.pesData,W=!1,Y=this.pmtParsed,z=this._pmtId,X=R.length;if(this.remainderData&&(X=(R=Object(N.appendUint8Array)(this.remainderData,R)).length,this.remainderData=null),X<188&&!w)return this.remainderData=R,{"audioTrack":O,"avcTrack":_,"id3Track":F,"textTrack":this._txtTrack};var q=Math.max(0,e.syncOffset(R));(X-=(X+q)%188)<R.byteLength&&!w&&(this.remainderData=new Uint8Array(R.buffer,X,R.buffer.byteLength-X));for(var Z=0,Q=q;Q<X;Q+=188)if(71===R[Q]){var J=!!(64&R[Q+1]),$=((31&R[Q+1])<<8)+R[Q+2],ee=void 0;if((48&R[Q+3])>>4>1){if((ee=Q+5+R[Q+4])===Q+188)continue}else ee=Q+4;switch($){case M:J&&(G&&(x=m(G))&&this.parseAVCPES(x,!1),G={"data":[],"size":0}),G&&(G.data.push(R.subarray(ee,Q+188)),G.size+=Q+188-ee);break;case j:J&&(H&&(x=m(H))&&(O.isAAC?this.parseAACPES(x):this.parseMPEGPES(x)),H={"data":[],"size":0}),H&&(H.data.push(R.subarray(ee,Q+188)),H.size+=Q+188-ee);break;case K:J&&(V&&(x=m(V))&&this.parseID3PES(x),V={"data":[],"size":0}),V&&(V.data.push(R.subarray(ee,Q+188)),V.size+=Q+188-ee);break;case 0:J&&(ee+=R[ee]+1),z=this._pmtId=g(R,ee);break;case z:J&&(ee+=R[ee]+1);var te=p(R,ee,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,I);(M=te.avc)>0&&(_.pid=M),(j=te.audio)>0&&(O.pid=j,O.isAAC=te.isAAC),(K=te.id3)>0&&(F.pid=K),W&&!Y&&(B.logger.log("reparse from beginning"),W=!1,Q=q-188),Y=this.pmtParsed=!0;break;case 17:case 8191:break;default:W=!0}}else Z++;Z>0&&this.observer.emit(P.Events.ERROR,P.Events.ERROR,{"type":U.ErrorTypes.MEDIA_ERROR,"details":U.ErrorDetails.FRAG_PARSING_ERROR,"fatal":!1,"reason":"Found "+Z+" TS packet/s that do not start with 0x47"}),_.pesData=G,O.pesData=H,F.pesData=V;var re={"audioTrack":O,"avcTrack":_,"id3Track":F,"textTrack":this._txtTrack};return w&&this.extractRemainingSamples(re),re},R.flush=function e(){var R,C=this.remainderData;return this.remainderData=null,R=C?this.demux(C,-1,!1,!0):{"audioTrack":this._audioTrack,"avcTrack":this._avcTrack,"textTrack":this._txtTrack,"id3Track":this._id3Track},this.extractRemainingSamples(R),this.sampleAes?this.decrypt(R,this.sampleAes):R},R.extractRemainingSamples=function e(R){var C,I=R.audioTrack,w=R.avcTrack,x=R.id3Track,_=w.pesData,O=I.pesData,F=x.pesData;_&&(C=m(_))?(this.parseAVCPES(C,!0),w.pesData=null):w.pesData=_,O&&(C=m(O))?(I.isAAC?this.parseAACPES(C):this.parseMPEGPES(C),I.pesData=null):(null!=O&&O.size&&B.logger.log("last AAC PES packet truncated,might overlap between fragments"),I.pesData=O),F&&(C=m(F))?(this.parseID3PES(C),x.pesData=null):x.pesData=F},R.demuxSampleAes=function e(R,C,I){var w=this.demux(R,I,!0,!this.config.progressive),x=this.sampleAes=new F.default(this.observer,this.config,C);return this.decrypt(w,x)},R.decrypt=function e(R,C){return new(M())((function(I){var w=R.audioTrack,x=R.avcTrack;w.samples&&w.isAAC?C.decryptAacSamples(w.samples,0,(function(){x.samples?C.decryptAvcSamples(x.samples,0,0,(function(){I(R)})):I(R)})):x.samples&&C.decryptAvcSamples(x.samples,0,0,(function(){I(R)}))}))},R.destroy=function e(){this._initPTS=this._initDTS=null,this._duration=0},R.parseAVCPES=function e(R,C){var I,w=this,x=this._avcTrack,F=this.parseAVCNALu(R.data),P=this.avcSample,M=!1;R.data=null,P&&F.length&&!x.audFound&&(y(P,x),P=this.avcSample=v(!1,R.pts,R.dts,"")),ne()(F).call(F,(function(C){switch(C.type){case 1:I=!0,P||(P=w.avcSample=v(!0,R.pts,R.dts,"")),P.frame=!0;var F=C.data;if(M&&F.length>4){var N=new _.default(F).readSliceType();2!==N&&4!==N&&7!==N&&9!==N||(P.key=!0)}break;case 5:I=!0,P||(P=w.avcSample=v(!0,R.pts,R.dts,"")),P.key=!0,P.frame=!0;break;case 6:I=!0;var B=new _.default(T(C.data));B.readUByte();for(var U=0,G=0,j=!1,K=0;!j&&B.bytesAvailable>1;){U=0;do{U+=K=B.readUByte()}while(255===K);G=0;do{G+=K=B.readUByte()}while(255===K);if(4===U&&0!==B.bytesAvailable){if(j=!0,181===B.readUByte())if(49===B.readUShort())if(1195456820===B.readUInt())if(3===B.readUByte()){for(var H=B.readUByte(),V=31&H,W=[H,B.readUByte()],Y=0;Y<V;Y++)W.push(B.readUByte()),W.push(B.readUByte()),W.push(B.readUByte());E(w._txtTrack.samples,{"type":3,"pts":R.pts,"bytes":W})}}else if(5===U&&0!==B.bytesAvailable){if(j=!0,G>16){for(var z=[],X=0;X<16;X++)z.push(B.readUByte().toString(16)),3!==X&&5!==X&&7!==X&&9!==X||z.push("-");for(var q=G-16,Z=new Uint8Array(q),Q=0;Q<q;Q++)Z[Q]=B.readUByte();E(w._txtTrack.samples,{"pts":R.pts,"payloadType":U,"uuid":z.join(""),"userData":Object(O.utf8ArrayToStr)(Z),"userDataBytes":Z})}}else if(G<B.bytesAvailable)for(var J=0;J<G;J++)B.readUByte()}break;case 7:if(I=!0,M=!0,!x.sps){var $=new _.default(C.data).readSPS();x.width=$.width,x.height=$.height,x.pixelRatio=$.pixelRatio,x.sps=[C.data],x.duration=w._duration;for(var ee=C.data.subarray(1,4),te="avc1.",re=0;re<3;re++){var ie=ee[re].toString(16);ie.length<2&&(ie="0"+ie),te+=ie}x.codec=te}break;case 8:I=!0,x.pps||(x.pps=[C.data]);break;case 9:I=!1,x.audFound=!0,P&&y(P,x),P=w.avcSample=v(!1,R.pts,R.dts,"");break;case 12:I=!1;break;default:I=!1,P&&(P.debug+="unknown NAL "+C.type+" ")}P&&I&&P.units.push(C)})),C&&P&&(y(P,x),this.avcSample=null)},R.getLastNalUnit=function e(){var R,C,I=this.avcSample;if(!I||0===I.units.length){var w=this._avcTrack.samples;I=w[w.length-1]}if(null!==(R=I)&&void 0!==R&&R.units){var x=I.units;C=x[x.length-1]}return C},R.parseAVCNALu=function e(R){var C,I,w=R.byteLength,x=this._avcTrack,_=x.naluState||0,O=_,F=[],P=0,M=-1,N=0;for(-1===_&&(M=0,N=31&R[0],_=0,P=1);P<w;)if(C=R[P++],_)if(1!==_)if(C)if(1===C){if(M>=0){var B={"data":R.subarray(M,P-_-1),"type":N};F.push(B)}else{var U=this.getLastNalUnit();if(U&&(O&&P<=4-O&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-O)),(I=P-_-1)>0)){var G=new Uint8Array(U.data.byteLength+I);G.set(U.data,0),G.set(R.subarray(0,I),U.data.byteLength),U.data=G,U.state=0}}P<w?(M=P,N=31&R[P],_=0):_=-1}else _=0;else _=3;else _=C?0:2;else _=C?0:1;if(M>=0&&_>=0){var j={"data":R.subarray(M,w),"type":N,"state":_};F.push(j)}if(0===F.length){var K=this.getLastNalUnit();if(K){var H=new Uint8Array(K.data.byteLength+R.byteLength);H.set(K.data,0),H.set(R,K.data.byteLength),K.data=H}}return x.naluState=_,F},R.parseAACPES=function e(R){var C,I,x,_,O,F=0,M=this._audioTrack,N=this.aacOverFlow,G=R.data;if(N){this.aacOverFlow=null;var j=N.sample.unit.byteLength,K=Math.min(N.missing,j),H=j-K;N.sample.unit.set(G.subarray(0,K),H),M.samples.push(N.sample),F=N.missing}for(C=F,I=G.length;C<I-1&&!w.isHeader(G,C);C++);if(C!==F&&(C<I-1?(x="AAC PES did not start with ADTS header,offset:"+C,_=!1):(x="no ADTS header found in AAC PES",_=!0),B.logger.warn("parsing error:"+x),this.observer.emit(P.Events.ERROR,P.Events.ERROR,{"type":U.ErrorTypes.MEDIA_ERROR,"details":U.ErrorDetails.FRAG_PARSING_ERROR,"fatal":_,"reason":x}),_))return;if(w.initTrackConfig(M,this.observer,G,C,this.audioCodec),void 0!==R.pts)O=R.pts;else{if(!N)return void B.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var V=w.getFrameDuration(M.samplerate);O=N.sample.pts+V}for(var W=0;C<I;){if(w.isHeader(G,C)){if(C+5<I){var Y=w.appendFrame(M,G,C,O,W);if(Y){if(!Y.missing){C+=Y.length,W++;continue}this.aacOverFlow=Y}}break}C++}},R.parseMPEGPES=function e(R){var C=R.data,I=C.length,w=0,_=0,O=R.pts;if(void 0!==O)for(;_<I;)if(x.isHeader(C,_)){var F=x.appendFrame(this._audioTrack,C,_,O,w);if(!F)break;_+=F.length,w++}else _++;else B.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},R.parseID3PES=function e(R){void 0!==R.pts?this._id3Track.samples.push(R):B.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function v(R,C,I,w){return{"key":R,"frame":!1,"pts":C,"dts":I,"units":[],"debug":w,"length":0}}function g(R,C){return(31&R[C+10])<<8|R[C+11]}function p(R,C,I,w){var x={"audio":-1,"avc":-1,"id3":-1,"isAAC":!0},_=C+3+((15&R[C+1])<<8|R[C+2])-4;for(C+=12+((15&R[C+10])<<8|R[C+11]);C<_;){var O=(31&R[C+1])<<8|R[C+2];switch(R[C]){case 207:if(!w){B.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===x.audio&&(x.audio=O);break;case 21:-1===x.id3&&(x.id3=O);break;case 219:if(!w){B.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===x.avc&&(x.avc=O);break;case 3:case 4:I?-1===x.audio&&(x.audio=O,x.isAAC=!1):B.logger.log("MPEG audio found, not supported in this browser");break;case 36:B.logger.warn("Unsupported HEVC stream type found")}C+=5+((15&R[C+3])<<8|R[C+4])}return x}function m(R){var C,I,w,x,_,O=0,F=R.data;if(!R||0===R.size)return null;for(;F[0].length<19&&F.length>1;){var P=new Uint8Array(F[0].length+F[1].length);P.set(F[0]),P.set(F[1],F[0].length),F[0]=P,Ke()(F).call(F,1,1)}if(1===((C=F[0])[0]<<16)+(C[1]<<8)+C[2]){if((I=(C[4]<<8)+C[5])&&I>R.size-6)return null;var M=C[7];192&M&&(x=536870912*(14&C[9])+4194304*(255&C[10])+16384*(254&C[11])+128*(255&C[12])+(254&C[13])/2,64&M?x-(_=536870912*(14&C[14])+4194304*(255&C[15])+16384*(254&C[16])+128*(255&C[17])+(254&C[18])/2)>54e5&&(B.logger.warn(Math.round((x-_)/9e4)+"s delta between PTS and DTS, align them"),x=_):_=x);var N=(w=C[8])+9;if(R.size<=N)return null;R.size-=N;for(var U=new Uint8Array(R.size),G=0,j=F.length;G<j;G++){var K=(C=F[G]).byteLength;if(N){if(N>K){N-=K;continue}C=C.subarray(N),K-=N,N=0}U.set(C,O),O+=K}return I&&(I-=w+3),{"data":U,"pts":x,"dts":_,"len":I}}return null}function y(R,C){if(R.units.length&&R.frame){if(void 0===R.pts){var I=C.samples,w=I.length;if(!w)return void C.dropped++;var x=I[w-1];R.pts=x.pts,R.dts=x.dts}C.samples.push(R)}R.debug.length&&B.logger.log(R.pts+"/"+R.dts+":"+R.debug)}function E(R,C){var I=R.length;if(I>0){if(C.pts>=R[I-1].pts)R.push(C);else for(var w=I-1;w>=0;w--)if(C.pts<R[w].pts){Ke()(R).call(R,w,0,C);break}}else R.push(C)}function T(R){for(var C=R.byteLength,I=[],w=1;w<C-2;)0===R[w]&&0===R[w+1]&&3===R[w+2]?(I.push(w+2),w+=2):w++;if(0===I.length)return R;var x=C-I.length,_=new Uint8Array(x),O=0;for(w=0;w<x;O++,w++)O===I[0]&&(O++,I.shift()),_[w]=R[O];return _}j.minProbeByteLength=188,C.default=j},"./src/errors.ts":function srcErrorsTs(R,C,I){var w,x;I.r(C),I.d(C,"ErrorTypes",(function(){return w})),I.d(C,"ErrorDetails",(function(){return x})),function(R){R.NETWORK_ERROR="networkError",R.MEDIA_ERROR="mediaError",R.KEY_SYSTEM_ERROR="keySystemError",R.MUX_ERROR="muxError",R.OTHER_ERROR="otherError"}(w||(w={})),function(R){R.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",R.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",R.KEY_SYSTEM_NO_SESSION="keySystemNoSession",R.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",R.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",R.MANIFEST_LOAD_ERROR="manifestLoadError",R.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",R.MANIFEST_PARSING_ERROR="manifestParsingError",R.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",R.LEVEL_EMPTY_ERROR="levelEmptyError",R.LEVEL_LOAD_ERROR="levelLoadError",R.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",R.LEVEL_SWITCH_ERROR="levelSwitchError",R.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",R.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",R.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",R.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",R.FRAG_LOAD_ERROR="fragLoadError",R.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",R.FRAG_DECRYPT_ERROR="fragDecryptError",R.FRAG_PARSING_ERROR="fragParsingError",R.REMUX_ALLOC_ERROR="remuxAllocError",R.KEY_LOAD_ERROR="keyLoadError",R.KEY_LOAD_TIMEOUT="keyLoadTimeOut",R.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",R.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",R.BUFFER_APPEND_ERROR="bufferAppendError",R.BUFFER_APPENDING_ERROR="bufferAppendingError",R.BUFFER_STALLED_ERROR="bufferStalledError",R.BUFFER_FULL_ERROR="bufferFullError",R.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",R.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",R.INTERNAL_EXCEPTION="internalException",R.INTERNAL_ABORTED="aborted",R.UNKNOWN="unknown"}(x||(x={}))},"./src/events.ts":function srcEventsTs(R,C,I){var w;I.r(C),I.d(C,"Events",(function(){return w})),function(R){R.MEDIA_ATTACHING="hlsMediaAttaching",R.MEDIA_ATTACHED="hlsMediaAttached",R.MEDIA_DETACHING="hlsMediaDetaching",R.MEDIA_DETACHED="hlsMediaDetached",R.BUFFER_RESET="hlsBufferReset",R.BUFFER_CODECS="hlsBufferCodecs",R.BUFFER_CREATED="hlsBufferCreated",R.BUFFER_APPENDING="hlsBufferAppending",R.BUFFER_APPENDED="hlsBufferAppended",R.BUFFER_EOS="hlsBufferEos",R.BUFFER_FLUSHING="hlsBufferFlushing",R.BUFFER_FLUSHED="hlsBufferFlushed",R.MANIFEST_LOADING="hlsManifestLoading",R.MANIFEST_LOADED="hlsManifestLoaded",R.MANIFEST_PARSED="hlsManifestParsed",R.LEVEL_SWITCHING="hlsLevelSwitching",R.LEVEL_SWITCHED="hlsLevelSwitched",R.LEVEL_LOADING="hlsLevelLoading",R.LEVEL_LOADED="hlsLevelLoaded",R.LEVEL_UPDATED="hlsLevelUpdated",R.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",R.LEVELS_UPDATED="hlsLevelsUpdated",R.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",R.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",R.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",R.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",R.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",R.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",R.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",R.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",R.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",R.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",R.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",R.CUES_PARSED="hlsCuesParsed",R.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",R.INIT_PTS_FOUND="hlsInitPtsFound",R.FRAG_LOADING="hlsFragLoading",R.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",R.FRAG_LOADED="hlsFragLoaded",R.FRAG_DECRYPTED="hlsFragDecrypted",R.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",R.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",R.FRAG_PARSING_METADATA="hlsFragParsingMetadata",R.FRAG_PARSED="hlsFragParsed",R.FRAG_BUFFERED="hlsFragBuffered",R.FRAG_CHANGED="hlsFragChanged",R.FPS_DROP="hlsFpsDrop",R.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",R.ERROR="hlsError",R.DESTROYING="hlsDestroying",R.KEY_LOADING="hlsKeyLoading",R.KEY_LOADED="hlsKeyLoaded",R.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",R.BACK_BUFFER_REACHED="hlsBackBufferReached"}(w||(w={}))},"./src/hls.ts":function srcHlsTs(R,C,I){I.r(C),I.d(C,"default",(function(){return W}));var w=I("./node_modules/url-toolkit/src/url-toolkit.js"),x=I("./src/loader/playlist-loader.ts"),_=I("./src/loader/key-loader.ts"),O=I("./src/controller/id3-track-controller.ts"),F=I("./src/controller/latency-controller.ts"),P=I("./src/controller/level-controller.ts"),M=I("./src/controller/fragment-tracker.ts"),N=I("./src/controller/stream-controller.ts"),U=I("./src/is-supported.ts"),G=I("./src/utils/logger.ts"),j=I("./src/config.ts"),K=I("./node_modules/eventemitter3/index.js"),H=I("./src/events.ts"),V=I("./src/errors.ts");function m(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var W=function(){function e(R){void 0===R&&(R={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new K.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var C=this.config=Object(j.mergeConfig)(e.DefaultConfig,R);this.userConfig=R,Object(G.enableLogs)(C.debug),this._autoLevelCapping=-1,C.progressive&&Object(j.enableStreamingMode)(C);var I=C.abrController,w=C.bufferController,B=C.capLevelController,U=C.fpsController,H=this.abrController=new I(this),V=this.bufferController=new w(this),W=this.capLevelController=new B(this),Y=new U(this),z=new x.default(this),X=new _.default(this),q=new O.default(this),Z=this.levelController=new P.default(this),Q=new M.FragmentTracker(this),J=this.streamController=new N.default(this,Q);W.setStreamController(J),Y.setStreamController(J);var $=[Z,J];this.networkControllers=$;var ee=[z,X,H,V,W,Y,q,Q];this.audioTrackController=this.createController(C.audioTrackController,null,$),this.createController(C.audioStreamController,Q,$),this.subtitleTrackController=this.createController(C.subtitleTrackController,null,$),this.createController(C.subtitleStreamController,Q,$),this.createController(C.timelineController,null,ee),this.emeController=this.createController(C.emeController,null,ee),this.cmcdController=this.createController(C.cmcdController,null,ee),this.latencyController=this.createController(F.default,null,ee),this.coreComponents=ee}e.isSupported=function e(){return Object(U.isSupported)()};var R=e.prototype;return R.createController=function e(R,C,I){if(R){var w=C?new R(this,C):new R(this);return I&&I.push(w),w}return null},R.on=function e(R,C,I){void 0===I&&(I=this),this._emitter.on(R,C,I)},R.once=function e(R,C,I){void 0===I&&(I=this),this._emitter.once(R,C,I)},R.removeAllListeners=function e(R){this._emitter.removeAllListeners(R)},R.off=function e(R,C,I,w){void 0===I&&(I=this),this._emitter.off(R,C,I,w)},R.listeners=function e(R){return this._emitter.listeners(R)},R.emit=function e(R,C,I){return this._emitter.emit(R,C,I)},R.trigger=function e(R,C){if(this.config.debug)return this.emit(R,R,C);try{return this.emit(R,R,C)}catch(e){G.logger.error("An internal error happened while handling event "+R+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(H.Events.ERROR,{"type":V.ErrorTypes.OTHER_ERROR,"details":V.ErrorDetails.INTERNAL_EXCEPTION,"fatal":!1,"event":R,"error":e})}return!1},R.listenerCount=function e(R){return this._emitter.listenerCount(R)},R.destroy=function e(){var R,C;G.logger.log("destroy"),this.trigger(H.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,ne()(R=this.networkControllers).call(R,(function(R){return R.destroy()})),this.networkControllers.length=0,ne()(C=this.coreComponents).call(C,(function(R){return R.destroy()})),this.coreComponents.length=0},R.attachMedia=function e(R){G.logger.log("attachMedia"),this._media=R,this.trigger(H.Events.MEDIA_ATTACHING,{"media":R})},R.detachMedia=function e(){G.logger.log("detachMedia"),this.trigger(H.Events.MEDIA_DETACHING,void 0),this._media=null},R.loadSource=function e(R){this.stopLoad();var C=this.media,I=this.url,x=this.url=w.buildAbsoluteURL(self.location.href,R,{"alwaysNormalize":!0});G.logger.log("loadSource:"+x),C&&I&&I!==x&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(C)),this.trigger(H.Events.MANIFEST_LOADING,{"url":R})},R.startLoad=function e(R){var C;void 0===R&&(R=-1),G.logger.log("startLoad("+R+")"),ne()(C=this.networkControllers).call(C,(function(C){C.startLoad(R)}))},R.stopLoad=function e(){var R;G.logger.log("stopLoad"),ne()(R=this.networkControllers).call(R,(function(R){R.stopLoad()}))},R.swapAudioCodec=function e(){G.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},R.recoverMediaError=function e(){G.logger.log("recoverMediaError");var R=this._media;this.detachMedia(),R&&this.attachMedia(R)},R.removeLevel=function e(R,C){void 0===C&&(C=0),this.levelController.removeLevel(R,C)},function y(R,C,I){return C&&m(R.prototype,C),I&&m(R,I),R}(e,[{"key":"levels","get":function e(){var R=this.levelController.levels;return R||[]}},{"key":"currentLevel","get":function e(){return this.streamController.currentLevel},"set":function e(R){G.logger.log("set currentLevel:"+R),this.loadLevel=R,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{"key":"nextLevel","get":function e(){return this.streamController.nextLevel},"set":function e(R){G.logger.log("set nextLevel:"+R),this.levelController.manualLevel=R,this.streamController.nextLevelSwitch()}},{"key":"loadLevel","get":function e(){return this.levelController.level},"set":function e(R){G.logger.log("set loadLevel:"+R),this.levelController.manualLevel=R}},{"key":"nextLoadLevel","get":function e(){return this.levelController.nextLoadLevel},"set":function e(R){this.levelController.nextLoadLevel=R}},{"key":"firstLevel","get":function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},"set":function e(R){G.logger.log("set firstLevel:"+R),this.levelController.firstLevel=R}},{"key":"startLevel","get":function e(){return this.levelController.startLevel},"set":function e(R){G.logger.log("set startLevel:"+R),-1!==R&&(R=Math.max(R,this.minAutoLevel)),this.levelController.startLevel=R}},{"key":"capLevelToPlayerSize","get":function e(){return this.config.capLevelToPlayerSize},"set":function e(R){var C=!!R;C!==this.config.capLevelToPlayerSize&&(C?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=C)}},{"key":"autoLevelCapping","get":function e(){return this._autoLevelCapping},"set":function e(R){this._autoLevelCapping!==R&&(G.logger.log("set autoLevelCapping:"+R),this._autoLevelCapping=R)}},{"key":"bandwidthEstimate","get":function e(){var R=this.abrController.bwEstimator;return R?R.getEstimate():NaN}},{"key":"autoLevelEnabled","get":function e(){return-1===this.levelController.manualLevel}},{"key":"manualLevel","get":function e(){return this.levelController.manualLevel}},{"key":"minAutoLevel","get":function e(){var R=this.levels,C=this.config.minAutoBitrate;if(!R)return 0;for(var I=R.length,w=0;w<I;w++)if(R[w].maxBitrate>C)return w;return 0}},{"key":"maxAutoLevel","get":function e(){var R=this.levels,C=this.autoLevelCapping;return-1===C&&R&&R.length?R.length-1:C}},{"key":"nextAutoLevel","get":function e(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},"set":function e(R){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,R)}},{"key":"audioTracks","get":function e(){var R=this.audioTrackController;return R?R.audioTracks:[]}},{"key":"audioTrack","get":function e(){var R=this.audioTrackController;return R?R.audioTrack:-1},"set":function e(R){var C=this.audioTrackController;C&&(C.audioTrack=R)}},{"key":"subtitleTracks","get":function e(){var R=this.subtitleTrackController;return R?R.subtitleTracks:[]}},{"key":"subtitleTrack","get":function e(){var R=this.subtitleTrackController;return R?R.subtitleTrack:-1},"set":function e(R){var C=this.subtitleTrackController;C&&(C.subtitleTrack=R)}},{"key":"media","get":function e(){return this._media}},{"key":"subtitleDisplay","get":function e(){var R=this.subtitleTrackController;return!!R&&R.subtitleDisplay},"set":function e(R){var C=this.subtitleTrackController;C&&(C.subtitleDisplay=R)}},{"key":"lowLatencyMode","get":function e(){return this.config.lowLatencyMode},"set":function e(R){this.config.lowLatencyMode=R}},{"key":"liveSyncPosition","get":function e(){return this.latencyController.liveSyncPosition}},{"key":"latency","get":function e(){return this.latencyController.latency}},{"key":"maxLatency","get":function e(){return this.latencyController.maxLatency}},{"key":"targetLatency","get":function e(){return this.latencyController.targetLatency}},{"key":"drift","get":function e(){return this.latencyController.drift}},{"key":"forceStartLoad","get":function e(){return this.streamController.forceStartLoad}}],[{"key":"version","get":function e(){return"1.1.5"}},{"key":"Events","get":function e(){return H.Events}},{"key":"ErrorTypes","get":function e(){return V.ErrorTypes}},{"key":"ErrorDetails","get":function e(){return V.ErrorDetails}},{"key":"DefaultConfig","get":function t(){return e.defaultConfig?e.defaultConfig:j.hlsDefaultConfig},"set":function t(R){e.defaultConfig=R}}]),e}();W.defaultConfig=void 0},"./src/is-supported.ts":function srcIsSupportedTs(R,C,I){I.r(C),I.d(C,"isSupported",(function(){return n})),I.d(C,"changeTypeSupported",(function(){return s}));var w=I("./src/utils/mediasource-helper.ts");function a(){return self.SourceBuffer||self.WebKitSourceBuffer}function n(){var R=Object(w.getMediaSource)();if(!R)return!1;var C=a(),I=R&&"function"==typeof R.isTypeSupported&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),x=!C||C.prototype&&"function"==typeof C.prototype.appendBuffer&&"function"==typeof C.prototype.remove;return!!I&&!!x}function s(){var R,C=a();return"function"==typeof(null==C||null===(R=C.prototype)||void 0===R?void 0:R.changeType)}},"./src/loader/fragment-loader.ts":function srcLoaderFragmentLoaderTs(R,C,I){I.r(C),I.d(C,"default",(function(){return O})),I.d(C,"LoadError",(function(){return F}));var w=I("./src/polyfills/number.ts"),x=I("./src/errors.ts");function s(R){var C="function"==typeof Ve()?new(Ve()):void 0;return s=function e(R){if(null===R||!function u(R){var C;return-1!==Ce()(C=Function.toString.call(R)).call(C,"[native code]")}(R))return R;if("function"!=typeof R)throw new TypeError("Super expression must either be null or a function");if(void 0!==C){if(C.has(R))return C.get(R);C.set(R,i)}function i(){return o(R,arguments,c(this).constructor)}return i.prototype=Object.create(R.prototype,{"constructor":{"value":i,"enumerable":!1,"writable":!0,"configurable":!0}}),f(i,R)},s(R)}function o(R,C,I){return o=l()?Ye():function e(R,C,I){var w=[null];w.push.apply(w,C);var x=new(Function.bind.apply(R,w));return I&&f(x,I.prototype),x},o.apply(null,arguments)}function l(){if("undefined"==typeof Reflect||!Ye())return!1;if(Ye().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Ye()(Boolean,[],(function(){}))),!0}catch(R){return!1}}function f(R,C){return f=Se()||function e(R,C){return R.__proto__=C,R},f(R,C)}function c(R){return c=Se()?Xe():function e(R){return R.__proto__||Xe()(R)},c(R)}var _=Math.pow(2,17),O=function(){function e(R){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=R}var R=e.prototype;return R.destroy=function e(){this.loader&&(this.loader.destroy(),this.loader=null)},R.abort=function e(){this.loader&&this.loader.abort()},R.load=function e(R,C){var I=this,w=R.url;if(!w)return M().reject(new F({"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"networkDetails":null},"Fragment does not have a "+(w?"part list":"url")));this.abort();var O=this.config,P=O.fLoader,N=O.loader;return new(M())((function(w,M){I.loader&&I.loader.destroy();var B=I.loader=R.loader=P?new P(O):new N(O),U=v(R),G={"timeout":O.fragLoadingTimeOut,"maxRetry":0,"retryDelay":0,"maxRetryDelay":O.fragLoadingMaxRetryTimeout,"highWaterMark":_};R.stats=B.stats,B.load(U,G,{"onSuccess":function r(C,x,_,O){I.resetLoader(R,B),w({"frag":R,"part":null,"payload":C.data,"networkDetails":O})},"onError":function e(C,w,_){I.resetLoader(R,B),M(new F({"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"response":C,"networkDetails":_}))},"onAbort":function e(C,w,_){I.resetLoader(R,B),M(new F({"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.INTERNAL_ABORTED,"fatal":!1,"frag":R,"networkDetails":_}))},"onTimeout":function e(C,w,_){I.resetLoader(R,B),M(new F({"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":R,"networkDetails":_}))},"onProgress":function e(I,w,x,_){C&&C({"frag":R,"part":null,"payload":x,"networkDetails":_})}})}))},R.loadPart=function e(R,C,I){var w=this;this.abort();var O=this.config,P=O.fLoader,N=O.loader;return new(M())((function(M,B){w.loader&&w.loader.destroy();var U=w.loader=R.loader=P?new P(O):new N(O),G=v(R,C),j={"timeout":O.fragLoadingTimeOut,"maxRetry":0,"retryDelay":0,"maxRetryDelay":O.fragLoadingMaxRetryTimeout,"highWaterMark":_};C.stats=U.stats,U.load(G,j,{"onSuccess":function a(x,_,O,F){w.resetLoader(R,U),w.updateStatsFromPart(R,C);var P={"frag":R,"part":C,"payload":x.data,"networkDetails":F};I(P),M(P)},"onError":function e(I,_,O){w.resetLoader(R,U),B(new F({"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.FRAG_LOAD_ERROR,"fatal":!1,"frag":R,"part":C,"response":I,"networkDetails":O}))},"onAbort":function e(I,_,O){R.stats.aborted=C.stats.aborted,w.resetLoader(R,U),B(new F({"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.INTERNAL_ABORTED,"fatal":!1,"frag":R,"part":C,"networkDetails":O}))},"onTimeout":function e(I,_,O){w.resetLoader(R,U),B(new F({"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":R,"part":C,"networkDetails":O}))}})}))},R.updateStatsFromPart=function e(R,C){var I=R.stats,w=C.stats,x=w.total;if(I.loaded+=w.loaded,x){var _=Math.round(R.duration/C.duration),O=Math.min(Math.round(I.loaded/x),_),F=(_-O)*Math.round(I.loaded/O);I.total=I.loaded+F}else I.total=Math.max(I.loaded,I.total);var P=I.loading,M=w.loading;P.start?P.first+=M.first-M.start:(P.start=M.start,P.first=M.first),P.end=M.end},R.resetLoader=function e(R,C){R.loader=null,this.loader===C&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),C.destroy()},e}();function v(R,C){void 0===C&&(C=null);var I=C||R,x={"frag":R,"part":C,"responseType":"arraybuffer","url":I.url,"headers":{},"rangeStart":0,"rangeEnd":0},_=I.byteRangeStartOffset,O=I.byteRangeEndOffset;return Object(w.isFiniteNumber)(_)&&Object(w.isFiniteNumber)(O)&&(x.rangeStart=_,x.rangeEnd=O),x}var F=function(R){function t(C){for(var I,w,x=arguments.length,_=new Array(x>1?x-1:0),O=1;O<x;O++)_[O-1]=arguments[O];return(w=R.call.apply(R,Y()(I=[this]).call(I,_))||this).data=void 0,w.data=C,w}return function n(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,f(R,C)}(t,R),t}(s(Error))},"./src/loader/fragment.ts":function srcLoaderFragmentTs(R,C,I){I.r(C),I.d(C,"ElementaryStreamTypes",(function(){return w})),I.d(C,"BaseSegment",(function(){return M})),I.d(C,"Fragment",(function(){return N})),I.d(C,"Part",(function(){return U}));var w,x=I("./src/polyfills/number.ts"),_=I("./node_modules/url-toolkit/src/url-toolkit.js"),O=I("./src/utils/logger.ts"),F=I("./src/loader/level-key.ts"),P=I("./src/loader/load-stats.ts");function l(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,u(R,C)}function u(R,C){return u=Se()||function e(R,C){return R.__proto__=C,R},u(R,C)}function f(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}function c(R,C,I){return C&&f(R.prototype,C),I&&f(R,I),R}!function(R){R.AUDIO="audio",R.VIDEO="video",R.AUDIOVIDEO="audiovideo"}(w||(w={}));var M=function(){function e(R){var C;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((C={})[w.AUDIO]=null,C[w.VIDEO]=null,C[w.AUDIOVIDEO]=null,C),this.baseurl=R}return e.prototype.setByteRange=function e(R,C){var I=R.split("@",2),w=[];1===I.length?w[0]=C?C.byteRangeEndOffset:0:w[0]=Re()(I[1]),w[1]=Re()(I[0])+w[0],this._byteRange=w},c(e,[{"key":"byteRange","get":function e(){return this._byteRange?this._byteRange:[]}},{"key":"byteRangeStartOffset","get":function e(){return this.byteRange[0]}},{"key":"byteRangeEndOffset","get":function e(){return this.byteRange[1]}},{"key":"url","get":function e(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(_.buildAbsoluteURL)(this.baseurl,this.relurl,{"alwaysNormalize":!0})),this._url||""},"set":function e(R){this._url=R}}]),e}(),N=function(R){function t(C,I){var w;return(w=R.call(this,I)||this)._decryptdata=null,w.rawProgramDateTime=null,w.programDateTime=null,w.tagList=[],w.duration=0,w.sn=0,w.levelkey=void 0,w.type=void 0,w.loader=null,w.level=-1,w.cc=0,w.startPTS=void 0,w.endPTS=void 0,w.appendedPTS=void 0,w.startDTS=void 0,w.endDTS=void 0,w.start=0,w.deltaPTS=void 0,w.maxStartPTS=void 0,w.minEndPTS=void 0,w.stats=new P.LoadStats,w.urlId=0,w.data=void 0,w.bitrateTest=!1,w.title=null,w.initSegment=null,w.type=C,w}l(t,R);var C=t.prototype;return C.createInitializationVector=function e(R){for(var C=new Uint8Array(16),I=12;I<16;I++)C[I]=R>>8*(15-I)&255;return C},C.setDecryptDataFromLevelKey=function e(R,C){var I=R;return"AES-128"===(null==R?void 0:R.method)&&R.uri&&!R.iv&&((I=F.LevelKey.fromURI(R.uri)).method=R.method,I.iv=this.createInitializationVector(C),I.keyFormat="identity"),I},C.setElementaryStreamInfo=function e(R,C,I,w,x,_){void 0===_&&(_=!1);var O=this.elementaryStreams,F=O[R];F?(F.startPTS=Math.min(F.startPTS,C),F.endPTS=Math.max(F.endPTS,I),F.startDTS=Math.min(F.startDTS,w),F.endDTS=Math.max(F.endDTS,x)):O[R]={"startPTS":C,"endPTS":I,"startDTS":w,"endDTS":x,"partial":_}},C.clearElementaryStreamInfo=function e(){var R=this.elementaryStreams;R[w.AUDIO]=null,R[w.VIDEO]=null,R[w.AUDIOVIDEO]=null},c(t,[{"key":"decryptdata","get":function e(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var R=this.sn;"number"!=typeof R&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&O.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),R=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,R)}return this._decryptdata}},{"key":"end","get":function e(){return this.start+this.duration}},{"key":"endProgramDateTime","get":function e(){if(null===this.programDateTime)return null;if(!Object(x.isFiniteNumber)(this.programDateTime))return null;var R=Object(x.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*R}},{"key":"encrypted","get":function e(){var R;return!(null===(R=this.decryptdata)||void 0===R||!R.keyFormat||!this.decryptdata.uri)}}]),t}(M),U=function(R){function t(C,I,w,x,_){var O;(O=R.call(this,w)||this).fragOffset=0,O.duration=0,O.gap=!1,O.independent=!1,O.relurl=void 0,O.fragment=void 0,O.index=void 0,O.stats=new P.LoadStats,O.duration=C.decimalFloatingPoint("DURATION"),O.gap=C.bool("GAP"),O.independent=C.bool("INDEPENDENT"),O.relurl=C.enumeratedString("URI"),O.fragment=I,O.index=x;var F=C.enumeratedString("BYTERANGE");return F&&O.setByteRange(F,_),_&&(O.fragOffset=_.fragOffset+_.duration),O}return l(t,R),c(t,[{"key":"start","get":function e(){return this.fragment.start+this.fragOffset}},{"key":"end","get":function e(){return this.start+this.duration}},{"key":"loaded","get":function e(){var R=this.elementaryStreams;return!!(R.audio||R.video||R.audiovideo)}}]),t}(M)},"./src/loader/key-loader.ts":function srcLoaderKeyLoaderTs(R,C,I){I.r(C),I.d(C,"default",(function(){return O}));var w=I("./src/events.ts"),x=I("./src/errors.ts"),_=I("./src/utils/logger.ts"),O=function(){function e(R){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=R,this._registerListeners()}var R=e.prototype;return R._registerListeners=function e(){this.hls.on(w.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function e(){this.hls.off(w.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function e(){for(var R in this._unregisterListeners(),this.loaders){var C=this.loaders[R];C&&C.destroy()}this.loaders={}},R.onKeyLoading=function e(R,C){var I=C.frag,x=I.type,O=this.loaders[x];if(I.decryptdata){var F=I.decryptdata.uri;if(F!==this.decrypturl||null===this.decryptkey){var P=this.hls.config;if(O&&(_.logger.warn("abort previous key loader for type:"+x),O.abort()),!F)return void _.logger.warn("key uri is falsy");var M=P.loader,N=I.loader=this.loaders[x]=new M(P);this.decrypturl=F,this.decryptkey=null;var B={"url":F,"frag":I,"responseType":"arraybuffer"},U={"timeout":P.fragLoadingTimeOut,"maxRetry":0,"retryDelay":P.fragLoadingRetryDelay,"maxRetryDelay":P.fragLoadingMaxRetryTimeout,"highWaterMark":0},G={"onSuccess":this.loadsuccess.bind(this),"onError":this.loaderror.bind(this),"onTimeout":this.loadtimeout.bind(this)};N.load(B,U,G)}else this.decryptkey&&(I.decryptdata.key=this.decryptkey,this.hls.trigger(w.Events.KEY_LOADED,{"frag":I}))}else _.logger.warn("Missing decryption data on fragment in onKeyLoading")},R.loadsuccess=function e(R,C,I){var x=I.frag;x.decryptdata?(this.decryptkey=x.decryptdata.key=new Uint8Array(R.data),x.loader=null,delete this.loaders[x.type],this.hls.trigger(w.Events.KEY_LOADED,{"frag":x})):_.logger.error("after key load, decryptdata unset")},R.loaderror=function e(R,C){var I=C.frag,_=I.loader;_&&_.abort(),delete this.loaders[I.type],this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.KEY_LOAD_ERROR,"fatal":!1,"frag":I,"response":R})},R.loadtimeout=function e(R,C){var I=C.frag,_=I.loader;_&&_.abort(),delete this.loaders[I.type],this.hls.trigger(w.Events.ERROR,{"type":x.ErrorTypes.NETWORK_ERROR,"details":x.ErrorDetails.KEY_LOAD_TIMEOUT,"fatal":!1,"frag":I})},e}()},"./src/loader/level-details.ts":function srcLoaderLevelDetailsTs(R,C,I){I.r(C),I.d(C,"LevelDetails",(function(){return x}));var w=I("./src/polyfills/number.ts");function a(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var x=function(){function e(R){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=R}return e.prototype.reloaded=function e(R){if(!R)return this.advanced=!0,void(this.updated=!0);var C=this.lastPartSn-R.lastPartSn,I=this.lastPartIndex-R.lastPartIndex;this.updated=this.endSN!==R.endSN||!!I||!!C,this.advanced=this.endSN>R.endSN||C>0||0===C&&I>0,this.updated||this.advanced?this.misses=Math.floor(.6*R.misses):this.misses=R.misses+1,this.availabilityDelay=R.availabilityDelay},function n(R,C,I){return C&&a(R.prototype,C),I&&a(R,I),R}(e,[{"key":"hasProgramDateTime","get":function e(){return!!this.fragments.length&&Object(w.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{"key":"levelTargetDuration","get":function e(){return this.averagetargetduration||this.targetduration||10}},{"key":"drift","get":function e(){var R=this.driftEndTime-this.driftStartTime;return R>0?1e3*(this.driftEnd-this.driftStart)/R:1}},{"key":"edge","get":function e(){return this.partEnd||this.fragmentEnd}},{"key":"partEnd","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{"key":"fragmentEnd","get":function e(){var R;return null!==(R=this.fragments)&&void 0!==R&&R.length?this.fragments[this.fragments.length-1].end:0}},{"key":"age","get":function e(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{"key":"lastPartIndex","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].index:-1}},{"key":"lastPartSn","get":function e(){var R;return null!==(R=this.partList)&&void 0!==R&&R.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}()},"./src/loader/level-key.ts":function srcLoaderLevelKeyTs(R,C,I){I.r(C),I.d(C,"LevelKey",(function(){return x}));var w=I("./node_modules/url-toolkit/src/url-toolkit.js");function a(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var x=function(){function e(R,C){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=C?Object(w.buildAbsoluteURL)(R,C,{"alwaysNormalize":!0}):R}return e.fromURL=function t(R,C){return new e(R,C)},e.fromURI=function t(R){return new e(R)},function n(R,C,I){return C&&a(R.prototype,C),I&&a(R,I),R}(e,[{"key":"uri","get":function e(){return this._uri}}]),e}()},"./src/loader/load-stats.ts":function srcLoaderLoadStatsTs(R,C,I){I.r(C),I.d(C,"LoadStats",(function(){return w}));var w=function e(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={"start":0,"first":0,"end":0},this.parsing={"start":0,"end":0},this.buffering={"start":0,"first":0,"end":0}}},"./src/loader/m3u8-parser.ts":function srcLoaderM3u8ParserTs(R,C,I){I.r(C),I.d(C,"default",(function(){return V}));var w=I("./src/polyfills/number.ts"),x=I("./node_modules/url-toolkit/src/url-toolkit.js"),_=I("./src/loader/fragment.ts"),O=I("./src/loader/level-details.ts"),F=I("./src/loader/level-key.ts"),P=I("./src/utils/attr-list.ts"),M=I("./src/utils/logger.ts"),N=I("./src/utils/codecs.ts"),B=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,U=/#EXT-X-MEDIA:(.*)/g,G=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),j=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),H=/\.(mp4|m4s|m4v|m4a)$/i;function p(R){var C,I;return H.test(null!=(C=null===(I=x.parseURL(R))||void 0===I?void 0:I.path)?C:"")}var V=function(){function e(){}return e.findGroup=function e(R,C){for(var I=0;I<R.length;I++){var w=R[I];if(w.id===C)return w}},e.convertAVC1ToAVCOTI=function e(R){var C=R.split(".");if(C.length>2){var I=C.shift()+".";return I+=Re()(C.shift()).toString(16),I+=("000"+Re()(C.shift()).toString(16)).substr(-4)}return R},e.resolve=function e(R,C){return x.buildAbsoluteURL(C,R,{"alwaysNormalize":!0})},e.parseMasterPlaylist=function t(R,C){var I,w=[],x={},_=!1;for(B.lastIndex=0;null!=(I=B.exec(R));)if(I[1]){var O,F,M=new P.AttrList(I[1]),N={"attrs":M,"bitrate":M.decimalInteger("AVERAGE-BANDWIDTH")||M.decimalInteger("BANDWIDTH"),"name":M.NAME,"url":e.resolve(I[2],C)},U=M.decimalResolution("RESOLUTION");U&&(N.width=U.width,N.height=U.height),y(se()(O=(M.CODECS||"").split(/[ ,]+/)).call(O,(function(R){return R})),N),N.videoCodec&&-1!==Ce()(F=N.videoCodec).call(F,"avc1")&&(N.videoCodec=e.convertAVC1ToAVCOTI(N.videoCodec)),w.push(N)}else if(I[3]){var G=new P.AttrList(I[3]);G["DATA-ID"]&&(_=!0,x[G["DATA-ID"]]=G)}return{"levels":w,"sessionData":_?x:null}},e.parseMasterPlaylistMedia=function t(R,C,I,w){var x;void 0===w&&(w=[]);var _=[],O=0;for(U.lastIndex=0;null!==(x=U.exec(R));){var F=new P.AttrList(x[1]);if(F.TYPE===I){var M={"attrs":F,"bitrate":0,"id":O++,"groupId":F["GROUP-ID"],"instreamId":F["INSTREAM-ID"],"name":F.NAME||F.LANGUAGE||"","type":I,"default":F.bool("DEFAULT"),"autoselect":F.bool("AUTOSELECT"),"forced":F.bool("FORCED"),"lang":F.LANGUAGE,"url":F.URI?e.resolve(F.URI,C):""};if(w.length){var N=e.findGroup(w,M.groupId)||w[0];E(M,N,"audioCodec"),E(M,N,"textCodec")}_.push(M)}}return _},e.parseLevelPlaylist=function e(R,C,I,x,N){var B,U,H,V=new O.LevelDetails(C),W=V.fragments,Y=null,z=0,X=0,q=0,Z=0,Q=null,J=new _.Fragment(x,C),$=-1,ee=!1;for(G.lastIndex=0,V.m3u8=R;null!==(B=G.exec(R));){ee&&(ee=!1,(J=new _.Fragment(x,C)).start=q,J.sn=z,J.cc=Z,J.level=I,Y&&(J.initSegment=Y,J.rawProgramDateTime=Y.rawProgramDateTime));var te=B[1];if(te){var re;J.duration=we()(te);var ie=K()(re=" "+B[2]).call(re,1);J.title=ie||null,J.tagList.push(ie?["INF",te,ie]:["INF",te])}else if(B[3]){var ne;if(Object(w.isFiniteNumber)(J.duration))J.start=q,H&&(J.levelkey=H),J.sn=z,J.level=I,J.cc=Z,J.urlId=N,W.push(J),J.relurl=K()(ne=" "+B[3]).call(ne,1),b(J,Q),Q=J,q+=J.duration,z++,X=0,ee=!0}else if(B[4]){var ae,se=K()(ae=" "+B[4]).call(ae,1);Q?J.setByteRange(se,Q):J.setByteRange(se)}else if(B[5]){var oe;J.rawProgramDateTime=K()(oe=" "+B[5]).call(oe,1),J.tagList.push(["PROGRAM-DATE-TIME",J.rawProgramDateTime]),-1===$&&($=W.length)}else{var le,ue,ce;if(!(B=B[0].match(j))){M.logger.warn("No matches on slow regex match for level playlist!");continue}for(U=1;U<B.length&&void 0===B[U];U++);var de=K()(le=" "+B[U]).call(le,1),he=K()(ue=" "+B[U+1]).call(ue,1),fe=B[U+2]?K()(ce=" "+B[U+2]).call(ce,1):"";switch(de){case"PLAYLIST-TYPE":V.type=he.toUpperCase();break;case"MEDIA-SEQUENCE":z=V.startSN=Re()(he);break;case"SKIP":var ge=new P.AttrList(he),ve=ge.decimalInteger("SKIPPED-SEGMENTS");if(Object(w.isFiniteNumber)(ve)){V.skippedSegments=ve;for(var pe=ve;pe--;)W.unshift(null);z+=ve}var me=ge.enumeratedString("RECENTLY-REMOVED-DATERANGES");me&&(V.recentlyRemovedDateranges=me.split("\t"));break;case"TARGETDURATION":V.targetduration=we()(he);break;case"VERSION":V.version=Re()(he);break;case"EXTM3U":break;case"ENDLIST":V.live=!1;break;case"#":(he||fe)&&J.tagList.push(fe?[he,fe]:[he]);break;case"DIS":Z++;case"GAP":J.tagList.push([de]);break;case"BITRATE":J.tagList.push([de,he]);break;case"DISCONTINUITY-SEQ":Z=Re()(he);break;case"KEY":var ye,Ee,Te=new P.AttrList(he),be=Te.enumeratedString("METHOD"),Se=Te.URI,Ae=Te.hexadecimalInteger("IV"),Le=Te.enumeratedString("KEYFORMATVERSIONS"),De=Te.enumeratedString("KEYID"),ke=null!=(ye=Te.enumeratedString("KEYFORMAT"))?ye:"identity",Ie=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Ce()(Ie).call(Ie,ke)>-1){M.logger.warn("Keyformat "+ke+" is not supported from the manifest");continue}if("identity"!==ke)continue;if(be)H=F.LevelKey.fromURL(C,Se),Se&&Ce()(Ee=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"]).call(Ee,be)>=0&&(H.method=be,H.keyFormat=ke,De&&(H.keyID=De),Le&&(H.keyFormatVersions=Le),H.iv=Ae);break;case"START":var xe=new P.AttrList(he).decimalFloatingPoint("TIME-OFFSET");Object(w.isFiniteNumber)(xe)&&(V.startTimeOffset=xe);break;case"MAP":var _e=new P.AttrList(he);J.relurl=_e.URI,_e.BYTERANGE&&J.setByteRange(_e.BYTERANGE),J.level=I,J.sn="initSegment",H&&(J.levelkey=H),J.initSegment=null,Y=J,ee=!0;break;case"SERVER-CONTROL":var Oe=new P.AttrList(he);V.canBlockReload=Oe.bool("CAN-BLOCK-RELOAD"),V.canSkipUntil=Oe.optionalFloat("CAN-SKIP-UNTIL",0),V.canSkipDateRanges=V.canSkipUntil>0&&Oe.bool("CAN-SKIP-DATERANGES"),V.partHoldBack=Oe.optionalFloat("PART-HOLD-BACK",0),V.holdBack=Oe.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Fe=new P.AttrList(he);V.partTarget=Fe.decimalFloatingPoint("PART-TARGET");break;case"PART":var Pe=V.partList;Pe||(Pe=V.partList=[]);var Me=X>0?Pe[Pe.length-1]:void 0,Ne=X++,Be=new _.Part(new P.AttrList(he),J,C,Ne,Me);Pe.push(Be),J.duration+=Be.duration;break;case"PRELOAD-HINT":var Ue=new P.AttrList(he);V.preloadHint=Ue;break;case"RENDITION-REPORT":var Ge=new P.AttrList(he);V.renditionReports=V.renditionReports||[],V.renditionReports.push(Ge);break;default:M.logger.warn("line parsed but not handled: "+B)}}}Q&&!Q.relurl?(W.pop(),q-=Q.duration,V.partList&&(V.fragmentHint=Q)):V.partList&&(b(J,Q),J.cc=Z,V.fragmentHint=J);var je=W.length,Ke=W[0],He=W[je-1];if((q+=V.skippedSegments*V.targetduration)>0&&je&&He){V.averagetargetduration=q/je;var Ve,We=He.sn;if(V.endSN="initSegment"!==We?We:0,Ke)if(V.startCC=Ke.cc,!Ke.initSegment)Ze()(Ve=V.fragments).call(Ve,(function(R){return R.relurl&&p(R.relurl)}))&&(M.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(J=new _.Fragment(x,C)).relurl=He.relurl,J.level=I,J.sn="initSegment",Ke.initSegment=J,V.needSidxRanges=!0)}else V.endSN=0,V.startCC=0;return V.fragmentHint&&(q+=V.fragmentHint.duration),V.totalduration=q,V.endCC=Z,$>0&&function T(R,C){for(var I=R[C],w=C;w--;){var x=R[w];if(!x)return;x.programDateTime=I.programDateTime-1e3*x.duration,I=x}}(W,$),V},e}();function y(R,C){var I;ne()(I=["video","audio","text"]).call(I,(function(I){var w=se()(R).call(R,(function(R){return Object(N.isCodecType)(R,I)}));if(w.length){var x=se()(w).call(w,(function(R){return 0===Z()(R).call(R,"avc1",0)||0===Z()(R).call(R,"mp4a",0)}));C[I+"Codec"]=x.length>0?x[0]:w[0],R=se()(R).call(R,(function(R){return-1===Ce()(w).call(w,R)}))}})),C.unknownCodecs=R}function E(R,C,I){var w=C[I];w&&(R[I]=w)}function b(R,C){R.rawProgramDateTime?R.programDateTime=Date.parse(R.rawProgramDateTime):null!=C&&C.programDateTime&&(R.programDateTime=C.endProgramDateTime),Object(w.isFiniteNumber)(R.programDateTime)||(R.programDateTime=null,R.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function srcLoaderPlaylistLoaderTs(R,C,I){I.r(C);var w=I("./src/polyfills/number.ts"),x=I("./src/events.ts"),_=I("./src/errors.ts"),O=I("./src/utils/logger.ts"),F=I("./src/utils/mp4-tools.ts"),P=I("./src/loader/m3u8-parser.ts"),M=I("./src/types/loader.ts"),N=I("./src/utils/attr-list.ts");function d(R,C){var I=R.url;return void 0!==I&&0!==Ce()(I).call(I,"data:")||(I=C.url),I}var B=function(){function e(R){this.hls=void 0,this.loaders=Object.create(null),this.hls=R,this.registerListeners()}var R=e.prototype;return R.registerListeners=function e(){var R=this.hls;R.on(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.on(x.Events.LEVEL_LOADING,this.onLevelLoading,this),R.on(x.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),R.on(x.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},R.unregisterListeners=function e(){var R=this.hls;R.off(x.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(x.Events.LEVEL_LOADING,this.onLevelLoading,this),R.off(x.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),R.off(x.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},R.createInternalLoader=function e(R){var C=this.hls.config,I=C.pLoader,w=C.loader,x=new(I||w)(C);return R.loader=x,this.loaders[R.type]=x,x},R.getInternalLoader=function e(R){return this.loaders[R.type]},R.resetInternalLoader=function e(R){this.loaders[R]&&delete this.loaders[R]},R.destroyInternalLoaders=function e(){for(var R in this.loaders){var C=this.loaders[R];C&&C.destroy(),this.resetInternalLoader(R)}},R.destroy=function e(){this.unregisterListeners(),this.destroyInternalLoaders()},R.onManifestLoading=function e(R,C){var I=C.url;this.load({"id":null,"groupId":null,"level":0,"responseType":"text","type":M.PlaylistContextType.MANIFEST,"url":I,"deliveryDirectives":null})},R.onLevelLoading=function e(R,C){var I=C.id,w=C.level,x=C.url,_=C.deliveryDirectives;this.load({"id":I,"groupId":null,"level":w,"responseType":"text","type":M.PlaylistContextType.LEVEL,"url":x,"deliveryDirectives":_})},R.onAudioTrackLoading=function e(R,C){var I=C.id,w=C.groupId,x=C.url,_=C.deliveryDirectives;this.load({"id":I,"groupId":w,"level":null,"responseType":"text","type":M.PlaylistContextType.AUDIO_TRACK,"url":x,"deliveryDirectives":_})},R.onSubtitleTrackLoading=function e(R,C){var I=C.id,w=C.groupId,x=C.url,_=C.deliveryDirectives;this.load({"id":I,"groupId":w,"level":null,"responseType":"text","type":M.PlaylistContextType.SUBTITLE_TRACK,"url":x,"deliveryDirectives":_})},R.load=function e(R){var C,I,w,x,_,F,P=this.hls.config,N=this.getInternalLoader(R);if(N){var B=N.context;if(B&&B.url===R.url)return void O.logger.trace("[playlist-loader]: playlist request ongoing");O.logger.log("[playlist-loader]: aborting previous loader for type: "+R.type),N.abort()}switch(R.type){case M.PlaylistContextType.MANIFEST:I=P.manifestLoadingMaxRetry,w=P.manifestLoadingTimeOut,x=P.manifestLoadingRetryDelay,_=P.manifestLoadingMaxRetryTimeout;break;case M.PlaylistContextType.LEVEL:case M.PlaylistContextType.AUDIO_TRACK:case M.PlaylistContextType.SUBTITLE_TRACK:I=0,w=P.levelLoadingTimeOut;break;default:I=P.levelLoadingMaxRetry,w=P.levelLoadingTimeOut,x=P.levelLoadingRetryDelay,_=P.levelLoadingMaxRetryTimeout}if((N=this.createInternalLoader(R),null!==(C=R.deliveryDirectives)&&void 0!==C&&C.part)&&(R.type===M.PlaylistContextType.LEVEL&&null!==R.level?F=this.hls.levels[R.level].details:R.type===M.PlaylistContextType.AUDIO_TRACK&&null!==R.id?F=this.hls.audioTracks[R.id].details:R.type===M.PlaylistContextType.SUBTITLE_TRACK&&null!==R.id&&(F=this.hls.subtitleTracks[R.id].details),F)){var U=F.partTarget,G=F.targetduration;U&&G&&(w=Math.min(1e3*Math.max(3*U,.8*G),w))}var j={"timeout":w,"maxRetry":I,"retryDelay":x,"maxRetryDelay":_,"highWaterMark":0},K={"onSuccess":this.loadsuccess.bind(this),"onError":this.loaderror.bind(this),"onTimeout":this.loadtimeout.bind(this)};N.load(R,j,K)},R.loadsuccess=function e(R,C,I,w){if(void 0===w&&(w=null),I.isSidxRequest)return this.handleSidxRequest(R,I),void this.handlePlaylistLoaded(R,C,I,w);this.resetInternalLoader(I.type);var x=R.data;0===Ce()(x).call(x,"#EXTM3U")?(C.parsing.start=performance.now(),Ce()(x).call(x,"#EXTINF:")>0||Ce()(x).call(x,"#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(R,C,I,w):this.handleMasterPlaylist(R,C,I,w)):this.handleManifestParsingError(R,I,"no EXTM3U delimiter",w)},R.loaderror=function e(R,C,I){void 0===I&&(I=null),this.handleNetworkError(C,I,!1,R)},R.loadtimeout=function e(R,C,I){void 0===I&&(I=null),this.handleNetworkError(C,I,!0)},R.handleMasterPlaylist=function e(R,C,I,w){var _=this.hls,F=R.data,M=d(R,I),B=P.default.parseMasterPlaylist(F,M),U=B.levels,G=B.sessionData;if(U.length){var j=ce()(U).call(U,(function(R){return{"id":R.attrs.AUDIO,"audioCodec":R.audioCodec}})),K=ce()(U).call(U,(function(R){return{"id":R.attrs.SUBTITLES,"textCodec":R.textCodec}})),H=P.default.parseMasterPlaylistMedia(F,M,"AUDIO",j),V=P.default.parseMasterPlaylistMedia(F,M,"SUBTITLES",K),W=P.default.parseMasterPlaylistMedia(F,M,"CLOSED-CAPTIONS");if(H.length){var Y=Le()(H).call(H,(function(R){return!R.url}));Y||!U[0].audioCodec||U[0].attrs.AUDIO||(O.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),H.unshift({"type":"main","name":"main","default":!1,"autoselect":!1,"forced":!1,"id":-1,"attrs":new N.AttrList({}),"bitrate":0,"url":""}))}_.trigger(x.Events.MANIFEST_LOADED,{"levels":U,"audioTracks":H,"subtitles":V,"captions":W,"url":M,"stats":C,"networkDetails":w,"sessionData":G})}else this.handleManifestParsingError(R,I,"no level found in manifest",w)},R.handleTrackOrLevelPlaylist=function e(R,C,I,O){var F=this.hls,B=I.id,U=I.level,G=I.type,j=d(R,I),K=Object(w.isFiniteNumber)(B)?B:0,H=Object(w.isFiniteNumber)(U)?U:K,V=function c(R){switch(R.type){case M.PlaylistContextType.AUDIO_TRACK:return M.PlaylistLevelType.AUDIO;case M.PlaylistContextType.SUBTITLE_TRACK:return M.PlaylistLevelType.SUBTITLE;default:return M.PlaylistLevelType.MAIN}}(I),W=P.default.parseLevelPlaylist(R.data,j,H,V,K);if(W.fragments.length){if(G===M.PlaylistContextType.MANIFEST){var Y={"attrs":new N.AttrList({}),"bitrate":0,"details":W,"name":"","url":j};F.trigger(x.Events.MANIFEST_LOADED,{"levels":[Y],"audioTracks":[],"url":j,"stats":C,"networkDetails":O,"sessionData":null})}if(C.parsing.end=performance.now(),W.needSidxRanges){var z,X=null===(z=W.fragments[0].initSegment)||void 0===z?void 0:z.url;this.load({"url":X,"isSidxRequest":!0,"type":G,"level":U,"levelDetails":W,"id":B,"groupId":null,"rangeStart":0,"rangeEnd":2048,"responseType":"arraybuffer","deliveryDirectives":null})}else I.levelDetails=W,this.handlePlaylistLoaded(R,C,I,O)}else F.trigger(x.Events.ERROR,{"type":_.ErrorTypes.NETWORK_ERROR,"details":_.ErrorDetails.LEVEL_EMPTY_ERROR,"fatal":!1,"url":j,"reason":"no fragments found in level","level":"number"==typeof I.level?I.level:void 0})},R.handleSidxRequest=function e(R,C){var I=Object(F.parseSegmentIndex)(new Uint8Array(R.data));if(I){var w=I.references,x=C.levelDetails;ne()(w).call(w,(function(R,C){var w=R.info,_=x.fragments[C];0===_.byteRange.length&&_.setByteRange(String(1+w.end-w.start)+"@"+String(w.start)),_.initSegment&&_.initSegment.setByteRange(String(I.moovEndOffset)+"@0")}))}},R.handleManifestParsingError=function e(R,C,I,w){this.hls.trigger(x.Events.ERROR,{"type":_.ErrorTypes.NETWORK_ERROR,"details":_.ErrorDetails.MANIFEST_PARSING_ERROR,"fatal":C.type===M.PlaylistContextType.MANIFEST,"url":R.url,"reason":I,"response":R,"context":C,"networkDetails":w})},R.handleNetworkError=function e(R,C,I,w){void 0===I&&(I=!1),O.logger.warn("[playlist-loader]: A network "+(I?"timeout":"error")+" occurred while loading "+R.type+" level: "+R.level+" id: "+R.id+' group-id: "'+R.groupId+'"');var F=_.ErrorDetails.UNKNOWN,P=!1,N=this.getInternalLoader(R);switch(R.type){case M.PlaylistContextType.MANIFEST:F=I?_.ErrorDetails.MANIFEST_LOAD_TIMEOUT:_.ErrorDetails.MANIFEST_LOAD_ERROR,P=!0;break;case M.PlaylistContextType.LEVEL:F=I?_.ErrorDetails.LEVEL_LOAD_TIMEOUT:_.ErrorDetails.LEVEL_LOAD_ERROR,P=!1;break;case M.PlaylistContextType.AUDIO_TRACK:F=I?_.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:_.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,P=!1;break;case M.PlaylistContextType.SUBTITLE_TRACK:F=I?_.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:_.ErrorDetails.SUBTITLE_LOAD_ERROR,P=!1}N&&this.resetInternalLoader(R.type);var B={"type":_.ErrorTypes.NETWORK_ERROR,"details":F,"fatal":P,"url":R.url,"loader":N,"context":R,"networkDetails":C};w&&(B.response=w),this.hls.trigger(x.Events.ERROR,B)},R.handlePlaylistLoaded=function e(R,C,I,w){var _=I.type,O=I.level,F=I.id,P=I.groupId,N=I.loader,B=I.levelDetails,U=I.deliveryDirectives;if(null!=B&&B.targetduration){if(N)switch(B.live&&(N.getCacheAge&&(B.ageHeader=N.getCacheAge()||0),N.getCacheAge&&!isNaN(B.ageHeader)||(B.ageHeader=0)),_){case M.PlaylistContextType.MANIFEST:case M.PlaylistContextType.LEVEL:this.hls.trigger(x.Events.LEVEL_LOADED,{"details":B,"level":O||0,"id":F||0,"stats":C,"networkDetails":w,"deliveryDirectives":U});break;case M.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(x.Events.AUDIO_TRACK_LOADED,{"details":B,"id":F||0,"groupId":P||"","stats":C,"networkDetails":w,"deliveryDirectives":U});break;case M.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(x.Events.SUBTITLE_TRACK_LOADED,{"details":B,"id":F||0,"groupId":P||"","stats":C,"networkDetails":w,"deliveryDirectives":U})}}else this.handleManifestParsingError(R,I,"invalid target duration",w)},e}();C.default=B},"./src/polyfills/number.ts":function srcPolyfillsNumberTs(R,C,I){I.r(C),I.d(C,"isFiniteNumber",(function(){return w})),I.d(C,"MAX_SAFE_INTEGER",(function(){return x}));var w=Je()||function(R){return"number"==typeof R&&isFinite(R)},x=et()||9007199254740991},"./src/remux/aac-helper.ts":function srcRemuxAacHelperTs(R,C,I){I.r(C);var w=function(){function e(){}return e.getSilentFrame=function e(R,C){if("mp4a.40.2"===R){if(1===C)return new Uint8Array([0,200,0,128,35,128]);if(2===C)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===C)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===C)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===C)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===C)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();C.default=w},"./src/remux/mp4-generator.ts":function srcRemuxMp4GeneratorTs(R,C,I){I.r(C);var w=Math.pow(2,32)-1,x=function(){function e(){}return e.init=function t(){var R;for(R in e.types={"avc1":[],"avcC":[],"btrt":[],"dinf":[],"dref":[],"esds":[],"ftyp":[],"hdlr":[],"mdat":[],"mdhd":[],"mdia":[],"mfhd":[],"minf":[],"moof":[],"moov":[],"mp4a":[],".mp3":[],"mvex":[],"mvhd":[],"pasp":[],"sdtp":[],"stbl":[],"stco":[],"stsc":[],"stsd":[],"stsz":[],"stts":[],"tfdt":[],"tfhd":[],"traf":[],"trak":[],"trun":[],"trex":[],"tkhd":[],"vmhd":[],"smhd":[]},e.types)e.types.hasOwnProperty(R)&&(e.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),I=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={"video":C,"audio":I};var w=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),x=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=x,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var _=new Uint8Array([105,115,111,109]),O=new Uint8Array([97,118,99,49]),F=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,_,F,_,O),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,w))},e.box=function e(R){for(var C=8,I=arguments.length,w=new Array(I>1?I-1:0),x=1;x<I;x++)w[x-1]=arguments[x];for(var _=w.length,O=_;_--;)C+=w[_].byteLength;var F=new Uint8Array(C);for(F[0]=C>>24&255,F[1]=C>>16&255,F[2]=C>>8&255,F[3]=255&C,F.set(R,4),_=0,C=8;_<O;_++)F.set(w[_],C),C+=w[_].byteLength;return F},e.hdlr=function t(R){return e.box(e.types.hdlr,e.HDLR_TYPES[R])},e.mdat=function t(R){return e.box(e.types.mdat,R)},e.mdhd=function t(R,C){C*=R;var I=Math.floor(C/(w+1)),x=Math.floor(C%(w+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,I>>24,I>>16&255,I>>8&255,255&I,x>>24,x>>16&255,x>>8&255,255&x,85,196,0,0]))},e.mdia=function t(R){return e.box(e.types.mdia,e.mdhd(R.timescale,R.duration),e.hdlr(R.type),e.minf(R))},e.mfhd=function t(R){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},e.minf=function t(R){return"audio"===R.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(R)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(R))},e.moof=function t(R,C,I){return e.box(e.types.moof,e.mfhd(R),e.traf(I,C))},e.moov=function t(R){for(var C,I,w=R.length,x=[];w--;)x[w]=e.trak(R[w]);return e.box.apply(null,Y()(C=Y()(I=[e.types.moov,e.mvhd(R[0].timescale,R[0].duration)]).call(I,x)).call(C,e.mvex(R)))},e.mvex=function t(R){for(var C,I=R.length,w=[];I--;)w[I]=e.trex(R[I]);return e.box.apply(null,Y()(C=[e.types.mvex]).call(C,w))},e.mvhd=function t(R,C){C*=R;var I=Math.floor(C/(w+1)),x=Math.floor(C%(w+1)),_=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,I>>24,I>>16&255,I>>8&255,255&I,x>>24,x>>16&255,x>>8&255,255&x,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,_)},e.sdtp=function t(R){var C,I,w=R.samples||[],x=new Uint8Array(4+w.length);for(C=0;C<w.length;C++)I=rt()(w[C]),x[C+4]=I.dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return e.box(e.types.sdtp,x)},e.stbl=function t(R){return e.box(e.types.stbl,e.stsd(R),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function t(R){var C,I,w,x,_,O,F=[],P=[];for(x=0;x<R.sps.length;x++)O=(_=R.sps[x]).byteLength,F.push(O>>>8&255),F.push(255&O),F=Y()(F).call(F,K()(Array.prototype).call(_));for(x=0;x<R.pps.length;x++)O=(_=R.pps[x]).byteLength,P.push(O>>>8&255),P.push(255&O),P=Y()(P).call(P,K()(Array.prototype).call(_));var M=e.box(e.types.avcC,new Uint8Array(Y()(C=Y()(I=Y()(w=[1,F[3],F[4],F[5],255,224|R.sps.length]).call(w,F)).call(I,[R.pps.length])).call(C,P))),N=R.width,B=R.height,U=R.pixelRatio[0],G=R.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,N>>8&255,255&N,B>>8&255,255&B,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),M,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([U>>24,U>>16&255,U>>8&255,255&U,G>>24,G>>16&255,G>>8&255,255&G])))},e.esds=function e(R){var C,I,w,x=R.config.length;return new Uint8Array(Y()(C=Y()(I=Y()(w=[0,0,0,0,3,23+x,0,1,0,4,15+x,64,21,0,0,0,0,0,0,0,0,0,0,0,5]).call(w,[x])).call(I,R.config)).call(C,[6,1,2]))},e.mp4a=function t(R){var C=R.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]),e.box(e.types.esds,e.esds(R)))},e.mp3=function t(R){var C=R.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,255&C,0,0]))},e.stsd=function t(R){return"audio"===R.type?R.isAAC||"mp3"!==R.codec?e.box(e.types.stsd,e.STSD,e.mp4a(R)):e.box(e.types.stsd,e.STSD,e.mp3(R)):e.box(e.types.stsd,e.STSD,e.avc1(R))},e.tkhd=function t(R){var C=R.id,I=R.duration*R.timescale,x=R.width,_=R.height,O=Math.floor(I/(w+1)),F=Math.floor(I%(w+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,255&C,0,0,0,0,O>>24,O>>16&255,O>>8&255,255&O,F>>24,F>>16&255,F>>8&255,255&F,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,x>>8&255,255&x,0,0,_>>8&255,255&_,0,0]))},e.traf=function t(R,C){var I=e.sdtp(R),x=R.id,_=Math.floor(C/(w+1)),O=Math.floor(C%(w+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,x>>24,x>>16&255,x>>8&255,255&x])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,_>>24,_>>16&255,_>>8&255,255&_,O>>24,O>>16&255,O>>8&255,255&O])),e.trun(R,I.length+16+20+8+16+8+8),I)},e.trak=function t(R){return R.duration=R.duration||4294967295,e.box(e.types.trak,e.tkhd(R),e.mdia(R))},e.trex=function t(R){var C=R.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,255&C,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function t(R,C){var I,w,x,_,O,F,P=R.samples||[],M=P.length,N=12+16*M,B=new Uint8Array(N);for(C+=8+N,B.set([0,0,15,1,M>>>24&255,M>>>16&255,M>>>8&255,255&M,C>>>24&255,C>>>16&255,C>>>8&255,255&C],0),I=0;I<M;I++)x=(w=P[I]).duration,_=w.size,O=rt()(w),F=w.cts,B.set([x>>>24&255,x>>>16&255,x>>>8&255,255&x,_>>>24&255,_>>>16&255,_>>>8&255,255&_,O.isLeading<<2|O.dependsOn,O.isDependedOn<<6|O.hasRedundancy<<4|O.paddingValue<<1|O.isNonSync,61440&O.degradPrio,15&O.degradPrio,F>>>24&255,F>>>16&255,F>>>8&255,255&F],12+16*I);return e.box(e.types.trun,B)},e.initSegment=function t(R){e.types||e.init();var C=e.moov(R),I=new Uint8Array(e.FTYP.byteLength+C.byteLength);return I.set(e.FTYP),I.set(C,e.FTYP.byteLength),I},e}();x.types=void 0,x.HDLR_TYPES=void 0,x.STTS=void 0,x.STSC=void 0,x.STCO=void 0,x.STSZ=void 0,x.VMHD=void 0,x.SMHD=void 0,x.STSD=void 0,x.FTYP=void 0,x.DINF=void 0,C.default=x},"./src/remux/mp4-remuxer.ts":function srcRemuxMp4RemuxerTs(R,C,I){I.r(C),I.d(C,"default",(function(){return j})),I.d(C,"normalizePts",(function(){return E}));var w=I("./src/polyfills/number.ts"),x=I("./src/remux/aac-helper.ts"),_=I("./src/remux/mp4-generator.ts"),O=I("./src/events.ts"),F=I("./src/errors.ts"),P=I("./src/utils/logger.ts"),M=I("./src/types/loader.ts"),N=I("./src/utils/timescale-conversion.ts");function c(){return c=ge()||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(R[w]=I[w])}return R},c.apply(this,arguments)}var B=null,U=null,G=!1,j=function(){function e(R,C,I,w){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=R,this.config=C,this.typeSupported=I,this.ISGenerated=!1,null===B){var x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);B=x?Re()(x[1]):0}if(null===U){var _=navigator.userAgent.match(/Safari\/(\d+)/i);U=_?Re()(_[1]):0}G=!!B&&B<75||!!U&&U<600}var R=e.prototype;return R.destroy=function e(){},R.resetTimeStamp=function e(R){P.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=R},R.resetNextTimestamp=function e(){P.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},R.resetInitSegment=function e(){P.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},R.getVideoStartPts=function e(R){var C=!1,I=re()(R).call(R,(function(R,I){var w=I.pts-R;return w<-4294967296?(C=!0,E(R,I.pts)):w>0?R:I.pts}),R[0].pts);return C&&P.logger.debug("PTS rollover detected"),I},R.remux=function e(R,C,I,w,x,_,O,F){var N,B,U,G,j,H,V=x,W=x,Y=R.pid>-1,z=C.pid>-1,X=C.samples.length,q=R.samples.length>0,Z=X>1;if((!Y||q)&&(!z||Z)||this.ISGenerated||O){this.ISGenerated||(U=this.generateIS(R,C,x));var Q=this.isVideoContiguous,J=-1;if(Z&&(J=function T(R){for(var C=0;C<R.length;C++)if(R[C].key)return C;return-1}(C.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(H=!0,J>0){var $;P.logger.warn("[mp4-remuxer]: Dropped "+J+" out of "+X+" video samples due to a missing keyframe");var ee=this.getVideoStartPts(C.samples);C.samples=K()($=C.samples).call($,J),C.dropped+=J,W+=(C.samples[0].pts-ee)/(C.timescale||9e4)}else-1===J&&(P.logger.warn("[mp4-remuxer]: No keyframe found out of "+X+" video samples"),H=!1);if(this.ISGenerated){if(q&&Z){var te=this.getVideoStartPts(C.samples),re=(E(R.samples[0].pts,te)-te)/C.inputTimeScale;V+=Math.max(0,re),W+=Math.max(0,-re)}if(q){if(R.samplerate||(P.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(R,C,x)),B=this.remuxAudio(R,V,this.isAudioContiguous,_,z||Z||F===M.PlaylistLevelType.AUDIO?W:void 0),Z){var ie=B?B.endPTS-B.startPTS:0;C.inputTimeScale||(P.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(R,C,x)),N=this.remuxVideo(C,W,Q,ie)}}else Z&&(N=this.remuxVideo(C,W,Q,0));N&&(N.firstKeyFrame=J,N.independent=-1!==J)}}return this.ISGenerated&&(I.samples.length&&(j=this.remuxID3(I,x)),w.samples.length&&(G=this.remuxText(w,x))),{"audio":B,"video":N,"initSegment":U,"independent":H,"text":G,"id3":j}},R.generateIS=function e(R,C,I){var x,O,F,P=R.samples,M=C.samples,N=this.typeSupported,B={},U=!Object(w.isFiniteNumber)(this._initPTS),G="audio/mp4";if(U&&(x=O=1/0),R.config&&P.length&&(R.timescale=R.samplerate,R.isAAC||(N.mpeg?(G="audio/mpeg",R.codec=""):N.mp3&&(R.codec="mp3")),B.audio={"id":"audio","container":G,"codec":R.codec,"initSegment":!R.isAAC&&N.mpeg?new Uint8Array(0):_.default.initSegment([R]),"metadata":{"channelCount":R.channelCount}},U&&(F=R.inputTimeScale,x=O=P[0].pts-Math.round(F*I))),C.sps&&C.pps&&M.length&&(C.timescale=C.inputTimeScale,B.video={"id":"main","container":"video/mp4","codec":C.codec,"initSegment":_.default.initSegment([C]),"metadata":{"width":C.width,"height":C.height}},U)){F=C.inputTimeScale;var j=this.getVideoStartPts(M),K=Math.round(F*I);O=Math.min(O,E(M[0].dts,j)-K),x=Math.min(x,j-K)}if(ee()(B).length)return this.ISGenerated=!0,U&&(this._initPTS=x,this._initDTS=O),{"tracks":B,"initPTS":x,"timescale":F}},R.remuxVideo=function e(R,C,I,w){var x,M,U,j=R.inputTimeScale,K=R.samples,V=[],W=K.length,Y=this._initPTS,z=this.nextAvcDts,X=8,q=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,Q=0,J=!1;I&&null!==z||(z=C*j-(K[0].pts-E(K[0].dts,K[0].pts)));for(var $=0;$<W;$++){var ee=K[$];if(ee.pts=E(ee.pts-Y,z),ee.dts=E(ee.dts-Y,z),ee.dts>ee.pts){Q=Math.max(Math.min(Q,ee.pts-ee.dts),-18e3)}ee.dts<K[$>0?$-1:$].dts&&(J=!0)}J&&Be()(K).call(K,(function(R,C){var I=R.dts-C.dts,w=R.pts-C.pts;return I||w})),M=K[0].dts,U=K[K.length-1].dts;var te=Math.round((U-M)/(W-1));if(Q<0){if(Q<-2*te){P.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(N.toMsFromMpegTsClock)(-te,!0)+" ms");for(var re=Q,ie=0;ie<W;ie++)K[ie].dts=re=Math.max(re,K[ie].pts-te),K[ie].pts=Math.max(re,K[ie].pts)}else{P.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(N.toMsFromMpegTsClock)(Q,!0)+" ms to overcome this issue");for(var ne=0;ne<W;ne++)K[ne].dts=K[ne].dts+Q}M=K[0].dts}if(I){var ae=M-z,se=ae>te;if(se||ae<-1){se?P.logger.warn("AVC: "+Object(N.toMsFromMpegTsClock)(ae,!0)+" ms ("+ae+"dts) hole between fragments detected, filling it"):P.logger.warn("AVC: "+Object(N.toMsFromMpegTsClock)(-ae,!0)+" ms ("+ae+"dts) overlapping between fragments detected"),M=z;var oe=K[0].pts-ae;K[0].dts=M,K[0].pts=oe,P.logger.log("Video: First PTS/DTS adjusted: "+Object(N.toMsFromMpegTsClock)(oe,!0)+"/"+Object(N.toMsFromMpegTsClock)(M,!0)+", delta: "+Object(N.toMsFromMpegTsClock)(ae,!0)+" ms")}}G&&(M=Math.max(0,M));for(var le=0,ue=0,ce=0;ce<W;ce++){for(var de=K[ce],he=de.units,fe=he.length,ge=0,ve=0;ve<fe;ve++)ge+=he[ve].data.length;ue+=ge,le+=fe,de.length=ge,de.dts=Math.max(de.dts,M),de.pts=Math.max(de.pts,de.dts,0),q=Math.min(de.pts,q),Z=Math.max(de.pts,Z)}U=K[W-1].dts;var pe,me=ue+4*le+8;try{pe=new Uint8Array(me)}catch(e){return void this.observer.emit(O.Events.ERROR,O.Events.ERROR,{"type":F.ErrorTypes.MUX_ERROR,"details":F.ErrorDetails.REMUX_ALLOC_ERROR,"fatal":!1,"bytes":me,"reason":"fail allocating video mdat "+me})}var ye=new DataView(pe.buffer);ye.setUint32(0,me),pe.set(_.default.types.mdat,4);for(var Ee=0;Ee<W;Ee++){for(var Te=K[Ee],be=Te.units,Se=0,Ae=0,Le=be.length;Ae<Le;Ae++){var De=be[Ae],Re=De.data,ke=De.data.byteLength;ye.setUint32(X,ke),X+=4,pe.set(Re,X),X+=ke,Se+=4+ke}if(Ee<W-1)x=K[Ee+1].dts-Te.dts;else{var Ce=this.config,Ie=Te.dts-K[Ee>0?Ee-1:Ee].dts;if(Ce.stretchShortVideoTrack&&null!==this.nextAudioPts){var we=Math.floor(Ce.maxBufferHole*j),xe=(w?q+w*j:this.nextAudioPts)-Te.pts;xe>we?((x=xe-Ie)<0&&(x=Ie),P.logger.log("[mp4-remuxer]: It is approximately "+xe/90+" ms to the next segment; using duration "+x/90+" ms for the last video frame.")):x=Ie}else x=Ie}var _e=Math.round(Te.pts-Te.dts);V.push(new H(Te.key,x,Se,_e))}if(V.length&&B&&B<70){var Oe=rt()(V[0]);Oe.dependsOn=2,Oe.isNonSync=0}console.assert(void 0!==x,"mp4SampleDuration must be computed"),this.nextAvcDts=z=U+x,this.isVideoContiguous=!0;var Fe={"data1":_.default.moof(R.sequenceNumber++,M,c({},R,{"samples":V})),"data2":pe,"startPTS":q/j,"endPTS":(Z+x)/j,"startDTS":M/j,"endDTS":z/j,"type":"video","hasAudio":!1,"hasVideo":!0,"nb":V.length,"dropped":R.dropped};return R.samples=[],R.dropped=0,console.assert(pe.length,"MDAT length must not be zero"),Fe},R.remuxAudio=function e(R,C,I,w,M){var N=R.inputTimeScale,B=N/(R.samplerate?R.samplerate:N),U=R.isAAC?1024:1152,G=U*B,j=this._initPTS,K=!R.isAAC&&this.typeSupported.mpeg,V=[],W=R.samples,Y=K?0:8,z=this.nextAudioPts||-1,X=C*N;if(this.isAudioContiguous=I=I||W.length&&z>0&&(w&&Math.abs(X-z)<9e3||Math.abs(E(W[0].pts-j,X)-z)<20*G),ne()(W).call(W,(function(R){R.pts=E(R.pts-j,X)})),!I||z<0){if(W=se()(W).call(W,(function(R){return R.pts>=0})),!W.length)return;z=0===M?0:w?Math.max(0,X):W[0].pts}if(R.isAAC)for(var q=void 0!==M,Z=this.config.maxAudioFramesDrift,Q=0,J=z;Q<W.length;Q++){var $=W[Q],ee=$.pts,te=ee-J,re=Math.abs(1e3*te/N);if(te<=-Z*G&&q)0===Q&&(P.logger.warn("Audio frame @ "+(ee/N).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*te/N)+" ms."),this.nextAudioPts=z=J=ee);else if(te>=Z*G&&re<1e4&&q){var ie=Math.round(te/G);(J=ee-ie*G)<0&&(ie--,J+=G),0===Q&&(this.nextAudioPts=z=J),P.logger.warn("[mp4-remuxer]: Injecting "+ie+" audio frame @ "+(J/N).toFixed(3)+"s due to "+Math.round(1e3*te/N)+" ms gap.");for(var ae=0;ae<ie;ae++){var oe=Math.max(J,0),le=x.default.getSilentFrame(R.manifestCodec||R.codec,R.channelCount);le||(P.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),le=$.unit.subarray()),Ke()(W).call(W,Q,0,{"unit":le,"pts":oe}),J+=G,Q++}}$.pts=J,J+=G}for(var ue,ce=null,de=null,he=0,fe=W.length;fe--;)he+=W[fe].unit.byteLength;for(var ge=0,ve=W.length;ge<ve;ge++){var pe=W[ge],me=pe.unit,ye=pe.pts;if(null!==de){V[ge-1].duration=Math.round((ye-de)/B)}else{if(I&&R.isAAC&&(ye=z),ce=ye,!(he>0))return;he+=Y;try{ue=new Uint8Array(he)}catch(e){return void this.observer.emit(O.Events.ERROR,O.Events.ERROR,{"type":F.ErrorTypes.MUX_ERROR,"details":F.ErrorDetails.REMUX_ALLOC_ERROR,"fatal":!1,"bytes":he,"reason":"fail allocating audio mdat "+he})}K||(new DataView(ue.buffer).setUint32(0,he),ue.set(_.default.types.mdat,4))}ue.set(me,Y);var Ee=me.byteLength;Y+=Ee,V.push(new H(!0,U,Ee,0)),de=ye}var Te=V.length;if(Te){var be=V[V.length-1];this.nextAudioPts=z=de+B*be.duration;var Se=K?new Uint8Array(0):_.default.moof(R.sequenceNumber++,ce/B,c({},R,{"samples":V}));R.samples=[];var Ae=ce/N,Le=z/N,De={"data1":Se,"data2":ue,"startPTS":Ae,"endPTS":Le,"startDTS":Ae,"endDTS":Le,"type":"audio","hasAudio":!0,"hasVideo":!1,"nb":Te};return this.isAudioContiguous=!0,console.assert(ue.length,"MDAT length must not be zero"),De}},R.remuxEmptyAudio=function e(R,C,I,w){var _=R.inputTimeScale,O=_/(R.samplerate?R.samplerate:_),F=this.nextAudioPts,M=(null!==F?F:w.startDTS*_)+this._initDTS,N=w.endDTS*_+this._initDTS,B=1024*O,U=Math.ceil((N-M)/B),G=x.default.getSilentFrame(R.manifestCodec||R.codec,R.channelCount);if(P.logger.warn("[mp4-remuxer]: remux empty Audio"),G){for(var j=[],K=0;K<U;K++){var H=M+K*B;j.push({"unit":G,"pts":H,"dts":H})}return R.samples=j,this.remuxAudio(R,C,I,!1)}P.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},R.remuxID3=function e(R,C){var I=R.samples.length;if(I){for(var w=R.inputTimeScale,x=this._initPTS,_=this._initDTS,O=0;O<I;O++){var F=R.samples[O];F.pts=E(F.pts-x,C*w)/w,F.dts=E(F.dts-_,C*w)/w}var P=R.samples;return R.samples=[],{"samples":P}}},R.remuxText=function e(R,C){var I,w=R.samples.length;if(w){for(var x=R.inputTimeScale,_=this._initPTS,O=0;O<w;O++){var F=R.samples[O];F.pts=E(F.pts-_,C*x)/x}Be()(I=R.samples).call(I,(function(R,C){return R.pts-C.pts}));var P=R.samples;return R.samples=[],{"samples":P}}},e}();function E(R,C){var I;if(null===C)return R;for(I=C<R?-8589934592:8589934592;Math.abs(R-C)>4294967296;)R+=I;return R}var H=function e(R,C,I,w){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=C,this.size=I,this.cts=w,this.flags=new V(R)},V=function e(R){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=R?2:1,this.isNonSync=R?0:1}},"./src/remux/passthrough-remuxer.ts":function srcRemuxPassthroughRemuxerTs(R,C,I){I.r(C);var w=I("./src/polyfills/number.ts"),x=I("./src/utils/mp4-tools.ts"),_=I("./src/loader/fragment.ts"),O=I("./src/utils/logger.ts"),F=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var R=e.prototype;return R.destroy=function e(){},R.resetTimeStamp=function e(R){this.initPTS=R,this.lastEndDTS=null},R.resetNextTimestamp=function e(){this.lastEndDTS=null},R.resetInitSegment=function e(R,C,I){this.audioCodec=C,this.videoCodec=I,this.generateInitSegment(R),this.emitInitSegment=!0},R.generateInitSegment=function e(R){var C=this.audioCodec,I=this.videoCodec;if(!R||!R.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var w=this.initData=Object(x.parseInitSegment)(R);C||(C=u(w.audio,_.ElementaryStreamTypes.AUDIO)),I||(I=u(w.video,_.ElementaryStreamTypes.VIDEO));var F={};w.audio&&w.video?F.audiovideo={"container":"video/mp4","codec":C+","+I,"initSegment":R,"id":"main"}:w.audio?F.audio={"container":"audio/mp4","codec":C,"initSegment":R,"id":"audio"}:w.video?F.video={"container":"video/mp4","codec":I,"initSegment":R,"id":"main"}:O.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=F},R.remux=function e(R,C,I,_,F){var M=this.initPTS,N=this.lastEndDTS,B={"audio":void 0,"video":void 0,"text":_,"id3":I,"initSegment":void 0};Object(w.isFiniteNumber)(N)||(N=this.lastEndDTS=F||0);var U=C.samples;if(!U||!U.length)return B;var G={"initPTS":void 0,"timescale":1},j=this.initData;if(j&&j.length||(this.generateInitSegment(U),j=this.initData),!j||!j.length)return O.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),B;this.emitInitSegment&&(G.tracks=this.initTracks,this.emitInitSegment=!1),Object(w.isFiniteNumber)(M)||(this.initPTS=G.initPTS=M=P(j,U,N));var K=Object(x.getDuration)(U,j),H=N,V=K+H;Object(x.offsetStartDTS)(j,U,M),K>0?this.lastEndDTS=V:(O.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var W=!!j.audio,Y=!!j.video,z="";W&&(z+="audio"),Y&&(z+="video");var X={"data1":U,"startPTS":H,"startDTS":H,"endPTS":V,"endDTS":V,"type":z,"hasAudio":W,"hasVideo":Y,"nb":1,"dropped":0};return B.audio="audio"===X.type?X:void 0,B.video="audio"!==X.type?X:void 0,B.text=_,B.id3=I,B.initSegment=G,B},e}(),P=function e(R,C,I){return Object(x.getStartDTS)(R,C)-I};function u(R,C){var I=null==R?void 0:R.codec;return I&&I.length>4?I:"hvc1"===I?"hvc1.1.c.L120.90":"av01"===I?"av01.0.04M.08":"avc1"===I||C===_.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=F},"./src/task-loop.ts":function srcTaskLoopTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w}));var w=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var R=e.prototype;return R.destroy=function e(){this.onHandlerDestroying(),this.onHandlerDestroyed()},R.onHandlerDestroying=function e(){this.clearNextTick(),this.clearInterval()},R.onHandlerDestroyed=function e(){},R.hasInterval=function e(){return!!this._tickInterval},R.hasNextTick=function e(){return!!this._tickTimer},R.setInterval=function e(R){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,R),!0)},R.clearInterval=function e(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},R.clearNextTick=function e(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},R.tick=function e(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},R.tickImmediate=function e(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},R.doTick=function e(){},e}()},"./src/types/cmcd.ts":function srcTypesCmcdTs(R,C,I){I.r(C),I.d(C,"CMCDVersion",(function(){return O})),I.d(C,"CMCDObjectType",(function(){return w})),I.d(C,"CMCDStreamingFormat",(function(){return x})),I.d(C,"CMCDStreamType",(function(){return _}));var w,x,_,O=1;!function(R){R.MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o"}(w||(w={})),function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"}(x||(x={})),function(R){R.VOD="v",R.LIVE="l"}(_||(_={}))},"./src/types/level.ts":function srcTypesLevelTs(R,C,I){function i(R,C){for(var I=0;I<C.length;I++){var w=C[I];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),B()(R,w.key,w)}}var w;function s(R,C){var I=R.canSkipUntil,x=R.canSkipDateRanges,_=R.endSN;return I&&(void 0!==C?C-_:0)<I?x?w.v2:w.Yes:w.No}I.r(C),I.d(C,"HlsSkip",(function(){return w})),I.d(C,"getSkipValue",(function(){return s})),I.d(C,"HlsUrlParameters",(function(){return x})),I.d(C,"Level",(function(){return _})),function(R){R.No="",R.Yes="YES",R.v2="v2"}(w||(w={}));var x=function(){function e(R,C,I){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=R,this.part=C,this.skip=I}return e.prototype.addDirectives=function e(R){var C=new(he())(R);return void 0!==this.msn&&C.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&C.searchParams.set("_HLS_part",this.part.toString()),this.skip&&C.searchParams.set("_HLS_skip",this.skip),C.toString()},e}(),_=function(){function e(R){var C;this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[R.url],this.attrs=R.attrs,this.bitrate=R.bitrate,R.details&&(this.details=R.details),this.id=R.id||0,this.name=R.name,this.width=R.width||0,this.height=R.height||0,this.audioCodec=R.audioCodec,this.videoCodec=R.videoCodec,this.unknownCodecs=R.unknownCodecs,this.codecSet=se()(C=[R.videoCodec,R.audioCodec]).call(C,(function(R){return R})).join(",").replace(/\.[^.,]+/g,"")}return function a(R,C,I){return C&&i(R.prototype,C),I&&i(R,I),R}(e,[{"key":"maxBitrate","get":function e(){return Math.max(this.realBitrate,this.bitrate)}},{"key":"uri","get":function e(){return this.url[this._urlId]||""}},{"key":"urlId","get":function e(){return this._urlId},"set":function e(R){var C=R%this.url.length;this._urlId!==C&&(this.details=void 0,this._urlId=C)}}]),e}()},"./src/types/loader.ts":function srcTypesLoaderTs(R,C,I){var w,x;I.r(C),I.d(C,"PlaylistContextType",(function(){return w})),I.d(C,"PlaylistLevelType",(function(){return x})),function(R){R.MANIFEST="manifest",R.LEVEL="level",R.AUDIO_TRACK="audioTrack",R.SUBTITLE_TRACK="subtitleTrack"}(w||(w={})),function(R){R.MAIN="main",R.AUDIO="audio",R.SUBTITLE="subtitle"}(x||(x={}))},"./src/types/transmuxer.ts":function srcTypesTransmuxerTs(R,C,I){I.r(C),I.d(C,"ChunkMetadata",(function(){return w}));var w=function e(R,C,I,w,x,_){void 0===w&&(w=0),void 0===x&&(x=-1),void 0===_&&(_=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={"start":0,"executeStart":0,"executeEnd":0,"end":0},this.buffering={"audio":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"video":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"audiovideo":{"start":0,"executeStart":0,"executeEnd":0,"end":0}},this.level=R,this.sn=C,this.id=I,this.size=w,this.part=x,this.partial=_}},"./src/utils/attr-list.ts":function srcUtilsAttrListTs(R,C,I){I.r(C),I.d(C,"AttrList",(function(){return _}));var w=/^(\d+)x(\d+)$/,x=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,_=function(){function e(R){for(var C in"string"==typeof R&&(R=e.parseAttrList(R)),R)R.hasOwnProperty(C)&&(this[C]=R[C])}var R=e.prototype;return R.decimalInteger=function e(R){var C=Re()(this[R],10);return C>et()?1/0:C},R.hexadecimalInteger=function e(R){if(this[R]){var C,I=K()(C=this[R]||"0x").call(C,2);I=(1&I.length?"0":"")+I;for(var w=new Uint8Array(I.length/2),x=0;x<I.length/2;x++)w[x]=Re()(K()(I).call(I,2*x,2*x+2),16);return w}return null},R.hexadecimalIntegerAsNumber=function e(R){var C=Re()(this[R],16);return C>et()?1/0:C},R.decimalFloatingPoint=function e(R){return we()(this[R])},R.optionalFloat=function e(R,C){var I=this[R];return I?we()(I):C},R.enumeratedString=function e(R){return this[R]},R.bool=function e(R){return"YES"===this[R]},R.decimalResolution=function e(R){var C=w.exec(this[R]);if(null!==C)return{"width":Re()(C[1],10),"height":Re()(C[2],10)}},e.parseAttrList=function e(R){var C,I={};for(x.lastIndex=0;null!==(C=x.exec(R));){var w=C[2];0===Ce()(w).call(w,'"')&&Z()(w).call(w,'"')===w.length-1&&(w=K()(w).call(w,1,-1)),I[C[1]]=w}return I},e}()},"./src/utils/binary-search.ts":function srcUtilsBinarySearchTs(R,C,I){I.r(C);C.default={"search":function e(R,C){for(var I=0,w=R.length-1,x=null,_=null;I<=w;){var O=C(_=R[x=(I+w)/2|0]);if(O>0)I=x+1;else{if(!(O<0))return _;w=x-1}}return null}}},"./src/utils/buffer-helper.ts":function srcUtilsBufferHelperTs(R,C,I){I.r(C),I.d(C,"BufferHelper",(function(){return _}));var w=I("./src/utils/logger.ts"),x={"length":0,"start":function e(){return 0},"end":function e(){return 0}},_=function(){function e(){}return e.isBuffered=function t(R,C){try{if(R)for(var I=e.getBuffered(R),w=0;w<I.length;w++)if(C>=I.start(w)&&C<=I.end(w))return!0}catch(R){}return!1},e.bufferInfo=function t(R,C,I){try{if(R){var w,x=e.getBuffered(R),_=[];for(w=0;w<x.length;w++)_.push({"start":x.start(w),"end":x.end(w)});return this.bufferedInfo(_,C,I)}}catch(R){}return{"len":0,"start":C,"end":C,"nextStart":void 0}},e.bufferedInfo=function e(R,C,I){C=Math.max(0,C),Be()(R).call(R,(function(R,C){var I=R.start-C.start;return I||C.end-R.end}));var w=[];if(I)for(var x=0;x<R.length;x++){var _=w.length;if(_){var O=w[_-1].end;R[x].start-O<I?R[x].end>O&&(w[_-1].end=R[x].end):w.push(R[x])}else w.push(R[x])}else w=R;for(var F,P=0,M=C,N=C,B=0;B<w.length;B++){var U=w[B].start,G=w[B].end;if(C+I>=U&&C<G)M=U,P=(N=G)-C;else if(C+I<U){F=U;break}}return{"len":P,"start":M||0,"end":N||0,"nextStart":F}},e.getBuffered=function e(R){try{return R.buffered}catch(e){return w.logger.log("failed to get media.buffered",e),x}},e}()},"./src/utils/cea-608-parser.ts":function srcUtilsCea608ParserTs(R,C,I){I.r(C),I.d(C,"Row",(function(){return W})),I.d(C,"CaptionScreen",(function(){return Y}));var w,x=I("./src/utils/logger.ts"),_={"42":225,"92":233,"94":237,"95":243,"96":250,"123":231,"124":247,"125":209,"126":241,"127":9608,"128":174,"129":176,"130":189,"131":191,"132":8482,"133":162,"134":163,"135":9834,"136":224,"137":32,"138":232,"139":226,"140":234,"141":238,"142":244,"143":251,"144":193,"145":201,"146":211,"147":218,"148":220,"149":252,"150":8216,"151":161,"152":42,"153":8217,"154":9473,"155":169,"156":8480,"157":8226,"158":8220,"159":8221,"160":192,"161":194,"162":199,"163":200,"164":202,"165":203,"166":235,"167":206,"168":207,"169":239,"170":212,"171":217,"172":249,"173":219,"174":171,"175":187,"176":195,"177":227,"178":205,"179":204,"180":236,"181":210,"182":242,"183":213,"184":245,"185":123,"186":125,"187":92,"188":94,"189":95,"190":124,"191":8764,"192":196,"193":228,"194":214,"195":246,"196":223,"197":165,"198":164,"199":9475,"200":197,"201":229,"202":216,"203":248,"204":9487,"205":9491,"206":9495,"207":9499},O=function e(R){var C=R;return _.hasOwnProperty(R)&&(C=_[R]),String.fromCharCode(C)},F=15,P=100,M={"17":1,"18":3,"21":5,"22":7,"23":9,"16":11,"19":12,"20":14},N={"17":2,"18":4,"21":6,"22":8,"23":10,"19":13,"20":15},B={"25":1,"26":3,"29":5,"30":7,"31":9,"24":11,"27":12,"28":14},U={"25":2,"26":4,"29":6,"30":8,"31":10,"27":13,"28":15},G=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(R){R[R.ERROR=0]="ERROR",R[R.TEXT=1]="TEXT",R[R.WARNING=2]="WARNING",R[R.INFO=2]="INFO",R[R.DEBUG=3]="DEBUG",R[R.DATA=3]="DATA"}(w||(w={}));var j=function(){function e(){this.time=null,this.verboseLevel=w.ERROR}return e.prototype.log=function e(R,C){this.verboseLevel>=R&&x.logger.log(this.time+" ["+R+"] "+C)},e}(),K=function e(R){for(var C=[],I=0;I<R.length;I++)C.push(R[I].toString(16));return C},H=function(){function e(R,C,I,w,x){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=R||"white",this.underline=C||!1,this.italics=I||!1,this.background=w||"black",this.flash=x||!1}var R=e.prototype;return R.reset=function e(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},R.setStyles=function e(R){for(var C=["foreground","underline","italics","background","flash"],I=0;I<C.length;I++){var w=C[I];R.hasOwnProperty(w)&&(this[w]=R[w])}},R.isDefault=function e(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},R.equals=function e(R){return this.foreground===R.foreground&&this.underline===R.underline&&this.italics===R.italics&&this.background===R.background&&this.flash===R.flash},R.copy=function e(R){this.foreground=R.foreground,this.underline=R.underline,this.italics=R.italics,this.background=R.background,this.flash=R.flash},R.toString=function e(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),V=function(){function e(R,C,I,w,x,_){this.uchar=void 0,this.penState=void 0,this.uchar=R||" ",this.penState=new H(C,I,w,x,_)}var R=e.prototype;return R.reset=function e(){this.uchar=" ",this.penState.reset()},R.setChar=function e(R,C){this.uchar=R,this.penState.copy(C)},R.setPenState=function e(R){this.penState.copy(R)},R.equals=function e(R){return this.uchar===R.uchar&&this.penState.equals(R.penState)},R.copy=function e(R){this.uchar=R.uchar,this.penState.copy(R.penState)},R.isEmpty=function e(){return" "===this.uchar&&this.penState.isDefault()},e}(),W=function(){function e(R){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var C=0;C<P;C++)this.chars.push(new V);this.logger=R,this.pos=0,this.currPenState=new H}var R=e.prototype;return R.equals=function e(R){for(var C=!0,I=0;I<P;I++)if(!this.chars[I].equals(R.chars[I])){C=!1;break}return C},R.copy=function e(R){for(var C=0;C<P;C++)this.chars[C].copy(R.chars[C])},R.isEmpty=function e(){for(var R=!0,C=0;C<P;C++)if(!this.chars[C].isEmpty()){R=!1;break}return R},R.setCursor=function e(R){this.pos!==R&&(this.pos=R),this.pos<0?(this.logger.log(w.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>P&&(this.logger.log(w.DEBUG,"Too large cursor position "+this.pos),this.pos=P)},R.moveCursor=function e(R){var C=this.pos+R;if(R>1)for(var I=this.pos+1;I<C+1;I++)this.chars[I].setPenState(this.currPenState);this.setCursor(C)},R.backSpace=function e(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},R.insertChar=function e(R){R>=144&&this.backSpace();var C=O(R);this.pos>=P?this.logger.log(w.ERROR,"Cannot insert "+R.toString(16)+" ("+C+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(C,this.currPenState),this.moveCursor(1))},R.clearFromPos=function e(R){var C;for(C=R;C<P;C++)this.chars[C].reset()},R.clear=function e(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},R.clearToEndOfRow=function e(){this.clearFromPos(this.pos)},R.getTextString=function e(){for(var R=[],C=!0,I=0;I<P;I++){var w=this.chars[I].uchar;" "!==w&&(C=!1),R.push(w)}return C?"":R.join("")},R.setPenStyles=function e(R){this.currPenState.setStyles(R),this.chars[this.pos].setPenState(this.currPenState)},e}(),Y=function(){function e(R){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var C=0;C<F;C++)this.rows.push(new W(R));this.logger=R,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var R=e.prototype;return R.reset=function e(){for(var R=0;R<F;R++)this.rows[R].clear();this.currRow=14},R.equals=function e(R){for(var C=!0,I=0;I<F;I++)if(!this.rows[I].equals(R.rows[I])){C=!1;break}return C},R.copy=function e(R){for(var C=0;C<F;C++)this.rows[C].copy(R.rows[C])},R.isEmpty=function e(){for(var R=!0,C=0;C<F;C++)if(!this.rows[C].isEmpty()){R=!1;break}return R},R.backSpace=function e(){this.rows[this.currRow].backSpace()},R.clearToEndOfRow=function e(){this.rows[this.currRow].clearToEndOfRow()},R.insertChar=function e(R){this.rows[this.currRow].insertChar(R)},R.setPen=function e(R){this.rows[this.currRow].setPenStyles(R)},R.moveCursor=function e(R){this.rows[this.currRow].moveCursor(R)},R.setCursor=function e(R){this.logger.log(w.INFO,"setCursor: "+R),this.rows[this.currRow].setCursor(R)},R.setPAC=function e(R){this.logger.log(w.INFO,"pacData = "+le()(R));var C=R.row-1;if(this.nrRollUpRows&&C<this.nrRollUpRows-1&&(C=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==C){for(var I=0;I<F;I++)this.rows[I].clear();var x=this.currRow+1-this.nrRollUpRows,_=this.lastOutputScreen;if(_){var O=_.rows[x].cueStartTime,P=this.logger.time;if(O&&null!==P&&O<P)for(var M=0;M<this.nrRollUpRows;M++)this.rows[C-this.nrRollUpRows+M+1].copy(_.rows[x+M])}}this.currRow=C;var N=this.rows[this.currRow];if(null!==R.indent){var B=R.indent,U=Math.max(B-1,0);N.setCursor(R.indent),R.color=N.chars[U].penState.foreground}var G={"foreground":R.color,"underline":R.underline,"italics":R.italics,"background":"black","flash":!1};this.setPen(G)},R.setBkgData=function e(R){this.logger.log(w.INFO,"bkgData = "+le()(R)),this.backSpace(),this.setPen(R),this.insertChar(32)},R.setRollUpRows=function e(R){this.nrRollUpRows=R},R.rollUp=function e(){var R,C;if(null!==this.nrRollUpRows){this.logger.log(w.TEXT,this.getDisplayText());var I=this.currRow+1-this.nrRollUpRows,x=Ke()(R=this.rows).call(R,I,1)[0];x.clear(),Ke()(C=this.rows).call(C,this.currRow,0,x),this.logger.log(w.INFO,"Rolling up")}else this.logger.log(w.DEBUG,"roll_up but nrRollUpRows not set yet")},R.getDisplayText=function e(R){R=R||!1;for(var C=[],I="",w=-1,x=0;x<F;x++){var _=this.rows[x].getTextString();_&&(w=x+1,R?C.push("Row "+w+": '"+_+"'"):C.push(X()(_).call(_)))}return C.length>0&&(I=R?"["+C.join(" | ")+"]":C.join("\n")),I},R.getTextAndFormat=function e(){return this.rows},e}(),z=function(){function e(R,C,I){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=R,this.outputFilter=C,this.mode=null,this.verbose=0,this.displayedMemory=new Y(I),this.nonDisplayedMemory=new Y(I),this.lastOutputScreen=new Y(I),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=I}var R=e.prototype;return R.reset=function e(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},R.getHandler=function e(){return this.outputFilter},R.setHandler=function e(R){this.outputFilter=R},R.setPAC=function e(R){this.writeScreen.setPAC(R)},R.setBkgData=function e(R){this.writeScreen.setBkgData(R)},R.setMode=function e(R){R!==this.mode&&(this.mode=R,this.logger.log(w.INFO,"MODE="+R),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=R)},R.insertChars=function e(R){for(var C=0;C<R.length;C++)this.writeScreen.insertChar(R[C]);var I=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(w.INFO,I+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(w.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},R.ccRCL=function e(){this.logger.log(w.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},R.ccBS=function e(){this.logger.log(w.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},R.ccAOF=function e(){},R.ccAON=function e(){},R.ccDER=function e(){this.logger.log(w.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},R.ccRU=function e(R){this.logger.log(w.INFO,"RU("+R+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(R)},R.ccFON=function e(){this.logger.log(w.INFO,"FON - Flash On"),this.writeScreen.setPen({"flash":!0})},R.ccRDC=function e(){this.logger.log(w.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},R.ccTR=function e(){this.logger.log(w.INFO,"TR"),this.setMode("MODE_TEXT")},R.ccRTD=function e(){this.logger.log(w.INFO,"RTD"),this.setMode("MODE_TEXT")},R.ccEDM=function e(){this.logger.log(w.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},R.ccCR=function e(){this.logger.log(w.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},R.ccENM=function e(){this.logger.log(w.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},R.ccEOC=function e(){if(this.logger.log(w.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var R=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=R,this.writeScreen=this.nonDisplayedMemory,this.logger.log(w.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},R.ccTO=function e(R){this.logger.log(w.INFO,"TO("+R+") - Tab Offset"),this.writeScreen.moveCursor(R)},R.ccMIDROW=function e(R){var C={"flash":!1};if(C.underline=R%2==1,C.italics=R>=46,C.italics)C.foreground="white";else{var I=Math.floor(R/2)-16;C.foreground=["white","green","blue","cyan","red","yellow","magenta"][I]}this.logger.log(w.INFO,"MIDROW: "+le()(C)),this.writeScreen.setPen(C)},R.outputDataUpdate=function e(R){void 0===R&&(R=!1);var C=this.logger.time;null!==C&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,C,this.lastOutputScreen),R&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:C):this.cueStartTime=C,this.lastOutputScreen.copy(this.displayedMemory))},R.cueSplitAtTime=function e(R){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,R,this.displayedMemory),this.cueStartTime=R))},e}(),q=function(){function e(R,C,I){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var w=new j;this.channels=[null,new z(R,C,w),new z(R+1,I,w)],this.cmdHistory={"a":null,"b":null},this.logger=w}var R=e.prototype;return R.getHandler=function e(R){return this.channels[R].getHandler()},R.setHandler=function e(R,C){this.channels[R].setHandler(C)},R.addData=function e(R,C){var I,x,_,O=!1;this.logger.time=R;for(var F=0;F<C.length;F+=2)if(x=127&C[F],_=127&C[F+1],0!==x||0!==_){if(this.logger.log(w.DATA,"["+K([C[F],C[F+1]])+"] -> ("+K([x,_])+")"),(I=this.parseCmd(x,_))||(I=this.parseMidrow(x,_)),I||(I=this.parsePAC(x,_)),I||(I=this.parseBackgroundAttributes(x,_)),!I&&(O=this.parseChars(x,_))){var P=this.currentChannel;if(P&&P>0)this.channels[P].insertChars(O);else this.logger.log(w.WARNING,"No channel found yet. TEXT-MODE?")}I||O||this.logger.log(w.WARNING,"Couldn't parse cleaned data "+K([x,_])+" orig: "+K([C[F],C[F+1]]))}},R.parseCmd=function e(R,C){var I=this.cmdHistory;if(!((20===R||28===R||21===R||29===R)&&C>=32&&C<=47)&&!((23===R||31===R)&&C>=33&&C<=35))return!1;if(A(R,C,I))return S(null,null,I),this.logger.log(w.DEBUG,"Repeated command ("+K([R,C])+") is dropped"),!0;var x=20===R||21===R||23===R?1:2,_=this.channels[x];return 20===R||21===R||28===R||29===R?32===C?_.ccRCL():33===C?_.ccBS():34===C?_.ccAOF():35===C?_.ccAON():36===C?_.ccDER():37===C?_.ccRU(2):38===C?_.ccRU(3):39===C?_.ccRU(4):40===C?_.ccFON():41===C?_.ccRDC():42===C?_.ccTR():43===C?_.ccRTD():44===C?_.ccEDM():45===C?_.ccCR():46===C?_.ccENM():47===C&&_.ccEOC():_.ccTO(C-32),S(R,C,I),this.currentChannel=x,!0},R.parseMidrow=function e(R,C){var I=0;if((17===R||25===R)&&C>=32&&C<=47){if((I=17===R?1:2)!==this.currentChannel)return this.logger.log(w.ERROR,"Mismatch channel in midrow parsing"),!1;var x=this.channels[I];return!!x&&(x.ccMIDROW(C),this.logger.log(w.DEBUG,"MIDROW ("+K([R,C])+")"),!0)}return!1},R.parsePAC=function e(R,C){var I,w=this.cmdHistory;if(!((R>=17&&R<=23||R>=25&&R<=31)&&C>=64&&C<=127)&&!((16===R||24===R)&&C>=64&&C<=95))return!1;if(A(R,C,w))return S(null,null,w),!0;var x=R<=23?1:2;I=C>=64&&C<=95?1===x?M[R]:B[R]:1===x?N[R]:U[R];var _=this.channels[x];return!!_&&(_.setPAC(this.interpretPAC(I,C)),S(R,C,w),this.currentChannel=x,!0)},R.interpretPAC=function e(R,C){var I,w={"color":null,"italics":!1,"indent":null,"underline":!1,"row":R};return I=C>95?C-96:C-64,w.underline=1==(1&I),I<=13?w.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(I/2)]:I<=15?(w.italics=!0,w.color="white"):w.indent=4*Math.floor((I-16)/2),w},R.parseChars=function e(R,C){var I,x,_=null,F=null;(R>=25?(I=2,F=R-8):(I=1,F=R),F>=17&&F<=19)?(x=17===F?C+80:18===F?C+112:C+144,this.logger.log(w.INFO,"Special char '"+O(x)+"' in channel "+I),_=[x]):R>=32&&R<=127&&(_=0===C?[R]:[R,C]);if(_){var P=K(_);this.logger.log(w.DEBUG,"Char codes =  "+P.join(",")),S(R,C,this.cmdHistory)}return _},R.parseBackgroundAttributes=function e(R,C){var I;if(!((16===R||24===R)&&C>=32&&C<=47)&&!((23===R||31===R)&&C>=45&&C<=47))return!1;var w={};16===R||24===R?(I=Math.floor((C-32)/2),w.background=G[I],C%2==1&&(w.background=w.background+"_semi")):45===C?w.background="transparent":(w.foreground="black",47===C&&(w.underline=!0));var x=R<=23?1:2;return this.channels[x].setBkgData(w),S(R,C,this.cmdHistory),!0},R.reset=function e(){for(var R=0;R<ee()(this.channels).length;R++){var C=this.channels[R];C&&C.reset()}this.cmdHistory={"a":null,"b":null}},R.cueSplitAtTime=function e(R){for(var C=0;C<this.channels.length;C++){var I=this.channels[C];I&&I.cueSplitAtTime(R)}},e}();function S(R,C,I){I.a=R,I.b=C}function A(R,C,I){return I.a===R&&I.b===C}C.default=q},"./src/utils/codecs.ts":function srcUtilsCodecsTs(R,C,I){I.r(C),I.d(C,"isCodecType",(function(){return a})),I.d(C,"isCodecSupportedInMp4",(function(){return n}));var w={"audio":{"a3ds":!0,"ac-3":!0,"ac-4":!0,"alac":!0,"alaw":!0,"dra1":!0,"dts+":!0,"dts-":!0,"dtsc":!0,"dtse":!0,"dtsh":!0,"ec-3":!0,"enca":!0,"g719":!0,"g726":!0,"m4ae":!0,"mha1":!0,"mha2":!0,"mhm1":!0,"mhm2":!0,"mlpa":!0,"mp4a":!0,"raw ":!0,"Opus":!0,"samr":!0,"sawb":!0,"sawp":!0,"sevc":!0,"sqcp":!0,"ssmv":!0,"twos":!0,"ulaw":!0},"video":{"avc1":!0,"avc2":!0,"avc3":!0,"avc4":!0,"avcp":!0,"av01":!0,"drac":!0,"dvav":!0,"dvhe":!0,"encv":!0,"hev1":!0,"hvc1":!0,"mjp2":!0,"mp4v":!0,"mvc1":!0,"mvc2":!0,"mvc3":!0,"mvc4":!0,"resv":!0,"rv60":!0,"s263":!0,"svc1":!0,"svc2":!0,"vc-1":!0,"vp08":!0,"vp09":!0},"text":{"stpp":!0,"wvtt":!0}};function a(R,C){var I=w[C];return!!I&&!0===I[K()(R).call(R,0,4)]}function n(R,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":function srcUtilsCuesTs(R,C,I){I.r(C);var w=I("./src/utils/vttparser.ts"),x=I("./src/utils/webvtt-parser.ts"),_=I("./src/utils/texttrack-utils.ts"),O=/\s/,F={"newCue":function e(R,C,I,F){for(var P,M,N,B,U,G=[],j=self.VTTCue||self.TextTrackCue,K=0;K<F.rows.length;K++)if(N=!0,B=0,U="",!(P=F.rows[K]).isEmpty()){for(var H=0;H<P.chars.length;H++)O.test(P.chars[H].uchar)&&N?B++:(U+=P.chars[H].uchar,N=!1);P.cueStartTime=C,C===I&&(I+=1e-4),B>=16?B--:B++;var V=Object(w.fixLineBreaks)(X()(U).call(U)),W=Object(x.generateCueId)(C,I,V);R&&R.cues&&R.cues.getCueById(W)||((M=new j(C,I,V)).id=W,M.line=K+1,M.align="left",M.position=10+Math.min(80,10*Math.floor(8*B/32)),G.push(M))}return R&&G.length&&(Be()(G).call(G,(function(R,C){return"auto"===R.line||"auto"===C.line?0:R.line>8&&C.line>8?C.line-R.line:R.line-C.line})),ne()(G).call(G,(function(C){return Object(_.addCueToTrack)(R,C)}))),G}};C.default=F},"./src/utils/discontinuities.ts":function srcUtilsDiscontinuitiesTs(R,C,I){I.r(C),I.d(C,"findFirstFragWithCC",(function(){return s})),I.d(C,"shouldAlignOnDiscontinuities",(function(){return o})),I.d(C,"findDiscontinuousReferenceFrag",(function(){return l})),I.d(C,"adjustSlidingStart",(function(){return f})),I.d(C,"alignStream",(function(){return c})),I.d(C,"alignPDT",(function(){return h})),I.d(C,"alignFragmentByPDTDelta",(function(){return v})),I.d(C,"alignMediaPlaylistByPDT",(function(){return g}));var w=I("./src/polyfills/number.ts"),x=I("./src/utils/logger.ts"),_=I("./src/controller/level-helper.ts");function s(R,C){for(var I=null,w=0,x=R.length;w<x;w++){var _=R[w];if(_&&_.cc===C){I=_;break}}return I}function o(R,C,I){return!(!C.details||!(I.endCC>I.startCC||R&&R.cc<I.startCC))}function l(R,C){var I=R.fragments,w=C.fragments;if(w.length&&I.length){var _=s(I,w[0].cc);if(_&&(!_||_.startPTS))return _;x.logger.log("No frag in previous level to align on")}else x.logger.log("No fragments to align")}function u(R,C){if(R){var I=R.start+C;R.start=R.startPTS=I,R.endPTS=I+R.duration}}function f(R,C){for(var I=C.fragments,w=0,x=I.length;w<x;w++)u(I[w],R);C.fragmentHint&&u(C.fragmentHint,R),C.alignedSliding=!0}function c(R,C,I){C&&(!function d(R,C,I){if(o(R,I,C)){var _=l(I.details,C);_&&Object(w.isFiniteNumber)(_.start)&&(x.logger.log("Adjusting PTS using last level due to CC increase within current level "+C.url),f(_.start,C))}}(R,I,C),!I.alignedSliding&&C.details&&h(I,C.details),I.alignedSliding||!C.details||I.skippedSegments||Object(_.adjustSliding)(C.details,I))}function h(R,C){if(C.fragments.length&&R.hasProgramDateTime&&C.hasProgramDateTime){var I=C.fragments[0].programDateTime,_=R.fragments[0].programDateTime,O=(_-I)/1e3+C.fragments[0].start;O&&Object(w.isFiniteNumber)(O)&&(x.logger.log("Adjusting PTS using programDateTime delta "+(_-I)+"ms, sliding:"+O.toFixed(3)+" "+R.url+" "),f(O,R))}}function v(R,C){var I=R.programDateTime;if(I){var w=(I-C)/1e3;R.start=R.startPTS=w,R.endPTS=w+R.duration}}function g(R,C){var I;if(C.fragments.length&&R.hasProgramDateTime&&C.hasProgramDateTime){var w=C.fragments[0].programDateTime-1e3*C.fragments[0].start;ne()(I=R.fragments).call(I,(function(R){v(R,w)})),R.fragmentHint&&v(R.fragmentHint,w),R.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function srcUtilsEwmaBandwidthEstimatorTs(R,C,I){I.r(C);var w=I("./src/utils/ewma.ts"),x=function(){function e(R,C,I){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=I,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new w.default(R),this.fast_=new w.default(C)}var R=e.prototype;return R.update=function e(R,C){var I=this.slow_,x=this.fast_;this.slow_.halfLife!==R&&(this.slow_=new w.default(R,I.getEstimate(),I.getTotalWeight())),this.fast_.halfLife!==C&&(this.fast_=new w.default(C,x.getEstimate(),x.getTotalWeight()))},R.sample=function e(R,C){var I=(R=Math.max(R,this.minDelayMs_))/1e3,w=8*C/I;this.fast_.sample(I,w),this.slow_.sample(I,w)},R.canEstimate=function e(){var R=this.fast_;return R&&R.getTotalWeight()>=this.minWeight_},R.getEstimate=function e(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function e(){},e}();C.default=x},"./src/utils/ewma.ts":function srcUtilsEwmaTs(R,C,I){I.r(C);var w=function(){function e(R,C,I){void 0===C&&(C=0),void 0===I&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=C,this.totalWeight_=I}var R=e.prototype;return R.sample=function e(R,C){var I=Math.pow(this.alpha_,R);this.estimate_=C*(1-I)+I*this.estimate_,this.totalWeight_+=R},R.getTotalWeight=function e(){return this.totalWeight_},R.getEstimate=function e(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},e}();C.default=w},"./src/utils/fetch-loader.ts":function srcUtilsFetchLoaderTs(R,C,I){I.r(C),I.d(C,"fetchSupported",(function(){return v}));var w=I("./src/polyfills/number.ts"),x=I("./src/loader/load-stats.ts"),_=I("./src/demux/chunk-cache.ts");function o(R){var C="function"==typeof Ve()?new(Ve()):void 0;return o=function e(R){if(null===R||!function f(R){var C;return-1!==Ce()(C=Function.toString.call(R)).call(C,"[native code]")}(R))return R;if("function"!=typeof R)throw new TypeError("Super expression must either be null or a function");if(void 0!==C){if(C.has(R))return C.get(R);C.set(R,i)}function i(){return l(R,arguments,d(this).constructor)}return i.prototype=Object.create(R.prototype,{"constructor":{"value":i,"enumerable":!1,"writable":!0,"configurable":!0}}),c(i,R)},o(R)}function l(R,C,I){return l=u()?Ye():function e(R,C,I){var w=[null];w.push.apply(w,C);var x=new(Function.bind.apply(R,w));return I&&c(x,I.prototype),x},l.apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Ye())return!1;if(Ye().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Ye()(Boolean,[],(function(){}))),!0}catch(R){return!1}}function c(R,C){return c=Se()||function e(R,C){return R.__proto__=C,R},c(R,C)}function d(R){return d=Se()?Xe():function e(R){return R.__proto__||Xe()(R)},d(R)}function h(){return h=ge()||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(R[w]=I[w])}return R},h.apply(this,arguments)}function v(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(R){}return!1}var O=function(){function e(R){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=R.fetchSetup||m,this.controller=new self.AbortController,this.stats=new x.LoadStats}var R=e.prototype;return R.destroy=function e(){this.loader=this.callbacks=null,this.abortInternal()},R.abortInternal=function e(){var R=this.response;R&&R.ok||(this.stats.aborted=!0,this.controller.abort())},R.abort=function e(){var R;this.abortInternal(),null!==(R=this.callbacks)&&void 0!==R&&R.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},R.load=function e(R,C,I){var x=this,_=this.stats;if(_.loading.start)throw new Error("Loader can only be used once.");_.loading.start=self.performance.now();var O=function p(R,C){var I={"method":"GET","mode":"cors","credentials":"same-origin","signal":C,"headers":new self.Headers(h({},R.headers))};R.rangeEnd&&I.headers.set("Range","bytes="+R.rangeStart+"-"+String(R.rangeEnd-1));return I}(R,this.controller.signal),P=I.onProgress,M="arraybuffer"===R.responseType,N=M?"byteLength":"length";this.context=R,this.config=C,this.callbacks=I,this.request=this.fetchSetup(R,O),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){x.abortInternal(),I.onTimeout(_,R,x.response)}),C.timeout),self.fetch(this.request).then((function(I){if(x.response=x.loader=I,!I.ok){var O=I.status,N=I.statusText;throw new F(N||"fetch, bad network response",O,I)}return _.loading.first=Math.max(self.performance.now(),_.loading.start),_.total=Re()(I.headers.get("Content-Length")||"0"),P&&Object(w.isFiniteNumber)(C.highWaterMark)?x.loadProgressively(I,_,R,C.highWaterMark,P):M?I.arrayBuffer():I.text()})).then((function(O){var F=x.response;self.clearTimeout(x.requestTimeout),_.loading.end=Math.max(self.performance.now(),_.loading.first),_.loaded=_.total=O[N];var M={"url":F.url,"data":O};P&&!Object(w.isFiniteNumber)(C.highWaterMark)&&P(_,R,O,F),I.onSuccess(M,_,R,F)})).catch((function(C){if(self.clearTimeout(x.requestTimeout),!_.aborted){var w=C.code||0;I.onError({"code":w,"text":C.message},R,C.details)}}))},R.getCacheAge=function e(){var R=null;if(this.response){var C=this.response.headers.get("age");R=C?we()(C):null}return R},R.loadProgressively=function e(R,C,I,w,x){void 0===w&&(w=0);var O=new _.default,F=R.body.getReader();return function e(){return F.read().then((function(_){if(_.done)return O.dataLength&&x(C,I,O.flush(),R),M().resolve(new ArrayBuffer(0));var F=_.value,P=F.length;return C.loaded+=P,P<w||O.dataLength?(O.push(F),O.dataLength>=w&&x(C,I,O.flush(),R)):x(C,I,F,R),e()})).catch((function(){return M().reject()}))}()},e}();function m(R,C){return new self.Request(R.url,C)}var F=function(R){function t(C,I,w){var x;return(x=R.call(this,C)||this).code=void 0,x.details=void 0,x.code=I,x.details=w,x}return function s(R,C){R.prototype=Object.create(C.prototype),R.prototype.constructor=R,c(R,C)}(t,R),t}(o(Error));C.default=O},"./src/utils/imsc1-ttml-parser.ts":function srcUtilsImsc1TtmlParserTs(R,C,I){I.r(C),I.d(C,"IMSC1_CODEC",(function(){return M})),I.d(C,"parseIMSC1",(function(){return v}));var w=I("./src/utils/mp4-tools.ts"),x=I("./src/utils/vttparser.ts"),_=I("./src/utils/vttcue.ts"),O=I("./src/demux/id3.ts"),F=I("./src/utils/timescale-conversion.ts"),P=I("./src/utils/webvtt-parser.ts");function u(){return u=ge()||function(R){for(var C=1;C<arguments.length;C++){var I=arguments[C];for(var w in I)Object.prototype.hasOwnProperty.call(I,w)&&(R[w]=I[w])}return R},u.apply(this,arguments)}var M="stpp.ttml.im1t",N=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,B=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,U={"left":"start","center":"center","right":"end","start":"start","end":"end"};function v(R,C,I,x,_){var P=Object(w.findBox)(new Uint8Array(R),["mdat"]);if(0!==P.length){var M=P[0],N=Object(O.utf8ArrayToStr)(new Uint8Array(R,M.start,M.end-M.start)),B=Object(F.toTimescaleFromScale)(C,1,I);try{x(g(N,B))}catch(R){_(R)}}else _(new Error("Could not parse IMSC1 mdat"))}function g(R,C){var I,w,x=(new DOMParser).parseFromString(R,"text/xml").getElementsByTagName("tt")[0];if(!x)throw new Error("Invalid ttml");var O={"frameRate":30,"subFrameRate":1,"frameRateMultiplier":0,"tickRate":0},F=re()(I=ee()(O)).call(I,(function(R,C){return R[C]=x.getAttribute("ttp:"+C)||O[C],R}),{}),M="preserve"!==x.getAttribute("xml:space"),N=m(p(x,"styling","style")),B=m(p(x,"layout","region")),G=p(x,"body","[begin]");return se()(w=ce()([]).call(G,(function(R){var I=y(R,M);if(!I||!R.hasAttribute("begin"))return null;var w=S(R.getAttribute("begin"),F),x=S(R.getAttribute("dur"),F),O=S(R.getAttribute("end"),F);if(null===w)throw b(R);if(null===O){if(null===x)throw b(R);O=w+x}var G=new _.default(w-C,O-C,I);G.id=Object(P.generateCueId)(G.startTime,G.endTime,G.text);var j=B[R.getAttribute("region")],K=N[R.getAttribute("style")];G.position=10,G.size=80;var H=E(j,K),V=H.textAlign;if(V){var W=U[V];W&&(G.lineAlign=W),G.align=V}return u(G,H),G}))).call(w,(function(R){return null!==R}))}function p(R,C,I){var w=R.getElementsByTagName(C)[0];return w?K()([]).call(w.querySelectorAll(I)):[]}function m(R){return re()(R).call(R,(function(R,C){var I=C.getAttribute("xml:id");return I&&(R[I]=C),R}),{})}function y(R,C){var I;return re()(I=K()([]).call(R.childNodes)).call(I,(function(R,I,w){var x,_;return"br"===I.nodeName&&w?R+"\n":null!==(x=I.childNodes)&&void 0!==x&&x.length?y(I,C):C?R+X()(_=I.textContent).call(_).replace(/\s+/g," "):R+I.textContent}),"")}function E(R,C){var I="http://www.w3.org/ns/ttml#styling",w=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return re()(w).call(w,(function(w,x){var _=T(C,I,x)||T(R,I,x);return _&&(w[x]=_),w}),{})}function T(R,C,I){return R.hasAttributeNS(C,I)?R.getAttributeNS(C,I):null}function b(R){return new Error("Could not parse ttml timestamp "+R)}function S(R,C){if(!R)return null;var I=Object(x.parseTimeStamp)(R);return null===I&&(N.test(R)?I=function A(R,C){var I=N.exec(R),w=(0|I[4])+(0|I[5])/C.subFrameRate;return 3600*(0|I[1])+60*(0|I[2])+(0|I[3])+w/C.frameRate}(R,C):B.test(R)&&(I=function L(R,C){var I=B.exec(R),w=Number(I[1]);switch(I[2]){case"h":return 3600*w;case"m":return 60*w;case"ms":return 1e3*w;case"f":return w/C.frameRate;case"t":return w/C.tickRate}return w}(R,C))),I}},"./src/utils/logger.ts":function srcUtilsLoggerTs(R,C,I){I.r(C),I.d(C,"enableLogs",(function(){return l})),I.d(C,"logger",(function(){return F}));var x=function e(){},_={"trace":x,"debug":x,"log":x,"warn":x,"info":x,"error":x},O=_;function s(R){var C=self.console[R];return C?C.bind(self.console,"["+R+"] >"):x}function l(R){if(self.console&&!0===R||"object"===(0,w.Z)(R)){!function o(R){for(var C=arguments.length,I=new Array(C>1?C-1:0),w=1;w<C;w++)I[w-1]=arguments[w];ne()(I).call(I,(function(C){O[C]=R[C]?R[C].bind(R):s(C)}))}(R,"debug","log","info","warn","error");try{O.log()}catch(R){O=_}}else O=_}var F=_},"./src/utils/mediakeys-helper.ts":function srcUtilsMediakeysHelperTs(R,C,I){var w;I.r(C),I.d(C,"KeySystems",(function(){return w})),I.d(C,"requestMediaKeySystemAccess",(function(){return x})),function(R){R.WIDEVINE="com.widevine.alpha",R.PLAYREADY="com.microsoft.playready"}(w||(w={}));var x="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function srcUtilsMediasourceHelperTs(R,C,I){function i(){return self.MediaSource||self.WebKitMediaSource}I.r(C),I.d(C,"getMediaSource",(function(){return i}))},"./src/utils/mp4-tools.ts":function srcUtilsMp4ToolsTs(R,C,I){I.r(C),I.d(C,"bin2str",(function(){return o})),I.d(C,"readUint16",(function(){return l})),I.d(C,"readUint32",(function(){return u})),I.d(C,"writeUint32",(function(){return f})),I.d(C,"findBox",(function(){return c})),I.d(C,"parseSegmentIndex",(function(){return d})),I.d(C,"parseInitSegment",(function(){return h})),I.d(C,"getStartDTS",(function(){return v})),I.d(C,"getDuration",(function(){return g})),I.d(C,"computeRawDurationFromSamples",(function(){return p})),I.d(C,"offsetStartDTS",(function(){return m})),I.d(C,"segmentValidRange",(function(){return y})),I.d(C,"appendUint8Array",(function(){return E}));var w=I("./src/utils/typed-array.ts"),x=I("./src/loader/fragment.ts"),_=Math.pow(2,32)-1,O=[].push;function o(R){return String.fromCharCode.apply(null,R)}function l(R,C){"data"in R&&(C+=R.start,R=R.data);var I=R[C]<<8|R[C+1];return I<0?65536+I:I}function u(R,C){"data"in R&&(C+=R.start,R=R.data);var I=R[C]<<24|R[C+1]<<16|R[C+2]<<8|R[C+3];return I<0?4294967296+I:I}function f(R,C,I){"data"in R&&(C+=R.start,R=R.data),R[C]=I>>24,R[C+1]=I>>16&255,R[C+2]=I>>8&255,R[C+3]=255&I}function c(R,C){var I,w,x,_=[];if(!C.length)return _;"data"in R?(I=R.data,w=R.start,x=R.end):(w=0,x=(I=R).byteLength);for(var F=w;F<x;){var P=u(I,F),M=P>1?F+P:x;if(o(I.subarray(F+4,F+8))===C[0])if(1===C.length)_.push({"data":I,"start":F+8,"end":M});else{var N=c({"data":I,"start":F+8,"end":M},K()(C).call(C,1));N.length&&O.apply(_,N)}F=M}return _}function d(R){var C=c(R,["moov"])[0],I=C?C.end:null,w=c(R,["sidx"]);if(!w||!w[0])return null;var x=[],_=w[0],O=_.data[0],F=0===O?8:16,P=u(_,F);F+=4;F+=0===O?8:16,F+=2;var M=_.end+0,N=l(_,F);F+=2;for(var B=0;B<N;B++){var U=F,G=u(_,U);U+=4;var j=2147483647&G;if(1===(2147483648&G)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var K=u(_,U);U+=4,x.push({"referenceSize":j,"subsegmentDuration":K,"info":{"duration":K/P,"start":M,"end":M+j-1}}),M+=j,F=U+=4}return{"earliestPresentationTime":0,"timescale":P,"version":O,"referencesCount":N,"references":x,"moovEndOffset":I}}function h(R){for(var C=[],I=c(R,["moov","trak"]),w=0;w<I.length;w++){var _=I[w],O=c(_,["tkhd"])[0];if(O){var F=O.data[O.start],P=0===F?12:20,M=u(O,P),N=c(_,["mdia","mdhd"])[0];if(N){var B=u(N,P=0===(F=N.data[N.start])?12:20),U=c(_,["mdia","hdlr"])[0];if(U){var G=o(U.data.subarray(U.start+8,U.start+12)),j={"soun":x.ElementaryStreamTypes.AUDIO,"vide":x.ElementaryStreamTypes.VIDEO}[G];if(j){var K=c(_,["mdia","minf","stbl","stsd"])[0],H=void 0;K&&(H=o(K.data.subarray(K.start+12,K.start+16))),C[M]={"timescale":B,"type":j},C[j]={"timescale":B,"id":M,"codec":H}}}}}}var V=c(R,["moov","mvex","trex"]);return ne()(V).call(V,(function(R){var I=u(R,4),w=C[I];w&&(w.default={"duration":u(R,12),"flags":u(R,20)})})),C}function v(R,C){var I;return re()(I=c(C,["moof","traf"])).call(I,(function(C,I){var w,x=c(I,["tfdt"])[0],_=x.data[x.start],O=re()(w=c(I,["tfhd"])).call(w,(function(C,I){var w=u(I,4),O=R[w];if(O){var F=u(x,4);1===_&&(F*=Math.pow(2,32),F+=u(x,8));var P=F/(O.timescale||9e4);if(isFinite(P)&&(null===C||P<C))return P}return C}),null);return null!==O&&isFinite(O)&&(null===C||O<C)?O:C}),null)||0}function g(R,C){for(var I=0,w=0,_=0,O=c(R,["moof","traf"]),F=0;F<O.length;F++){var P=O[F],M=c(P,["tfhd"])[0],N=C[u(M,4)];if(N){var B=N.default,U=u(M,0)|(null==B?void 0:rt()(B)),G=null==B?void 0:B.duration;8&U&&(G=u(M,2&U?12:8));for(var j=N.timescale||9e4,K=c(P,["trun"]),H=0;H<K.length;H++){if(!(I=p(K[H]))&&G)I=G*u(K[H],4);N.type===x.ElementaryStreamTypes.VIDEO?w+=I/j:N.type===x.ElementaryStreamTypes.AUDIO&&(_+=I/j)}}}if(0===w&&0===_){var V,W=d(R);if(null!=W&&W.references)return re()(V=W.references).call(V,(function(R,C){return R+C.info.duration||0}),0)}return w||_}function p(R){var C=u(R,0),I=8;1&C&&(I+=4),4&C&&(I+=4);for(var w=0,x=u(R,4),_=0;_<x;_++){if(256&C)w+=u(R,I),I+=4;512&C&&(I+=4),1024&C&&(I+=4),2048&C&&(I+=4)}return w}function m(R,C,I){var w;ne()(w=c(C,["moof","traf"])).call(w,(function(C){var w;ne()(w=c(C,["tfhd"])).call(w,(function(w){var x,O=u(w,4),F=R[O];if(F){var P=F.timescale||9e4;ne()(x=c(C,["tfdt"])).call(x,(function(R){var C=R.data[R.start],w=u(R,4);if(0===C)f(R,4,w-I*P);else{w*=Math.pow(2,32),w+=u(R,8),w-=I*P,w=Math.max(w,0);var x=Math.floor(w/(_+1)),O=Math.floor(w%(_+1));f(R,4,x),f(R,8,O)}}))}}))}))}function y(R){var C={"valid":null,"remainder":null},I=c(R,["moof"]);if(!I)return C;if(I.length<2)return C.remainder=R,C;var x=I[I.length-1];return C.valid=Object(w.sliceUint8)(R,0,x.start-8),C.remainder=Object(w.sliceUint8)(R,x.start-8),C}function E(R,C){var I=new Uint8Array(R.length+C.length);return I.set(R),I.set(C,R.length),I}},"./src/utils/output-filter.ts":function srcUtilsOutputFilterTs(R,C,I){I.r(C),I.d(C,"default",(function(){return w}));var w=function(){function e(R,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=C}var R=e.prototype;return R.dispatchCue=function e(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},R.newCue=function e(R,C,I){(null===this.startTime||this.startTime>R)&&(this.startTime=R),this.endTime=C,this.screen=I,this.timelineController.createCaptionsTrack(this.trackName)},R.reset=function e(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function srcUtilsTexttrackUtilsTs(R,C,I){I.r(C),I.d(C,"sendAddTrackEvent",(function(){return a})),I.d(C,"addCueToTrack",(function(){return n})),I.d(C,"clearCurrentCues",(function(){return s})),I.d(C,"removeCuesInRange",(function(){return o})),I.d(C,"getCuesInRange",(function(){return u}));var w=I("./src/utils/logger.ts");function a(R,C){var I;try{I=new Event("addtrack")}catch(R){(I=document.createEvent("Event")).initEvent("addtrack",!1,!1)}I.track=R,C.dispatchEvent(I)}function n(R,C){var I=R.mode;if("disabled"===I&&(R.mode="hidden"),R.cues&&!R.cues.getCueById(C.id))try{if(R.addCue(C),!R.cues.getCueById(C.id))throw new Error("addCue is failed for: "+C)}catch(I){w.logger.debug("[texttrack-utils]: "+I);var x=new self.TextTrackCue(C.startTime,C.endTime,C.text);x.id=C.id,R.addCue(x)}"disabled"===I&&(R.mode=I)}function s(R){var C=R.mode;if("disabled"===C&&(R.mode="hidden"),R.cues)for(var I=R.cues.length;I--;)R.removeCue(R.cues[I]);"disabled"===C&&(R.mode=C)}function o(R,C,I){var w=R.mode;if("disabled"===w&&(R.mode="hidden"),R.cues&&R.cues.length>0)for(var x=u(R.cues,C,I),_=0;_<x.length;_++)R.removeCue(x[_]);"disabled"===w&&(R.mode=w)}function u(R,C,I){var w=[],x=function l(R,C){if(C<R[0].startTime)return 0;var I=R.length-1;if(C>R[I].endTime)return-1;for(var w=0,x=I;w<=x;){var _=Math.floor((x+w)/2);if(C<R[_].startTime)x=_-1;else{if(!(C>R[_].startTime&&w<I))return _;w=_+1}}return R[w].startTime-C<C-R[x].startTime?w:x}(R,C);if(x>-1)for(var _=x,O=R.length;_<O;_++){var F=R[_];if(F.startTime>=C&&F.endTime<=I)w.push(F);else if(F.startTime>I)return w}return w}},"./src/utils/time-ranges.ts":function srcUtilsTimeRangesTs(R,C,I){I.r(C);C.default={"toString":function e(R){for(var C="",I=R.length,w=0;w<I;w++)C+="["+R.start(w).toFixed(3)+","+R.end(w).toFixed(3)+"]";return C}}},"./src/utils/timescale-conversion.ts":function srcUtilsTimescaleConversionTs(R,C,I){I.r(C),I.d(C,"toTimescaleFromBase",(function(){return a})),I.d(C,"toTimescaleFromScale",(function(){return n})),I.d(C,"toMsFromMpegTsClock",(function(){return s})),I.d(C,"toMpegTsClockFromTimescale",(function(){return o}));function a(R,C,I,w){void 0===I&&(I=1),void 0===w&&(w=!1);var x=R*C*I;return w?Math.round(x):x}function n(R,C,I,w){return void 0===I&&(I=1),void 0===w&&(w=!1),a(R,C,1/I,w)}function s(R,C){return void 0===C&&(C=!1),a(R,1e3,1/9e4,C)}function o(R,C){return void 0===C&&(C=1),a(R,9e4,1/C)}},"./src/utils/typed-array.ts":function srcUtilsTypedArrayTs(R,C,I){function i(R,C,I){return K()(Uint8Array.prototype)?K()(R).call(R,C,I):new Uint8Array(K()(Array.prototype).call(R,C,I))}I.r(C),I.d(C,"sliceUint8",(function(){return i}))},"./src/utils/vttcue.ts":function srcUtilsVttcueTs(R,C,I){I.r(C),C.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var R=["","lr","rl"],C=["start","middle","end","left","right"];function r(R,C){if("string"!=typeof C)return!1;if(!Array.isArray(R))return!1;var I=C.toLowerCase();return!!~Ce()(R).call(R,I)&&I}function i(C){return r(R,C)}function a(R){return r(C,R)}function n(R){for(var C=arguments.length,I=new Array(C>1?C-1:0),w=1;w<C;w++)I[w-1]=arguments[w];for(var x=1;x<arguments.length;x++){var _=arguments[x];for(var O in _)R[O]=_[O]}return R}function s(R,C,I){var w=this,x={"enumerable":!0};w.hasBeenReset=!1;var _="",O=!1,F=R,P=C,M=I,N=null,U="",G=!0,j="auto",K="start",H=50,V="middle",W=50,Y="middle";B()(w,"id",n({},x,{"get":function e(){return _},"set":function e(R){_=""+R}})),B()(w,"pauseOnExit",n({},x,{"get":function e(){return O},"set":function e(R){O=!!R}})),B()(w,"startTime",n({},x,{"get":function e(){return F},"set":function e(R){if("number"!=typeof R)throw new TypeError("Start time must be set to a number.");F=R,this.hasBeenReset=!0}})),B()(w,"endTime",n({},x,{"get":function e(){return P},"set":function e(R){if("number"!=typeof R)throw new TypeError("End time must be set to a number.");P=R,this.hasBeenReset=!0}})),B()(w,"text",n({},x,{"get":function e(){return M},"set":function e(R){M=""+R,this.hasBeenReset=!0}})),B()(w,"region",n({},x,{"get":function e(){return N},"set":function e(R){N=R,this.hasBeenReset=!0}})),B()(w,"vertical",n({},x,{"get":function e(){return U},"set":function e(R){var C=i(R);if(!1===C)throw new SyntaxError("An invalid or illegal string was specified.");U=C,this.hasBeenReset=!0}})),B()(w,"snapToLines",n({},x,{"get":function e(){return G},"set":function e(R){G=!!R,this.hasBeenReset=!0}})),B()(w,"line",n({},x,{"get":function e(){return j},"set":function e(R){if("number"!=typeof R&&"auto"!==R)throw new SyntaxError("An invalid number or illegal string was specified.");j=R,this.hasBeenReset=!0}})),B()(w,"lineAlign",n({},x,{"get":function e(){return K},"set":function e(R){var C=a(R);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");K=C,this.hasBeenReset=!0}})),B()(w,"position",n({},x,{"get":function e(){return H},"set":function e(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");H=R,this.hasBeenReset=!0}})),B()(w,"positionAlign",n({},x,{"get":function e(){return V},"set":function e(R){var C=a(R);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");V=C,this.hasBeenReset=!0}})),B()(w,"size",n({},x,{"get":function e(){return W},"set":function e(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");W=R,this.hasBeenReset=!0}})),B()(w,"align",n({},x,{"get":function e(){return Y},"set":function e(R){var C=a(R);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");Y=C,this.hasBeenReset=!0}})),w.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}()},"./src/utils/vttparser.ts":function srcUtilsVttparserTs(R,C,I){I.r(C),I.d(C,"parseTimeStamp",(function(){return n})),I.d(C,"fixLineBreaks",(function(){return c})),I.d(C,"VTTParser",(function(){return P}));var w=I("./src/utils/vttcue.ts"),x=function(){function e(){}return e.prototype.decode=function e(R,C){if(!R)return"";if("string"!=typeof R)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(R))},e}();function n(R){function t(R,C,I,w){return 3600*(0|R)+60*(0|C)+(0|I)+we()(w||0)}var C=R.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return C?we()(C[2])>59?t(C[2],C[3],0,C[4]):t(C[1],C[2],C[3],C[4]):null}var _=function(){function e(){this.values=Object.create(null)}var R=e.prototype;return R.set=function e(R,C){this.get(R)||""===C||(nt()(this)[R]=C)},R.get=function e(R,C,I){return I?this.has(R)?nt()(this)[R]:C[I]:this.has(R)?nt()(this)[R]:C},R.has=function e(R){return R in nt()(this)},R.alt=function e(R,C,I){for(var w=0;w<I.length;++w)if(C===I[w]){this.set(R,C);break}},R.integer=function e(R,C){/^-?\d+$/.test(C)&&this.set(R,Re()(C,10))},R.percent=function e(R,C){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(C)){var e=we()(C);if(e>=0&&e<=100)return this.set(R,e),!0}return!1},e}();function o(R,C,I,w){var x=w?R.split(w):[R];for(var _ in x)if("string"==typeof x[_]){var O=x[_].split(I);if(2===O.length)C(O[0],O[1])}}var O=new w.default(0,0,""),F="middle"===O.align?"middle":"center";function f(R,C,I){var w=R;function a(){var C=n(R);if(null===C)throw new Error("Malformed timestamp: "+w);return R=R.replace(/^[^\sa-zA-Z-]+/,""),C}function c(){R=R.replace(/^\s+/,"")}if(c(),C.startTime=a(),c(),"--\x3e"!==R.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+w);R=R.substr(3),c(),C.endTime=a(),c(),function f(R,C){var w=new _;o(R,(function(R,C){var x;switch(R){case"region":for(var _=I.length-1;_>=0;_--)if(I[_].id===C){w.set(R,I[_].region);break}break;case"vertical":w.alt(R,C,["rl","lr"]);break;case"line":x=C.split(","),w.integer(R,x[0]),w.percent(R,x[0])&&w.set("snapToLines",!1),w.alt(R,x[0],["auto"]),2===x.length&&w.alt("lineAlign",x[1],["start",F,"end"]);break;case"position":x=C.split(","),w.percent(R,x[0]),2===x.length&&w.alt("positionAlign",x[1],["start",F,"end","line-left","line-right","auto"]);break;case"size":w.percent(R,C);break;case"align":w.alt(R,C,["start",F,"end","left","right"])}}),/:/,/\s/),C.region=w.get("region",null),C.vertical=w.get("vertical","");var x=w.get("line","auto");"auto"===x&&-1===O.line&&(x=-1),C.line=x,C.lineAlign=w.get("lineAlign","start"),C.snapToLines=w.get("snapToLines",!0),C.size=w.get("size",100),C.align=w.get("align",F);var P=w.get("position","auto");"auto"===P&&50===O.position&&(P="start"===C.align||"left"===C.align?0:"end"===C.align||"right"===C.align?100:50),C.position=P}(R,C)}function c(R){return R.replace(/<br(?: \/)?>/gi,"\n")}var P=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new x,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var R=e.prototype;return R.parse=function e(R){var C=this;function a(){var R=C.buffer,I=0;for(R=c(R);I<R.length&&"\r"!==R[I]&&"\n"!==R[I];)++I;var w=R.substr(0,I);return"\r"===R[I]&&++I,"\n"===R[I]&&++I,C.buffer=R.substr(I),w}function n(R){o(R,(function(R,C){}),/:/)}R&&(C.buffer+=C.decoder.decode(R,{"stream":!0}));try{var I="";if("INITIAL"===C.state){if(!/\r\n|\n/.test(C.buffer))return this;var x=(I=a()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!x||!x[0])throw new Error("Malformed WebVTT signature.");C.state="HEADER"}for(var _=!1;C.buffer;){if(!/\r\n|\n/.test(C.buffer))return this;switch(_?_=!1:I=a(),C.state){case"HEADER":/:/.test(I)?n(I):I||(C.state="ID");continue;case"NOTE":I||(C.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(I)){C.state="NOTE";break}if(!I)continue;if(C.cue=new w.default(0,0,""),C.state="CUE",-1===Ce()(I).call(I,"--\x3e")){C.cue.id=I;continue}case"CUE":if(!C.cue){C.state="BADCUE";continue}try{f(I,C.cue,C.regionList)}catch(e){C.cue=null,C.state="BADCUE";continue}C.state="CUETEXT";continue;case"CUETEXT":var O=-1!==Ce()(I).call(I,"--\x3e");if(!I||O&&(_=!0)){C.oncue&&C.cue&&C.oncue(C.cue),C.cue=null,C.state="ID";continue}if(null===C.cue)continue;C.cue.text&&(C.cue.text+="\n"),C.cue.text+=I;continue;case"BADCUE":I||(C.state="ID")}}}catch(e){"CUETEXT"===C.state&&C.cue&&C.oncue&&C.oncue(C.cue),C.cue=null,C.state="INITIAL"===C.state?"BADWEBVTT":"BADCUE"}return this},R.flush=function e(){var R=this;try{if((R.cue||"HEADER"===R.state)&&(R.buffer+="\n\n",R.parse()),"INITIAL"===R.state||"BADWEBVTT"===R.state)throw new Error("Malformed WebVTT signature.")}catch(e){R.onparsingerror&&R.onparsingerror(e)}return R.onflush&&R.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":function srcUtilsWebvttParserTs(R,C,I){I.r(C),I.d(C,"generateCueId",(function(){return d})),I.d(C,"parseWebVTT",(function(){return v}));var w=I("./src/polyfills/number.ts"),x=I("./src/utils/vttparser.ts"),_=I("./src/demux/id3.ts"),O=I("./src/utils/timescale-conversion.ts"),F=I("./src/remux/mp4-remuxer.ts"),P=/\r\n|\n\r|\n|\r/g,M=function e(R,C,I){return void 0===I&&(I=0),R.substr(I,C.length)===C},N=function e(R){var C=Re()(R.substr(-3)),I=Re()(R.substr(-6,2)),x=Re()(R.substr(-9,2)),_=R.length>9?Re()(R.substr(0,Ce()(R).call(R,":"))):0;if(!(Object(w.isFiniteNumber)(C)&&Object(w.isFiniteNumber)(I)&&Object(w.isFiniteNumber)(x)&&Object(w.isFiniteNumber)(_)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+R);return C+=1e3*I,C+=6e4*x,C+=36e5*_},B=function e(R){for(var e=5381,C=R.length;C;)e=33*e^R.charCodeAt(--C);return(e>>>0).toString()};function d(R,C,I){return B(R.toString())+B(C.toString())+B(I)}function v(R,C,I,w,B,U,G,j){var K,H,V=new x.VTTParser,W=X()(K=Object(_.utf8ArrayToStr)(new Uint8Array(R))).call(K).replace(P,"\n").split("\n"),Y=[],z=Object(O.toMpegTsClockFromTimescale)(C,I),q="00:00.000",Z=0,Q=0,J=!0,$=!1;V.oncue=function(R){var C,I=w[B],x=w.ccOffset,_=(Z-z)/9e4;if(null!=I&&I.new&&(void 0!==Q?x=w.ccOffset=I.start:function e(R,C,I){var w=R[C],x=R[w.prevCC];if(!x||!x.new&&w.new)return R.ccOffset=R.presentationOffset=w.start,void(w.new=!1);for(;null!==(_=x)&&void 0!==_&&_.new;){var _;R.ccOffset+=w.start-x.start,w.new=!1,x=R[(w=x).prevCC]}R.presentationOffset=I}(w,B,_)),_&&(x=_-w.presentationOffset),$){var O=R.endTime-R.startTime,P=Object(F.normalizePts)(9e4*(R.startTime+x-Q),9e4*U)/9e4;R.startTime=P,R.endTime=P+O}var M=X()(C=R.text).call(C);R.text=decodeURIComponent(encodeURIComponent(M)),R.id||(R.id=d(R.startTime,R.endTime,M)),R.endTime>0&&Y.push(R)},V.onparsingerror=function(R){H=R},V.onflush=function(){H?j(H):G(Y)},ne()(W).call(W,(function(R){if(J){if(M(R,"X-TIMESTAMP-MAP=")){var C;J=!1,$=!0,ne()(C=R.substr(16).split(",")).call(C,(function(R){M(R,"LOCAL:")?q=R.substr(6):M(R,"MPEGTS:")&&(Z=Re()(R.substr(7)))}));try{Q=N(q)/1e3}catch(R){$=!1,H=R}return}""===R&&(J=!1)}V.parse(R+"\n")})),V.flush()}},"./src/utils/xhr-loader.ts":function srcUtilsXhrLoaderTs(R,C,I){I.r(C);var w=I("./src/utils/logger.ts"),x=I("./src/loader/load-stats.ts"),_=/^age:\s*[\d.]+\s*$/m,O=function(){function e(R){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=R?R.xhrSetup:null,this.stats=new x.LoadStats,this.retryDelay=0}var R=e.prototype;return R.destroy=function e(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function e(){var R=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),R&&(R.onreadystatechange=null,R.onprogress=null,4!==R.readyState&&(this.stats.aborted=!0,R.abort()))},R.abort=function e(){var R;this.abortInternal(),null!==(R=this.callbacks)&&void 0!==R&&R.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function e(R,C,I){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=R,this.config=C,this.callbacks=I,this.retryDelay=C.retryDelay,this.loadInternal()},R.loadInternal=function e(){var R=this.config,C=this.context;if(R){var I=this.loader=new self.XMLHttpRequest,w=this.stats;w.loading.first=0,w.loaded=0;var x=this.xhrSetup;try{if(x)try{x(I,C.url)}catch(e){I.open("GET",C.url,!0),x(I,C.url)}I.readyState||I.open("GET",C.url,!0);var _=this.context.headers;if(_)for(var O in _)I.setRequestHeader(O,_[O])}catch(e){return void this.callbacks.onError({"code":I.status,"text":e.message},C,I)}C.rangeEnd&&I.setRequestHeader("Range","bytes="+C.rangeStart+"-"+(C.rangeEnd-1)),I.onreadystatechange=this.readystatechange.bind(this),I.onprogress=this.loadprogress.bind(this),I.responseType=C.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),R.timeout),I.send()}},R.readystatechange=function e(){var R=this.context,C=this.loader,I=this.stats;if(R&&C){var x=C.readyState,_=this.config;if(!I.aborted&&x>=2)if(self.clearTimeout(this.requestTimeout),0===I.loading.first&&(I.loading.first=Math.max(self.performance.now(),I.loading.start)),4===x){C.onreadystatechange=null,C.onprogress=null;var O=C.status;if(O>=200&&O<300){var F,P;if(I.loading.end=Math.max(self.performance.now(),I.loading.first),P="arraybuffer"===R.responseType?(F=C.response).byteLength:(F=C.responseText).length,I.loaded=I.total=P,!this.callbacks)return;var M=this.callbacks.onProgress;if(M&&M(I,R,F,C),!this.callbacks)return;var N={"url":C.responseURL,"data":F};this.callbacks.onSuccess(N,I,R,C)}else I.retry>=_.maxRetry||O>=400&&O<499?(w.logger.error(O+" while loading "+R.url),this.callbacks.onError({"code":O,"text":C.statusText},R,C)):(w.logger.warn(O+" while loading "+R.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,_.maxRetryDelay),I.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout)}},R.loadtimeout=function e(){w.logger.warn("timeout while loading "+this.context.url);var R=this.callbacks;R&&(this.abortInternal(),R.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function e(R){var C=this.stats;C.loaded=R.loaded,R.lengthComputable&&(C.total=R.total)},R.getCacheAge=function e(){var R=null;if(this.loader&&_.test(this.loader.getAllResponseHeaders())){var C=this.loader.getResponseHeader("age");R=C?we()(C):null}return R},e}();C.default=O}}).default}))})),pt=(0,lt.g)(vt),__awaiter$1=function(R,C,I,w){function a(R){return R instanceof I?R:new I((function(C){C(R)}))}return new(I||(I=M()))((function(I,x){function s(R){try{l(w.next(R))}catch(R){x(R)}}function o(R){try{l(w.throw(R))}catch(R){x(R)}}function l(R){R.done?I(R.value):a(R.value).then(s,o)}l((w=w.apply(R,C||[])).next())}))},mt=function(){function e(R){var C=this;(0,ot.r)(this,R),this.onPlay=(0,ot.c)(this,"play",7),this.onPause=(0,ot.c)(this,"pause",7),this.onEnded=(0,ot.c)(this,"ended",7),this.onTimeUpdate=(0,ot.c)(this,"timeupdate",7),this.onError=(0,ot.c)(this,"error",7),this.onFullScreenChange=(0,ot.c)(this,"fullscreenchange",7),this.onProgress=(0,ot.c)(this,"progress",7),this.onLoadedMetaData=(0,ot.c)(this,"loadedmetadata",7),this.currentTime=0,this.isDraggingProgress=!1,this.gestureType="none",this.controls=!0,this.autoplay=!1,this.loop=!1,this.muted=!1,this.initialTime=0,this.objectFit="contain",this.showProgress=!0,this.showFullscreenBtn=!0,this.showPlayBtn=!0,this.showCenterPlayBtn=!0,this.showMuteBtn=!1,this.danmuBtn=!1,this.enableDanmu=!1,this.enablePlayGesture=!1,this.enableProgressGesture=!0,this.vslideGesture=!1,this.vslideGestureInFullscreen=!0,this.nativeProps={},this._enableDanmu=!1,this.isPlaying=!1,this.isFirst=!0,this.isFullScreen=!1,this.fullScreenTimestamp=(new Date).getTime(),this.isMute=!1,this.analyzeGesture=function(R){var I,w={"type":"none"},x=R.touches[0].screenX,_=R.touches[0].screenY,O=x-C.lastTouchScreenX,F=_-C.lastTouchScreenY,P=C.isFullScreen?C.vslideGestureInFullscreen:C.vslideGesture;if("none"===C.gestureType){var M=function calcDist(R,C){return Math.sqrt(Math.pow(R,2)+Math.pow(C,2))}(O,F);if(M<10)return w;if(Math.abs(F)>=Math.abs(O)){if(!P)return w;C.gestureType="adjustVolume",C.lastVolume=C.videoRef.volume}else if(Math.abs(F)<Math.abs(O)){if(!C.enableProgressGesture)return w;C.gestureType="adjustProgress",C.lastPercentage=C.currentTime/(null!==(I=C.duration)&&void 0!==I?I:C._duration)}}return w.type=C.gestureType,w.dataX=dt(O/200),w.dataY=dt(F/200),w},this.loadNativePlayer=function(){C.videoRef&&(C.videoRef.src=C.src,C.videoRef.load())},this.init=function(){var R=C,I=R.src,w=R.videoRef;!function isHls(R){return/\.(m3u8)($|\?)/i.test(R)}(I)?C.loadNativePlayer():pt.isSupported()?(C.hls&&C.hls.destroy(),C.hls=new pt,C.hls.loadSource(I),C.hls.attachMedia(w),C.hls.on(pt.Events.MANIFEST_PARSED,(function(){C.autoplay&&C.play()})),C.hls.on(pt.Events.ERROR,(function(R,I){C.handleError(I)}))):w.canPlayType("application/vnd.apple.mpegurl")?C.loadNativePlayer():console.error("该浏览器不支持 HLS 播放")},this.handlePlay=function(){C.isPlaying=!0,C.isFirst=!1,C.controlsRef.toggleVisibility(!0),C.onPlay.emit()},this.handlePause=function(){C.isPlaying=!1,C.controlsRef.toggleVisibility(!0),C.onPause.emit()},this.handleEnded=function(){C.isFirst=!0,C.pause(),C.controlsRef.toggleVisibility(),C.onEnded.emit()},this.handleTimeUpdate=(0,ut.t)((function(R){return __awaiter$1(C,void 0,void 0,(function(){var C,I,w,x;return __generator(this,(function(_){switch(_.label){case 0:return this.currentTime=this.videoRef.currentTime,w=this.duration||this._duration,[4,this.controlsRef.getIsDraggingProgressBall()];case 1:return x=_.sent(),this.controls&&this.showProgress&&(x||this.isDraggingProgress||(this.controlsRef.setProgressBall(this.currentTime/w),this.controlsRef.setCurrentTime(this.currentTime))),this.danmuRef.tick(this.currentTime),this.onTimeUpdate.emit({"duration":null===(C=R.target)||void 0===C?void 0:C.duration,"currentTime":null===(I=R.target)||void 0===I?void 0:I.currentTime}),this.duration&&this.currentTime>=this.duration&&(this.seek(0),this.handleEnded()),[2]}}))}))}),250),this.handleError=function(R){var I,w;if(C.hls)switch(R.type){case pt.ErrorTypes.NETWORK_ERROR:C.onError.emit({"errMsg":R.response}),C.hls.startLoad();break;case pt.ErrorTypes.MEDIA_ERROR:C.onError.emit({"errMsg":R.reason||"媒体错误,请重试"}),C.hls.recoverMediaError()}else C.onError.emit({"errMsg":null===(w=null===(I=R.target)||void 0===I?void 0:I.error)||void 0===w?void 0:w.message})},this.handleDurationChange=function(){C._duration=C.videoRef.duration},this.handleProgress=function(){C.onProgress.emit()},this.handleLoadedMetaData=function(R){var I=R.target;C.onLoadedMetaData.emit({"width":I.videoWidth,"height":I.videoHeight,"duration":I.duration})},this._play=function(){return C.videoRef.play()},this._pause=function(){return C.videoRef.pause()},this._stop=function(){C.videoRef.pause(),C._seek(0)},this._seek=function(R){C.videoRef.currentTime=R},this.onTouchStartContainer=function(R){C.lastTouchScreenX=R.touches[0].screenX,C.lastTouchScreenY=R.touches[0].screenY},this.onClickContainer=function(){if(C.enablePlayGesture){var R=Date.now();R-C.lastClickedTime<300&&(C.isPlaying?C.pause():C.play()),C.lastClickedTime=R}C.controlsRef.toggleVisibility()},this.onClickFullScreenBtn=function(R){R.stopPropagation(),C.toggleFullScreen()},this.handleFullScreenChange=function(R){var I=(new Date).getTime();!R.detail&&C.isFullScreen&&!document[ft.fullscreenElement]&&I-C.fullScreenTimestamp>100&&C.toggleFullScreen(!1)},this.toggleFullScreen=function(R){void 0===R&&(R=!C.isFullScreen),C.isFullScreen=R,C.controlsRef.toggleVisibility(!0),C.fullScreenTimestamp=(new Date).getTime(),C.onFullScreenChange.emit({"fullScreen":C.isFullScreen,"direction":"vertical"}),C.isFullScreen&&!document[ft.fullscreenElement]&&setTimeout((function(){C.videoRef[ft.requestFullscreen]({"navigationUI":"auto"})}),0)},this.toggleMute=function(R){R.stopPropagation(),C.videoRef.muted=!C.isMute,C.controlsRef.toggleVisibility(!0),C.isMute=!C.isMute},this.toggleDanmu=function(R){R.stopPropagation(),C.controlsRef.toggleVisibility(!0),C._enableDanmu=!C._enableDanmu}}return e.prototype.componentWillLoad=function(){this._enableDanmu=this.enableDanmu},e.prototype.componentDidLoad=function(){this.init(),this.initialTime&&(this.videoRef.currentTime=this.initialTime),this.danmuRef.sendDanmu(this.danmuList),document.addEventListener&&document.addEventListener(ft.fullscreenchange,this.handleFullScreenChange),this.videoRef&&"iOS"===ht&&this.videoRef.addEventListener("webkitendfullscreen",this.handleFullScreenChange)},e.prototype.componentDidRender=function(){},e.prototype.disconnectedCallback=function(){document.removeEventListener&&document.removeEventListener(ft.fullscreenchange,this.handleFullScreenChange),this.videoRef&&"iOS"===ht&&this.videoRef.removeEventListener("webkitendfullscreen",this.handleFullScreenChange)},e.prototype.watchEnableDanmu=function(R){this._enableDanmu=R},e.prototype.watchSrc=function(){this.init()},e.prototype.onDocumentTouchMove=function(R){return __awaiter$1(this,void 0,void 0,(function(){var C,I,w;return __generator(this,(function(x){switch(x.label){case 0:return void 0===this.lastTouchScreenX||void 0===this.lastTouchScreenY?[2]:[4,this.controlsRef.getIsDraggingProgressBall()];case 1:return x.sent()||("adjustVolume"===(C=this.analyzeGesture(R)).type?(this.toastVolumeRef.style.visibility="visible",I=Math.max(Math.min(this.lastVolume-C.dataY,1),0),this.videoRef.volume=I,this.toastVolumeBarRef.style.width=100*I+"%"):"adjustProgress"===C.type&&(this.isDraggingProgress=!0,this.nextPercentage=Math.max(Math.min(this.lastPercentage+C.dataX,1),0),this.controls&&this.showProgress&&(this.controlsRef.setProgressBall(this.nextPercentage),this.controlsRef.toggleVisibility(!0)),w=this.duration||this._duration,this.toastProgressTitleRef.innerHTML=ct(this.nextPercentage*w)+" / "+ct(w),this.toastProgressRef.style.visibility="visible")),[2]}}))}))},e.prototype.onDocumentTouchEnd=function(){var R;"adjustVolume"===this.gestureType?this.toastVolumeRef.style.visibility="hidden":"adjustProgress"===this.gestureType&&(this.toastProgressRef.style.visibility="hidden"),this.isDraggingProgress&&(this.isDraggingProgress=!1,this.seek(this.nextPercentage*(null!==(R=this.duration)&&void 0!==R?R:this._duration))),this.gestureType="none",this.lastTouchScreenX=void 0,this.lastTouchScreenY=void 0},e.prototype.play=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this._play(),[2]}))}))},e.prototype.pause=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this._pause(),[2]}))}))},e.prototype.stop=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this._stop(),[2]}))}))},e.prototype.seek=function(R){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(C){return this._seek(R),[2]}))}))},e.prototype.requestFullScreen=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this.toggleFullScreen(!0),[2]}))}))},e.prototype.exitFullScreen=function(){return __awaiter$1(this,void 0,void 0,(function(){return __generator(this,(function(R){return this.toggleFullScreen(!1),[2]}))}))},e.prototype.render=function(){var R,C,I=this,w=this,x=w.controls,_=w.autoplay,O=w.loop,F=w.muted,P=w.poster,M=w.objectFit,N=w.isFirst,B=w.isMute,U=w.isFullScreen,G=w.showCenterPlayBtn,j=w.isPlaying,K=w._enableDanmu,H=w.showMuteBtn,V=w.danmuBtn,W=w.showFullscreenBtn,Y=w.nativeProps,z=this.duration||this._duration,X=ct(z);return(0,ot.h)(ot.H,{"class":(0,lt.c)("taro-video-container",{"taro-video-type-fullscreen":U}),"onTouchStart":this.onTouchStartContainer,"onClick":this.onClickContainer},(0,ot.h)("video",ge()({"class":"taro-video-video","style":{"object-fit":M},"ref":function ref(R){R&&(I.videoRef=R)},"autoplay":_,"loop":O,"muted":F,"poster":x?P:void 0,"playsinline":!0,"webkit-playsinline":!0,"onPlay":this.handlePlay,"onPause":this.handlePause,"onEnded":this.handleEnded,"onTimeUpdate":this.handleTimeUpdate,"onError":this.handleError,"onDurationChange":this.handleDurationChange,"onProgress":this.handleProgress,"onLoadedMetaData":this.handleLoadedMetaData},Y),"暂时不支持播放该视频"),(0,ot.h)("taro-video-danmu",{"ref":function ref(R){R&&(I.danmuRef=R)},"enable":K}),N&&G&&!j&&(0,ot.h)("div",{"class":"taro-video-cover"},(0,ot.h)("div",{"class":"taro-video-cover-play-button","onClick":function onClick(){return I.play()}}),(0,ot.h)("p",{"class":"taro-video-cover-duration"},X)),(0,ot.h)("taro-video-control",{"ref":function ref(R){R&&(I.controlsRef=R)},"controls":x,"currentTime":this.currentTime,"duration":z,"isPlaying":this.isPlaying,"pauseFunc":this._pause,"playFunc":this._play,"seekFunc":this._seek,"showPlayBtn":this.showPlayBtn,"showProgress":this.showProgress},H&&(0,ot.h)("div",{"class":(0,lt.c)("taro-video-mute",{"taro-video-type-mute":B}),"onClick":this.toggleMute}),V&&(0,ot.h)("div",{"class":(0,lt.c)("taro-video-danmu-button",{"taro-video-danmu-button-active":K}),"onClick":this.toggleDanmu},"弹幕"),W&&(0,ot.h)("div",{"class":(0,lt.c)("taro-video-fullscreen",{"taro-video-type-fullscreen":U}),"onClick":this.onClickFullScreenBtn})),(0,ot.h)("div",{"class":"taro-video-toast taro-video-toast-volume","ref":function ref(R){R&&(I.toastVolumeRef=R)}},(0,ot.h)("div",{"class":"taro-video-toast-title"},"音量"),(0,ot.h)("div",{"class":"taro-video-toast-icon"}),(0,ot.h)("div",{"class":"taro-video-toast-value"},(0,ot.h)("div",{"class":"taro-video-toast-value-content","ref":function ref(R){R&&(I.toastVolumeBarRef=R)}},(0,ot.h)("div",{"class":"taro-video-toast-volume-grids"},ce()(R=st()(C=Array(10)).call(C,1)).call(R,(function(){return(0,ot.h)("div",{"class":"taro-video-toast-volume-grids-item"})})))))),(0,ot.h)("div",{"class":"taro-video-toast taro-video-toast-progress","ref":function ref(R){R&&(I.toastProgressRef=R)}},(0,ot.h)("div",{"class":"taro-video-toast-title","ref":function ref(R){R&&(I.toastProgressTitleRef=R)}})))},B()(e.prototype,"el",{"get":function get(){return(0,ot.g)(this)},"enumerable":!1,"configurable":!0}),B()(e,"watchers",{"get":function get(){return{"enableDanmu":["watchEnableDanmu"],"src":["watchSrc"]}},"enumerable":!1,"configurable":!0}),e}();mt.style='.taro-video{display:inline-block;overflow:hidden;position:relative;width:100%;height:225px;line-height:0}.taro-video[hidden]{display:none}.taro-video-container{display:inline-block;position:absolute;left:0;top:0;width:100%;height:100%;background-color:#000;-o-object-position:inherit;object-position:inherit}.taro-video-container.taro-video-type-fullscreen{position:fixed;left:0;right:0;top:0;bottom:0;z-index:999}.taro-video-container.taro-video-type-fullscreen.taro-video-type-rotate-left{-webkit-transform:translate(-50%, -50%) rotate(-90deg);transform:translate(-50%, -50%) rotate(-90deg)}.taro-video-container.taro-video-type-fullscreen.taro-video-type-rotate-right{-webkit-transform:translate(-50%, -50%) rotate(90deg);transform:translate(-50%, -50%) rotate(90deg)}.taro-video-video{width:100%;height:100%;-o-object-position:inherit;object-position:inherit}.taro-video-cover{display:-ms-flexbox;display:flex;position:absolute;left:0;top:0;bottom:0;z-index:1;-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;width:100%;background-color:rgba(1, 1, 1, 0.5);-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-box-pack:center;-webkit-box-align:center}.taro-video-cover-play-button{width:40px;height:40px;background-repeat:no-repeat;background-position:50% 50%;background-size:50%}.taro-video-cover-duration{margin-top:10px;line-height:1;font-size:16px;color:#fff}.taro-video-bar{display:-ms-flexbox;display:flex;visibility:hidden;overflow:hidden;position:absolute;right:0;bottom:0;z-index:1;-ms-flex-align:center;align-items:center;padding:0 10px;height:44px;background-color:rgba(0, 0, 0, 0.5);-webkit-box-align:center}.taro-video-bar.taro-video-bar-full{left:0}.taro-video-controls{display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;margin:0 8.5px}.taro-video-control-button{-webkit-box-sizing:content-box;box-sizing:content-box;margin-left:-8.5px;padding:14.5px 12.5px;width:13px;height:15px}.taro-video-control-button::after{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50% 50%;background-size:100%;content:""}.taro-video-control-button.taro-video-control-button-play::after,.taro-video-cover-play-button{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAeCAYAAAAy2w7YAAAAAXNSR0IArs4c6QAAAWhJREFUSA1j+P///0cgBoHjQGzCQCsAtgJB/AMy5wCxGNXtQ9iBwvoA5BUCMQvVLEQxHpNzDSjkRhXLMM3GKrIeKKpEkYVYjcUu+AMo3ALE3GRZiN1MvKKPgbIRJFuG10j8koeA0gZEW4jfLIKyf4EqpgOxMEELCRpFnIJ3QGU5QMyM00LizCFa1SWgSkeslhFtBGkKVwGVy6FYSJp+klR/A6quB2JOkIWMIK0oNlOf8xBoZDE9LAI7nYn6HsBq4l96WHQEaLUpAyiOaASeAM2NgvuPBpaACt82IEYtfKls0UagecpwXyAzqGTRdaA57sjmYrAptAjUsCkGYlYMg9EFyLQI1IiZB8Ti6Obh5JNh0QmgHlOcBuKSIMGi50C18UDMiMssvOJEWPQLqKYbiHnxGkRIkoBF24DyaoTMIEoeh0W3geI+RBlArCI0iz4D+RVAzEasfqLVAQ19AcSg5LoYiKWI1kiiQgCMBLnEEcfDSgAAAABJRU5ErkJggg==")}.taro-video-control-button.taro-video-control-button-pause::after{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAgCAYAAAAffCjxAAAAAXNSR0IArs4c6QAAAFlJREFUSA3tksEKACAIQ7X//5zq98wOgQayum8QaGweHhMzG/6OujzKAymn+0LMqivu1XznWmX8/echTIyMyAgTwA72iIwwAexgj8gIE8CO3aMRbDPMaEy5BRGaKcZv8YxRAAAAAElFTkSuQmCC")}.taro-video-current-time,.taro-video-duration{margin-top:15px;margin-bottom:14.5px;height:14.5px;line-height:14.5px;font-size:12px;color:#cbcbcb}.taro-video-progress-container{position:relative;-ms-flex-positive:2;flex-grow:2;-webkit-box-flex:2}.taro-video-progress{position:relative;margin:21px 12px;height:2px;background-color:rgba(255, 255, 255, 0.4)}.taro-video-progress-buffered{position:absolute;left:0;top:0;width:0;height:100%;background-color:rgba(255, 255, 255, 0.8);-webkit-transition:width 0.1s;transition:width 0.1s}.taro-video-ball{position:absolute;left:0;top:-21px;-webkit-box-sizing:content-box;box-sizing:content-box;margin-left:-22px;padding:14px;width:16px;height:16px}.taro-video-inner{border-radius:50%;width:100%;height:100%;background-color:#fff}.taro-video-danmu-button{margin:0 8.5px;padding:2px 10px;border:1px solid #fff;border-radius:5px;line-height:1;font-size:13px;color:#fff;white-space:nowrap}.taro-video-danmu-button.taro-video-danmu-button-active{border-color:#48c23d;color:#48c23d}.taro-video-fullscreen,.taro-video-mute{-webkit-box-sizing:content-box;box-sizing:content-box;padding:8.5px;width:17px;height:17px;background-repeat:no-repeat;background-position:50% 50%;background-size:50%}.taro-video-fullscreen{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAhUlEQVRYR+2WSwrAMAhEnZO3PfmULLooGEFTiIXJ2s/kRY2wzQeb85sE9CRA8jSzY1YfAFzhJBnU1AVgxH2dSiArCnD9QgGzRNnOech48SRABHoSyFb5in3PSbhyo6yvCPQkEM3u7BsPe/0FIvBfAh/vhKmVbO9SWun1qk/PSVi9TcVPBG6R1YIhgWwNpQAAAABJRU5ErkJggg==")}.taro-video-fullscreen.taro-video-type-fullscreen{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+2Xu0pDURBF1/ZLxNcHKNiIlfhA7C0UBSEE8RNEBNFPUEQEEbGxFiSSSrCwEHsf5E/ccsSUuWfUhKQ40947+y42Z8+ZK/pcinzf9hhwD1xJ2q/qsb0JHAOzkl5y+lGAGnCWICQtZgAS6DxQk3TeLYA6cAo0JSXxjmW7CcwBdUkJurKiDhSA4kBvHbA9CqwBQx2O7BSw8ssU3ALPFRF4knT3nQLbr8B4LjLBOdAAFgJaLUkjbYC9n+zm+i4kXWbmwCqwnRMCHiXthuZAQOzPrxSA4kBxYDAcsH0EzATCfCLpJjOINoCtgFZabg7bk7AFDAeaGpKWgitZTu5N0kQbYBmYrujo9mX0CVxL+gidAdu9vY5zXhWA4sAgOND3X7NJ4AHYCaxkB8B62gslvecSFpoDOZH/PP8Cnt7hIaM5xCEAAAAASUVORK5CYII=")}.taro-video-mute{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAGAGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTktMDQtMTFUMTA6MTg6MjArMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjIyKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjIyKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk3YmE4Yjg0LTFhNTYtNGM1MS04NDVkLTNiZmYyMGI0ZDc0ZiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjg1NGQ3MjlkLWUwNjctZjU0OC1hMTlhLTBlZjQ4OGRkYjJiOSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjA1ODY3ZDFlLWQ3NGEtNDgyNC04MDU3LTYzYmRmMTdjODk5ZSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDU4NjdkMWUtZDc0YS00ODI0LTgwNTctNjNiZGYxN2M4OTllIiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjE4OjIwKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OTdiYThiODQtMWE1Ni00YzUxLTg0NWQtM2JmZjIwYjRkNzRmIiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjIyOjIyKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz459+FoAAABqElEQVRYhc2XPWsVQRSGnxPjF4oGRfxoRQKGWCU2Ft7CykrQWosEyf/If0hhIPgHDEmbNJZqCFxiQEgTUGxsBUVEHgvnyrjZZJO92V1fGIaZnTPvszPszNlQ6VIjnbr/DwCoDLMNak/dUVfUK0f2rQugnlcX/FevWgFQH6gf3autRgHUC+piiXHzAOmtPx9gXgug8itQx9SXwDpw47AGKXZWvXvQmNFCwE3gCXA2dY0Az4GrRzHONA9cU/vAbERsllEOyh31e8USV2mrMPdG9uyn+rDom2/BHHCm5puWKiKmgdtAnz+rvaxO5mNygEvHaZ5BfADuARvAaWBpP4DGFBHfgBngFzClTrUKkCDeA+9S837rAEnbqb7VFcCpVJ/oCmCw959aB1AfAROpudYqgDoOLKRmPyLelAF8bcD4pPoMeAtcB34AT4uDBqXXwFG8XXUU/72MIuK1OgE8Bs6l7mEvo8up7lN1Ge0n9aK6VHMFZvJTr9S3CiALaCQhqZOSvegMIAvu2UVSWpigLC1fbQ0gm6in7qpfLCQbhwGIYcyPQ53/G3YO8BtUtd35bvKcVwAAAABJRU5ErkJggg==")}.taro-video-mute.taro-video-type-mute{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAYAAAB3j6rJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGAGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTktMDQtMTFUMTA6MTk6MDMrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjMzKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTA0LTExVDEwOjIyOjMzKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzYjJmNjE2LTZmZTUtNDJjNC1iNTgwLTczNzZjZjI2NzdmNSIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjYzZjQ2NTYzLWE0ZjktOGQ0Mi1hM2FhLTY3ODJhNDBhYWNjMSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjIyYWNjMWFlLTg4ZmMtNDBlZi1iMWM1LTNmODgwY2QzYWI2MiI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjJhY2MxYWUtODhmYy00MGVmLWIxYzUtM2Y4ODBjZDNhYjYyIiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjE5OjAzKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MDNiMmY2MTYtNmZlNS00MmM0LWI1ODAtNzM3NmNmMjY3N2Y1IiBzdEV2dDp3aGVuPSIyMDE5LTA0LTExVDEwOjIyOjMzKzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5PmxYVAAACLklEQVRYhc2XP2sVQRRHz40hKoqaQgVBCy1EozFlGiVFxMLGh4piYWEh+hkEP4YKAVFEEFTyughaCH6DqIVpAhYWEgIxoJE8cywyi5tNHu/tJmvyg2WZO3dmzt47/zZUtoJ6Nhsg09YDiYhKDzACTAFNYH9lEpUq80TdrT5wpV5n/ZV9KoGoo+pXV2uyKkipOaLuUceAt8DhUvQd1FsCYhR4ChzaSIBMHSOi7lOfsByFWiCgEBH1GHAF2JlMPcBt4GC3HUYEaj9wF3gVEVPtfNVTwAXgWX7CDKq/1piAZTSZBmim8qJ6sQ3EgDqb/L7kU3MH2NHtl3dQX3r3Ak21UYAYAj4A/cl0JB+RF+uMRj4iQ+p8zt7KYFLdXKHuRi0gacBhV6a6pd5bA6KRNagFJPU9qv5u47toLmW1HnoR8Q5oAK1CVQu4FBHj/wUkaXsb+4pzpVaQFPqXrN7Be4Fx9VztIOr1BLEtmX4A94E/qdwHTKjDWYM6lu81dSlnn3V570BtuLxaMs2rZ/IgYxsBovaoPwsQA4VoFWEm8ql5DiysNyURsQTMpOIMcDYiPhd8xoGr/FtNC2G6FKXD6ihwGdiVHMoeeh8jYlA9ANwE3kTEp3bO6vE03qOONzR1r/q4RGrquaFFxFxE3ALOA9+6jExpdb180y55AhirhaRTatq0GXEzL8+ZIuI9cBJ4WKiartJf9nWV/mty7UfUafW7erpqRGI9EBuprffvu9n6C1KOmsqwI5A1AAAAAElFTkSuQmCC")}.taro-video-danmu{overflow:visible;position:absolute;left:0;top:0;bottom:0;margin-top:14px;margin-bottom:44px;width:100%;line-height:14px;font-size:14px}.taro-video-danmu-item{position:absolute;left:100%;line-height:1;color:#fff;white-space:nowrap;-webkit-transform:translateX(0);transform:translateX(0);-webkit-transition-property:left, -webkit-transform;transition-property:left, -webkit-transform;transition-property:left, transform;transition-property:left, transform, -webkit-transform;-webkit-transition-duration:3s;transition-duration:3s;-webkit-transition-timing-function:linear;transition-timing-function:linear}.taro-video-toast{display:block;visibility:hidden;position:absolute;left:50%;top:50%;border-radius:5px;background-color:rgba(255, 255, 255, 0.8);pointer-events:none;color:#000;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%)}.taro-video-toast.taro-video-toast-volume{display:block;width:100px;height:100px}.taro-video-toast-volume .taro-video-toast-title{display:block;margin-top:10px;width:100%;line-height:16px;text-align:center;font-size:12px}.taro-video-toast-volume .taro-video-toast-icon{display:block;margin-left:25%;width:50%;height:50%;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAFhklEQVR4Xu2aeaxfQxTHP1VBES0NIQitWtpaaxeCUkQtaYVa0tiClAq1ExIiQTVppaWxt8RWSa2tWkJQRGgtQaSIpUKEpG0ssbbk28yV2+mZO/e9e3vvu/e98897mZnfzPl+75mZs0wvurn06ub46SGgxwLqZaA3sB/wO/A+8G/V6tS5BU4BJgJbO9DvAMOB36okoQ4CNgAeBEYbQK8Bbm4zAdsBc4EdAyA/APZoKwHHAA8DG2UA/AnYrG0ErAVcD1yXA9gfQJ8c40obsqbPgH7AY8CROTVuFQFD3X7fJid4DWsNAWOAGZ0w58YTsDZwKzChA189PbTRBGwKzAYO6iT4srbAMHfTfAksjulS1iG4JzAH2Dy2YKS/qAVcCdzi1vgZOBZ4PWvNGAG6wgYCW0IwctzNmf06BcEXtYABwOeA4otEfgEOdnGGqV6IAAUopwM6zDYuAVjeKYpYwCjgCWOhH513+b2lhE+Avrj89NPyalzyuCIE6EN9BfQ1dHoPOAD40+9LE6D/5aoqSqtLsgiQC60DTiHzfGCFoaSsQAexZdlTgEuyCDgLuK8u5G7dEAHyKN8CBrtxLwDHAX8Z+l4N3GS0L3db4aN0X5opmc+2XZQAfb2LPd2eciG1lUSRJZ9qYHkZONwiYAjwSc3gs24BXWWWfzEVuMjQez13HljX8v7A28lvEgsInaBVcxLaAvr6sgJLtBWeNTrOB+4w2p8DRvoEnAPcXTVaY70QAbrbXwIONX7zBSAL/tvrk1+iviTllnRry2irr/QSEws4D7izCxMg1XQLLAQGGXpeCkw22kOWI49RMUujCJC+uwAfGtfcImAng4AtAMsBeg04pIkESOfbgQsMsNoGnxrtSrfv7rXrSlwXWN6kLZBgEBiB8iWUUZZPIN/AF1nMoiYSICDfAlt5iB4CxhpAzwXuMtqPBuY1lYB5wFEeqFeAwwyguvIUqvuiQO/xphJwP3Cmhyh0EKrOoGDIF7n+M5pKwEwXrqdBCaQSM77Ig7SSIicDs5pKwIvACA+pzFwZIF9OlKm36QyQV7jEqDDJk5VD58uFgGIGX1Se+6yJFqAKsqI6X84GdDb4Mh0Y5zUqjFYFakUTCXja5QLSmBQHbAL8ahAgT1AeYVreSKLLphGwF/CuAfLJQLldGSTFD75c5d4mNCoWyAqG9gYWGED1AOMKo12ZbiWA/idA++deY2DVTZ0Jh5UJPsFQtD/wDaAHGWl5EzgwaUi2gK4UXS11S0cTIjrMFBtYQdAk4DID0BnAAz4B6wNLgTKKG0VIDBHwqitwpOcW+OOB540FdeipNKbUWFrUtn06o5xOij4KyDuqU0IE3Obl/rLA63pTzm9XA8jKACjdniZAaSKFmUpB1yUhAlTsUEpMh913wEkuTe7rKTzPAHqO44vpKPkFhH3cWWBVV6ogJVYZUgz/tXtIYelzI3Ct0fExIGx6j7iKWBUUveyYBehv1RIjIEsfqziq8Xp4pSBJOYTVJFQcVY3wCFeKUjVGyYfQWB00+5bEVBECrNS+qsOKBpVHNCVWHs+LS7H5PV5pOu9v0+OKEOAXR39w1e1C7wM6AkJ1eLmkRcrpRQiQrqobXO5S3vL3/4kBKMsCknV0k+iasVLUMV3UX5SAPGtED8EOT+L9YENnCasUIXNO2goChFWHqAIRyxXN4qI1BCQg9dJESYq8LnbrCBAR8t50Lig6i0krCRBoVWhVlt45wkBrCRBuRZyPuAguxIPe9lXqhpd9DcZMXOvdkPF0Xu/8dohNUmZ/1QQkuitXr+d4fryuFx3jywQYm6suAqSX8vLTXKJDt4QqO6rtLYspXWZ/nQQkOJTAUJZGIav19q9MvKvN1RUIWKMAY5P3EBBjqO393d4C/gMVHwRQlpx21QAAAABJRU5ErkJggg==");background-repeat:no-repeat;background-position:50% 50%;background-size:50%;fill:#000}.taro-video-toast-volume .taro-video-toast-value{margin-left:10px;margin-top:5px;width:80px;height:5px}.taro-video-toast-volume .taro-video-toast-value>.taro-video-toast-value-content{overflow:hidden}.taro-video-toast-volume-grids{width:80px;height:5px}.taro-video-toast-volume-grids-item{float:left;width:7.1px;height:5px;background-color:#000}.taro-video-toast-volume-grids-item:not(:first-child){margin-left:1px}.taro-video-toast.taro-video-toast-progress{padding:6px;background-color:rgba(0, 0, 0, 0.8);line-height:18px;font-size:14px;color:#fff}';var __awaiter=function(R,C,I,w){function a(R){return R instanceof I?R:new I((function(C){C(R)}))}return new(I||(I=M()))((function(I,x){function s(R){try{l(w.next(R))}catch(R){x(R)}}function o(R){try{l(w.throw(R))}catch(R){x(R)}}function l(R){R.done?I(R.value):a(R.value).then(s,o)}l((w=w.apply(R,C||[])).next())}))},yt=function(){function e(R){(0,ot.r)(this,R),this.list=[],this.danmuElList=[],this.currentTime=0,this.enable=!1,this.danmuList=[]}return e.prototype.ensureProperties=function(R){var C=ge()({},R);return"time"in R||(C.time=this.currentTime),C.key=Math.random(),C.bottom=90*Math.random()+5+"%",C},e.prototype.sendDanmu=function(R){return void 0===R&&(R=[]),__awaiter(this,void 0,void 0,(function(){var C,I=this;return __generator(this,(function(w){return Array.isArray(R)?this.list=__spreadArray(__spreadArray([],this.list),ce()(R).call(R,(function(R){return I.ensureProperties(R)}))):(C=R,this.list=__spreadArray(__spreadArray([],this.list),[ge()({},this.ensureProperties(C))])),[2]}))}))},e.prototype.tick=function(R){return __awaiter(this,void 0,void 0,(function(){var C,I,w,x;return __generator(this,(function(_){return this.currentTime=R,this.enable?(C=this.list,I=se()(C).call(C,(function(C){var I=C.time;return R-I<4&&R>I})),w=!1,x=this.danmuList,w=I.length!==x.length||Le()(I).call(I,(function(R){var C=R.key;return Ze()(x).call(x,(function(R){return C!==R.key}))})),w&&(this.danmuList=I),[2]):[2]}))}))},e.prototype.componentDidUpdate=function(){var R=this;requestAnimationFrame((function(){setTimeout((function(){var C,I=Ke()(C=R.danmuElList).call(C,0);ne()(I).call(I,(function(R){R.style.left="0",R.style.webkitTransform="translateX(-100%)",R.style.transform="translateX(-100%)"}))}))}))},e.prototype.render=function(){var R,C=this;return this.enable?(0,ot.h)(ot.H,{"class":"taro-video-danmu"},ce()(R=this.danmuList).call(R,(function(R){var I=R.text,w=R.color,x=R.bottom,_=R.key;return(0,ot.h)("p",{"class":"taro-video-danmu-item","key":_,"style":{"color":w,"bottom":x},"ref":function ref(R){R&&C.danmuElList.push(R)}},I)}))):""},e}()},"42142":function(R,C,I){var w=I(31585);R.exports=w},"95498":function(R,C,I){I(79307);var w=I(45607);R.exports=w("Array").every},"9510":function(R,C,I){I(21710);var w=I(45607);R.exports=w("Array").fill},"35403":function(R,C,I){I(71939);var w=I(45607);R.exports=w("Array").lastIndexOf},"89163":function(R,C,I){I(13025);var w=I(45607);R.exports=w("Array").reduce},"90190":function(R,C,I){I(76193);var w=I(45607);R.exports=w("Array").sort},"57175":function(R,C,I){I(98939),I(46663);var w=I(45607);R.exports=w("Array").values},"74030":function(R,C,I){I(25067),R.exports=I(98576)},"36161":function(R,C,I){var w=I(8902),x=I(95498),_=Array.prototype;R.exports=function(R){var C=R.every;return R===_||w(_,R)&&C===_.every?x:C}},"27731":function(R,C,I){var w=I(8902),x=I(9510),_=Array.prototype;R.exports=function(R){var C=R.fill;return R===_||w(_,R)&&C===_.fill?x:C}},"58769":function(R,C,I){var w=I(8902),x=I(72240),_=RegExp.prototype;R.exports=function(R){return R===_||w(_,R)?x(R):R.flags}},"76144":function(R,C,I){var w=I(8902),x=I(35403),_=Array.prototype;R.exports=function(R){var C=R.lastIndexOf;return R===_||w(_,R)&&C===_.lastIndexOf?x:C}},"49088":function(R,C,I){var w=I(8902),x=I(89163),_=Array.prototype;R.exports=function(R){var C=R.reduce;return R===_||w(_,R)&&C===_.reduce?x:C}},"496":function(R,C,I){var w=I(8902),x=I(90190),_=Array.prototype;R.exports=function(R){var C=R.sort;return R===_||w(_,R)&&C===_.sort?x:C}},"47183":function(R,C,I){I(19495);var w=I(57545);R.exports=w.Number.isFinite},"45078":function(R,C,I){I(39136);var w=I(57545);R.exports=w.Number.isNaN},"58623":function(R,C,I){I(48969),R.exports=9007199254740991},"60632":function(R,C,I){I(89189);var w=I(57545).Object,x=R.exports=function getOwnPropertyDescriptor(R,C){return w.getOwnPropertyDescriptor(R,C)};w.getOwnPropertyDescriptor.sham&&(x.sham=!0)},"12921":function(R,C,I){I(36187);var w=I(57545);R.exports=w.Object.getOwnPropertySymbols},"72240":function(R,C,I){I(11005);var w=I(37018);R.exports=w},"82069":function(R,C,I){I(68671),I(58556),I(46663),I(71367),I(36886);var w=I(89207);R.exports=w.f("toStringTag")},"36516":function(R,C,I){R.exports=I(79987)},"79987":function(R,C,I){I(5363);var w=I(42142);R.exports=w},"62724":function(R,C,I){"use strict";var w=I(71795),x=I(97739),_=I(84104);R.exports=function fill(R){for(var C=w(this),I=_(C),O=arguments.length,F=x(O>1?arguments[1]:void 0,I),P=O>2?arguments[2]:void 0,M=void 0===P?I:x(P,I);M>F;)C[F++]=R;return C}},"59284":function(R,C,I){"use strict";var w=I(86298),x=I(20101),_=I(41941),O=I(84104),F=I(10424),P=Math.min,M=[].lastIndexOf,N=!!M&&1/[1].lastIndexOf(1,-0)<0,B=F("lastIndexOf"),U=N||!B;R.exports=U?function lastIndexOf(R){if(N)return w(M,this,arguments)||0;var C=x(this),I=O(C),F=I-1;for(arguments.length>1&&(F=P(F,_(arguments[1]))),F<0&&(F=I+F);F>=0;F--)if(F in C&&C[F]===R)return F||0;return-1}:M},"13702":function(R,C,I){var w=I(78989).match(/firefox\/(\d+)/i);R.exports=!!w&&+w[1]},"87033":function(R,C,I){var w=I(78989);R.exports=/MSIE|Trident/.test(w)},"12626":function(R,C,I){var w=I(78989).match(/AppleWebKit\/(\d+)\./);R.exports=!!w&&+w[1]},"33572":function(R,C,I){var w=I(98576).isFinite;R.exports=Number.isFinite||function isFinite(R){return"number"==typeof R&&w(R)}},"72202":function(R,C,I){"use strict";var w=I(31138);R.exports=function(){var R=w(this),C="";return R.hasIndices&&(C+="d"),R.global&&(C+="g"),R.ignoreCase&&(C+="i"),R.multiline&&(C+="m"),R.dotAll&&(C+="s"),R.unicode&&(C+="u"),R.unicodeSets&&(C+="v"),R.sticky&&(C+="y"),C}},"37018":function(R,C,I){var w=I(18922),x=I(64500),_=I(8902),O=I(72202),F=RegExp.prototype;R.exports=function(R){var C=R.flags;return void 0!==C||"flags"in F||x(R,"flags")||!_(F,R)?C:w(O,R)}},"79307":function(R,C,I){"use strict";var w=I(93085),x=I(50454).every;w({"target":"Array","proto":!0,"forced":!I(10424)("every")},{"every":function every(R){return x(this,R,arguments.length>1?arguments[1]:void 0)}})},"21710":function(R,C,I){var w=I(93085),x=I(62724),_=I(67423);w({"target":"Array","proto":!0},{"fill":x}),_("fill")},"71939":function(R,C,I){var w=I(93085),x=I(59284);w({"target":"Array","proto":!0,"forced":x!==[].lastIndexOf},{"lastIndexOf":x})},"13025":function(R,C,I){"use strict";var w=I(93085),x=I(90264).left,_=I(10424),O=I(14218),F=I(58189);w({"target":"Array","proto":!0,"forced":!_("reduce")||!F&&O>79&&O<83},{"reduce":function reduce(R){var C=arguments.length;return x(this,R,C,C>1?arguments[1]:void 0)}})},"76193":function(R,C,I){"use strict";var w=I(93085),x=I(84120),_=I(66235),O=I(71795),F=I(84104),P=I(29970),M=I(44845),N=I(76192),B=I(6614),U=I(10424),G=I(13702),j=I(87033),K=I(14218),H=I(12626),V=[],W=x(V.sort),Y=x(V.push),z=N((function(){V.sort(void 0)})),X=N((function(){V.sort(null)})),q=U("sort"),Z=!N((function(){if(K)return K<70;if(!(G&&G>3)){if(j)return!0;if(H)return H<603;var R,C,I,w,x="";for(R=65;R<76;R++){switch(C=String.fromCharCode(R),R){case 66:case 69:case 70:case 72:I=3;break;case 68:case 71:I=4;break;default:I=2}for(w=0;w<47;w++)V.push({"k":C+w,"v":I})}for(V.sort((function(R,C){return C.v-R.v})),w=0;w<V.length;w++)C=V[w].k.charAt(0),x.charAt(x.length-1)!==C&&(x+=C);return"DGBEFHACIJK"!==x}}));w({"target":"Array","proto":!0,"forced":z||!X||!q||!Z},{"sort":function sort(R){void 0!==R&&_(R);var C=O(this);if(Z)return void 0===R?W(C):W(C,R);var I,w,x=[],N=F(C);for(w=0;w<N;w++)w in C&&Y(x,C[w]);for(B(x,function(R){return function(C,I){return void 0===I?-1:void 0===C?1:void 0!==R?+R(C,I)||0:M(C)>M(I)?1:-1}}(R)),I=x.length,w=0;w<I;)C[w]=x[w++];for(;w<N;)P(C,w++);return C}})},"25067":function(R,C,I){I(93085)({"global":!0},{"globalThis":I(98576)})},"19495":function(R,C,I){I(93085)({"target":"Number","stat":!0},{"isFinite":I(33572)})},"39136":function(R,C,I){I(93085)({"target":"Number","stat":!0},{"isNaN":function isNaN(R){return R!=R}})},"48969":function(R,C,I){I(93085)({"target":"Number","stat":!0,"nonConfigurable":!0,"nonWritable":!0},{"MAX_SAFE_INTEGER":9007199254740991})},"89189":function(R,C,I){var w=I(93085),x=I(76192),_=I(20101),O=I(5141).f,F=I(50069),P=x((function(){O(1)}));w({"target":"Object","stat":!0,"forced":!F||P,"sham":!F},{"getOwnPropertyDescriptor":function getOwnPropertyDescriptor(R,C){return O(_(R),C)}})},"11005":function(){},"5363":function(R,C,I){I(25067)},"73124":function(R,C,I){var w=I(57175);R.exports=w},"31585":function(R,C,I){var w=I(74030);R.exports=w},"38313":function(R,C,I){var w=I(36161);R.exports=w},"97178":function(R,C,I){var w=I(27731);R.exports=w},"86126":function(R,C,I){var w=I(58769);R.exports=w},"4380":function(R,C,I){var w=I(76144);R.exports=w},"87760":function(R,C,I){var w=I(49088);R.exports=w},"44612":function(R,C,I){var w=I(496);R.exports=w},"10986":function(R,C,I){I(80162);var w=I(4696),x=I(64500),_=I(8902),O=I(73124),F=Array.prototype,P={"DOMTokenList":!0,"NodeList":!0};R.exports=function(R){var C=R.values;return R===F||_(F,R)&&C===F.values||x(P,w(R))?O:C}},"60962":function(R,C,I){var w=I(47183);R.exports=w},"24169":function(R,C,I){var w=I(45078);R.exports=w},"90968":function(R,C,I){var w=I(58623);R.exports=w},"74194":function(R,C,I){var w=I(60632);R.exports=w},"60002":function(R,C,I){var w=I(12921);R.exports=w},"95679":function(R,C,I){var w=I(82069);R.exports=w},"48621":function(R,C,I){R.exports=I(53822)},"29413":function(R,C,I){R.exports=I(38313)},"39805":function(R,C,I){R.exports=I(97178)},"52271":function(R,C,I){R.exports=I(86126)},"10262":function(R,C,I){R.exports=I(4380)},"25431":function(R,C,I){R.exports=I(87760)},"91375":function(R,C,I){R.exports=I(44612)},"49599":function(R,C,I){R.exports=I(10986)},"3676":function(R,C,I){R.exports=I(60962)},"81080":function(R,C,I){R.exports=I(24169)},"35451":function(R,C,I){R.exports=I(90968)},"9353":function(R,C,I){R.exports=I(74194)},"47834":function(R,C,I){R.exports=I(60002)},"52015":function(R,C,I){R.exports=I(28980)},"86227":function(R,C,I){R.exports=I(95679)},"1858":function(R,C,I){R.exports=I(36516)}}]);